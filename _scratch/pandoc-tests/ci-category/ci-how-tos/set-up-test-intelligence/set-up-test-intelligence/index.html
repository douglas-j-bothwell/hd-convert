<p></p><p>Test Intelligence (TI) dramatically improves test time by running only those tests required to confirm the quality of the code changes which triggered the build. You can enable Test Intelligence for your build in your CI stages using the Run Tests steps.</p><p>In this topic, we&#39;ll cover how to set up Test Intelligence in Harness CI Stage.</p><h3>Before You Begin</h3><ul><li><a href="https://newdocs.helpdocs.io/article/vtu9k1dsfa">Test Intelligence Overview</a></li><li><a href="https://ngdocs.harness.io/article/x0d77ktjw8-ci-pipeline-quickstart">CI Pipeline Quickstart</a></li></ul><h3>Limitations</h3><p>Test Intelligence is supported for Java and .NET Core codebases only at this time.</p><div class="note-callout">Currently, Test Intelligence for .NET is behind the Feature Flag <code>TI_DOTNET</code>. Contact <a href="mailto:support@harness.io" target="_blank">Harness Support</a> to enable the feature.</div><h3>Step 1: Create the CI Stage</h3><p>In your Harness Pipeline, click <strong>Add Stage</strong>, and then click Build.</p><h3>Step 2: Add the Codebase</h3><p>Do one of the following:</p><ul><li>If this is the first CI stage in the Pipeline, in the Build stage settings, enable <strong>Clone Codebase</strong>.</li><li>If you have an existing Pipeline with a Build stage, click <strong>Codebase</strong> to configure your codebase settings<strong>.</strong></li></ul><p>See <a href="https://ngdocs.harness.io/article/ota4xj59le-run-a-script-in-a-ci-stage">Edit Codebase Configuration</a>.</p><h3>Step 3: Define the Build Farm Infrastructure</h3><p>In the Build stage <strong>Infrastructure</strong>, define the build farm for the codebase. See <a href="https://ngdocs.harness.io/article/ia5dwx5ya8-set-up-a-kubernetes-cluster-build-infrastructure">Kubernetes Cluster Build Infrastructure Setup</a>.</p><h3>Step 4: Configure a Run Tests Stage</h3><p>In the Build stage <strong>Execution</strong>, click <strong>Add step</strong> and then click <strong>Run Tests</strong>.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/428cs02e6u/1630483471027/oor-iqwasmvig-ca-y-y-tfgh-df-chx-g-v-umrgwvlg-rpktal-mcjb-svfqryqnt-fo-ctw-4-tw-cpy-5-zn-k-2-5-w-dhc-a-7-kze-dhl-6-an-f-0-v-ipf-jad-bi-qugv-61-xgq-yvi-0-jm-bevxxjn-xwmsicwz-2-m-s-0" style="max-height:50%;max-width:50%;display:block;margin-left:0;margin-right:auto" data-hd-height="50%" data-hd-width="50%" data-hd-align="left"/></figure><p></p><p>The <strong>Run Tests</strong> step executes one or more commands on a container image.</p><p>The following screenshot explains the various parameters of <strong>Configure Run Tests Step</strong>. See <a href="https://ngdocs.harness.io/article/axzckflbt2">Run Test Step Settings</a> for details about specific settings.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/428cs02e6u/1632153021466/image.png" style="max-height:50%;max-width:50%;display:block;margin-left:0;margin-right:auto" data-hd-height="50%" data-hd-width="50%" data-hd-align="left"/></figure><p></p><table><tbody><tr><td><p><strong>Name</strong></p></td><td><p>Enter a unique name for the step.</p></td></tr><tr><td><p><strong>Description</strong></p></td><td><p>Enter a description for the step.</p></td></tr><tr><td><p><strong>Container Registry</strong></p></td><td><p>The Harness connector for a container registry. This is the container registry for the image Harness will use run build command on, such as Docker Hub.</p></td></tr><tr><td><p><strong>Image</strong></p></td><td><p>The name of the Docker image to use for running the build commands. Enter a Fully Qualified Image Name(FQIN) when using a private container registry.</p></td></tr><tr><td><p><strong>Arguments</strong></p></td><td><p>Enter the <a href="https://docs.harness.io/article/axzckflbt2#arguments_java" target="_blank">arguments</a> for the build tool. These are used as input for the build tool choice.</p></td></tr><tr><td><p><strong>Build Tool</strong></p></td><td><p>Enter the build automation tool. Currently, Harness supports the following:</p><ul><li><strong>Java:</strong> <a href="https://bazel.build/">Bazel</a>, <a href="https://maven.apache.org/">Maven</a>, and <a href="https://gradle.org/">Gradle</a>.</li><li><strong>.NET:</strong> .<a href="https://docs.microsoft.com/en-us/dotnet/core/tools/" target="_blank">NET CLI</a> and <a href="https://nunit.org/" target="_blank">Nunit</a>.</li></ul></td></tr><tr><td><p><strong>Language</strong></p></td><td><p>Select the source code language to build, such as Java or C#.</p></td></tr><tr><td><p><strong>Namespaces</strong></p></td><td><p>(<em>C# only</em>) A comma-separated list of the Namespace prefixes that you want to test.</p></td></tr><tr><td><p><strong>Packages</strong></p></td><td><p>List of source code package prefixes supported by a comma. For example <code>com.company.</code>, <code>io.company.</code>, migrations.</p></td></tr><tr><td><p><strong>Test Annotations</strong></p></td><td><p>Enter the list of test annotations used in unit testing, separated by commas. Any method annotated with this will be treated as a test method. The defaults are: <code>org.junit.Test</code>, <code>org.junit.jupiter.api.Test</code>, <code>org.testng.annotations.Test</code></p></td></tr></tbody></table><h3>Step 5: Perform the Bootstrap</h3><p>Bootstrapping helps generate the initial call graph for Test Intelligence. Once the call graph is generated, TI can perform Test Selection. Perform the bootstrap in the following steps:</p><p>Configure the Webhook.</p><p>You can trigger Pipelines in response to Git events automatically. For configuring the webhook for the Trigger, see <a href="https://ngdocs.harness.io/article/hndnde8usz-triggering-pipelines#step_1_add_a_trigger_to_a_pipeline">Add a Trigger</a>. </p><p>Open the PR.</p><div class="note-callout">Note: This PR should trigger all the tests (pom.xml, non-Java, etc.)</div><p>Merge the PR.</p><h3>Step 6: View the Test Report</h3><p>Once the Pipeline is executed, click <strong>Tests</strong>. <strong>Tests</strong> shows the test report of the test you configured and ran. Harness publishes test results in JUnit format. </p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/428cs02e6u/1630602513018/ti-desc.png" style="max-height:100%;max-width:80%;display:block;margin-left:0;margin-right:auto" data-hd-height="100%" data-hd-width="80%" data-hd-align="left"/></figure><h4>Test Execution Overview</h4><p>Displays the overview of Total Test, Tests Selected, Duration of the Selected Tests, and Time Saved.</p><h4>Test Execution Result</h4><p>Displays the graphical representation of the successful and failed tests.</p><h4>Test Selection Breakdown</h4><p>Displays the selection of Tests on the following metrics: changed code, changed tests, and new tests.</p><h4>Test Execution</h4><p>Displays the detailed list of all tests: class methods and test methods.</p><h4>Call Graph</h4><p>A call graph is generated once the bootstrap is completed. In each later run, the test tab will display stats corresponding to the selection. </p><h4>Visualization </h4><p>Visualization shows why a specific test was selected and the reason behind every test selection. Click on any test (the purple node), and you can see all the classes and methods covered by this test. These are the changed classes and methods (denoted by the blue nodes), which led to the selection of that test.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/428cs02e6u/1630483756690/jxm-583-sm-sm-0-y-rd-4-eaw-ymxy-ow-yvy-1-f-fco-zd-oi-qycfhief-j-9-mqlylfiou-4-h-8-ee-eylo-2-vp-zgr-g-2-qc-axm-98-iwk-c-0-ys-p-4-ku-iwlk-1-t-yj-5-d-bxt-v-5-a-8-x-mg-8-x-u-9-wh-1-rpkk-scv-so-7-e-qs-0-tg-s-0" style="max-height:80%;max-width:70%;display:block;margin-left:0;margin-right:auto" data-hd-height="80%" data-hd-width="70%" data-hd-align="left"/></figure><h3>Optional: YAML Configure As Code</h3><p>Here&#39;s a working example of Test Intelligence on the open-source project Dubbo. Use this YAML template to create and configure the TI pipeline on the go.</p><pre class="hljs yaml">pipeline:<br/>    name: ti-dubbo<br/>    identifier: tidubbo<br/>    properties:<br/>        ci:<br/>            codebase:<br/>                connectorRef: account.howdi<br/>                repoName: dubbo<br/>                build: &lt;+input&gt;<br/>    stages:<br/>        - stage:<br/>              name: unit-test<br/>              identifier: unitteststi<br/>              type: CI<br/>              spec:<br/>                  cloneCodebase: true<br/>                  execution:<br/>                      steps:<br/>                          - step:<br/>                                type: RunTests<br/>                                name: runTestsWithIntelligence<br/>                                identifier: runTestsWithIntelligence<br/>                                spec:<br/>                                    connectorRef: account.GCR<br/>                                    image: maven:3-openjdk-8<br/>                                    args: test -Dmaven.test.failure.ignore=true -DfailIfNoTests=false<br/>                                    buildTool: Maven<br/>                                    language: Java<br/>                                    packages: org.apache.dubbo,com.alibaba.dubbo<br/>                                    runOnlySelectedTests: true<br/>                                    reports:<br/>                                        type: JUnit<br/>                                        spec:<br/>                                            paths:<br/>                                                - &#34;**/*.xml&#34;<br/>                                    resources:<br/>                                        limits:<br/>                                            memory: 2Gi<br/>                                            cpu: 2000m<br/>                                timeout: 60m<br/>                  serviceDependencies: []<br/>                  infrastructure:<br/>                      type: KubernetesDirect<br/>                      spec:<br/>                          connectorRef: Kubernetes_Quickstart<br/>                          namespace: harness-delegate<br/>              variables: []<br/>    projectIdentifier: CD_Examples<br/>    orgIdentifier: default<br/>    description: TI for open source project dubbo<br/>    tags: {}</pre><h3>See Also</h3><ul><li><a href="https://ngdocs.harness.io/article/vtu9k1dsfa">Test Intelligence Concepts</a></li><li><a href="https://ngdocs.harness.io/article/sof7n3qjap-viewing-tests">View Test Report</a></li></ul><p></p>