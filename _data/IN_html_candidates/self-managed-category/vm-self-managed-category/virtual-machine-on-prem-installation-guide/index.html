<p></p><table class="borderless" style="margin-top:-0.5em"><tbody><tr><td style="padding-left:0 !important"><p>This topic covers installing Harness Self-Managed Enterprise Edition - Virtual Machine <strong>NextGen</strong> as a Kubernetes cluster embedded on your target VMs.</p><p>To install Harness Self-Managed Enterprise Edition Virtual Machine <strong>NextGen</strong>, first you install Harness Self-Managed Enterprise Edition Virtual Machine <strong>FirstGen</strong> and then you install NextGen as an application.</p><p>Installing Harness Self-Managed Enterprise Edition into an embedded Kubernetes cluster is a simple process where you prepare your VMs and network, and use the Kubernetes installer kURL and the KOTS plugin to complete the installation and deploy Harness.</p><p>Once you have set up Harness on a VM, you can add additional worker nodes by simply running a command.</p><div class="tip-callout">Harness Self-Managed Enterprise Edition uses the open source Kubernetes installer kURL and the KOTS plugin for installation. See <a href="https://kurl.sh/docs/install-with-kurl/" target="_blank">Install with kURL</a> from kURL and <a href="https://kots.io/kotsadm/installing/installing-embedded-cluster/" target="_blank">Installing an Embedded Cluster</a> from KOTS.</div></td><td><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/kgvg58wg1g/1602544109582/image.png"/></figure></td></tr></tbody></table><p></p><h3>Harness Self-Managed Enterprise Edition NextGenInstallation Options</h3><p>How you install Harness Self-Managed Enterprise Edition NextGen will follow one of the use cases below:</p><h4>NextGen on Existing FirstGen VMs</h4><p>In this scenario, you have an existing Harness Self-Managed Enterprise Edition FirstGen running and you want to add Harness NextGen to it.</p><p>You simply add Harness Self-Managed Enterprise Edition NextGen as a new application in your existing Harness Self-Managed Enterprise Edition FirstGen installation.</p><ol><li>Open the FirstGen KOTS admin tool.</li><li>Install NextGen as a new application on existing FirstGen.</li><li>Upload the NextGen license file.</li><li>Use the exact same FirstGen configuration values for the NextGen configuration.</li></ol><p>If you are using this option, skip to <a href="#install_next_gen_on_existing_first_gen">Install NextGen on Existing FirstGen</a>.</p><h4>NextGen on New FirstGen VMs</h4><p>In this scenario, you want to install FirstGen and NextGen on new VMs.</p><ol><li>Set up your VMs according to the requirements specified in <a href="/article/emup5gv8f4-virtual-machine-on-prem-infrastructure-requirements">Self-Managed Enterprise Edition - Virtual Machine: Infrastructure Requirements</a>.</li><li>Install FirstGen.</li><li>Install NextGen as a new application on existing FirstGen.</li><li>Upload the NextGen license file.</li><li>Use the exact same FirstGen configuration values for the NextGen configuration.</li></ol><p>If you are using this option, do the following:</p><ol><li>Follow all of the FirstGen installation instructions beginning with <a href="#step_1_set_up_vm_requirements">Step 1: Set up VM Requirements</a>.</li><li>Follow the NextGen installation instructions in <a href="#install_next_gen_on_existing_first_gen">Install NextGen on Existing FirstGen</a>.</li></ol><h4>Legacy FirstGen not Using KOTS</h4><p>In this scenario, you have a legacy FirstGen installation that is not a KOTS-based installation.</p><p>This process will involve migrating your legacy FirstGen data to a new KOTS-based FirstGen and then installing NextGen.</p><ol><li>Set up your VMs according to the requirements specified in <a href="/article/emup5gv8f4-virtual-machine-on-prem-infrastructure-requirements">Self-Managed Enterprise Edition - Virtual Machine: Infrastructure Requirements</a>.</li><li>Install FirstGen.</li><li>Migrate data to new FirstGen using a script from Harness Support.</li><li>Install NextGen as a new application on the new FirstGen.</li><li>Upload the NextGen license file.</li><li>Use the exact same FirstGen configuration values for the NextGen configuration.</li></ol><p>If you are using this option, do the following:</p><ol><li>Follow all of the FirstGen installation instructions beginning with <a href="#step_1_set_up_vm_requirements">Step 1: Set up VM Requirements</a>.</li><li>Migrate data to new FirstGen using a script from Harness Support.</li><li>Follow the NextGen installation instructions in <a href="#install_next_gen_on_existing_first_gen">Install NextGen on Existing FirstGen</a>.</li></ol><h3>Step 1: Set up VM Requirements</h3><p>Ensure that your VMs meet the requirements specified in <a href="/article/emup5gv8f4-virtual-machine-on-prem-infrastructure-requirements">Self-Managed Enterprise Edition - Virtual Machine: Infrastructure Requirements</a>.</p><p>Different cloud platforms use different methods for grouping VMs (GCP instance groups, AWS target groups, etc). Set up your 3 VMs using the platform method that works best with the platform&#39;s networking processes.</p><h3>Step 2: Set Up Load Balancer and Networking Requirements</h3><p>Ensure that your networking meets the requirements specified in <a href="/article/emup5gv8f4-virtual-machine-on-prem-infrastructure-requirements">Self-Managed Enterprise Edition - Virtual Machine: Infrastructure Requirements</a>.</p><p>You will need to have two load balancers, as described in the <a href="/article/emup5gv8f4-virtual-machine-on-prem-infrastructure-requirements">Self-Managed Enterprise Edition - Virtual Machine: Infrastructure Requirements</a>.</p><p>One for routing traffic to the VMs and one for the in-cluster load balancer.</p><p>During installation, you are asked for the IP address of the in-cluster TCP load balancer first.</p><p>When you configure the Harness Self-Managed Enterprise Edition application in the KOTS admin console, you are asked for the HTTP load balancer URL.</p><h3>Option 1: Disconnected Installation</h3><p>Disconnected Installation involves downloading the Self-Managed Enterprise Edition - Virtual Machine archive file onto a jump box, and then copying and the file to each host VM you want to use.</p><p>One each VM, you extract and install Harness.</p><p>On your jump box, run the following command to obtain the Self-Managed Enterprise Edition - Virtual Machine file:</p><pre>curl -LO https://kurl.sh/bundle/harness.tar.gz</pre><p>Copy the file to a Harness host and extract it (<code>tar xvf harness.tar.gz</code>).</p><p>On the VM, install Harness:</p><pre>cat install.sh | sudo bash -s airgap ha</pre><p>This will install the entire Self-Managed Enterprise Edition Kubernetes cluster and all related microservices.</p><p>The <code>ha</code> parameter is used to set up high availability. If you are not using high availability, you can omit the parameter.</p><h4>Provide Load Balancer Settings</h4><p>First, you are prompted to provide the IP address of the TCP Load Balancer for the cluster HA:</p><pre>The installer will use network interface &#39;ens4&#39; (with IP address &#39;10.128.0.25&#39;)<br/>Please enter a load balancer address to route external and internal traffic to the API servers.<br/>In the absence of a load balancer address, all traffic will be routed to the first master.<br/>Load balancer address:</pre><p></p><p>This is the TCP load balancer you created in <a href="/article/emup5gv8f4-virtual-machine-on-prem-infrastructure-requirements">Self-Managed Enterprise Edition - Virtual Machine: Infrastructure Requirements</a>.</p><p>For example, here is a GCP TCP load balancer with its frontend forwarding rule using port 6443:</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/yo2jldlq45/1594938385189/image.png"/></figure><p></p><p>Enter the IP address and port of your TCP load balancer (for example, <code>10.128.0.50:6443</code>), and press Enter. The installation process will continue. The installation process begins like this:</p><pre>...<br/>Fetching weave-2.5.2.tar.gz<br/>Fetching rook-1.0.4.tar.gz<br/>Fetching contour-1.0.1.tar.gz<br/>Fetching registry-2.7.1.tar.gz<br/>Fetching prometheus-0.33.0.tar.gz<br/>Fetching kotsadm-1.16.0.tar.gz<br/>Fetching velero-1.2.0.tar.gz<br/>Found pod network: 10.32.0.0/22<br/>Found service network: 10.96.0.0/22<br/>...</pre><p></p><h4>Review Configuration Settings</h4><p>Once the installation process is complete, KOTS provides you with several configuration settings and commands. Save these settings and commands.</p><ul><li>KOTS admin console and password:</li></ul><pre>Kotsadm: http://00.000.000.000:8800<br/>Login with password (will not be shown again): D1rgBIu21</pre><div class="note-callout">If you need to reset your password, enter <code>kubectl kots reset-password -n default</code>. You will be prompted for a new password.</div><ul><li>Prometheus, Grafana, and Alertmanager ports and passwords:</li></ul><pre>The UIs of Prometheus, Grafana and Alertmanager have been exposed on NodePorts 30900, 30902 and 30903 respectively.<br/>To access Grafana use the generated user:password of admin:RF1KuqreN .</pre><ul><li>kubectl access to your cluster:</li></ul><pre>To access the cluster with kubectl, reload your shell:<br/>    bash -l</pre><ul><li>The command to add worker nodes to the installation:</li></ul><pre>To add worker nodes to this installation, run the following script on your other nodes:<br/><br/>curl -sSL https://kurl.sh/harness/join.sh | sudo bash -s kubernetes-master-address=10.128.0.24:6443 kubeadm-token=xxxxx kubeadm-token-ca-hash=shaxxxxxx kubernetes-version=1.15.3 docker-registry-ip=10.96.3.130</pre><p>We will use this command later.</p><ul><li>Add master nodes:</li></ul><pre>To add MASTER nodes to this installation, run the following script on your other nodes<br/>    curl -sSL https://kurl.sh/harness/join.sh | sudo bash -s kubernetes-master-address=34.71.32.244:6443 kubeadm-to<br/>ken=c2yack.q7lt3z6yuevqlmtf kubeadm-token-ca-hash=sha256:9db504ecdee08ff6dfa3b299ce95302fe53dd632a2e9356c55e9272db7<br/>2d60d1 kubernetes-version=1.15.3 cert-key=f0373e812e0657b4f727e90a7286c5b65539dfe7ee5dc535df0a1bcf74ad5c57 control-<br/>plane docker-registry-ip=10.96.2.100</pre><h4>Log into the Admin Tool</h4><p>In a browser, enter the Kotsadm link.</p><p>The browser displays a TLS warning.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/kgvg58wg1g/1594760318387/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Click <strong>Continue to Setup</strong>.</p><p>In the warning page, click <strong>Advanced</strong>, then click <strong>Proceed</strong> to continue to the admin console.</p><p>As KOTS uses a self-signed certification, but you can upload your own.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/kgvg58wg1g/1594760397701/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Upload your certificate or click <strong>Skip and continue</strong>.</p><p>Log into the console using the password provided in the installation output.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/kgvg58wg1g/1594764251884/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><h4>Upload Your Harness License</h4><p>Once you are logged into the KOTS admin console, you can upload your Harness license.</p><p>Obtain the Harness license file from your Harness Customer Success contact or email <a href="mailto:support@harness.io">support@harness.io</a>.</p><p>Drag your license YAML file into the KOTS admin tool:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593544168266/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Next, upload the license file:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593544350008/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Now that license file is uploaded, you can install Harness.</p><p>Go to <a href="#step_3_configure_harness">Step 3: Configure Harness</a>.</p><h3>Option 2: Connected Installation</h3><p>Once you have your VMs and networking requirements set up, you can install Harness.</p><p>Log into one of your VMs, and then run the following command:</p><pre>curl -sSL https://k8s.kurl.sh/harness | sudo bash -s ha</pre><p>This will install the entireSelf-Managed Enterprise Edition Kubernetes cluster and all related microservices.</p><p>The <code>-s ha</code> parameter is used to set up high availability.</p><h4>Provide Load Balancer Settings</h4><p>First, you are prompted to provide the IP address of the TCP Load Balancer for the cluster HA:</p><pre>The installer will use network interface &#39;ens4&#39; (with IP address &#39;10.128.0.25&#39;)<br/>Please enter a load balancer address to route external and internal traffic to the API servers.<br/>In the absence of a load balancer address, all traffic will be routed to the first master.<br/>Load balancer address:</pre><p></p><p>This is the TCP load balancer you created in <a href="/article/emup5gv8f4-virtual-machine-on-prem-infrastructure-requirements">Self-Managed Enterprise Edition - Virtual Machine: Infrastructure Requirements</a>.</p><p>For example, here is a GCP TCP load balancer with its frontend forwarding rule using port 6443:</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/yo2jldlq45/1594938385189/image.png"/></figure><p></p><p>Enter the IP address and port of your TCP load balancer (for example, <code>10.128.0.50:6443</code>), and press Enter. The installation process will continue. The installation process begins like this:</p><pre>...<br/>Fetching weave-2.5.2.tar.gz<br/>Fetching rook-1.0.4.tar.gz<br/>Fetching contour-1.0.1.tar.gz<br/>Fetching registry-2.7.1.tar.gz<br/>Fetching prometheus-0.33.0.tar.gz<br/>Fetching kotsadm-1.16.0.tar.gz<br/>Fetching velero-1.2.0.tar.gz<br/>Found pod network: 10.32.0.0/22<br/>Found service network: 10.96.0.0/22<br/>...</pre><p></p><h4>Review Configuration Settings</h4><p>Once the installation process is complete, KOTS provides you with several configuration settings and commands. Save these settings and commands.</p><ul><li>KOTS admin console and password:</li></ul><pre>Kotsadm: http://00.000.000.000:8800<br/>Login with password (will not be shown again): D1rgBIu21</pre><div class="note-callout">If you need to reset your password, enter <code>kubectl kots reset-password -n default</code>. You will be prompted for a new password.</div><ul><li>Prometheus, Grafana, and Alertmanager ports and passwords:</li></ul><pre>The UIs of Prometheus, Grafana and Alertmanager have been exposed on NodePorts 30900, 30902 and 30903 respectively.<br/>To access Grafana use the generated user:password of admin:RF1KuqreN .</pre><ul><li>kubectl access to your cluster:</li></ul><pre>To access the cluster with kubectl, reload your shell:<br/>    bash -l</pre><ul><li>The command to add worker nodes to the installation:</li></ul><pre>To add worker nodes to this installation, run the following script on your other nodes:<br/><br/>curl -sSL https://kurl.sh/harness/join.sh | sudo bash -s kubernetes-master-address=10.128.0.24:6443 kubeadm-token=xxxxx kubeadm-token-ca-hash=shaxxxxxx kubernetes-version=1.15.3 docker-registry-ip=10.96.3.130</pre><p>We will use this command later.</p><ul><li>Add master nodes:</li></ul><pre>To add MASTER nodes to this installation, run the following script on your other nodes<br/>    curl -sSL https://kurl.sh/harness/join.sh | sudo bash -s kubernetes-master-address=34.71.32.244:6443 kubeadm-to<br/>ken=c2yack.q7lt3z6yuevqlmtf kubeadm-token-ca-hash=sha256:9db504ecdee08ff6dfa3b299ce95302fe53dd632a2e9356c55e9272db7<br/>2d60d1 kubernetes-version=1.15.3 cert-key=f0373e812e0657b4f727e90a7286c5b65539dfe7ee5dc535df0a1bcf74ad5c57 control-<br/>plane docker-registry-ip=10.96.2.100</pre><h4>Log into the Admin Tool</h4><p>In a browser, enter the Kotsadm link.</p><p>The browser displays a TLS warning.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/kgvg58wg1g/1594760318387/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Click <strong>Continue to Setup</strong>.</p><p>In the warning page, click <strong>Advanced</strong>, then click <strong>Proceed</strong> to continue to the admin console.</p><p>As KOTS uses a self-signed certification, but you can upload your own.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/kgvg58wg1g/1594760397701/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Upload your certificate or click <strong>Skip and continue</strong>.</p><p>Log into the console using the password provided in the installation output.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/kgvg58wg1g/1594764251884/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><h4>Upload Your Harness License</h4><p>Once you are logged into the KOTS admin console, you can upload your Harness license.</p><p>Obtain the Harness license file from your Harness Customer Success contact or email <a href="mailto:support@harness.io">support@harness.io</a>.</p><p>Drag your license YAML file into the KOTS admin tool:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593544168266/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Next, upload the license file:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593544350008/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Now that license file is uploaded, you can install Harness.</p><h4>Download Harness over the Internet</h4><p>If you are installing Harness over the Internet, click the <strong>download Harness from the Internet</strong> link.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593544532503/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><p>KOTS begins installing Harness into your cluster.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593544576040/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Next, you will provide KOTS with the Harness configuration information (Load Balancer URL and NodePort).</p><h3>Step 3: Configure Harness</h3><p>Now that you have added your license you can configure the networking for the Harness installation.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/kgvg58wg1g/1610562791086/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><h4>Mode</h4><ul><li>Select <strong>Demo</strong> to run a Self-Managed Enterprise Edition in demo mode and experiment with it.</li><li>Select <strong>Production - Single Node</strong> to run this on one node. You can convert to Production - High Availability later.</li><li>Select <strong>Production</strong> - <strong>High Availability</strong> to run a production version of Self-Managed Enterprise Edition.</li></ul><p>In you use <strong>Production - Single Node</strong>, you can convert to <strong>Production - High Availability</strong> later by doing the following:</p><ol><li>In the KOTS admin console, go to <strong>Cluster Management</strong>.</li><li>Click <strong>Add a node</strong>. This will generate scripts for joining additional worker and master nodes.</li></ol><div class="note-callout">For Disconnected (Airgap) installations, the bundle must also be downloaded and extracted on the remote node prior to running the join script.</div><h4>NodePort and Application URL</h4><p>Self-Managed Enterprise Edition - Virtual Machine requires that you provide a NodePort and Application URL.</p><ol><li>In <strong>Application URL</strong>, enter the <strong>full URL</strong> for the HTTP load balancer you set up for routing external traffic to your VMs.<br/>Include the scheme and hostname/IP. For example, <code>https://app.example.com</code>.<br/>Typically, this is the frontend IP address for the load balancer. For example, here is an HTTP load balancer in GCP and how you enter its information into <strong>Harness Configuration</strong>.<br/>If you have set up DNS to resolve a domain name to the load balancer IP, enter that domain name in <strong>Application URL</strong>.</li><li>In <strong>NodePort</strong>, enter the port number you set up for load balancer backend: <strong>80</strong>.<figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/tjvawty1do/1626288141192/image.png"/></figure></li><li>When you are done, click <strong>Continue</strong>.</li></ol><h4>Option: Advanced Configurations</h4><p>In the <strong>Advanced Configurations</strong> section, there are a number of advanced settings you can configure. If this is the first time you are setting up Self-Managed Enterprise Edition, there&#39;s no reason to fine tune the installation with these settings.</p><p>You can change the settings later in the KOTS admin console&#39;s Config tab:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593545725176/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><h5>Ingress Service Type</h5><p>By default, nginx is used for Ingress automatically. If you are deploy nginx separately, do the following:</p><ol><li>Click <strong>Advanced Configurations</strong>.</li><li>Disable the <strong>Install Nginx Ingress Controller</strong> option.</li></ol><h5>gRPC and Load Balancer Settings</h5><p>In <strong>Scheme</strong>, if you select HTTPS, the GRPC settings appear.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/d5lptkp5ow/1625082872413/clean-shot-2021-06-30-at-12-54-18.png"/></figure><p><strong>If your load balancer does support HTTP2 over port 443</strong>, enter the following:</p><ul><li><strong>GRPC Target:</strong> enter the load balancer hostname (hostname from the load balancer URL)</li><li><strong>GRPC Authority:</strong> enter <code>manager-grpc-&lt;hostname&gt;</code>. For example: <code>manager-grpc-35.202.197.230</code>.</li></ul><p><strong>If your load balancer does not support HTTP2 over port 443</strong> you have two options:</p><ul><li>If your load balancer supports multiple ports for SSL then add port 9879 in the application load balancer and target port 9879 or node port 32510 on the Ingress controller.<ul><li><strong>GRPC Target:</strong> enter the load balancer hostname</li><li><strong>GRPC Authority:</strong> enter the load balancer hostname</li></ul></li><li>If your load balancer does not support multiple ports for SSL then create a new load balancer and target port 9879 or node port 32510 on the Ingress controller:<ul><li><strong>GRPC Target:</strong> enter the <u>new</u> load balancer hostname</li><li><strong>GRPC Authority:</strong> enter the <u>new</u> load balancer hostname</li></ul></li></ul><h5>Log Service Backend</h5><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/tjvawty1do/1624905186456/clean-shot-2021-06-28-at-11-32-56.png"/></figure><p>There are two options for <strong>Log Service Backend</strong>:</p><p><strong>Minio:</strong> If you want to use the builtin <a href="https://docs.min.io/docs/minio-quickstart-guide.html" target="_blank">Minio</a> log service then your load balancer needs to reach the Ingress controller on port 9000. Create a new load balancer and target port 9000 or node port 32507.</p><p><strong>Amazon S3 Bucket:</strong> Enter the S3 bucket settings to use.</p><h3>Step 4: Perform Preflight Checks</h3><p>Preflight checks run automatically and verify that your setup meets the minimum requirements.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593545769365/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>You can skip these checks, but we recommend you let them run.</p><p>Fix any issues in the preflight steps.</p><h3>Step 5: Deploy Harness</h3><p>When you are finished pre-flight checks, click <strong>Deploy and</strong> <strong>Continue</strong>.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1608066016585/image.png"/></figure><p>Harness is deployed in a few minutes.</p><div class="note-callout">It can take up to 30 minutes when installing the demo version on a system with the minimum recommended specs.</div><p>In a new browser tab, go to the following URL, replacing <code>&lt;LB_URL&gt;</code> with the URL you entered in the <strong>Application URL</strong> setting in the KOTS admin console:</p><p><code>&lt;LB_URL&gt;/auth/#/signup</code></p><p>For example:</p><p><code>http://harness.mycompany.com/auth/#/signup</code></p><p>The Harness sign up page appears.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/kgvg58wg1g/1648592863659/clean-shot-2022-03-29-at-15-27-33.png"/></figure><p>Sign up with a new account and then sign in.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/kgvg58wg1g/1648592928001/clean-shot-2022-03-29-at-15-27-52.png"/></figure><p>Your new account will be added to the Harness Account Administrators User Group.</p><p>See <a href="/article/dfwuvmy33m-add-user-groups">Add and Manage User Groups</a>.</p><h4>Future Versions</h4><p>To set up future versions of Self-Managed Enterprise Edition, in the KOTS admin console, in the <strong>Version history</strong> tab, click <strong>Deploy</strong>. The new version is displayed in Deployed version.</p><p></p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593545900180/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><h3>Step 6: Add Worker Nodes</h3><p>Now that Self-Managed Enterprise Edition is installed in one VM, you can install it on other VMs using the command provided when you installed Harness:</p><pre>To add worker nodes to this installation, run the following script on your other nodes<br/>    curl -sSL https://kurl.sh/harness/join.sh | sudo bash -s kubernetes-master-address=10.128.0.24:6443 kubeadm-token=xxxxx kubeadm-token-ca-hash=shaxxxxxx kubernetes-version=1.15.3 docker-registry-ip=10.96.3.130</pre><p>Run this on each VM in your group. The installation will begins something like this:</p><pre>...<br/>Docker already exists on this machine so no docker install will be performed<br/>Container already exists on this machine so no container install will be performed<br/>The installer will use network interface &#39;ens4&#39; (with IP address &#39;10.128.0.44&#39;)<br/>Loaded image: replicated/kurl-util:v2020.07.15-0<br/>Loaded image: weaveworks/weave-kube:2.5.2<br/>Loaded image: weaveworks/weave-npc:2.5.2<br/>Loaded image: weaveworks/weaveexec:2.5.2<br/>...</pre><p>When installation is complete, you will see the worker join the cluster and preflight checks are performed:</p><pre>⚙  Join Kubernetes node<br/>+ kubeadm join --config /opt/replicated/kubeadm.conf --ignore-preflight-errors=all<br/>[preflight] Running pre-flight checks<br/>validated versions: 19.03.4. Latest<br/> validated version: 18.09</pre><p>The worker is now joined.</p><h3>Important Next Steps</h3><div class="note-callout"><strong>Important:</strong> You cannot invite other users to Harness until a Harness Delegate is installed and a Harness SMTP Collaboration Provider is configured.</div><ol><li>Install the Harness Delegate.</li><li>Set up an SMTP Collaboration Provider in Harness for email notifications from the Harness Manager.<br/>Ensure you open the correct port for your SMTP provider, such as <a href="https://support.office.com/en-us/article/server-settings-you-ll-need-from-your-email-provider-c82de912-adcc-4787-8283-45a1161f3cc3">Office 365</a>.</li><li><a href="/article/bo4qbrcggv-add-secrets-manager">Add a Secrets Manager</a>. By default, Self-Managed Enterprise Edition installations use the local Harness MongoDB for the default Harness Secrets Manager. This is not recommended.<br/>After Self-Managed Enterprise Edition installation, configure a new Secret Manager (Vault, AWS, etc). You will need to open your network for the Secret Manager connection.</li></ol><h3>Updating Harness</h3><div class="note-callout"><strong>Do not upgrade Harness past 4 major releases.</strong> Instead, upgrades each interim release until you upgrade to the latest release. A best practice is to upgrade Harness once a month.</div><p>Please follow these steps to update your Self-Managed Enterprise Edition installation.</p><p>The steps are very similar to how you installed Harness initially.</p><p>For more information, see <a href="https://kots.io/kotsadm/updating/updating-embedded-cluster/" target="_blank">Updating an Embedded Cluster</a> from KOTS.</p><h4>Disconnected (Airgap)</h4><p>The following steps require a private registry, just like the initial installation of Self-Managed Enterprise Edition.</p><h5>Upgrade Harness</h5><ol><li>Download the latest release from Harness.</li><li>Run the following command on the VM(s) hosting Harness, replacing the placeholders:</li></ol><pre>kubectl kots upstream upgrade harness \ <br/>--airgap-bundle &lt;path to harness-&lt;version&gt;.airgap&gt; \ <br/>--kotsadm-namespace harness-kots \ <br/>-n default</pre><h5>Upgrade Embedded Kubernetes Cluster and KOTS</h5><ol><li>Download the latest version of Self-Managed Enterprise Edition:</li></ol><pre>curl -SL -o harnesskurl.tar.gz https://kurl.sh/bundle/harness.tar.gz</pre><ol><li style="counter-increment:li 1" start="2">Move the tar.gz file to the disconnected VMs.</li><li>On each VM, run the following command to update Harness Self-Managed Enterprise Edition:</li></ol><pre>tar xzvf harnesskurl.tar.gz<br/>cat install.sh | sudo bash -s airgap</pre><h4>Connected</h4><p>The following steps require a secure connection to the Internet, just like the initial installation of Harness Self-Managed Enterprise Edition.</p><h5>Upgrade Harness</h5><ol><li>Run the following command on the VMs hosting Harness Self-Managed Enterprise Edition:</li></ol><pre>kubectl kots upstream upgrade harness -n harness</pre><h5>Upgrade Embedded Kubernetes Cluster and KOTS</h5><ol><li>Run the following command on the VMs hosting Harness Self-Managed Enterprise Edition:</li></ol><pre>curl -sSL https://kurl.sh/harness | sudo bash</pre><h3>Monitoring Harness</h3><p>Harness monitoring is performed using the built in monitoring tools.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/kgvg58wg1g/1594857422125/image.png"/></figure><p>When you installed Harness, your were provided with connection information for Prometheus, Grafana, and Alertmanager ports and passwords:</p><pre>The UIs of Prometheus, Grafana and Alertmanager have been exposed on NodePorts 30900, 30902 and 30903 respectively.<br/>To access Grafana use the generated user:password of admin:RF1KuqreN .</pre><p>For steps on using the monitoring tools, see <a href="https://kots.io/kotsadm/monitoring/prometheus/" target="_blank">Prometheus</a> from KOTS.</p><h3>License Expired</h3><p>If your license has expired, you will see something like the following:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593544662234/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Contact your Harness Customer Success representative or <a href="mailto:support@harness.io">support@harness.io</a>.</p><h3>Install NextGen on Existing FirstGen</h3><p>This section assumes you have a Self-Managed Enterprise Edition FirstGen installation set up and running following the step earlier in this guide (beginning with <a href="#step_1_set_up_vm_requirements">Step 1: Set up VM Requirements</a>).</p><p>Now you can add Self-Managed Enterprise Edition NextGen as a new application to your FirstGen installation.</p><ol><li>Log into your Self-Managed Enterprise Edition FirstGen KOTS admin tool.</li><li>Click <strong>Config</strong>.</li><li>Record all of the FirstGen settings. You will need to use these exact same settings when setting up Self-Managed Enterprise Edition NextGen.<br/>If you want to change settings, change them and then record them so you can use them during the NextGen installation.</li><li>Click <strong>Add a new application</strong>.<figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/95mwydgm6w/1623362723690/clean-shot-2021-06-10-at-15-05-08.png"/></figure></li><li>Add the Self-Managed Enterprise Edition NextGen license file you received from Harness Support, and then click <strong>Upload license</strong>.<figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/95mwydgm6w/1623362818008/clean-shot-2021-06-10-at-15-06-51.png"/></figure></li><li>Depending on whether your Self-Managed Enterprise Edition FirstGen installation is Disconnected or Connected, follow the installation steps described here:<ul><li><a href="#option_1_disconnected_installation">Option 1: Disconnected Installation</a></li><li><a href="#option_2_connected_installation">Option 2: Connected Installation</a></li></ul>When you are done, you&#39;ll be on the <strong>Configure HarnessNG</strong> page. This is the standard configuration page you followed when you set up Self-Managed Enterprise Edition FirstGen in <a href="#step_3_configure_harness">Step 3: Configure Harness</a>.</li><li>Enter the <u>exact same configuration options</u> as your FirstGen installation.<br/>Please ensure you include your <strong>Advanced Configuration</strong> settings.<br/>Ensure you use the exact same <strong>Scheme</strong> you used in FirstGen (HTTP or HTTPS).<br/>The <strong>Load Balancer IP Address</strong> setting does not appear because Self-Managed Enterprise Edition NextGen is simply a new application added onto Self-Managed Enterprise Edition FirstGen. NextGen will use the exact same <strong>Load Balancer IP Address</strong> setting by default.</li><li>Click <strong>Continue</strong> at the bottom of the page.<br/>Harness will perform pre-flight checks.</li><li>Click <strong>Continue</strong>.<br/>Harness is deployed in a few minutes.<br/>When Self-Managed Enterprise Edition NextGen is ready, you will see it listed as <strong>Ready</strong>:<figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/95mwydgm6w/1623365943741/clean-shot-2021-06-10-at-15-58-29.png"/></figure></li><li>In a new browser tab, go to the following URL, replacing <code>&lt;LB_URL&gt;</code> with the URL you entered in the <strong>Application URL</strong> setting in the KOTS admin console</li></ol><p><code>&lt;LB_URL&gt;/auth/#/signup</code></p><p>For example:</p><p><code>http://harness.mycompany.com/auth/#/signup</code></p><p>The Harness sign up page appears.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/kgvg58wg1g/1648592863659/clean-shot-2022-03-29-at-15-27-33.png"/></figure><p>Sign up with a new account and then sign in.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/kgvg58wg1g/1648592928001/clean-shot-2022-03-29-at-15-27-52.png"/></figure><p>If you are familiar with Harness, you can skip <a href="/article/hv2758ro4e-learn-harness-key-concepts">Learn Harness&#39; Key Concepts</a>.</p><p>Try the <a href="/article/u8lgzsi7b3-quickstarts">NextGen Quickstarts</a>.</p><p></p><h3>Notes</h3><p>Self-Managed Enterprise Edition installations do not currently support the Harness Helm Delegate.</p><p></p><p></p>