<p>You can monitor your Harness Self-Managed Enterprise Edition installation and receive alerts on metrics such as CPU, memory, and disk usage.</p><h3>Monitoring Overview</h3><p>The Harness Self-Managed Enterprise Edition monitoring options available depend on whether you are running Harness Self-Managed Enterprise Edition - Virtual Machine or Harness Self-Managed Enterprise Edition - Kubernetes Cluster.</p><p>Harness Self-Managed Enterprise Edition - Virtual Machine comes with built in monitoring using Prometheus, Grafana, and Alertmanager, but Harness Self-Managed Enterprise Edition - Kubernetes Cluster requires that you set up monitoring on your own.</p><h3>Monitoring Harness Self-Managed Enterprise Edition - Virtual Machine</h3><p>Monitoring is included in Harness Self-Managed Enterprise Edition - Virtual Machine by default.</p><p>The KOTS admin tool for a running version of Harness Self-Managed Enterprise Edition - Virtual Machine displays Prometheus monitoring:</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/ho0c1at9nv/1635791626196/clean-shot-2021-11-01-at-11-33-32.png"/></figure><p>When you installed Harness Self-Managed Enterprise Edition - Virtual Machine, you were provided with Prometheus, Grafana, and Alertmanager ports and passwords in the output of the installer. For example:</p><pre>The UIs of Prometheus, Grafana and Alertmanager have been exposed on NodePorts 30900, 30902 and 30903 respectively.<br/>To access Grafana use the generated user: xxxxx password of admin: xxxxx.</pre><p></p><p></p><p>To view these addresses, log into the VM running Harness, and then view the Kubernetes services running in the <code>monitoring</code> namespace:</p><pre>kubectl get svc -n monitoring</pre><p></p><p>The output will be something like this:</p><pre>NAME                    TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)                      AGE<br/>alertmanager-main       NodePort    10.96.2.240   &lt;none&gt;        9093:30903/TCP               282d<br/>alertmanager-operated   ClusterIP   None          &lt;none&gt;        9093/TCP,9094/TCP,9094/UDP   282d<br/>grafana                 NodePort    10.96.2.252   &lt;none&gt;        3000:30902/TCP               282d<br/>kube-state-metrics      ClusterIP   None          &lt;none&gt;        8443/TCP,9443/TCP            282d<br/>node-exporter           ClusterIP   None          &lt;none&gt;        9100/TCP                     282d<br/>prometheus-adapter      ClusterIP   10.96.1.45    &lt;none&gt;        443/TCP                      282d<br/>prometheus-k8s          NodePort    10.96.2.94    &lt;none&gt;        9090:30900/TCP               282d<br/>prometheus-operated     ClusterIP   None          &lt;none&gt;        9090/TCP                     282d<br/>prometheus-operator     ClusterIP   None          &lt;none&gt;        8080/TCP                     282d</pre><p></p><h4>Prometheus</h4><p>The Prometheus port number is taken from the <code>prometheus-k8s</code> service (in this example <code>30900</code>).</p><p>Combine that port number with the public IP for Harness Self-Managed Enterprise Edition and you have the Prometheus endpoint.</p><div class="note-callout">If you have a load balancer configured, then configure it to support the <code>prometheus-k8s</code> port number.</div><p>In the KOTS admin tool, in <strong>Application</strong>, click <strong>Configure Prometheus Address</strong>.</p><p>In <strong>Configure graphs</strong>, enter the URL using the public IP and the Prometheus port number.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/ho0c1at9nv/1635792790405/clean-shot-2021-11-01-at-11-52-54.png"/></figure><p>Click <strong>Save</strong>. The graphs appear.</p><h4>Grafana</h4><p>The Grafana port is listed by running <code>kubectl get svc -n monitoring</code>:</p><pre>grafana                 NodePort    10.96.2.252   &lt;none&gt;        3000:30902/TCP               </pre><p></p><p>Combine that port number with the public IP for Harness Self-Managed Enterprise Edition and you have the Grafana endpoint. For example <code>http://35.233.239.15:30902</code>.</p><p>Log into Grafana using the generated username and password you received when you installed Harness Self-Managed Enterprise Edition:</p><pre>To access Grafana use the generated user: xxxxx password of admin: xxxxx.</pre><p></p><p>If you do not have the username and password, log into the VM hosting Harness Self-Managed Enterprise Edition and run the following:</p><pre>kubectl get secrets grafana-admin -n monitoring -o yaml</pre><p></p><p>Once you are logged in, go to Dashboards and click a default dashboard or created a new one.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/ho0c1at9nv/1635798842287/clean-shot-2021-11-01-at-13-33-51.png"/></figure><p>For example, open the <strong>Kubernetes / Pods</strong> dashboard.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/ho0c1at9nv/1635798878842/clean-shot-2021-11-01-at-13-34-29.png"/></figure><p>See <a href="https://grafana.com/docs/" target="_blank">Grafana docs</a> for information on creating dashboards.</p><p>For information on querying Prometheus, see <a href="https://prometheus.io/docs/prometheus/latest/querying/basics/" target="_blank">Querying Prometheus</a>.</p><h4>Alertmanager</h4><p>The Alertmanager port is listed by running <code>kubectl get svc -n monitoring</code>:</p><pre>alertmanager-main       NodePort    10.96.2.240   &lt;none&gt;        9093:30903/TCP</pre><p></p><p>Combine that port number with the public IP for Harness Self-Managed Enterprise Edition and you have the Alertmanager endpoint. For example <code>http://35.233.239.15:30903</code>.</p><p>See <a href="https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/" target="_blank">Alerting Rules</a> from Prometheus for details on setting up alerts.</p><h3>Monitoring Harness Self-Managed Enterprise Edition - Kubernetes Cluster</h3><p>Harness does not provide default monitoring for Harness Self-Managed Enterprise Edition.</p><p>You can deploy a Prometheus server and Grafana to monitor Harness Self-Managed Enterprise Edition. For steps on setting up monitoring using Prometheus, Grafana, and Alertmanager, see <a href="https://kots.io/kotsadm/monitoring/prometheus/" target="_blank">Prometheus</a> in the KOTS docs.</p><p>If you have an existing Prometheus setup, in the KOTS admin tool you can click <strong>Configure Prometheus Address</strong> and then enter the Prometheus URL endpoint.</p><h3>Availability Monitoring</h3><p>The following table shows the two available URL endpoints. These are microservices with external endpoints (they have Ingress configured by default).</p><p>In these examples, <code>&lt;domain name&gt;</code> represents your vanity URL (for example, <code>mycompany.harness.io</code>). If your load balancer directs internal traffic for <code>app.harness.io</code> then the URLs can use that address.</p><table><tbody><tr><td><p><strong>Service Name</strong></p></td><td><p><strong>Endpoint</strong></p></td><td><p><strong>Response</strong></p></td></tr><tr><td><p>Verification</p></td><td><p><code>https://&lt;domain name&gt;/verification/health</code></p></td><td><p><code>{&#34;metaData&#34;:{},&#34;resource&#34;:&#34;healthy&#34;,&#34;responseMessages&#34;:[]}</code></p></td></tr><tr><td><p>NextGen Manager</p></td><td><p><code>https://&lt;domain name&gt;/ng/api/health</code></p></td><td><p><code>{&#34;status&#34;:&#34;SUCCESS&#34;,&#34;data&#34;:&#34;healthy&#34;,&#34;metaData&#34;:null,&#34;correlationId&#34;:&#34;a38c51ac-07ec-4596-b40b-4cc9487f8506&#34;}</code></p></td></tr></tbody></table><p></p><p>The following methods can be used for monitoring other Harness Self-Managed Enterprise Edition microservices:</p><ul><li>MongoDB: there are many ways to monitor MongoDB instances. For example, you can monitor your MongoDB database with Grafana and Prometheus. See the article <a href="https://devconnected.com/mongodb-monitoring-with-grafana-prometheus/" target="_blank">MongoDB Monitoring with Grafana &amp; Prometheus</a> for a summary.</li><li>Disk/Memory: use the <a href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/" target="_blank">Kubernetes pod dashboard</a>.</li></ul><p></p>