type: article
article_id: 95mwydgm6w
user_id: znazf3hcp9
category_id: ody8r3ad8f
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/77114bb5eef5503c5a09ad7655120b17?d=mm&s=150
title: Installation
slug: kubernetes-cluster-on-prem-kubernetes-cluster-setup
description: This topic covers installing Harness Self-Managed Enterprise Edition
  - Kubernetes Cluster.
short_version: This topic covers installing Harness Self-Managed Enterprise Edition
  - Kubernetes Cluster NextGen.
tags:
- on-premises
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: ""
  source: API
  triggered_at: 2022-09-15T01:12:14.133094Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Installation
  description: This topic covers installing Harness Self-Managed Enterprise Edition
    - Kubernetes Cluster.
  short_version: This topic covers installing Harness Self-Managed Enterprise Edition
    - Kubernetes Cluster NextGen.
  body: '<p>This topic covers installing Harness Self-Managed Enterprise Edition -
    Kubernetes Cluster <strong>NextGen</strong> in an existing Kubernetes cluster.
    Harness Self-Managed Enterprise Edition - Kubernetes Cluster <strong>NextGen</strong>
    uses the <a href="https://kots.io/kots-cli/getting-started/" target="_blank">KOTS
    kubectl plugin</a> for installation.</p><p>To install Harness Self-Managed Enterprise
    Edition - Kubernetes Cluster <strong>NextGen</strong>, first you install Harness
    Self-Managed Enterprise Edition - Kubernetes Cluster <strong>FirstGen</strong>
    and then you install NextGen as an application.</p><div class="note-callout">We
    assume that you are very familiar with Kubernetes, and can perform the standard
    Kubernetes and managing configurations using <a href="https://kubernetes.io/docs/tasks/manage-kubernetes-objects/kustomization/"
    target="_blank">Kustomize</a> overlays.</div><p>Installing Harness Self-Managed
    Enterprise Edition into an existing Kubernetes cluster is a simple process where
    you prepare your existing cluster and network, and use the KOTS admin tool and
    Kustomize to complete the installation and deploy Harness.</p><h3>Cluster Requirements</h3><p>Do
    not perform any of the steps in this topic until you have set up the requirements
    in the <a href="/article/d5lptkp5ow-kubernetes-cluster-on-prem-infrastructure-requirements">Self-Managed
    Enterprise Edition - Kubernetes Cluster: Infrastructure Requirements</a> topic.</p><h3>Summary</h3><p>Installing
    Harness Self-Managed Enterprise Edition in an existing cluster is performed as
    a <a href="https://kots.io/kotsadm/installing/installing-a-kots-app/#existing-cluster-or-embedded-kubernetes"
    target="_blank">KOTS Existing Cluster Online Install</a>.</p><p>This simply means
    that you are using an existing Kubernetes cluster, as opposed to bare metal or
    VMs, and that your cluster can make outbound internet requests for an online installation.</p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1596470762187/image.png"
    style="display:block;margin-left:auto;margin-right:auto" data-hd-align="center"/></figure><h3>Harness
    Self-Managed Enterprise Edition NextGen Installation Options</h3><p>How you install
    Harness Self-Managed Enterprise Edition NextGen will follow one of the use cases
    below:</p><h4>NextGen on Existing FirstGen Cluster</h4><p>In this scenario, you
    have an existing Harness Self-Managed Enterprise Edition FirstGen cluster running
    and you want to add Harness Self-Managed Enterprise Edition NextGen to it.</p><p>You
    simply add Harness Self-Managed Enterprise Edition NextGen as a new application
    in your existing FirstGen installation.</p><ol><li>Open the FirstGen KOTS admin
    tool.</li><li>Install NextGen as a new application on existing FirstGen cluster.</li><li>Upload
    the NextGen license file.</li><li>Use the exact same FirstGen configuration values
    for the NextGen configuration.</li></ol><p>If you are using this option, skip
    to <a href="https://ngdocs.harness.io/article/95mwydgm6w-kubernetes-cluster-on-prem-kubernetes-cluster-setup#install_next_gen_on_existing_first_gen_cluster">Install
    NextGen on Existing FirstGen Cluster</a>.</p><h4>NextGen on New FirstGen Cluster</h4><p>In
    this scenario, you want to install FirstGen and NextGen on a new cluster.</p><ol><li>Create
    a new Kubernetes cluster following the steps in the <a href="/article/d5lptkp5ow-kubernetes-cluster-on-prem-infrastructure-requirements">Self-Managed
    Enterprise Edition - Kubernetes Cluster: Infrastructure Requirements</a>.</li><li>Install
    FirstGen.</li><li>Install NextGen as a new application on existing FirstGen cluster.</li><li>Upload
    the NextGen license file.</li><li>Use the exact same FirstGen configuration values
    for the NextGen configuration.</li></ol><p>If you are using this option, do the
    following:</p><ol><li>Follow all of the FirstGen installation instructions beginning
    with <a href="https://ngdocs.harness.io/article/95mwydgm6w-kubernetes-cluster-on-prem-kubernetes-cluster-setup#step_1_set_up_cluster_requirements">Step
    1: Set up Cluster Requirements</a>.</li><li>Follow the NextGen installation instructions
    in <a href="https://ngdocs.harness.io/article/95mwydgm6w-kubernetes-cluster-on-prem-kubernetes-cluster-setup#install_next_gen_on_existing_first_gen_cluster">Install
    NextGen on Existing FirstGen Cluster</a>.</li></ol><h4>Legacy FirstGen not Using
    KOTS</h4><p>In this scenario, you have a legacy FirstGen installation that is
    not a KOTS-based installation.</p><p>This process will involve migrating your
    legacy FirstGen data to a new KOTS-based FirstGen and then installing NextGen.</p><ol><li>Create
    a new Kubernetes cluster following the steps in the <a href="/article/d5lptkp5ow-kubernetes-cluster-on-prem-infrastructure-requirements">Self-Managed
    Enterprise Edition - Kubernetes Cluster: Infrastructure Requirements</a>.</li><li>Install
    FirstGen.</li><li>Migrate data to new FirstGen using a script from Harness Support.</li><li>Install
    NextGen as a new application on the new FirstGen cluster.</li><li>Upload the NextGen
    license file.</li><li>Use the exact same FirstGen configuration values for the
    NextGen configuration.</li></ol><p>If you are using this option, do the following:</p><ol><li>Follow
    all of the FirstGen installation instructions beginning with <a href="https://ngdocs.harness.io/article/95mwydgm6w-kubernetes-cluster-on-prem-kubernetes-cluster-setup#step_1_set_up_cluster_requirements">Step
    1: Set up Cluster Requirements</a>.</li><li>Migrate data to new FirstGen using
    a script from Harness Support.</li><li>Follow the NextGen installation instructions
    in <a href="https://ngdocs.harness.io/article/95mwydgm6w-kubernetes-cluster-on-prem-kubernetes-cluster-setup#install_next_gen_on_existing_first_gen_cluster">Install
    NextGen on Existing FirstGen Cluster</a>.</li></ol><h3>Step 1: Set up Cluster
    Requirements</h3><p>As stated earlier, follow the steps in the <a href="/article/d5lptkp5ow-kubernetes-cluster-on-prem-infrastructure-requirements">Self-Managed
    Enterprise Edition - Kubernetes Cluster: Infrastructure Requirements</a> topic
    to ensure you have your cluster set up correctly.</p><p>These requirements also
    include RBAC settings that might require your IT administrator to assist you unless
    your user account is bound to the <code>cluster-admin</code> Cluster Role.</p><p>Specifically,
    you need to create a KOTS admin Role and bind it to the user that will install
    Harness. You also need to create a Harness ClusterRole.</p><h3>Step 2: Set Up
    Networking Requirements</h3><p>Perform the following steps to ensure that you
    have the Load Balancer set up for Harness Self-Managed Enterprise Edition.</p><p>Later,
    when you set up the kustomization for Harness Self-Managed Enterprise Edition,
    you will provide an IP address for the cluster load balancer settings.</p><p>Finally,
    when you configure the Harness Self-Managed Enterprise Edition application, you
    will provide the Load Balancer URL. This URL is what Harness Self-Managed Enterprise
    Edition users will use.</p><h4>Using NodePort?</h4><p>If you are creating the
    load balancer&#39;s Service type using NodePort, create a load balancer that points
    to any port in range 30000-32767 on the node pool on which the Kubernetes cluster
    is running.</p><p>If you are using NodePort, you can skip to <a href="#step_3_configure_harness">Step
    3: Configure Harness</a>.</p><h4>Set Up Static External IP</h4><p>You should have
    a static IP reserved to expose Harness outside of the Kubernetes cluster.</p><p>For
    example, in the GCP console, click <strong>VPC network</strong>, and then click
    <strong>External IP Addresses</strong>.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/voxht9rqkr/1592599157533/image.png"/></figure><p>For
    more information, see <a href="https://cloud.google.com/compute/docs/ip-addresses/reserve-static-external-ip-address"
    target="_blank">Reserving a static external IP address</a>.</p><div class="note-callout">For
    GCP, the External IP address must be <a href="https://cloud.google.com/network-tiers/docs/overview#premium_tier"
    target="_blank">Premium Tier</a>.</div><h4>Set Up DNS</h4><p>Set up DNS to resolve
    the domain name you want to use for Harness Self-Managed Enterprise Edition to
    the static IP address you reserved in the previous step.</p><p>For example, the
    domain name <strong>harness.abc.com</strong> would resolve to the static IP:</p><pre>host
    harness.abc.com<br/>harness.abc.com has address 192.0.2.0</pre><p>The above DNS
    setup can be tested by running <code>host &lt;domain_name&gt;</code>.</p><h3>Review:
    OpenShift Clusters</h3><p>If you will be using OpenShift Clusters, run the following
    commands after installing the KOTS plugin, but before installing Harness:</p><pre>oc
    adm policy add-scc-to-user anyuid -z harness-serviceaccount -n harness</pre><pre>oc
    adm policy add-scc-to-user anyuid -z harness-default -n harness</pre><pre>oc adm
    policy add-scc-to-user anyuid -z default -n harness</pre><p></p><p>Once you&#39;ve
    installed Harness and you want to install a Harness Kubernetes Delegate, see <a
    href="#delegates_and_open_shift">Delegates and OpenShift</a> below.</p><h3>Option
    1: Disconnected Installation (Airgap)</h3><p>The following steps will install
    KOTS from your private repo and the Harness Self-Managed Enterprise Edition license
    and airgap file you obtain from Harness.</p><ol><li>Download the latest KOTS (kotsadm.tar.gz)
    release from <a href="https://github.com/replicatedhq/kots/releases" target="_blank">https://github.com/replicatedhq/kots/releases</a>.</li><li>Push
    KOTS images to your private registry:<br/><pre>kubectl kots admin-console push-images
    ./kotsadm.tar.gz &lt;private.registry.host&gt;/harness \<br/>--registry-username
    &lt;rw-username&gt; \<br/>--registry-password &lt;rw-password&gt;</pre></li><li>Obtain
    the Harness license file from your Harness Customer Success contact or email <a
    href="https://mail.google.com/mail/?view=cm&amp;fs=1&amp;tf=1&amp;to=support@harness.io"
    target="_blank">support@harness.io</a>.</li><li>Obtain the Harness airgap file
    from Harness.</li><li>Log into your cluster.</li><li>Install KOTS and Harness
    using the following command:</li></ol><pre>kubectl kots install harness <br/>--namespace
    harness<br/>--shared-password &lt;password&gt; <br/>--license-file &lt;path to
    license.yaml&gt;<br/>--config-values &lt;path to configvalues.yaml&gt;<br/>--airgap-bundle
    &lt;path to harness-&lt;version&gt;.airgap&gt;<br/>--kotsadm-registry &lt;private.registry.host&gt;/harness
    <br/>--kotsadm-namespace harness-kots<br/>--registry-username &lt;rw-username&gt;
    <br/>--registry-password &lt;rw-password&gt;</pre><p>Notes:</p><ul><li>The <code>--namespace</code>
    parameter uses the namespace you created in <a href="/article/d5lptkp5ow-kubernetes-cluster-on-prem-infrastructure-requirements">Self-Managed
    Enterprise Edition - Kubernetes Cluster: Infrastructure Requirements</a>. in this
    documentation, we use the namespace <strong>harness</strong><strong>.</strong></li><li>For
    the <code>--shared-password</code> parameter, enter a password for the KOTS admin
    console. You will use this password to log into the KOTS admin tool.</li><li>The
    <code>--config-values</code> parameter is only needed if you use a config-values
    files, as described in <a href="https://kots.io/kotsadm/installing/automating/#config-values"
    target="_blank">Config Values</a> from KOTS.</li></ul><p>In the terminal, it will
    look like this:</p><pre>  • Deploying Admin Console<br/>    • Creating namespace
    ✓  <br/>    • Waiting for datastore to be ready ✓  </pre><p>The KOTS admin tool
    URL is provided:</p><pre>  • Waiting for Admin Console to be ready ✓  <br/><br/>  •
    Press Ctrl+C to exit<br/>  • Go to http://localhost:8800 to access the Admin Console</pre><p>Use
    the URL provided in the output to open the KOTS admin console in a browser.</p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593543936446/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Enter
    the password you provided earlier, and click <strong>Log In</strong>.</p><p>You
    might be prompted to allow a port-forward connection into the cluster.</p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593544048482/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Now
    that KOTS and Harness are installed, you can perform the necessary configurations.</p><h3>Option
    2: Connected Installation</h3><p>The following steps will install KOTS and Harness
    Self-Managed Enterprise Edition online. There is also an option to use a Harness
    Self-Managed Enterprise Edition airgap file instead of downloading Harness Self-Managed
    Enterprise Edition.</p><h4>Install KOTS Plugin</h4><ol><li>Log into your cluster.</li><li>Install
    the KOTS kubectl plugin using the following command:</li></ol><p><code>curl https://kots.io/install
    | bash</code></p><p>The output of the command is similar to this:</p><pre>Installing
    replicatedhq/kots v1.16.1<br/>(https://github.com/replicatedhq/kots/releases/download/v1.16.1/kots_darwin_amd64.tar.gz)...<br/>#############################################
    100.0%#=#=-#  #<br/>############################################# 100.0%<br/>Installed
    at /usr/local/bin/kubectl-kots</pre><p>To test the installation, run this command:</p><p><code>kubectl
    kots --help</code></p><p>The KOTS help appears.</p><p>Now that KOTS is installed,
    you can install Harness Self-Managed Enterprise Edition into your cluster.</p><h4>Install
    KOTS</h4><p>To install the KOTS Admin tool, enter the following command:</p><p><code>kubectl
    kots install harness</code></p><p>You are prompted to enter the namespace for
    the Harness installation. This is the namespace you created in <a href="/article/d5lptkp5ow-kubernetes-cluster-on-prem-infrastructure-requirements">Self-Managed
    Enterprise Edition - Kubernetes Cluster: Infrastructure Requirements</a>.</p><p>In
    this documentation, we use the namespace <strong>harness</strong>.</p><p>In the
    terminal, it will look like this:</p><pre>Enter the namespace to deploy to: harness<br/>  •
    Deploying Admin Console<br/>    • Creating namespace ✓  <br/>    • Waiting for
    datastore to be ready ✓  </pre><p>Enter a password for the KOTS admin console
    and hit Enter. You will use this password to log into the KOTS admin tool.</p><p>The
    KOTS admin tool URL is provided:</p><pre>Enter a new password to be used for the
    Admin Console: ••••••••<br/>  • Waiting for Admin Console to be ready ✓  <br/><br/>  •
    Press Ctrl+C to exit<br/>  • Go to http://localhost:8800 to access the Admin Console</pre><p>Use
    the URL provided in the output to open the KOTS admin console in a browser.</p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593543936446/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Enter
    the password you provided earlier, and click <strong>Log In</strong>.</p><p>You
    might be prompted to allow a port-forward connection into the cluster.</p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593544048482/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><h4>Upload
    Your Harness License</h4><p>Once you are logged into the KOTS admin console, you
    can upload your Harness license.</p><p>Obtain the Harness license file from your
    Harness Customer Success contact or email <a href="mailto:support@harness.io">support@harness.io</a>.</p><p>Drag
    your license YAML file into the KOTS admin tool:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593544168266/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Next,
    upload the license file:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593544350008/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Click
    <strong>Upload license</strong>.</p><p>Now that license file is uploaded, you
    can install Harness.</p><h4>Download Harness over the Internet</h4><p>If you are
    installing Harness over the Internet, click the <strong>download Harness from
    the Internet</strong> link.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593544532503/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><p>KOTS
    begins installing Harness into your cluster.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593544576040/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Next,
    you will configure Harness.</p><h3>Step 3: Configure Harness</h3><p>Now that you
    have added your license you can configure the networking for the Harness installation.</p><div
    class="note-callout">If the KOTS Admin tool is not running, point <code>kubectl</code>
    to the cluster where Harness is deployed and run the following command: <code>kubectl
    kots admin-console --namespace harness</code></div><p>In the KOTS admin tool,
    the <strong>Configure Harness</strong> settings appear.</p><p>Harness Self-Managed
    Enterprise Edition - Kubernetes Cluster requires that you provide a NodePort and
    Application URL.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1608063321994/image.png"/></figure><h4>Mode</h4><ul><li>Select
    <strong>Demo</strong> to run Harness Self-Managed Enterprise Edition in demo mode
    and experiment with it. If you&#39;re a new user, choose <strong>Demo</strong>
    and upgrade to Production HA later.</li><li>Select <strong>Production HA</strong>
    to run a production version of Harness Self-Managed Enterprise Edition.</li></ul><p></p><h4>Ingress
    Service Type</h4><p>By default, nginx is used for Ingress automatically. If you
    are deploy nginx separately, do the following:</p><ol><li>Click <strong>Advanced
    Configurations</strong>.</li><li>Disable the <strong>Install Nginx Ingress Controller</strong>
    option.</li></ol><h4>NodePort</h4><p>Enter any port in the range 30000-32767 on
    the node pool on which the Kubernetes cluster is running.</p><p>If you do not
    enter a port, Harness uses 32500 by default.</p><h4>External Loadbalancer</h4><p>Enter
    the IP address of the Load Balancer.</p><h4>Application URL</h4><p>Enter the URL
    users will enter to access Harness. This is the DNS domain name mapped to the
    Load Balancer IP.</p><p>When you are done, click <strong>Continue</strong>.</p><h4>Storage
    Class</h4><p>You can also add a Storage Class. The name of the Storage Class depends
    on the provider where you are hosting your Kubernetes cluster. See <a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#parameters"
    target="_blank">Storage Classes</a> from Kubernetes.</p><p>If you don&#39;t provide
    a name, Harness will use <code>default</code>.</p><p>Once you have Harness Self-Managed
    Enterprise Edition installed, you can just run the following command to get the
    Storage Classes in the namespace (in this example, <strong>harness</strong>):</p><p><code>kubectl
    get storageclass -n harness</code></p><p>Enter the name of the Storage Class.</p><h4>Option:
    Advanced Configurations</h4><p>In the <strong>Advanced Configurations</strong>
    section, there are a number of advanced settings you can configure. If this is
    the first time you are setting up Harness Self-Managed Enterprise Edition, there&#39;s
    no reason to fine tune the installation with these settings.</p><p>You can change
    the settings later in the KOTS admin console&#39;s Config tab:</p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593545725176/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><h5>gRPC
    and Load Balancer Settings</h5><p>In <strong>Scheme</strong>, if you select HTTPS,
    the GRPC settings appear.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/d5lptkp5ow/1625082872413/clean-shot-2021-06-30-at-12-54-18.png"/></figure><p><strong>If
    your load balancer does support HTTP2 over port 443</strong>, enter the following:</p><ul><li><strong>GRPC
    Target:</strong> enter the load balancer hostname (hostname from the load balancer
    URL)</li><li><strong>GRPC Authority:</strong> enter <code>manager-grpc-&lt;hostname&gt;</code>.
    For example: <code>manager-grpc-35.202.197.230</code>.</li></ul><p><strong>If
    your load balancer does not support HTTP2 over port 443</strong> you have two
    options:</p><ul><li>If your load balancer supports multiple ports for SSL then
    add port 9879 in the application load balancer and target port 9879 or node port
    32510 on the Ingress controller.<ul><li><strong>GRPC Target:</strong> enter the
    load balancer hostname</li><li><strong>GRPC Authority:</strong> enter the load
    balancer hostname</li></ul></li><li>If your load balancer does not support multiple
    ports for SSL then create a new load balancer and target port 9879 or node port
    32510 on the Ingress controller:<ul><li><strong>GRPC Target:</strong> enter the
    <u>new</u> load balancer hostname</li><li><strong>GRPC Authority:</strong> enter
    the <u>new</u> load balancer hostname</li></ul></li></ul><h5>Log Service Backend</h5><p></p><figure><img
    src="https://files.helpdocs.io/i5nl071jo5/articles/tjvawty1do/1624905186456/clean-shot-2021-06-28-at-11-32-56.png"/></figure><p>There
    are two options for <strong>Log Service Backend</strong>:</p><p><strong>Minio:</strong>
    If you want to use the builtin <a href="https://docs.min.io/docs/minio-quickstart-guide.html"
    target="_blank">Minio</a> log service then your load balancer needs to reach the
    Ingress controller on port 9000. Create a new load balancer and target port 9000
    or node port 32507.</p><p><strong>Amazon S3 Bucket:</strong> Enter the S3 bucket
    settings to use.</p><h3>Step 4: Perform Preflight Checks</h3><p>Preflight checks
    run automatically and verify that your setup meets the minimum requirements.</p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593545769365/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>You
    can skip these checks, but we recommend you let them run.</p><p>Fix any issues
    in the preflight steps. A common example is the message:</p><pre>Your cluster
    meets the minimum version of Kubernetes, but we recommend you update to 1.15.0
    or later.</pre><p>You can update your cluster&#39;s version of Kubernetes if you
    like.</p><p></p><h3>Step 5: Deploy Harness</h3><p>When you are finished pre-flight
    checks, click <strong>Deploy and</strong> <strong>Continue</strong>.</p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1608066016585/image.png"/></figure><p></p><p>Harness
    is deployed in a few minutes.</p><p>In a new browser tab, go to the following
    URL, replacing <code>&lt;LB_URL&gt;</code> with the URL you entered in the <strong>Application
    URL</strong> setting in the KOTS admin console:</p><p><code>&lt;LB_URL&gt;/auth/#/signup</code></p><p>For
    example:</p><p><code>http://harness.mycompany.com/auth/#/signup</code></p><p>The
    Harness sign up page appears.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/kgvg58wg1g/1648592863659/clean-shot-2022-03-29-at-15-27-33.png"/></figure><p>Sign
    up with a new account and then sign in.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/kgvg58wg1g/1648592928001/clean-shot-2022-03-29-at-15-27-52.png"/></figure><p>Your
    new account will be added to the Harness Account Administrators User Group.</p><p>See
    <a href="/article/dfwuvmy33m-add-user-groups">Add and Manage User Groups</a>.</p><h4>Future
    Versions</h4><p>To set up future versions of Harness Self-Managed Enterprise Edition,
    in the KOTS admin console, in the <strong>Version history</strong> tab, click
    <strong>Deploy</strong>. The new version is displayed in Deployed version.</p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593545900180/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><h3>Important
    Next Steps</h3><div class="note-callout"><strong>Important:</strong> You cannot
    invite other users to Harness until a Harness Delegate is installed and a Harness
    SMTP Collaboration Provider is configured.</div><ol><li>Install the Harness Delegate:
    <a href="/article/re8kk0ex4k-delegate-installation-overview">Delegate Installation
    Overview</a>.</li><li>Set up an SMTP Collaboration Provider in Harness for email
    notifications from the Harness Manager.<br/>Ensure you open the correct port for
    your SMTP provider, such as <a href="https://support.office.com/en-us/article/server-settings-you-ll-need-from-your-email-provider-c82de912-adcc-4787-8283-45a1161f3cc3">Office
    365</a>.</li><li><a href="/article/bo4qbrcggv-add-secrets-manager">Add a Secrets
    Manager</a>. By default, Harness Self-Managed Enterprise Edition installations
    use the local Harness MongoDB for the default Harness Secrets Manager. This is
    not recommended.<br/>After Harness Self-Managed Enterprise Edition installation,
    configure a new Secret Manager (Vault, AWS, etc). You will need to open your network
    for the Secret Manager connection.</li></ol><h4>Delegates and OpenShift</h4><p>If
    you are deploying the Harness Kubernetes Delegate into an OpenShift cluster, you
    need to edit the Harness Kubernetes Delegate YAML before installing the Delegate.</p><p>You
    simply need to point to the OpenShift image.</p><p>Here&#39;s the default YAML
    with <code>harness/delegate:latest</code>:</p><pre>...<br/>apiVersion: apps/v1<br/>kind:
    StatefulSet<br/>...<br/>    spec:<br/>      containers:<br/>      - image: harness/delegate:latest</pre><p></p><p>Change
    the <code>image</code> entry to <code>harness/delegate:non-root-openshift</code>:</p><pre>...<br/>apiVersion:
    apps/v1<br/>kind: StatefulSet<br/>...<br/>    spec:<br/>      containers:<br/>      -
    image: harness/delegate:non-root-openshift</pre><h3>Updating Harness FirstGen</h3><div
    class="note-callout"><strong>Do not upgrade Harness past 4 major releases.</strong>
    Instead, upgrades each interim release until you upgrade to the latest release.
    A best practice is to upgrade Harness once a month.</div><p>Please follow these
    steps to update your Harness Harness Self-Managed Enterprise Edition installation.</p><p>The
    steps are very similar to how you installed Harness initially.</p><p>For more
    information on updating KOTS and applications, see <a href="https://kots.io/kotsadm/updating/updating-kots-apps/#using-cli"
    target="_blank">Using CLI</a> and <a href="https://kots.io/kotsadm/updating/updating-admin-console/"
    target="_blank">Updating the Admin Console</a> from KOTS.</p><h4>Disconnected
    (Airgap)</h4><p>The following steps require a private registry, just like the
    initial installation of Harness.</p><h5>Upgrade Harness</h5><ol><li>Download the
    latest release from Harness.</li><li>Run the following command on the cluster
    hosting Harness, replacing the placeholders:</li></ol><pre class="hljs bash">kubectl
    kots upstream upgrade harness \ <br/>--airgap-bundle &lt;path to harness-&lt;version&gt;.airgap&gt;
    \<br/>--kotsadm-namespace harness-kots \<br/>--kotsadm-registry &lt;private.registry.host&gt;/harness
    \<br/>--registry-username &lt;username&gt; \<br/>--registry-password &lt;password&gt;
    \<br/>--deploy \<br/>-n harness</pre><h5>Upgrade KOTS Admin Tool</h5><p>To upgrade
    the KOTS admin tool, first you will push images to your private Docker registry.</p><ol><li>Run
    the following command to push the images, replacing the placeholders:</li></ol><pre
    class="hljs bash">kubectl kots admin-console push-images ./&lt;new-kotsadm&gt;.tar.gz
    \<br/>&lt;private.registry.host&gt;/harness \<br/>--registry-username rw-username
    \<br/>--registry-password rw-password</pre><ol><li style="counter-increment:li
    1" start="2">Next, run the following command on the cluster hosting Harness, replacing
    the placeholders:</li></ol><pre class="hljs bash">kubectl kots admin-console upgrade
    \ <br/>--kotsadm-registry &lt;private.registry.host&gt;/harness \<br/>--registry-username
    rw-username \<br/>--registry-password rw-password \<br/>-n harness</pre><h4>Connected</h4><p>The
    following steps require a secure connection to the Internet, just like the initial
    installation of Harness.</p><h5>Upgrade Harness</h5><ol><li>Run the following
    command on the cluster hosting Harness:</li></ol><pre class="hljs bash">kubectl
    kots upstream upgrade harness --deploy -n harness</pre><h5>Upgrade KOTS Admin
    Tool</h5><ol><li>Run the following command on the cluster hosting Harness:</li></ol><pre
    class="hljs bash">kubectl kots admin-console upgrade -n harness</pre><h3>Monitoring
    Harness</h3><p>Harness monitoring is performed using the built in monitoring tools.</p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1594857436751/image.png"/></figure><p>For
    steps on using the monitoring tools, see <a href="https://kots.io/kotsadm/monitoring/prometheus/"
    target="_blank">Prometheus</a> from KOTS.</p><h3>License Expired</h3><p>If your
    license has expired, you will see something like the following:</p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593544662234/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Contact
    your Harness Customer Success representative or <a href="mailto:support@harness.io">support@harness.io</a>.</p><h3>Bring
    Down Harness Cluster for Planned Downtime</h3><p>If you need to bring down the
    Harness cluster for any reason, you simply scale down the Harness Manager and
    Verification Service deployments to zero replicas. That is sufficient to stop
    background tasks and remove connections to the database.</p><p>Next, optionally,
    you can scale everything else down if needed, but it is not necessary.</p><p>To
    bring Harness back up, first ensure the Harness MongoDB is scaled up to 3 instances
    and Redis is scaled up also. Next, scale up the Harness Manager and Verification
    Service.</p><h3>Logging</h3><p>For Harness Self-Managed Enterprise Edition - Kubernetes
    Cluster, logs are available as standard out.</p><p>Use <code>kubectl get logs</code>
    on any pod to see the logs.</p><h3>Notes</h3><p>Harness Self-Managed Enterprise
    Edition installations do not currently support the Harness Helm Delegate.</p><h3>Note:
    Remove Previous kustomization for Ingress Controller</h3><p><strong>This option
    is only needed if you have installed Harness Self-Managed Enterprise Edition previously.</strong>
    If this is a fresh install, you can go directly to <a href="#step_4_configure_harness">Configure
    Harness</a>.</p><p>If you have installed Harness Harness Self-Managed Enterprise
    Edition previously, you updated Harness manifests using kustomize for the ingress
    controller. This is no longer required.</p><p>Do the following to remove the kustomization
    as follows:</p><ol><li>If you are using a single terminal, close the KOTS admin
    tool (Ctrl+C).</li><li>Ensure <code>kubectl</code> is pointing to the cluster.</li><li>Run
    the following command:</li></ol><pre>kubectl kots download --namespace harness
    --slug harness</pre><div class="note-callout">This example assumes we are installing
    Harness in a namespace named <strong>harness</strong>. Please change the namespace
    according to your configuration.</div><p>This command will download a folder named
    <strong>harness</strong> in your current directory.</p><ol><li style="counter-increment:li
    3" start="4">In the <strong>harness</strong> folder, open the file <strong>kustomization.yaml</strong>:</li></ol><pre>vi
    harness/overlays/midstream/kustomization.yaml </pre><ol><li style="counter-increment:li
    4" start="5">In <code>patchesStrategicMerge</code> <strong>remove</strong> <code>nginx-service.yaml</code>.</li><li>Save
    the file.</li><li>Remove the nginx-service.yaml file:</li></ol><pre>rm -rf harness/overlays/midstream/nginx-service.yaml</pre><ol><li
    style="counter-increment:li 7" start="8">Upload Harness:</li></ol><pre>kubectl
    kots upload --namespace harness --slug harness ./harness</pre><ol><li style="counter-increment:li
    8" start="9">Open the KOTS admin tool, and then deploy the uploaded version of
    Harness.</li></ol><h3>Install NextGen on Existing FirstGen Cluster</h3><p>This
    section assumes you have a Harness Self-Managed Enterprise Edition FirstGen installation
    set up and running following the step earlier in this guide (beginning with <a
    href="https://ngdocs.harness.io/article/95mwydgm6w-kubernetes-cluster-on-prem-kubernetes-cluster-setup#step_1_set_up_cluster_requirements">Step
    1: Set up Cluster Requirements</a>).</p><p>Now you can add Harness Self-Managed
    Enterprise Edition NextGen as a new application to your Harness Self-Managed Enterprise
    Edition FirstGen installation.</p><ol><li>Log into your Harness Self-Managed Enterprise
    Edition FirstGen KOTS admin tool.</li><li>Click <strong>Config</strong>.</li><li>Record
    all of the FirstGen settings. You will need to use these exact same settings when
    setting up Harness Self-Managed Enterprise Edition NextGen.<br/>If you want to
    change settings, change them and then record them so you can use them during the
    Harness Self-Managed Enterprise Edition NextGen installation.</li><li>Click <strong>Add
    a new application</strong>.<figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/95mwydgm6w/1623362723690/clean-shot-2021-06-10-at-15-05-08.png"/></figure></li><li>Add
    the Harness Self-Managed Enterprise Edition NextGen license file you received
    from Harness Support, and then click <strong>Upload license</strong>.<figure><img
    src="https://files.helpdocs.io/i5nl071jo5/articles/95mwydgm6w/1623362818008/clean-shot-2021-06-10-at-15-06-51.png"/></figure></li><li>Depending
    on whether your Harness Self-Managed Enterprise Edition FirstGen installation
    is Disconnected or Connected, follow the installation steps described here:<ul><li><a
    href="https://ngdocs.harness.io/article/95mwydgm6w-kubernetes-cluster-on-prem-kubernetes-cluster-setup#option_1_disconnected_installation_airgap">Option
    1: Disconnected Installation (Airgap)</a></li><li><a href="https://ngdocs.harness.io/article/95mwydgm6w-kubernetes-cluster-on-prem-kubernetes-cluster-setup#option_2_connected_installation">Option
    2: Connected Installation</a></li></ul>When you are done, you&#39;ll be on the
    <strong>Configure HarnessNG</strong> page. This is the standard configuration
    page you followed when you set up Harness Self-Managed Enterprise Edition FirstGen
    in <a href="https://ngdocs.harness.io/article/95mwydgm6w-kubernetes-cluster-on-prem-kubernetes-cluster-setup#step_3_configure_harness">Step
    3: Configure Harness</a>.</li><li>Enter the <u>exact same configuration options</u>
    as your Harness Self-Managed Enterprise Edition FirstGen installation.<br/>Please
    ensure you include your <strong>Advanced Configuration</strong>, including any
    <strong>Ingress Controller Configurations</strong> settings.<br/>Ensure you use
    the exact same <strong>Scheme</strong> you used in Harness Self-Managed Enterprise
    Edition FirstGen (HTTP or HTTPS).<br/>The <strong>Load Balancer IP Address</strong>
    setting does not appear because Harness Self-Managed Enterprise Edition NextGen
    is simply a new application added onto FirstGen. Harness Self-Managed Enterprise
    Edition NextGen will use the exact same <strong>Load Balancer IP Address</strong>
    setting by default.</li><li>Click <strong>Continue</strong> at the bottom of the
    page.<br/>Harness will perform pre-flight checks.<figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/95mwydgm6w/1623364399933/clean-shot-2021-06-10-at-15-33-11.png"/></figure></li><li>Click
    <strong>Continue</strong>.<br/>Harness is deployed in a few minutes. If autoscaling
    is required, then it can take more time.<br/>When Harness Self-Managed Enterprise
    Edition NextGen is ready, you will see it listed as <strong>Ready</strong>:<figure><img
    src="https://files.helpdocs.io/i5nl071jo5/articles/95mwydgm6w/1623365943741/clean-shot-2021-06-10-at-15-58-29.png"/></figure></li><li>In
    a new browser tab, go to the following URL, replacing <code>&lt;LB_URL&gt;</code> with
    the URL you entered in the <strong>Application URL</strong> setting in the KOTS
    admin console:</li></ol><p><code>&lt;LB_URL&gt;/auth/#/signup</code></p><p>For
    example:</p><p><code>http://harness.mycompany.com/auth/#/signup</code></p><p>The
    Harness sign up page appears.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/kgvg58wg1g/1648592863659/clean-shot-2022-03-29-at-15-27-33.png"/></figure><p>Sign
    up with a new account and then sign in.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/kgvg58wg1g/1648592928001/clean-shot-2022-03-29-at-15-27-52.png"/></figure><p></p><p>If
    you are familiar with Harness, you can skip <a href="/article/hv2758ro4e-learn-harness-key-concepts">Learn
    Harness&#39; Key Concepts</a>.</p><p>Try the <a href="/article/u8lgzsi7b3-quickstarts">Quickstarts</a>.</p><h3>Updating
    Harness NextGen</h3><div class="note-callout"><strong>Do not upgrade Harness past
    4 major releases.</strong> Instead, upgrades each interim release until you upgrade
    to the latest release. A best practice is to upgrade Harness once a month.</div><p>Please
    follow these steps to update your Harness Self-Managed Enterprise Edition installation.</p><p>The
    steps are very similar to how you installed Harness initially.</p><p>For more
    information on updating KOTS and applications, see <a href="https://kots.io/kotsadm/updating/updating-kots-apps/#using-cli"
    target="_blank">Using CLI</a> and <a href="https://kots.io/kotsadm/updating/updating-admin-console/"
    target="_blank">Updating the Admin Console</a> from KOTS.</p><h4>Disconnected
    (Airgap)</h4><p>The following steps require a private registry, just like the
    initial installation of Harness.</p><h5>Upgrade Harness NextGen</h5><ol><li>Download
    the latest release from Harness.</li><li>Run the following command on the cluster
    hosting Harness, replacing the placeholders:</li></ol><pre class="hljs bash">kubectl
    kots upstream upgrade harnesss-ng \ <br/>--airgap-bundle &lt;path to harness-&lt;version&gt;.airgap&gt;
    \<br/>--kotsadm-namespace harness-kots \<br/>--kotsadm-registry &lt;private.registry.host&gt;/harness
    \<br/>--registry-username &lt;username&gt; \<br/>--registry-password &lt;password&gt;
    \<br/>--deploy \<br/>-n harness</pre><h5>Upgrade KOTS Admin Tool</h5><p>To upgrade
    the KOTS admin tool, first you will push images to your private Docker registry.</p><ol><li>Run
    the following command to push the images, replacing the placeholders:</li></ol><pre
    class="hljs bash">kubectl kots admin-console push-images ./&lt;new-kotsadm&gt;.tar.gz
    \<br/>&lt;private.registry.host&gt;/harness \<br/>--registry-username rw-username
    \<br/>--registry-password rw-password</pre><ol><li style="counter-increment:li
    1" start="2">Next, run the following command on the cluster hosting Harness, replacing
    the placeholders:</li></ol><pre class="hljs bash">kubectl kots admin-console upgrade
    \ <br/>--kotsadm-registry &lt;private.registry.host&gt;/harness \<br/>--registry-username
    rw-username \<br/>--registry-password rw-password \<br/>-n harness</pre><h4>Connected</h4><p>The
    following steps require a secure connection to the Internet, just like the initial
    installation of Harness.</p><h5>Upgrade Harness</h5><ol><li>Run the following
    command on the cluster hosting Harness:</li></ol><pre class="hljs bash">kubectl
    kots upstream upgrade harnesss-ng --deploy -n harness</pre><h5>Upgrade KOTS Admin
    Tool</h5><ol><li>Run the following command on the cluster hosting Harness:</li></ol><pre
    class="hljs bash">kubectl kots admin-console upgrade -n harness</pre><p></p><p></p>'
  slug: kubernetes-cluster-on-prem-kubernetes-cluster-setup
  tags:
  - on-premises
  is_live: true
