<div class="note-callout">Currently, this feature is behind the feature flag <code>NG_FILE_STORE</code>. Contact <a href="mailto:support@harness.io" target="_blank">Harness Support</a> to enable the feature.</div><p>You can use Kubernetes manifests and other configuration files in Git repos or in the Harness File Store. If you use a Git repo, Harness fetches files from the remote repo during deployment runtime.</p><p>If you use the Harness File Store, you can store files in Harness and select them in your Services. At deployment runtime, Harness simply uses the files from the Harness File Store.</p><p>File Store lets you share files with your team without managing remote repos.</p><p>For Kubernetes, the following configuration files are supported for File Store:</p><ul><li>Kubernetes Manifest</li><li>Helm Chart</li><li>OpenShift Template and OpenShift Param</li><li>Kustomize and Kustomize Patches</li></ul><div class="note-callout">Other configuration files for other integrations, such as Azure Web Apps, etc, are supported as those integrations are released.</div><p>You can access File Store from <strong>Project Setup</strong> in Harness or via the <strong>Add Manifest</strong> step during Pipeline creation.</p><p>Before You Begin</p><ul><li><a href="https://docs.harness.io/article/knunou9j30-kubernetes-cd-quickstart" target="_blank">Kubernetes CD Quickstart</a></li><li><a href="https://docs.harness.io/article/u29v1uc1mh-kubernetes-deployments-overview">Kubernetes Deployments Overview</a></li><li><a href="https://docs.harness.io/article/ssbq0xh0hx" target="_blank">Add Kubernetes Manifests</a></li><li><a href="https://docs.harness.io/article/4ifq51cp0i-add-artifacts-for-kubernetes-deployments">Add Container Images as Artifacts for Kubernetes Deployments</a></li></ul><h3>Review: File Store</h3><p>File Store is a hierarchical file manager in Harness for managing configuration files used in Pipelines.</p><p>With File Store, you can perform all of the standard file manager tasks:</p><ul><li>Create and edit folders and files at the Account, Organization, or Project level.</li><li>Upload existing configuration files from your machine to a folder in File Store.</li><li>Select configuration files or folders for deployments.</li></ul><p>You can use a combination of File Store and remote repos for your configuration files. You aren&#39;t limited to one method. </p><h3>Requirements</h3><ul><li>File Store requires the Account Admin role for Read/Write access to modify folders and files. The Account Viewer role allows you to view folders and files.</li></ul><h3>Limitation</h3><ul><li>You can upload only a single file into the File Store folder. Support for uploading multiple configuration files concurrently is not available.</li><li>The maximum file size cannot exceed 100MB.</li></ul><h3>Start a Pipeline</h3><p>This topic assumes that you have a Harness Project set up. See Create Organizations and Projects.</p><ol><li>In Harness Manager, select Pipelines and click <strong>New Pipeline</strong>.</li><li>Enter a name in <strong>Create new Pipeline</strong> and click <strong>Start</strong>.</li></ol><h3>Add a Deploy Stage</h3><p>For steps on adding a stage, see Add a Stage.</p><ol><li>Click <strong>Add Stage</strong> and select <strong>Deploy</strong>.</li><li>Name the stage, and select what you’d like to deploy. For example, select <strong>Service</strong>.</li><li>Click <strong>Set Up Stage</strong>. The new stage settings appear.</li></ol><h3>Create the Harness Service</h3><p>In Service, you can define or select the Service and Service Definition.</p><ol><li>In <strong>Specify Service</strong>, click <strong>New Service</strong> and enter a name for this service and click <strong>Save</strong>. </li><li>Select a <strong>K8s</strong> Service or create a new Service for <strong>K8s</strong>.</li><li>For <strong>Service Definition</strong>, select <strong>Kubernetes</strong>.</li></ol><p>To add your manifests, go to <strong>Manifests</strong> in the Service Definition.</p><h3>Add Kubernetes Manifests and Values YAML to File Store</h3><p>You can create folders in File Store, add manifests to those folder, and Harness will use them at runtime. </p><p>Let’s create a new folder called CD_Manifests for three manifests (deployment.yaml, service.yaml, and namespace.yaml) and a folder named Templates for the values.yaml file. In the blank file that appears for each of these manifests in File Store, we can copy the contents of a sample manifest file into each of these blank files and save them in File Store.</p><p>Note: You can create a single folder and save all of the manifest files in that folder. Or you can store the values.yaml file in a folder that is separate from a Templates folder where the deployment.yaml, service.yaml, and namespace.yaml files are stored.</p><p>You can access sample manifest files at:</p><ol><li>In Manifests, click <strong>Add Manifest</strong>.</li><li>In <strong>Specify Manifest Type</strong>, select <strong>K8s Manifest</strong> and then click <strong>Continue</strong>. </li><li>In the <strong>Specify K8s Manifest Store</strong>, select <strong>Harness</strong> and click <strong>Continue</strong>.</li></ol><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/oaihv6nry9/1659470544394/koyl-8-gawk-w-82-gc-k-15-qqig-xjbk-pi-3-pgh-ex-7-c-dbh-8-d-ehv-lwb-5-m-zsaw-6-ua-b-va-jvl-mib-9-l-w-f-we-3-q-4-mn-jk-2-r-ly-tlr-9-ew-7-zy-0-r-4-ag-fi-nr-z-1-xdt-2-nnb-qkzs-kfczzgvz-vn-0-d-mi-xcv-ed-a-9-x-70-pjyyjjv-txu.png"/></figure><ol><li>In the <strong>Manifest Details</strong> dialog, enter a name for this manifest: CD_Manifests.</li><li>In the field under <strong>File Store</strong>, click the down arrow.</li><li>In the <strong>Create or Select an Existing Config File</strong> dialog, select <strong>Project</strong>.</li><li>Click <strong>New</strong>, select <strong>New Folder</strong>, enter a name for the folder (for example, Templates), and click <strong>Save</strong>.</li><li>With this new folder selected, click <strong>New File</strong>.</li><li>Enter the file name deployment.yaml, select <strong>Manifest for File Usage</strong>, and click <strong>Create</strong>.</li></ol><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/oaihv6nry9/1659470623882/mmz-7-p-2-kr-sjb-nbf-921-jsfr-7-p-lv-ddgv-54-b-nit-4-f-xp-wih-pli-me-xqwunpj-s-1-xym-ljplfj-jdp-9-j-3-rnt-0-chq-exxr-ro-4-ds-wqh-63-ims-bzjp-ld-2-jajtln-3-h-mj-81-myr-oe-uxo-0-pzzz-aut-nsl-6-6-u-jhsi-xshywy-ho.png"/></figure><ol><li>When Harness displays the blank deployment.yaml manifest, copy the contents of the sample deployment.yaml manifest, and paste it in the blank file. Click <strong>Save</strong>. </li><li>Create the namespace.yaml and service.yaml manifests by copying, pasting, and saving the manifests in File Store.</li><li>Click New, select <strong>New Folder</strong>, name the new folder (for example, Files) and click <strong>Create</strong>.</li><li>With the Templates folder selected, click <strong>New</strong> and select <strong>New File</strong>.</li><li>In <strong>New File</strong>, enter values.yaml as the manifest name, select <strong>Manifest for File Usage</strong>, and click <strong>Create</strong>. </li><li>When the blank values.yaml manifest appears, copy the contents of the values.yaml file, and paste it in the blank file. Click <strong>Save</strong>.</li></ol><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/oaihv6nry9/1659470685727/v-k-4-yy-uc-2-h-sti-2-bnlq-lp-qwmv-y-1-e-7-hmoak-39-lvd-gpp-vi-dz-mfyry-he-shhf-5-dqzdo-kosl-9-sqex-0-ph-i-0-xv-vjz-cc-7-ms-wv-7-wahd-nz-mr-rsj-3-en-juora-xe-bnx-m-4-slo-2-kn-p-0-hkt-rjf-khwq-ng-4-dup-b-8-grieo-lt-q.png"/></figure><p></p><p>You have now completed adding folders and manifests to File Store.</p><h3>Selecting Kubernetes Manifests and Values YAML File from File Store</h3><p>You can select and apply the File Store folder with the Kubernetes manifests and the values.yaml file to your pipeline.</p><ol><li>In File Store, select the CD_Manifests folder that contains the manifests, and click <strong>Apply Selected</strong>. File Store in <strong>Manifest Details</strong> is populated with the /CD_Manifests folder and the manifests within that folder.</li><li>In <strong>Manifest Details</strong>, select Values.yaml.</li><li>In <strong>Create or Select an Existing Config file</strong>, click <strong>Project</strong>, and navigate to the CD_Manifests/Templates folder. Select values.yaml and click <strong>Apply Selected</strong>.</li><li><strong>Manifest Details</strong> is now populated with the values.yaml file. Click <strong>Submit</strong>. The manifests that you created for this service are now applied to the service.</li></ol><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/oaihv6nry9/1659470737168/jixxk-ra-ceqs-7-fv-nqb-3-r-4-xnynt-ido-0-a-uhtamzys-ch-lq-tdl-9-g-0-u-7-nmkqz-hg-sfi-vcyw-6-h-s-5-dpwt-dp-4-fiwlk-2-nv-1-sdv-ox-k-0-d-4-u-npef-tqrzgs-31-jox-q-6-rp-2-f-32-yplu-gvxru-wj-2-rn-2-fll-3-dp-gr-bu-bo-541-h-4-q.png"/></figure><h3>Example Manifests</h3><p>Manifests can use hardcoded values or a Value YAML file and templating. Harness supports Go templating. See <a href="https://docs.harness.io/article/qvlmr4plcp-example-kubernetes-manifests-using-go-templating">Example Kubernetes Manifests using Go Templating</a>.</p><p>Use the following manifests to copy into your blank manifest files in File Store and save them. Then, customize them for your environment, and apply them to your Pipelines.</p><h4>values.yaml</h4><pre>name: example<br/>replicas: 2<br/><br/>image: &lt;+artifact.image&gt;<br/># dockercfg: &lt;+artifact.imagePullSecret&gt;<br/><br/>createNamespace: true<br/>namespace: &lt;+infra.namespace&gt;<br/><br/># Service Type allow you to specify what kind of service you want.<br/># Possible values for ServiceType are:<br/># ClusterIP | NodePort | LoadBalancer | ExternalName<br/>serviceType: LoadBalancer<br/><br/># A Service can map an incoming port to any targetPort.<br/># targetPort is where application is listening on inside the container.<br/>servicePort: 80<br/>serviceTargetPort: 80<br/><br/># Specify all environment variables to be added to the container.<br/># The following two maps, config and secrets, are put into a ConfigMap<br/># and a Secret, respectively.<br/># Both are added to the container environment in podSpec as envFrom source.<br/>env:<br/>  config:<br/>    key1: value10<br/>  secrets:<br/>    key2: value2</pre><h4>deployment.yaml</h4><pre>{{- if .Values.env.config}}<br/>apiVersion: v1<br/>kind: ConfigMap<br/>metadata:<br/>  name: {{.Values.name}}<br/>data:<br/>{{.Values.env.config | toYaml | indent 2}}<br/>---<br/>{{- end}}<br/><br/>{{- if .Values.env.secrets}}<br/>apiVersion: v1<br/>kind: Secret<br/>metadata:<br/>  name: {{.Values.name}}<br/>stringData:<br/>{{.Values.env.secrets | toYaml | indent 2}}<br/>---<br/>{{- end}}<br/><br/>{{- if .Values.dockercfg}}<br/>apiVersion: v1<br/>kind: Secret<br/>metadata:<br/>  name: {{.Values.name}}-dockercfg<br/>  annotations:<br/>    harness.io/skip-versioning: true<br/>data:<br/>  .dockercfg: {{.Values.dockercfg}}<br/>type: kubernetes.io/dockercfg<br/>---<br/>{{- end}}<br/><br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: {{.Values.name}}-deployment<br/>spec:<br/>  replicas: {{int .Values.replicas}}<br/>  selector:<br/>    matchLabels:<br/>      app: {{.Values.name}}<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: {{.Values.name}}<br/>    spec:<br/>      {{- if .Values.dockercfg}}<br/>      imagePullSecrets:<br/>      - name: {{.Values.name}}-dockercfg<br/>      {{- end}}<br/>      containers:<br/>      - name: {{.Values.name}}<br/>        image: {{.Values.image}}<br/>        {{- if or .Values.env.config .Values.env.secrets}}<br/>        envFrom:<br/>        {{- if .Values.env.config}}<br/>        - configMapRef:<br/>            name: {{.Values.name}}<br/>        {{- end}}<br/>        {{- if .Values.env.secrets}}<br/>        - secretRef:<br/>            name: {{.Values.name}}<br/>        {{- end}}<br/>        {{- end}}</pre><h4>service.yaml</h4><pre>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: {{.Values.name}}-svc<br/>spec:<br/>  type: {{.Values.serviceType}}<br/>  ports:<br/>  - port: {{.Values.servicePort}}<br/>    targetPort: {{.Values.serviceTargetPort}}<br/>    protocol: TCP<br/>  selector:<br/>    app: {{.Values.name}}</pre><h4>namespace.yaml</h4><pre>{{- if .Values.createNamespace}}<br/>apiVersion: v1<br/>kind: Namespace<br/>metadata:<br/>  name: {{.Values.namespace}}<br/>{{- end}}</pre><p></p><p></p><p><br/></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>