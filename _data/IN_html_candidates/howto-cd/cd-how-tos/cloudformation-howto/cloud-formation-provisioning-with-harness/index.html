<div class="note-callout">Currently, this feature is behind the feature flag <code>CLOUDFORMATION_NG</code>. Contact <a href="mailto:support@harness.io" target="_blank">Harness Support</a> to enable the feature.</div><p></p><p>Harness lets you use CloudFormation to provision infrastructure as part of your deployment process. Harness can provision any resource that is supported by CloudFormation.</p><div class="note-callout">Looking for How-tos? See <a href="/article/vynj4hxt98-cloud-formation-how-tos">CloudFormation How-tos</a>.</div><h3>CloudFormation Provisioning Options</h3><p>You can use Harness with CloudFormation in two ways:</p><ul><li>Target Infra Provisioning: provision the target infrastructure for a deployment, and then deploy to that provisioned infrastructure.</li><li>Non-target Provisioning: provision any resources other than the target infrastructure for the deployment.</li></ul><p>You can do both in the same stage if you want.</p><h3>CloudFormation Target Infra Provisioning Summary</h3><p>You set up a CloudFormation target infrastructure provisioning in the following order:</p><ol><li>Select Dynamic Provisioning. In the Pipeline stage <strong>Infrastructure</strong>, you select the <strong>Dynamic Provisioning</strong> option and select <strong>CloudFormation</strong>.<figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/vu2qi7dfzm/1653684739137/clean-shot-2022-05-27-at-13-52-08-2-x.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure>Harness automatically adds the CloudFormation <strong>Create Stack</strong>, <strong>Harness Approval</strong>, and <strong>Delete Stack</strong> steps.<figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/vu2qi7dfzm/1653684768651/clean-shot-2022-05-27-at-13-52-32-2-x.png"/></figure>You can change these steps, but these steps perform the most common CloudFormation target deployment infrastructure process. We use that process in our CloudFormation documentation.</li><li>In the CloudFormation Create Stack step, you link Harness to the CloudFormation templates you want to use. You add the scripts by connecting to a Git repo where the scripts are kept and setting up and other common options.</li><li>Map outputs to the target Infrastructure. Harness needs a few outputs so that it can target the provisioned infrastructure, such as a cluster namespace. You simply map some outputs to the required Harness target infrastructure settings.</li><li>Deployment. The Pipeline provisions the infrastructure defined in its target Infrastructure, and then, in the stage Execution, Harness deploys to that provisioned infrastructure.</li></ol><h4>Limitations</h4><p>Infrastructure provisioning is limited to what is available in the target environment.</p><p>For example, the cloud-agnostic Kubernetes infrastructure requires that you have an existing cluster, so you cannot provision a new cluster. But it does let you provision a namespace.</p><h3>Use CloudFormation for Non-Target Deployment Provisioning</h3><p>You can use the Harness CloudFormation steps to provision any non-target resources also. You simply add the CloudFormation Create Stack step in the stage Execution.</p><div class="note-callout">See <a href="/article/vynj4hxt98-cloud-formation-how-tos">CloudFormation How-tos</a>.</div><h3>CloudFormation Rollback</h3><p>When rollback happens, Harness rolls back the provisioned infrastructure/resources to the previous successful version of the CloudFormation stack.</p><p>Harness won&#39;t increment the serial in the state, but perform a hard rollback to the exact version of the state provided.</p><p>Harness determines what to rollback using the <strong>Provision Identifier</strong> entered in the <strong>CloudFormation Rollback</strong> step.</p><p>If you&#39;ve made these settings using Harness expressions, Harness uses the values it obtains at runtime when it evaluates the expression.</p><p>See <a href="/article/5ooc4heyl4-rollback-provisioned-infra-with-the-cloud-formation-rollback-step">Rollback Provisioned Infra with the CloudFormation Rollback Step</a>.</p><p></p>