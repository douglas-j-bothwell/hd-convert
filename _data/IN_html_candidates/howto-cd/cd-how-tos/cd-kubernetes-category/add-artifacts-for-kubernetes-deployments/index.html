<p>If a public Docker image location is hardcoded in your Kubernetes manifest (for example, <code>image: nginx:1.14.2</code>), then you can simply add the manifest to Harness and the Harness Delegate will pull the image during deployment.</p><p>Alternatively, you can add the image location to Harness as an artifact in the <strong>Service Definition</strong>. This allows you to reference the image in your manifests and elsewhere using the Harness expression <code>&lt;+artifact.image&gt;</code>.</p><p>When you deploy, Harness connects to your repo and you select which image and version/tag to deploy.</p><p>With a Harness artifact, you can template your manifests, detaching them from a hardcoded location. This makes your manifests reusable and dynamic.</p><p>This topic covers adding container image locations as Harness artifacts and referencing them in your Values files.</p><h3>Before You Begin</h3><p>Make sure you&#39;ve reviewed and set up the following:</p><ul><li><a href="/article/f9bd10b3nj-install-a-kubernetes-delegate">Install a Kubernetes Delegate</a>. You must have a Harness Kubernetes Delegate running in your target Kubernetes cluster.</li><li><a href="/article/u29v1uc1mh-kubernetes-deployments-overview">Kubernetes Deployments Overview</a></li></ul><h3>Visual Summary</h3><p>To add a container image to Harness as an Artifact, you add a Harness Connector for your repository and then add the container image as an artifact source. In your Values file (values.yaml), you simply add a Harness expression where you&#39;d normally hardcode the location.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/4ifq51cp0i/1633646178768/clean-shot-2021-10-07-at-15-36-02-2-x.png"/></figure><p></p><h3>Review: Artifacts and Manifests in Harness</h3><p>There are several scenarios to consider before you use artifacts and manifests in the Harness stage:</p><ul><li><strong>Public artifact hardcoded in the manifest:</strong> if the image location is hardcoded in your Kubernetes manifest (for example, <code>image: nginx:1.14.2</code>), you do not need to use the <strong>Artifacts</strong> settings in the Harness Service Definition. The Harness Delegate will pull the image at runtime. You simply need to ensure that the Delegate can connect to the public repo.</li><li><strong>Public artifact is not hardcoded in the manifest:</strong> in this scenario, you&#39;ll use the <strong>Artifacts</strong> settings in the Harness Service Definition to identify the artifact to use and select the image and tag in Harness at runtime.<ul><li><strong>Primary artifact:</strong> In your manifest, you refer to the primary artifact you set up in Harness using the expression <code>&lt;+artifact.image&gt;</code>: <code>image: &lt;+artifact.image&gt;</code>.</li><li><strong>Sidecar artifacts:</strong> In your manifest, you refer to the sidecar artifact you set up in Harness using the expression <code>&lt;+serviceConfig.serviceDefinition.spec.artifacts.sidecars.[sidecar_identifier].spec.imagePath&gt;:&lt;+serviceConfig.serviceDefinition.spec.artifacts.sidecars.[sidecar_identifier].spec.tag&gt;</code>.<br/>In this example, <code>[sidecar_identifier]</code> is the sidecar identifier you specified when you added the sidecar artifact to Harness.</li></ul></li><li><strong>Private repo artifact:</strong> in some cases, your Kubernetes cluster might not have the permissions needed to access a private repo (GCR, etc). For these cases, you use the expression <code>&lt;+artifact.imagePullSecret&gt;</code> in the Values file and reference it in the Secret and Deployment objects in your manifest.<br/>This key will import the credentials from the Docker credentials file in the artifact.<br/>See <a href="#example_manifests">Example Manifests</a>.</li><li><strong>Service account of the Kubernetes Delegate can pull from the private repo:</strong> if the Kubernetes service account used by the Connector or Delegate has permission to pull from the private repo, you do not need to use the <strong>Artifacts</strong> settings in the Harness Service Definition. You can hardcode the image location in the manifest, and the Delegate will pull it at runtime.<br/>If multiple Delegates are selected, make sure that all of their service accounts have permission to pull from the private repo.</li><li><strong>Sidecar artifacts:</strong> sidecar artifacts follow the same rules as primary artifacts.<br/>If you do not hardcode the sidecar image location in the manifest, you will use the <strong>Artifacts</strong> settings in the Harness Service Definition to identify the sidecar artifact to use and select the image and tag in Harness at runtime.<br/>As explained above, in your Values file, you refer to the sidecar artifact you set up in Harness using the expression <code>&lt;+serviceConfig.serviceDefinition.spec.artifacts.sidecars.[sidecar_identifier].spec.imagePath&gt;:&lt;+serviceConfig.serviceDefinition.spec.artifacts.sidecars.[sidecar_identifier].spec.tag&gt;</code>.<br/>In this example, <code>[sidecar_identifier]</code> is the sidecar identifier you specified when you added the sidecar artifact.</li></ul><h3>Review: Container Registry Support</h3><p>Harness supports all of the popular container registries. You can add your container registry account as a Harness Connector.</p><p>The Connector can be added in line when you select your artifacts or separately in <strong>Project Setup</strong> (for Projects) or <strong>Account Resources</strong> (for accounts).</p><p>For steps on setting up each artifact server as a Connector, see the following <a href="/article/xxvnk67c5x-connect-to-an-artifact-repo">Connect to an Artifact Repo</a>.</p><p>If you are using Google Container Registry (GCR) or Amazon Elastic Container Registry (ECR), see <a href="https://ngdocs.harness.io/category/1ehb4tcksy">Cloud Platform Connectors</a>.</p><h3>Review: Primary and Sidecar Artifacts</h3><p>You can add a primary artifact and multiple sidecar artifacts. The sidecars are treated the same as the primary artifact. Both are deployed to the target infrastructure in the <strong>Infrastructure Definition</strong>.</p><p>You don&#39;t need to create a separate Service for a sidecar artifact. Both are added in the Service Definition. The steps for adding them are the same.</p><p>You must select artifact versions at deployment runtime for all primary and sidecar artifacts.</p><h3>Step 1: Add Deploy Stage</h3><p>For steps on adding a stage, see <a href="/article/2chyf1acil-add-a-stage">Add a Stage</a>.</p><p>When you add a stage, select <strong>Deploy</strong>.</p><p>Name the stage, and select what you&#39;d like to deploy. For example, select <strong>Service</strong>.</p><p>Click <strong>Set Up Stage</strong>.</p><p>The new stage&#39;s settings appear.</p><p>Click <strong>Next</strong> or <strong>Service</strong>.</p><h3>Step 2: Create the Harness Service</h3><p>In <strong>Service</strong>, you can define/select the Service and Service Definition.</p><div class="note-callout">Let&#39;s take a moment and review Harness Services and Service Definitions (which are explained below). Harness Services represent your microservices/apps logically.<br/><br/>You can add the same Service to as many stages are you need. Service Definitions represent your artifacts, manifests, and variables physically. They are the actual files and variable values.<br/><br/>By separating Services and Service Definitions, you can propagate the same Service across stages and change artifacts, manifests, and variables with each stage.</div><p>Select or create the Service.</p><p>To add your container image, go to <strong>Artifacts</strong> in the Service Definition.</p><h3>Step 3: Add the Artifact Source</h3><p>In <strong>Artifacts</strong>, you add connections to the images in their repos.</p><p>To demonstrate how to add the Artifact Source, we use a Docker image from a Docker Registry Connector.</p><p>In <strong>Artifacts</strong>, click <strong>Add Primary</strong> <strong>Artifact.</strong></p><p>Select the <strong>Artifact Repository Type</strong>.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/4ifq51cp0i/1644836420615/screenshot-2022-02-14-at-4-29-51-pm.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><div class="note-callout">For Azure Container Registry, use the <strong>Docker Registry</strong> type.</div><h4>Option: Docker Registry</h4><p>Select <strong>Docker Registry</strong>, and click <strong>Continue</strong>.</p><p>The <strong>Docker Registry</strong> settings appear.</p><p>Select a <a href="/article/u9bsd77g5a-docker-registry-connector-settings-reference">Docker Registry Connector</a> or create a new one.</p><div class="note-callout">In your Docker Registry Connector, to connect to a public Docker registry like Docker Hub, use <code>https://registry.hub.docker.com/v2/</code>. To connect to a private Docker registry, use <code>https://index.docker.io/v2/</code>.</div><p>Click <strong>Continue</strong>.</p><p>In <strong>Image path</strong>, enter the name of the artifact you want to deploy, such as <strong>library/nginx</strong>.</p><p>In <strong>Tag</strong>, enter the <a href="https://docs.docker.com/engine/reference/commandline/tag/" target="_blank">Docker image tag</a> for the image.</p><p>Click <strong>Submit</strong>.</p><p>The Artifact is added to the Service Definition.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/4ifq51cp0i/1617925211121/image.png"/></figure><h4>Option: Nexus</h4><div class="note-callout">Currently, this feature is behind the Feature Flag <code>NG_NEXUS_ARTIFACTORY</code>. Contact <a href="mailto:support@harness.io" target="_blank">Harness Support</a> to enable the feature.</div><p>Select <strong>Nexus</strong>, and click <strong>Continue</strong>.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/4ifq51cp0i/1648731253456/screenshot-2022-03-31-at-6-23-39-pm.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Select a <a href="/article/faor0dc98d-nexus-connector-settings-reference">Nexus Connector</a> or create a new one.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/4ifq51cp0i/1648731328792/screenshot-2022-03-31-at-6-24-50-pm.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Click <strong>Continue</strong>. The Artifact Details settings appear.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/4ifq51cp0i/1648731459510/screenshot-2022-03-31-at-6-27-07-pm.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Based on your server and network configuration, choose one of the following and fill in the details:</p><ul><li><strong>Repository URL</strong> - You can choose this for custom infrastructure with a specific hostname and/or port.<br/>Enter the URL you would use in the Docker login to fetch the artifact. This is the same as the domain name and port you use for <code>docker login hostname:port</code>.<figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/4ifq51cp0i/1651755924227/screenshot-2022-05-05-at-6-34-42-pm.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li><li><strong>Repository Port</strong> - You can choose this for standard Nexus 3 installation without any additional infrastructure.<br/>Enter the port you use for <code>docker login hostname:port</code>.<br/>The port you enter will be used along with the domain, username, and password provided in the Nexus Connector.<figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/4ifq51cp0i/1651755805488/screenshot-2022-05-05-at-3-47-05-pm.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li></ul><p>In <strong>Repository</strong>, enter the name of the repository where the artifact is located.</p><div class="note-callout">Harness supports only the Docker repository format as the Artifact source for the Nexus 3 Artifact registry.</div><p>In <strong>Artifact Path</strong>, enter the name of the artifact you want to deploy. For example <code>nginx</code>, <code>private/nginx</code>, <code>public/org/nginx</code>.</p><p>In <strong>Tag</strong>, select the tag for the image/artifact.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/4ifq51cp0i/1651756523562/screenshot-2022-05-05-at-6-44-16-pm.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>For details on the settings, see <a href="/article/faor0dc98d-nexus-connector-settings-reference">Nexus Connector Settings Reference</a>.</p><p>You can optionally add validations to Tags. To do this, click the settings icon and select the validation type.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/4ifq51cp0i/1646834941242/screenshot-2022-03-09-at-7-37-04-pm.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Click <strong>Submit</strong>.</p><p>The Artifact is added to the Service Definition.</p><h4>Option: Artifactory</h4><div class="note-callout">Currently, this feature is behind the Feature Flag <code>NG_NEXUS_ARTIFACTORY</code>. Contact <a href="mailto:support@harness.io" target="_blank">Harness Support</a> to enable the feature.</div><p>Select <strong>Artifactory</strong>, and click <strong>Continue</strong>.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/4ifq51cp0i/1648734314563/screenshot-2022-03-31-at-6-50-29-pm.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Select an <a href="/article/euueiiai4m-artifactory-connector-settings-reference">Artifactory Connector</a> or create a new one.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/4ifq51cp0i/1648734369379/screenshot-2022-03-31-at-6-50-43-pm.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Click <strong>Continue</strong>. The <strong>Artifact Details</strong> settings appear.</p><p>In <strong>Repository URL</strong>, enter the URL you would use in the Docker login to fetch the artifact. This is the same as the domain name and port you use for <code>docker login hostname:port</code>. For more information, see <a href="/article/euueiiai4m-artifactory-connector-settings-reference">Artifactory Connector Settings Reference</a>.</p><p>In <strong>Repository</strong>, enter the name of the repository where the artifact is located.</p><p>In <strong>Artifact Path</strong>, enter the name of the artifact you want to deploy. For example <code>nginx</code>, <code>private/nginx</code>, <code>public/org/nginx</code>.</p><p>In <strong>Tag</strong>, select the tag for the image/artifact. For more information, see <a href="/article/euueiiai4m-artifactory-connector-settings-reference">Artifactory Connector Settings Reference</a>.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/4ifq51cp0i/1648734529786/screenshot-2022-03-31-at-6-53-15-pm.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Click <strong>Submit</strong>.</p><p>The Artifact is added to the Service Definition.</p><p>You can add sidecar artifacts the same way.</p><p>When you run the Pipeline, select the build of the artifact(s) to use.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/4ifq51cp0i/1646886244877/screenshot-2022-03-10-at-9-53-28-am.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><h4>Option: Custom</h4><div class="note-callout">Currently, this feature is behind the Feature Flag <code>CUSTOM_ARTIFACT_NG</code>. Contact <a href="mailto:support@harness.io" target="_blank">Harness Support</a> to enable the feature.</div><p>You can select a Custom Artifact Source to add your custom repository.</p><p>Select <strong>Custom</strong> and click <strong>Continue</strong>.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/4ifq51cp0i/1650520923270/screenshot-2022-04-21-at-11-31-04-am.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>The <strong>Artifact Details</strong> settings appear.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/4ifq51cp0i/1650524096271/screenshot-2022-04-21-at-12-24-09-pm.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>In <strong>Version</strong>, enter your artifact version.</p><p>Click <strong>Submit</strong>.</p><div class="note-callout">You can only set an Artifact version number when using a Custom Artifact Source. The version you select determines the Artifact context for the deploy stage. You may refer to it anywhere in the stage by using the expression <code>&lt;+artifact.version&gt;</code>.</div><h3>Step 4: Reference the Artifact in Your Values File</h3><p>In this example, the public artifact isn&#39;t hardcoded in the manifest and we reference the image in the Service Definition <strong>Artifacts</strong> section using the variable <code>&lt;+artifact.image&gt;</code>.</p><p>For example, here&#39;s a reference in a Values file:</p><pre class="hljs yaml">...<br/>name: &lt;+stage.variables.name&gt;<br/>replicas: 2<br/><br/>image: &lt;+artifact.image&gt;<br/>dockercfg: &lt;+artifact.imagePullSecret&gt;<br/>...</pre><p></p><p>That <code>&lt;+artifact.image&gt;</code> will reference the <strong>Primary</strong> artifact.</p><p>In your manifests, you simply use the Go template reference to the <code>image</code> value (<code>{{.Values.image}}</code>):</p><pre class="hljs yaml">apiVersion: apps/v1<br/>kind: Deployment<br/>...<br/>    spec:<br/>      {{- if .Values.dockercfg}}<br/>      imagePullSecrets:<br/>      - name: {{.Values.name}}-dockercfg<br/>      {{- end}}<br/>      containers:<br/>      - name: {{.Values.name}}<br/>        image: {{.Values.image}}<br/>...</pre><p></p><p>See <a href="#example_manifests">Example Manifests</a> for more details.</p><h3>Step 5: Add Your Manifests</h3><p>Once your manifests and Values file are configured to use the artifact reference <code>&lt;+artifact.image&gt;</code>, you can add them to the Service.</p><p>See <a href="/article/ssbq0xh0hx-define-kubernetes-manifests">Define Kubernetes Manifests</a>.</p><h3>Step 6: Add Infrastructure and Execution</h3><p>Next, you&#39;ll add the target infrastructure and execution steps to your stage.</p><p>We won&#39;t cover those here, but see the <a href="/article/knunou9j30-kubernetes-cd-quickstart">Kubernetes CD Quickstart</a> for a summary.</p><h3>Example Manifests</h3><p>Below are some examples of manifests using the Harness expression for the artifact you added in <strong>Artifacts</strong> (<code>&lt;+artifact.image&gt;</code>).</p><h4>Basic Values YAML and Manifests for Public Image</h4><p>This is a simple example using the Artifact reference <code>&lt;+artifact.image&gt;</code>. It can be used whenever the public image isn&#39;t hardcoded in manifests.</p><p>We use Go templating with a values.yaml file and manifests for deployment, namespace, and service. The manifests for deployment, namespace, and service are in a <strong>templates</strong> folder that is a peer of the values.yaml file.</p><h5>values.yaml</h5><p>This file uses the <code>image: &lt;+artifact.image&gt;</code> to identify the primary artifact added in <strong>Artifacts</strong>.</p><p>It also uses <code>name: &lt;+stage.variables.name&gt;</code> to reference a Stage variable <code>name</code>, and <code>namespace: &lt;+infra.namespace&gt;</code> to reference the namespace entered in the Stage&#39;s <strong>Infrastructure Definition</strong>. Service type and ports are hardcoded.</p><p>The name, image, and namespace values are referenced in the manifests described later.</p><pre class="hljs yaml">name: &lt;+stage.variables.name&gt;<br/>replicas: 2<br/><br/>image: &lt;+artifact.image&gt;<br/># dockercfg: &lt;+artifact.imagePullSecret&gt;<br/><br/>createNamespace: true<br/>namespace: &lt;+infra.namespace&gt;<br/><br/># Service Type allow you to specify what kind of service you want.<br/># Possible values for ServiceType are:<br/># ClusterIP | NodePort | LoadBalancer | ExternalName<br/>serviceType: LoadBalancer<br/><br/># A Service can map an incoming port to any targetPort.<br/># targetPort is where application is listening on inside the container.<br/>servicePort: 80<br/>serviceTargetPort: 80<br/><br/># Specify all environment variables to be added to the container.<br/># The following two maps, config and secrets, are put into a ConfigMap<br/># and a Secret, respectively.<br/># Both are added to the container environment in podSpec as envFrom source.<br/>env:<br/>  config:<br/>    key1: value10<br/>  secrets:<br/>    key2: value2</pre><p></p><h5>templates/deployment.yaml</h5><p>The deployment manifest references the name and image values from values.yaml. The manifest also contains the ConfigMap and Secret objects.</p><pre class="hljs yaml">{{- if .Values.env.config}}<br/>apiVersion: v1<br/>kind: ConfigMap<br/>metadata:<br/>  name: {{.Values.name}}<br/>data:<br/>{{.Values.env.config | toYaml | indent 2}}<br/>---<br/>{{- end}}<br/><br/>{{- if .Values.env.secrets}}<br/>apiVersion: v1<br/>kind: Secret<br/>metadata:<br/>  name: {{.Values.name}}<br/>stringData:<br/>{{.Values.env.secrets | toYaml | indent 2}}<br/>---<br/>{{- end}}<br/><br/>{{- if .Values.dockercfg}}<br/>apiVersion: v1<br/>kind: Secret<br/>metadata:<br/>  name: {{.Values.name}}-dockercfg<br/>  annotations:<br/>    harness.io/skip-versioning: true<br/>data:<br/>  .dockercfg: {{.Values.dockercfg}}<br/>type: kubernetes.io/dockercfg<br/>---<br/>{{- end}}<br/><br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: {{.Values.name}}-deployment<br/>spec:<br/>  replicas: {{int .Values.replicas}}<br/>  selector:<br/>    matchLabels:<br/>      app: {{.Values.name}}<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: {{.Values.name}}<br/>    spec:<br/>      {{- if .Values.dockercfg}}<br/>      imagePullSecrets:<br/>      - name: {{.Values.name}}-dockercfg<br/>      {{- end}}<br/>      containers:<br/>      - name: {{.Values.name}}<br/>        image: {{.Values.image}}<br/>        {{- if or .Values.env.config .Values.env.secrets}}<br/>        envFrom:<br/>        {{- if .Values.env.config}}<br/>        - configMapRef:<br/>            name: {{.Values.name}}<br/>        {{- end}}<br/>        {{- if .Values.env.secrets}}<br/>        - secretRef:<br/>            name: {{.Values.name}}<br/>        {{- end}}<br/>        {{- end}}</pre><p></p><h5>templates/namespace.yaml</h5><p>The namespace manifest references the namespace value from values.yaml.</p><pre class="hljs yaml">{{- if .Values.createNamespace}}<br/>apiVersion: v1<br/>kind: Namespace<br/>metadata:<br/>  name: {{.Values.namespace}}<br/>{{- end}}</pre><p></p><h5>templates/service.yaml</h5><p>The service manifest references the hardcoded service type and ports from values.yaml.</p><pre class="hljs yaml">apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: {{.Values.name}}-svc<br/>spec:<br/>  type: {{.Values.serviceType}}<br/>  ports:<br/>  - port: {{.Values.servicePort}}<br/>    targetPort: {{.Values.serviceTargetPort}}<br/>    protocol: TCP<br/>  selector:<br/>    app: {{.Values.name}}</pre><p></p><h4>Private Artifact</h4><p>When the image is in a private repo, you use the expression <code>&lt;+artifact.imagePullSecret&gt;</code> in the Secret and Deployment objects in your manifest.</p><p>This key will import the credentials from the Docker credentials file in the artifact.</p><p>It&#39;s much simpler to simple use the <code>&lt;+artifact.imagePullSecret&gt;</code> expression in the values.yaml file and then reference it in other manifests.</p><p>Using the values.yaml file above, we simply remove the comment in front of <code>dockercfg: &lt;+artifact.imagePullSecret&gt;</code>:</p><pre class="hljs yaml">name: &lt;+stage.variables.name&gt;<br/>replicas: 2<br/><br/>image: &lt;+artifact.image&gt;<br/>dockercfg: &lt;+artifact.imagePullSecret&gt;<br/><br/>createNamespace: true<br/>namespace: &lt;+infra.namespace&gt;<br/>...</pre><p></p><p>You don&#39;t need to make changes to the deployment manifest from earlier. It uses Go templating to check for the <code>dockercfg</code> value in values.yaml and applies it to Secret and Deployment.</p><p>If using the condition <code>{{- if .Values.dockercfg}}</code> to check for <code>dockercfg</code> in values.yaml.</p><pre>...<br/>{{- if .Values.dockercfg}}<br/>apiVersion: v1<br/>kind: Secret<br/>metadata:<br/>  name: {{.Values.name}}-dockercfg<br/>  annotations:<br/>    harness.io/skip-versioning: true<br/>data:<br/>  .dockercfg: {{.Values.dockercfg}}<br/>type: kubernetes.io/dockercfg<br/>---<br/>{{- end}}<br/><br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: {{.Values.name}}-deployment<br/>spec:<br/>  replicas: {{int .Values.replicas}}<br/>  selector:<br/>    matchLabels:<br/>      app: {{.Values.name}}<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: {{.Values.name}}<br/>    spec:<br/>      {{- if .Values.dockercfg}}<br/>      imagePullSecrets:<br/>      - name: {{.Values.name}}-dockercfg<br/>      {{- end}}<br/>      containers:<br/>      - name: {{.Values.name}}<br/>        image: {{.Values.image}}<br/>...</pre><p></p><p></p><h3>Notes</h3><ul><li><a href="/article/lml71vhsim-harness-variables">Harness Variables and Expressions</a> may be added to Values files (for example values.yaml), not the manifests themselves. This provides more flexibility.</li><li>The Values file used in a Harness Service Definition doesn&#39;t support Helm templating, <strong>only Go templating</strong>. Helm templating is fully supported in the <u>remote</u> Helm charts you add to your Harness Service Definition. See <a href="/article/cifa2yb19a-helm-cd-quickstart">Helm CD Quickstart</a>.</li><li>Harness uses Go template version 0.4. If you are used to Helm templating, you can download Go template and try it out locally to find out if your manifests will work. This can help you avoid issues when adding your manifests to Harness.<br/>You can install Go template version 0.4 locally to test your manifests.<ul><li>Mac OS: curl -O https://app.harness.io/public/shared/tools/go-template/release/v0.4/bin/darwin/amd64/go-template</li><li>Linux: curl -O https://app.harness.io/public/shared/tools/go-template/release/v0.4/bin/linux/amd64/go-template</li><li>Windows: curl -O https://app.harness.io/public/shared/tools/go-template/release/v0.4/bin/windows/amd64/go-template</li></ul>For steps on doing local Go templating, see <a href="https://community.harness.io/t/harness-local-go-templating/460" target="_blank">Harness Local Go-Templating</a> on Harness Community.</li><li>Harness uses an internal build of Go templating. It cannot be upgraded. Harness uses <a href="http://masterminds.github.io/sprig/" target="_blank">Spring templates functions</a>, excluding those functions that provide access to the underlying OS (env, expandenv) for security reasons.<br/>In addition, Harness uses the functions ToYaml, FromYaml, ToJson, FromJson.</li></ul><p></p>