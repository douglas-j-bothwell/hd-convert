<p>The <strong>Verify</strong> step in a CD stage uses Harness Continuous Verification (CV) to verify your deployments.</p><p>Harness CV integrates with your APMs and logging tools to:</p><ul><li>Verify that the deployed service is running safely and perform automatic rollbacks.</li><li>Apply machine learning to every deployment to identify and flag anomalies in future deployments.</li></ul><p>This topic covers how to add and configure the Verify step.</p><h3>Before You Begin</h3><ul><li><a href="/article/hv2758ro4e-learn-harness-key-concepts">Learn Harness&#39; Key Concepts</a></li><li><a href="/article/knunou9j30-kubernetes-cd-quickstart">Kubernetes CD Quickstart</a></li></ul><p></p><h3>Supported Platforms and Technologies</h3><p>See <strong>Continuous Verification</strong> in <a href="/article/1e536z41av-supported-platforms-and-technologies">Supported Platforms and Technologies</a>.</p><h3>Review: What is Harness Continuous Verification (CV)?</h3><p>The more often you deploy software, the more you need to validate the health of newly deployed service instances. You need the ability to rapidly detect regressions or anomalies, and to rapidly roll back failed deployments.</p><p>You have your choice of state-of-the-art APM (application performance monitoring) and logging software to continually measure your deployment data. But before Harness, you needed to connect your data to these multiple systems, and manually monitor each provider for unusual, post-deployment activity.</p><p>Harness&#39; Continuous Verification (CV) approach simplifies verification. Harness uses machine learning to identify normal behavior for your applications. This allows Harness to identify and flag anomalies in future deployments, and to perform automatic rollbacks.</p><h3>Review: CV Setup Options</h3><p>To use the Verify step, you will need a Harness Service Reliability Management Monitored Service. In the simplest terms, a Monitored Service is basically a mapping of a Harness Service to a service monitored by your APM or logging tool.</p><p>You can set up a Monitored Service in the Service Reliability Management module or in the Verify step in a CD stage. The process is the same.</p><p>No matter where you set up the Monitored Service, once it&#39;s set up, it&#39;s available to both Service Reliability Management and CD modules.</p><p>In this topic we&#39;ll set up the Monitored Service as part of the <strong>Verify</strong> step.</p><h3>Step 1: Add Verify Step</h3><p>There are two ways to add the Verify step:</p><ul><li><strong>When selecting the stage deployment strategy:</strong><br/>The <strong>Verify</strong> step can be enabled in a CD stage the first time you open the <strong>Execution</strong> settings and select the deployment strategy. When you select the deployment strategy you want to use, there is also an <strong>Enable Verification</strong> option. Select the <strong>Enable Verification</strong> option.<br/>Harness will automatically add the <strong>Verify</strong> step. For example, here is a stage where Canary strategy and the <strong>Enable Verification</strong> option were selected.<figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/3xhqq9xllp/1629841311860/clean-shot-2021-08-24-at-14-41-30.png"/></figure></li><li><strong>Add the Verify step to an existing Execution setup:</strong> You can also add the Verify step to the Execution section of a CD stage in a Pipeline you previously created. Simply click <strong>Add Step</strong> after the deployment step, and then select <strong>Verify</strong>.<figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/3xhqq9xllp/1629841332662/clean-shot-2021-08-24-at-14-42-00.png"/></figure></li></ul><h3>Step 2: Enter a Name and Timeout</h3><p>In <strong>Name</strong>, enter a name for the step.</p><p>In <strong>Timeout</strong>, enter a timeout value for the step.</p><p>You can use:</p><ul><li><code>w</code>¬†for weeks</li><li><code>d</code>¬†for days</li><li><code>h</code>¬†for hours</li><li><code>m</code>¬†for minutes</li><li><code>s</code>¬†for seconds</li><li><code>ms</code>¬†for milliseconds</li></ul><p>The maximum is¬†<code>53w</code>.Timeouts can be set at the Pipeline level also.</p><h3>Step 3: Select a Continuous Verification Type</h3><p>In <strong>Continuous Verification Type</strong>, select a type that matches your deployment strategy.</p><p><strong>Rolling</strong>, <strong>Canary</strong>, and <strong>Blue Green</strong> simply refer to the strategy in the stage.</p><p>For example, Canary deployment strategies use the <strong>Canary</strong> Continuous Verification type, and so on.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/3xhqq9xllp/1629842329188/clean-shot-2021-08-24-at-14-58-23.png"/></figure><p></p><p>For <strong>Load Test</strong>, Harness compares the current Verify step execution with the last successful run of the Verify step. The first time you run the Pipeline there&#39;s no comparison. The comparisons are made is successive deployments.</p><p>Typically, <strong>Load Test</strong> is used in lower environments like QA where there is no continuous load and the deployments are usually verified by generating load via scripts, etc.</p><h3>Step 4: Create a Monitored Service</h3><p>In <strong>Monitored Service</strong>, click <strong>Click to autocreate a monitored service</strong>.</p><p>Harness automatically creates a Monitored Service using a concatenation of the Service and Environment names. For example, a Service named <code>todolist</code> and an Environment named <code>dev</code> will result in a Monitored Service named <code>todolist_dev</code>.</p><p>If the stage Service or Environment settings are <a href="/article/f6yobn7iq0-runtime-inputs">Runtime Inputs</a>, the Monitored Service and Health Sources settings will show up in the <strong>Runtime Input</strong> settings when you run the Pipeline.</p><h3>Step 5: Add Health Sources</h3><p>A Health Source is basically a mapping of a Harness Service to the service in a deployment environment monitored by an APM or logging tool.</p><p>A Health Source is a combination of the following:</p><ul><li>Health Source type. This is the APM or logging tool monitoring the deployment environment. For example, AppDynamics or Splunk.</li><li>Connection to the APM or logging tool monitoring the deployment environment. This is set up as a Harness Connector.</li><li>The APM or logging tool feature used in monitoring. For example, AppDynamics Application Monitoring.</li><li>The APM or logging tool settings that let you select the deployment environment. For example, an AppDynamics application and tier.</li><li>Metric Pack: the metrics you want to use in verification. For example, Errors and Performance.</li></ul><p>In <strong>Health Sources</strong>, click <strong>Add</strong>. The <strong>Add New Health Source</strong> settings appear.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/3xhqq9xllp/1629845578124/clean-shot-2021-08-24-at-15-52-49.png"/></figure><p>In <strong>Select health source type</strong>, select your APM or logging tool. Each tool requires its own Health Source.</p><p>In <strong>Health Source Name</strong>, enter a name for the Health Source.</p><p>Click in <strong>Select Connector</strong>.</p><p>In the <strong>Connector</strong> settings, select a Connector to your APM or logging tool or click <strong>New Connector</strong>.</p><p>Here&#39;s an example of an AppDynamics Connector&#39;s settings:</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/3xhqq9xllp/1629845989568/clean-shot-2021-08-24-at-15-59-21.png"/></figure><p>When your Connector is set up, click <strong>Apply Selected</strong>. The Connector is added to the Health Source.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/3xhqq9xllp/1629846048596/clean-shot-2021-08-24-at-16-00-43.png"/></figure><p>In <strong>Select Feature</strong>, select the APM or logging tool component to use. For example, AppDynamics <strong>Application Monitoring</strong>.</p><p>Click <strong>Next</strong>.</p><p>The settings in <strong>Customize Health Source</strong> will depend on the Health Source Type you selected. For example, here are the Customize Health Source settings for an AppDynamics Health Source:</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/3xhqq9xllp/1629848868081/clean-shot-2021-08-24-at-16-47-40.png"/></figure><p>The AppDynamics application and tier are selected to map the Harness Service to the monitored environment.</p><p>In <strong>Metric Packs</strong>, select the metrics you want Harness to use.</p><p>Click <strong>Validation Passed</strong> or <strong>No Data</strong> to see the data received from the tool. Some metrics might not have data at this time.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/3xhqq9xllp/1629849173325/clean-shot-2021-08-24-at-16-52-19.png"/></figure><p>Click <strong>View calls to [Provider Name]</strong> to see the requests and responses of each call.</p><p>Click <strong>Submit</strong>. The Health Source is displayed in the Verify step.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/3xhqq9xllp/1629849284635/clean-shot-2021-08-24-at-16-54-36.png"/></figure><p>You can add more Health Sources for each APM or logging provider.</p><h3>Step 6: Select Sensitivity</h3><p>In <strong>Sensitivity</strong>, you select the risk level that will be used as failure criteria during the deployment. When the criteria are met, the Failure Strategy for the stage or step is executed.</p><p>For time-series analysis (APM), the risk level is determined using standard deviations, as follows: 5ùûº¬†(<a href="https://watchmaker.uncommons.org/manual/ch03s05.html">sigma</a>) represents high risk, 4ùûº represents medium risk, and 3ùûº or below represents low risk.</p><p>Harness also takes into account the number of points that deviated: 50%+ is <strong>High</strong>, 25%-50% is <strong>Medium</strong>, and 25% or below is <strong>Low</strong>.</p><p>Every successful deployment contributes to creating and shaping a healthy baseline that tells Harness what a successful deployment looks like, and what should be flagged as a risk. If a deployment failed due to verification, Harness will not consider any of the metrics produced by that deployment as part of the baseline.</p><p></p><h3>Step 7: Select Duration</h3><p>In <strong>Duration</strong>, select the number of data points Harness uses. If you enter 10 minutes, Harness will take the first 10 minutes worth of the log/APM data points and analyze it.</p><p>The length of time it takes Harness to analyze the 10 min of data points depends on the number of instances being analyzed and the monitoring tool. If you have a 1000 instances, it can take some time to analyze the first 10 minutes of all of their logs/APM data points.</p><p>The recommended <strong>Duration</strong> is <strong>10 min</strong> for logging providers and <strong>15 min</strong> for APM and infrastructure providers.</p><p>Harness waits 2-3 minutes to allow enough time for the data to be sent to the verification provider before it analyzes the data. This wait time is a standard with monitoring tools. So, if you set the¬†<strong>Duration</strong>¬†to 10 minutes, the 10 minutes excludes the initial 2-3 minute wait, but the total sample time is 13 minutes.</p><h3>Step 8: Specify Artifact Tag</h3><p>In <strong>Artifact Tag</strong>, use a <a href="/article/lml71vhsim-harness-variables">Harness expression</a> to reference the artifact in the stage Service settings.</p><p>The expression <code>&lt;+serviceConfig.artifacts.primary.tag&gt;</code> references the primary artifact.</p><h3>Option: Advanced Settings</h3><p>In Advanced, you can use the following options:</p><ul><li><a href="/article/i36ibenkq2-step-skip-condition-settings">Step Skip Condition Settings</a></li><li><a href="/article/htrur23poj-step-failure-strategy-settings">Step Failure Strategy Settings</a></li><li><a href="/article/nnuf8yv13o-select-delegates-with-selectors">Select Delegates with Selectors</a></li></ul><p>By default, Harness adds the following Failure Strategy for <strong>Verification Failures</strong>:</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/3xhqq9xllp/1629852853615/clean-shot-2021-08-24-at-17-53-40.png"/></figure><p>You can change the strategy to perform different actions, but leave the <strong>Verification Failures</strong> type to ensure that the Pipeline rolls back if it fails verification.</p><h3>Step 9: Deploy and Review Results</h3><p>When you are done setting up the <strong>Verify</strong> step, click <strong>Apply Changes</strong>.</p><p>Now you can run the Pipeline. Click <strong>Run</strong>.</p><p>In <strong>Run Pipeline</strong>, select the tag for the artifact if a tag was not added in the <strong>Artifact Details</strong> settings.</p><p>Click <strong>Run Pipeline</strong>.</p><p>When the Pipeline is running, click the <strong>Verify</strong> step.</p><p>You can see that the verification takes a few minutes.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/3xhqq9xllp/1649854005997/screenshot-2022-04-13-at-6-16-09-pm.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><h4>Summary</h4><p>The <strong>Summary</strong> section shows how many metrics and logs are in violation.</p><h4>Console View</h4><p>You can take a deeper look at verification, click <strong>Console View</strong> or simply click <strong>View Details</strong> in <strong>Summary</strong>.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/3xhqq9xllp/1649854277360/screenshot-2022-04-13-at-6-20-52-pm.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Each row shows the metric name, Health Source name, risk type, nodes etc.</p><p>If you have more than one Health Source, click the Health Source dropdown to select each one.</p><h3>See Also</h3><ul><li><a href="/article/17wrdeuv0x-canary-deployment-step">Canary Deployment Step</a></li></ul><p></p>