<p>A <a href="/article/0zsf97lo3c-deployment-concepts">rolling update strategy</a> updates Kubernetes deployments with zero downtime by incrementally updating pod instances with your new app version. New pods are scheduled on nodes using the available resources.</p><p>This method is similar to a standard Canary strategy, but different from the Harness Kubernetes Canary strategy. The Harness Kubernetes Canary strategy uses a canary phase followed by a rolling update as its final phase. See <a href="/article/i5p4feil89">Create a Kubernetes Canary Deployment</a> for more information.</p><div class="note-callout">For a detailed explanation of Kubernetes rolling updates, see <a href="https://kubernetes.io/docs/tutorials/kubernetes-basics/update/update-intro/">Performing a Rolling Update</a> from Kubernetes.</div><h3>Before You Begin</h3><ul><li><a href="/article/knunou9j30-kubernetes-cd-quickstart">Kubernetes CD Quickstart</a></li><li><a href="/article/ssbq0xh0hx-define-kubernetes-manifests">Add Kubernetes Manifests</a></li><li><a href="/article/0ud2ut4vt2-define-your-kubernetes-target-infrastructure">Define Your Kubernetes Target Infrastructure</a></li></ul><h3>Review: What Workloads Can I Deploy?</h3><p>Stages using Harness Canary and Blue/Green steps only support <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" target="_blank">Kubernetes Deployment workloads</a>.</p><p>The Rolling Deployment step supports all workloads except Jobs.</p><p>The <a href="/article/00el61pzok">Apply Step</a> can deploy any workloads or objects in any strategy including Rolling Deployment.</p><p>In Harness, a workload is a Deployment, StatefulSet, or DaemonSet object deployed and managed to steady state.</p><h4>Rolling vs Apply</h4><p>The following table lists the differences between the Rolling Deployment step (default in a Rolling strategy) and the Apply step (which may be used with any strategy).</p><table><tbody><tr><td><p></p></td><td><p><strong>Jobs</strong></p></td><td><p><strong>Rollback</strong></p></td></tr><tr><td><p><strong>Rolling Deployment step</strong></p></td><td><p>No</p></td><td><p>Yes</p></td></tr><tr><td><p><strong>Apply step</strong></p></td><td><p>Yes</p></td><td><p>No</p></td></tr></tbody></table><p></p><p></p><h4>Multiple Managed Workloads</h4><p>With the Rolling Deployment step, you can deploy multiple managed workloads.</p><p>For Canary and Blue/Green steps, only one managed object may be deployed per step by default.</p><p>You can deploy additional objects using the <a href="/article/00el61pzok-deploy-manifests-separately-using-apply-command">Apply Step</a>, but it is typically used for deploying Jobs controllers.</p><div class="note-callout">You can specify the multiple workload objects in a single manifest or in individual manifests, or any other arrangement.</div><p>Here is the log from a deployment where you can see both Deployment objects deployed:</p><pre>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: anshul-multiple-workloads-deployment<br/>spec:<br/>  replicas: 1<br/>  selector:<br/>    matchLabels:<br/>      app: anshul-multiple-workloads<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: anshul-multiple-workloads<br/>    spec:<br/>      containers:<br/>      - name: anshul-multiple-workloads<br/>        image: registry.hub.docker.com/library/nginx:stable<br/>        envFrom:<br/>        - configMapRef:<br/>            name: anshul-multiple-workloads<br/>        - secretRef:<br/>            name: anshul-multiple-workloads<br/>---<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: anshul-multiple-workloads-deployment-1<br/>spec:<br/>  replicas: 3<br/>  selector:<br/>    matchLabels:<br/>      app: anshul-multiple-workloads<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: anshul-multiple-workloads<br/>    spec:<br/>      containers:<br/>      - name: anshul-multiple-workloads<br/>        image: registry.hub.docker.com/library/nginx:stable<br/>        envFrom:<br/>        - configMapRef:<br/>            name: anshul-multiple-workloads<br/>        - secretRef:<br/>            name: anshul-multiple-workloads</pre><p></p><h3>Step 1: Define Rollout Strategy</h3><p>There are no mandatory Rolling Update–specific settings for manifests in the Harness Service. You can use any Kubernetes configuration.</p><p>The default Rolling Update strategy used by Harness is:</p><pre class="hljs http">RollingUpdateStrategy:  25% max unavailable, 25% max surge</pre><p></p><p>If you want to set a Rolling Update strategy that is different from the default, you can include the strategy settings in your Deployment manifest:</p><pre class="hljs properties">strategy:<br/>  type: RollingUpdate<br/>  rollingUpdate:<br/>    maxSurge: 1<br/>    maxUnavailable: 1</pre><p></p><p>For details on the settings, see <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#rollingupdatedeployment-v1-apps">RollingUpdateDeployment</a> in the Kubernetes API.</p><h3>Step 2: Define the Service and Infrastructure</h3><p>Create your CD Pipeline stage.</p><p>To set up your Service and Infrastructure in the stage, follow the steps in these topics:</p><ul><li><a href="/article/ssbq0xh0hx-define-kubernetes-manifests">Add Kubernetes Manifests</a></li><li><a href="/article/0ud2ut4vt2-define-your-kubernetes-target-infrastructure">Define Your Kubernetes Target Infrastructure</a></li></ul><h3>Step 3: Add the Rollout Step</h3><p>In the stage&#39;s <strong>Execution</strong>, click <strong>Add Step</strong>, and select <strong>Rolling Deployment</strong>.</p><p>That&#39;s it. Harness will perform the Kubernetes rollout using your manifests and artifacts.</p><p>To change the default settings, click the <strong>Rolling Deployment</strong> step.</p><p>See <a href="/article/2bwlugh9gi-kubernetes-rollout-step">Kubernetes Rollout Step</a> for settings.</p><h3>Step 4: Deploy</h3><p>Let&#39;s look at what the <strong>Rollout Deployment</strong> step does in the deployment logs.</p><h4>Apply</h4><p>The Apply section deploys the manifests from the Service <strong>Manifests</strong> section as one file.</p><pre class="hljs nginx">kubectl --kubeconfig=config apply --filename=manifests.yaml --record<br/><br/>configmap/harness-example-config-3 configured<br/>deployment.apps/harness-example-deployment created<br/><br/>Done.</pre><h4>Wait for Steady State</h4><p>The Wait for Steady State section shows the containers and pods rolled out.</p><pre class="hljs coffeescript">kubectl --kubeconfig=config get events --output=custom-columns=KIND:involvedObject.kind,NAME:.involvedObject.name,MESSAGE:.message,REASON:.reason --watch-only<br/><br/>kubectl --kubeconfig=config rollout status Deployment/harness-example-deployment --watch=true<br/><br/><br/>Status : Waiting for deployment &#34;harness-example-deployment&#34; rollout to finish: 0 of 2 updated replicas are available...<br/>Event  : Pod    harness-example-deployment-5674658766-6b2fw   Successfully pulled image &#34;registry.hub.docker.com/library/nginx:stable-perl&#34;   Pulled<br/>Event  : Pod   harness-example-deployment-5674658766-p9lpz   Successfully pulled image &#34;registry.hub.docker.com/library/nginx:stable-perl&#34;   Pulled<br/>Event  : Pod   harness-example-deployment-5674658766-6b2fw   Created container   Created<br/>Event  : Pod   harness-example-deployment-5674658766-p9lpz   Created container   Created<br/>Event  : Pod   harness-example-deployment-5674658766-6b2fw   Started container   Started<br/>Event  : Pod   harness-example-deployment-5674658766-p9lpz   Started container   Started<br/><br/>Status : Waiting for deployment &#34;harness-example-deployment&#34; rollout to finish: 1 of 2 updated replicas are available...<br/><br/>Status : deployment &#34;harness-example-deployment&#34; successfully rolled out<br/><br/>Done.</pre><h4>Wrap Up</h4><p>The Wrap Up section shows the Rolling Update strategy used.</p><pre class="hljs makefile">...<br/>Name:                   harness-example-deployment<br/>Namespace:              default<br/>CreationTimestamp:      Sun, 17 Feb 2019 22:03:53 +0000<br/>Labels:                 &lt;none&gt;<br/>Annotations:            deployment.kubernetes.io/revision: 1<br/>                        kubectl.kubernetes.io/last-applied-configuration:<br/>                          {&#34;apiVersion&#34;:&#34;apps/v1&#34;,&#34;kind&#34;:&#34;Deployment&#34;,&#34;metadata&#34;:{&#34;annotations&#34;:{&#34;kubernetes.io/change-cause&#34;:&#34;kubectl apply --kubeconfig=config --f...<br/>                        kubernetes.io/change-cause: kubectl apply --kubeconfig=config --filename=manifests.yaml --record=true<br/>Selector:               app=harness-example<br/>Replicas:               2 desired | 2 updated | 2 total | 2 available | 0 unavailable<br/>StrategyType:           RollingUpdate<br/>MinReadySeconds:        0<br/>RollingUpdateStrategy:  25% max unavailable, 25% max surge<br/>...<br/>NewReplicaSet:   harness-example-deployment-5674658766 (2/2 replicas created)<br/>Events:<br/>  Type    Reason             Age   From                   Message<br/>  ----    ------             ----  ----                   -------<br/>  Normal  ScalingReplicaSet  8s    deployment-controller  Scaled up replica set harness-example-deployment-5674658766 to 2<br/><br/>Done.</pre><h3>Example: Rolling Update Deployment</h3><p>Now that the setup is complete, you can click <strong>Run Pipeline</strong>.</p><p>The Pipeline is deployed.</p><p>To see the completed deployment, log into your cluster and run <code>kubectl get all</code>. The output lists the new Deployment:</p><pre class="hljs properties">NAME                                                   READY     STATUS    RESTARTS   AGE<br/>pod/harness-example-deployment-5674658766-6b2fw        1/1       Running   0          34m<br/>pod/harness-example-deployment-5674658766-p9lpz        1/1       Running   0          34m<br/>                                                       <br/>NAME                                                   TYPE           CLUSTER-IP      EXTERNAL-IP      PORT(S)        AGE<br/>service/kubernetes                                     ClusterIP      10.83.240.1     &lt;none&gt;           443/TCP        34m<br/>                                                       <br/>NAME                                                   DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE<br/>deployment.apps/harness-example-deployment             2         2         2            2           34m<br/>                                                       <br/>NAME                                                   DESIRED   CURRENT   READY     AGE<br/>replicaset.apps/harness-example-deployment-5674658766  2         2         2         34m</pre><p></p><h3>Notes</h3><ul><li><strong>Rolling Rollback step:</strong> you can add a <strong>Rolling Rollback</strong> step to your stage to roll back the workloads deployed by the <strong>Rollout Deployment</strong> step.<br/>Simply add this step where you want to initiate a rollback. Note that this command applies to the deployments of the Rollout Deployment command, and not the <a href="/article/00el61pzok">Apply Step</a> command.</li></ul><h3>Next Steps</h3><ul><li><a href="/category/85tr1q4hin-cd-k8s-ref">Kubernetes CD Reference</a></li></ul><p></p>