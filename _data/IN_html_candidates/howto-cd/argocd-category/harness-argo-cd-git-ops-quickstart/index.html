<p>This quickstart shows you how to connect Argo CD and Harness to perform GitOps deployments in Harness. Argo CD syncs state between your Kubernetes resource files (Kubernetes, Helm Charts, Kustomize, etc) and your target environments. By relying on the source files as the single source of truth, Argo CD gives you automated, traceable, declarative, version controlled Kubernetes deployments.</p><p>Once Argo CD is connected to Harness, the Argo CD interface is exposed in the Harness Manager and you can create and manage your Argo CD Applications using Harness.</p><div class="note-callout">If you&#39;re new to Argo CD, see <a href="https://argo-cd.readthedocs.io/en/stable/getting_started/">Argo CD Getting Started Guide</a>.</div><p>In this topic:</p><ul><li><a href="https://ngdocs.harness.io/article/ptlvh7c6z2-harness-argo-cd-git-ops-quickstart#objectives">Objectives</a></li><li><a href="https://ngdocs.harness.io/article/ptlvh7c6z2-harness-argo-cd-git-ops-quickstart#visual_summary">Visual Summary</a></li><li><a href="https://ngdocs.harness.io/article/ptlvh7c6z2-harness-argo-cd-git-ops-quickstart#before_you_begin">Before You Begin</a></li><li><a href="https://ngdocs.harness.io/article/ptlvh7c6z2-harness-argo-cd-git-ops-quickstart#step_1_install_the_adapter_in_the_cluster">Step 1: Install the Adapter in the Cluster</a></li><li><a href="https://ngdocs.harness.io/article/ptlvh7c6z2-harness-argo-cd-git-ops-quickstart#step_2_get_the_adapter_url_from_the_cluster">Step 2: Get the Adapter URL from the Cluster</a></li><li><a href="https://ngdocs.harness.io/article/ptlvh7c6z2-harness-argo-cd-git-ops-quickstart#step_3_permit_the_url_in_your_browser">Step 3: Permit the URL in Your Browser</a></li><li><a href="https://ngdocs.harness.io/article/ptlvh7c6z2-harness-argo-cd-git-ops-quickstart#step_4_connect_argo_cd_adapter_to_harness">Step 4: Connect Argo CD Adapter to Harness</a></li><li><a href="https://ngdocs.harness.io/article/ptlvh7c6z2-harness-argo-cd-git-ops-quickstart#summary">Summary</a></li></ul><h3>Objectives</h3><p>In this quickstart you will learn how to create the Harness Argo CD Adapter and connect Argo CD to Harness. In this process you will:</p><ul><li>Download and edit the Harness Argo CD Adapter Kubernetes manifest files.</li><li>Deploy the Harness Argo CD Adapter to the cluster running Argo CD.</li><li>Add the Harness Argo CD Adapter in Harness and connect Argo CD with Harness.</li></ul><h3>Visual Summary</h3><p>Harness connects to Argo CD using a Harness Adapter. The Adapter acts as a proxy server and enables Cross-Origin Resource Sharing (CORS). This allows Argo CD Server to be loaded in the Harness Manager hosted in your web browser. When using this Adapter, no additional configuration changes are required in your Argo CD instance.</p><div class="note-callout">The Argo CD Adapter only makes secure outbound connections to Harness. There are no inbound connections.</div><p>Once the Adapter is installed and connected to the Argo CD instance, the Argo CD interface can be exposed in Harness using the Adapter. Then you can use Argo CD from within Harness just like you would when logging into the Argo CD Server through a browser.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/ptlvh7c6z2/1634060093345/image.png"/></figure><h3>Before You Begin</h3><p>Make sure you have the following:</p><ul><li><strong>Kubernetes Cluster with Argo CD installed</strong>: This cluster is where you will install the Harness Adapter.</li><li><strong>Access to GitHub:</strong> This is needed to use the YAML files for the Harness Argo CD Adapter.</li></ul><p>If you&#39;re new to Argo CD, see <a href="https://argo-cd.readthedocs.io/en/stable/getting_started/">Argo CD Getting Started Guide</a>.</p><h3>Step 1: Install the Adapter in the Cluster</h3><p>To install the Adapter, do the following:</p><p>Download the Harness Argo CD Adapter Kubernetes YAML file from <a href="https://github.com/wings-software/harness-docs/blob/main/argoui-adapter/argo-quickstart.yaml">GitHub</a> or copy and paste it into a text editor<strong>.</strong></p><p>This quickstart uses the <a href="https://github.com/wings-software/harness-docs/blob/main/argoui-adapter/argo-quickstart.yaml">argo-quickstart.yaml</a> manifest (<code>https://github.com/wings-software/harness-docs/blob/main/argoui-adapter/argo-quickstart.yaml</code>).</p><div class="note-callout">There are other manifests in the repo for different use cases:<br/><br/>- <strong>adapter-trusted.yaml:</strong> When deploying the Adapter with a trusted CA certificate. See <a href="https://github.com/wings-software/harness-docs/blob/main/argoui-adapter/adapter-trusted.yaml" target="_blank">adapter-trusted.yaml</a>.<br/>- <strong>adapter-selfsigned.yaml:</strong> When deploying the Adapter with a self-signed certificate. See <a href="https://github.com/wings-software/harness-docs/blob/main/argoui-adapter/adapter-selfsigned.yaml" target="_blank">adapter-selfsigned.yaml</a>.<br/></div><p>You can see that the image for the Adapter is <code>argocd-ui-proxy</code>. When you deploy this manifest, Kubernetes pulls the image from a public repository on <a href="https://hub.docker.com/r/harness/argocd-ui-proxy">DockerHub</a>.</p><p>Update the manifest for the URL of your Argo CD Server.</p><p>In the <code>ConfigMap</code> manifest, replace <code>&lt;ArgoCdServerURL&gt;</code> with the Argo CD Server URL. The Argo CD Server URL is the URL Endpoint for the Argo CD Server. The same URL you would use to log into Argo CD Server in your browser.</p><pre>kind: ConfigMap<br/>metadata:<br/>    name: harness-argocd-adapter<br/>    namespace: argocd<br/>data:<br/>    ARGO_CD_URL: &lt;<em>ArgoCdServerURL</em>&gt;<br/>    ALLOWED_ORIGINS: https://app.harness.io</pre><p></p><div class="note-callout">For Harness On-Prem editions, the <code>ALLOWED_ORIGINS</code> setting should use the IP address or domain name you use to log into Harness On-Prem. Typically this is the IP address of the load balancer for Harness On-Prem or a DNS domain name that resolves to that IP address.</div><p>In the Service manifest, you can see <code>loadBalancerSourceRanges</code> with the following Harness IP addresses:</p><pre>loadBalancerSourceRanges:<br/>    - 34.82.155.149/32<br/>    - 34.83.51.28/32<br/>    - 35.230.70.231/32<br/>    - 35.236.117.224/32<br/>    - 35.236.112.238/32</pre><p>You will need these IPs added to <code>loadBalancerSourceRanges</code> whenever you are using Argo CD with the SaaS version of Harness.</p><div class="note-callout">If you are using Harness On-Prem, you do not need <code>loadBalancerSourceRanges</code>. You can delete it from the file.</div><p>Once the file is updated, save it locally as <code>argo-quickstart.yaml</code>. Navigate to the folder where the file is saved. </p><p>Log into the Kubernetes cluster where Argo CD is installed.</p><p>Apply the Kubernetes file:</p><pre>kubectl apply -f argo-quickstart.yaml</pre><p></p><p>The output will look like this:</p><pre>configmap/harness-argocd-adapter created<br/>service/harness-argocd-adapter created<br/>deployment.apps/harness-argocd-adapter created</pre><p></p><p>Now the Harness Argo CD Adapter is running. Next, you will use the Adapter URL in Harness to connect to Argo CD Server.</p><h3>Step 2: Get the Adapter URL from the Cluster</h3><p>Now that the Adapter is running, you can obtain its endpoint URL. You&#39;ll use this endpoint URL to add a new Adapter in the Harness Manager.</p><p>Here is an example using GKE.</p><p>Open the GKE cluster where you installed the Adapter.</p><p>Click <strong>Workloads</strong>, and then search <code>Name:harness-argocd-adapter.</code></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/ptlvh7c6z2/1632965886446/gke-example.png" style="max-height:40%;max-width:40%" data-hd-height="40%" data-hd-width="40%"/></figure><p>Click <strong>harness-argocd-adapter</strong> workload.</p><p>The workload can take some time to start. If you see the following error messages, simply wait a few minutes.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/ptlvh7c6z2/1632966047264/deployment-details.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>In <strong>Exposing services</strong>, locate the <code>harness-argocd-adapter</code> endpoint. Kubernetes can take a little while to set up the Service endpoints.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/ptlvh7c6z2/1632966119624/exposing-service-2.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Copy the endpoint URL. You do not need the port number.</p><h3>Step 3: Permit the URL in Your Browser</h3><p>The <a href="https://github.com/wings-software/harness-docs/blob/main/argoui-adapter/argo-quickstart.yaml">argo-quickstart.yaml</a> manifest we used does not use a certificate. Consequently, you need to permit the URL in your browser.</p><div class="note-callout">When you use the manifests for trusted or self-signed certificates, you do not need to do this step.</div><p>Open a new tab in your browser.</p><p>Paste the Adapter URL endpoint into your browser and press enter. The browser will show the following error messages. </p><ul><li>For <strong>Firefox</strong>, you will see the error message <strong>Warning: Potential Security Risk Ahead</strong>.<ul><li>Click <strong>Advanced</strong>, and then click <strong>Accept the Risk and Continue</strong>. The Argo CD UI will load.</li></ul></li><li>For <strong>Google Chrome</strong>, you will see the error message <strong>Your connection is not private</strong>.<ul><li>Click anywhere in the blank space of the page and type <code>thisisunsafe</code>. The Argo CD UI will load.</li></ul></li></ul><p>Now you can use the URL in your Harness account.</p><h3>Step 4: Connect Argo CD Adapter to Harness</h3><p>Log into Harness.</p><p>Open your Harness <a href="/article/36fw2u92i4-create-an-organization">Project</a> and click the <strong>Deployments</strong> module.</p><p>In <strong>Deployments</strong>, click <strong>GitOps</strong>.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/ptlvh7c6z2/1633690562046/screenshot-2021-10-08-at-4-24-57-pm.png" style="max-height:40%;max-width:40%" data-hd-height="40%" data-hd-width="40%"/></figure><p>Click <strong>New Adapter</strong><strong>.</strong> The <strong>Adapter Overview page</strong> appears.</p><p>In <strong>Name</strong>, enter the name for your Adapter. For example, <strong>Quickstart</strong>.</p><p>In <strong>Adapter URL</strong>, enter the Adapter endpoint URL that you <a href="https://ngdocs.harness.io/article/ptlvh7c6z2-harness-argo-cd-git-ops-quickstart#step_2_get_the_adapter_url_from_the_cluster">obtained from cluster</a>.</p><div class="note-callout">Do not enter any trailing slash in the URL.</div><p>Click <strong>Save and Continue</strong>. The adapter is added.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/ptlvh7c6z2/1633933501372/picture-1.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Your Argo CD Server is displayed.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/ptlvh7c6z2/1632966474092/argo-cd-server.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Log into your Argo CD Server.</p><p>Your Argo CD Application appears.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/ptlvh7c6z2/1633933766258/picture-2.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Now you can use Argo CD in Harness for GitOps.</p><h3>Summary</h3><p>In this quickstart, you learned how to:</p><ul><li>Download and edit the Harness Argo CD Adapter Kubernetes manifest files.</li><li>Deploy the Harness Argo CD Adapter to the cluster running Argo CD.</li><li>Add the Harness Argo CD Adapter in Harness and connect Argo CD with Harness.</li></ul><p></p><p></p>