<p>Barriers allow you to synchronize different stages and <a href="/article/ihnuhrtxe3-run-steps-in-parallel-using-a-step-group">step groups</a> in your Pipeline and control the flow of your deployment systematically.</p><div class="note-callout">Harness provide multiple options for controlling resource usage and protecting capacity limits. See <a href="/article/7ogetmgq7y-controlling-deployments-with-barriers-resource-constraints-and-queue-steps">Controlling Resource Usage with Barriers, Resource Constraints, and Queue Steps</a>.</div><h3>Before You Begin</h3><ul><li><a href="/article/knunou9j30-kubernetes-cd-quickstart">Kubernetes CD Quickstart</a></li></ul><h3>Review: Barriers and Synchronization</h3><p>When deploying interdependent services, such as microservices or a large and complicated application, there might be a need to coordinate the timing of the different components&#39; deployments. A common example is the need to verify a group of services only after <em>all the services</em> are deployed successfully.</p><p>Harness address this scenario using Barriers. Barriers allow you to synchronize different stages and step groups in your Pipeline, and control the flow of your deployment systematically.</p><p>Barriers have an effect only when two or more stages/step groups use the same barrier name (<strong>Barrier Reference</strong> setting in the Barrier step), and are executed in parallel in a Pipeline. When executed in parallel, both stages/step groups will cross the barrier at the same time.</p><p>If a stage/step group fails before reaching its barrier point, the stage/step group signals the other stages/step groups that have the same barrier, and the other stages/step groups will react as if they failed as well. At that point, each stage/step group will act according to its <a href="/article/0zvnn5s1ph-define-a-failure-strategy-on-stages-and-steps">Define a Failure Strategy on Stages and Steps</a>.</p><p>Here&#39;s a visualization of three stages run in parallel using Barriers. Stages A and B will wait for each other to reach Barrier X and Stages B and C will wait for each other to reach Barrier Y.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/dmlf8w2aeh/1629326840828/clean-shot-2021-08-18-at-15-47-02.png"/></figure><h3>Step 1: Add Barrier</h3><p>A barrier is simply a name added in a Pipeline&#39;s <strong>Flow Control</strong> settings.</p><p>In your Pipeline, click <strong>Flow Control</strong>.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/dmlf8w2aeh/1629398383036/clean-shot-2021-08-19-at-11-39-13.png"/></figure><p>In <strong>Flow Control</strong>, click <strong>Add Barrier</strong>.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/dmlf8w2aeh/1629398445808/clean-shot-2021-08-19-at-11-40-40.png"/></figure><p>In <strong>Barrier Name</strong>, enter a unique name, and then click outside of the settings. The barrier is created.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/dmlf8w2aeh/1629398517980/clean-shot-2021-08-19-at-11-41-50.png"/></figure><p>Next, the name is selected using the <strong>Barrier</strong> step in the stages where you want to synchronize.</p><h3>Step 2: Configure Barrier</h3><p>To apply a barrier, do the following:</p><p>In your stage, in Execution, click <strong>Add Step</strong>, and then click <strong>Barrier</strong>.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/dmlf8w2aeh/1629326888512/clean-shot-2021-08-18-at-15-48-00.png"/></figure><p>Enter a name for the step.</p><p>In <strong>Timeout</strong>, enter the timeout period, in milliseconds. For example, 600000 milliseconds is 10 minutes. The timeout period determines how long each stage with a barrier must wait for the other stage to reach their barrier point. When the timeouts expire, it is considered a deployment failure.</p><div class="note-callout">Barrier timeouts are not hard timeouts. A barrier can fail anytime between timeout + 1min.</div><p>In <strong>Barrier Reference</strong>, select the name of an existing barrier.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/dmlf8w2aeh/1629398714903/clean-shot-2021-08-19-at-11-44-56.png"/></figure><p>Click <strong>Apply Changes</strong>.</p><div class="note-callout">You cannot use a Harness variable expression in <strong>Barrier Reference</strong>.</div><p>Now you can add another Barrier step using the same name to another stage at the point where you want to synchronize execution.</p><h3>Notes</h3><ul><li>You can have multiple barriers in a stage/step group. Every barrier in the same stage/step group must use a unique <strong>Barrier Reference</strong>.</li><li>Ensure the Barrier Reference string for each related barrier across the different stages/step groups matches.</li></ul><p></p>