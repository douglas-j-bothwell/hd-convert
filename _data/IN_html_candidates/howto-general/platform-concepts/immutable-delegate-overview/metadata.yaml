type: article
article_id: 4zzg5qitkv
user_id: znazf3hcp9
category_id: sy6sod35zi
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/77114bb5eef5503c5a09ad7655120b17?d=mm&s=150
title: Immutable Delegate Overview
slug: immutable-delegate-overview
description: Learn about Immutable Delegates
short_version: Learn about Immutable Delegates
tags: []
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: ""
  source: API
  triggered_at: 2022-07-06T16:45:00.23241Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Immutable Delegate Overview
  description: Learn about Immutable Delegates
  short_version: Learn about Immutable Delegates
  body: '<div class="note-callout">Currently, this feature is behind the feature flag
    <code>USE_IMMUTABLE_DELEGATE</code>and in Beta. Contact <a href="mailto:support@harness.io"
    target="_blank">Harness Support</a> to enable the feature. Enabling this Feature
    Flag means that any future Delegates you install will be immutable, but it doesn’t
    impact existing <a href="/article/f9bd10b3nj-install-a-kubernetes-delegate">Legacy
    Kubernetes Delegates</a>.</div><p>Containerized Delegates can be installed as
    Legacy or Immutable Delegates.</p><p>Immutable Delegates differ from Legacy Delegates
    in a number of ways.</p><ul><li>Legacy:<ul><li>Downloads Delegate components and
    dependencies at installation.</li><li>Delegate includes a Watch process that upgrades
    the Delegate automatically.</li><li>See <a href="/article/f9bd10b3nj-install-a-kubernetes-delegate">Install
    a Legacy Kubernetes Delegate</a>.</li></ul></li><li>Immutable:<ul><li>All binaries
    and dependencies are installed when the image is built.</li><li>Ephemeral pods
    for Kubernetes Delegates.</li><li>Security scanning of Delegates is possible.</li><li>Faster
    setup time.</li><li>Custom Delegate images can be created by simply building a
    new image from each image/version Harness releases. Installing additional tools
    like Terraform and others becomes a lot easier.</li><li>See <a href="/article/4ax6q6dxa4-install-an-immutable-kubernetes-delegate">Install
    an Immutable Kubernetes Delegate</a>.</li></ul></li></ul><p>The standard installation
    process in the Harness Manager for both types is the same.</p><h3 id="What-types-of-delegates-are-supported-for-immutable-delegate?">What
    types of Delegates are supported for Immutable Delegates?</h3><p>Currently, only
    Kubernetes Delegates. We will add support for other containerized Delegates soon.</p><h3
    id="Are-there-any-UI-changes-?">Are there any UI changes?</h3><p>No.</p><h3 id="What-base-image-is-used-by-the-immutable-delegate?">What
    Base Image is used by the Immutable Delegate?</h3><p>The Immutable Delegate is
    based on <code>redhat/ubi8-minimal:8.4</code>.</p><h3 id="Is-the-image-signed?">Is
    the Image Signed?</h3><p>Yes, the image is signed. You can check it by running
    the command <code>docker trust inspect --pretty harness/delegate-immutable:22.03.74407</code>.</p><h3
    id="Does-the-new-delegate-emit-Prometheus-metrics?">Does the Immutable Delegate
    emit Prometheus Metrics?</h3><p>Immutable delegates come with Prometheus annotations
    and these metrics exposed:</p><ol><li>Current tasks running.</li><li>Tasks waiting
    in queue.</li><li>Time taken in tasks executions.</li></ol><p>Below are the annotations
    in the YAMK. Prometheus can be configured to scrape metrics on port 3460 and endpoint
    /api/metrics.</p><pre class="hljs yaml">annotations:<br/>  prometheus.io/scrape:
    &#34;true&#34;<br/>  prometheus.io/port: &#34;3460&#34;<br/>  prometheus.io/path:
    &#34;/api/metrics&#34;</pre><h3 id="Root-vs-non-root">Root vs Non-Root</h3><p>The
    Immutable Delegate doesn’t have a root image. There are only two images for the
    same tag and they are both non-root. For example:</p><ul><li><code>harness/delegate-immutable:22.03.74411</code></li><li><code>harness/delegate-immutable:22.03.74411.minimal</code></li></ul><p>The
    first one has the client tools like kubectl, Helm, ChartMuseum, etc included.
    The minimal image does not have those tools.</p><p>If you want to install more
    tools in the image, we recommend you make your own image.</p><h3 id="Do-I-need-to-migrate-all-my-existing-delegates?">Do
    I need to Migrate all my Existing Legacy Delegates?</h3><p>No, existing (non-immutable)
    Legacy Delegates can continue working in parallel with any new Immutable Delegates.</p><p>You
    can migrate Legacy Delegates over time.</p><h3 id="How-to-migrate-my-existing-delegates-to-be-immutable?">How
    do I Migrate my Existing Delegates to be Immutable?</h3><p>Currently there is
    no automated process for this.</p><p>You will need to add new Immutable Delegates.</p><h3
    id="What-if-the-Delegate-keeps-restarting?">What if the Immutable Delegate keeps
    Restarting?</h3><p>Immutable Delegates are configured to get probed by Kubernetes
    for liveness every 10s. If two probes fail, the pod will restart.</p><p>Make sure
    that the liveness/startup probes are accessible by Kubernetes and that they add
    sufficient delay so that the Delegate has enough time to start up in your environment.</p><p>With
    the default resource configuration, the Delegate should take around 45-60s to
    startup.</p><h3 id="How-do-I-use-a-custom-delegate-image?">How do I use a Custom
    Delegate Image?</h3><p>See <strong>Custom Installation</strong> in <a href="/article/4ax6q6dxa4-install-an-immutable-kubernetes-delegate">Install
    an Immutable Kubernetes Delegate</a></p><h3 id="Which-upgrader-image-should-I-use?">Which
    Upgrader Image should I Use?</h3><p>For the upgrader component, we will be releasing
    versioned images (e.g. <code>1.0.0</code>), but also a <code>latest</code> tag,
    which represents the latest released image (highest version number) for the time
    being.</p><p>The upgrader component doesn&#39;t yet support automatic upgrading,
    so we will default to using the <code>latest</code> image tag (which will get
    pulled every time upgrader runs, effectively upgrading it).</p>'
  slug: immutable-delegate-overview
  tags: []
  is_live: true
