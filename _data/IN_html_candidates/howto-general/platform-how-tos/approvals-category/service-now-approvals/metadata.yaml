type: article
article_id: h1so82u9ub
user_id: 2te4j9f9g7
category_id: 2d7y1cr09y
author:
  name: Rashmi Nanda Sahoo
  profile_image: https://www.gravatar.com/avatar/b7bfd905f8714099535f2ff657fa3975?d=mm&s=150
title: Adding ServiceNow Approval Steps and Stages
slug: service-now-approvals
description: Describes how to add ServiceNow-based approvals for a Pipeline.
short_version: Describes how to add ServiceNow-based approvals for a Pipeline.
tags:
- ServiceNow
- Pipelines
- Approvals
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: ""
  source: API
  triggered_at: 2022-09-12T19:23:03.045097Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Adding ServiceNow Approval Steps and Stages
  description: Describes how to add ServiceNow-based approvals for a Pipeline.
  short_version: Describes how to add ServiceNow-based approvals for a Pipeline.
  body: '<p>You can use ServiceNow tickets to approve or reject a Pipeline or stage
    at any point in its execution.</p><p>During deployment, a ServiceNow ticket&#39;s
    fields are evaluated according to the criteria you define, and its approval/rejection
    determines if the Pipeline or stage may proceed.</p><p>Approvals can be added
    as stages or in-between stage steps to prevent stage execution from proceeding
    without approval.</p><p>For example, in a <a href="/article/mog5tnk5pi-create-a-kubernetes-blue-green-deployment">Kubernetes
    Blue Green Deployment</a>, you might want to add an approval step between the
    Stage Deployment step, where the new app version is deployed to the staging environment,
    and the Swap Primary with Stage step, where production traffic is routed to the
    pods for the new version.</p><h3>Before You Begin</h3><ul><li><a href="/article/illz8off8q-connect-to-service-now">Connect
    to ServiceNow</a></li></ul><h3>Review: ServiceNow Approval Stages vs Steps</h3><p>You
    can use ServiceNow Approvals in two ways:</p><ul><li><strong>ServiceNow Approval
    step:</strong> you can add a ServiceNow Approval step to any Pipeline or Approval
    stage.</li><li><strong>ServiceNow</strong> <strong>Approval stage:</strong> the
    ServiceNow Approval stage.<figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/h1so82u9ub/1640002249102/screenshot-2021-12-20-at-5-37-12-pm.png"
    style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure></li></ul><h3>UTC
    Timezone Only</h3><p>The ServiceNow API only allows date time and time values
    in the UTC timezone. Consequently, input for any datetime/time fields in Harness
    ServiceNow steps must be provided in UTC format irrespective of time zone settings
    in your ServiceNow account.</p><p>The timezone settings govern the <u>display
    value</u> of the settings not their <u>actual</u> value.</p><div class="note-callout">The
    display values in the Harness UI depend on ServiceNow timezone settings.</div><h3>Step:
    Add an Approval Step</h3><p>In your Pipeline, click <strong>Add Stage</strong>.</p><figure><img
    src="https://files.helpdocs.io/i5nl071jo5/articles/h1so82u9ub/1639056094384/screenshot-2021-12-09-at-6-50-53-pm.png"
    style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure><p>Click
    <strong>Approval</strong>. The Stage settings appear.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/h1so82u9ub/1639056215972/screenshot-2021-12-09-at-6-53-07-pm.png"
    style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure><p>In
    <strong>Name</strong>, enter a name for your Stage and select <strong>ServiceNow</strong>
    as approval type. Click <strong>Setup Stage</strong>. The ServiceNow Approval
    settings appear.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/h1so82u9ub/1639993512644/screenshot-2021-12-20-at-3-14-22-pm.png"
    style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure><p>In <strong>Timeout</strong>,
    enter how long you want Harness to try to complete the step before failing (and
    initiating the stage or step <a href="/article/0zvnn5s1ph-define-a-failure-strategy-on-stages-and-steps">Failure
    Strategy</a>).</p><p>You can use <code><strong>w</strong></code>  for week, <code><strong>d</strong></code>  for
    day, <code><strong>h</strong></code>  for hour, <code><strong>m</strong></code>  for
    minutes, <code><strong>s</strong></code>  for seconds and <code><strong>ms</strong></code> for
    milliseconds. For example, 1d for one day.</p><p>ServiceNow communication can
    take a few minutes. Do not use a brief timeout.</p><div class="note-callout">The
    maximum is 3w 3d 20h 30m.</div><p>In <strong>ServiceNow</strong> <strong>Connector</strong>
    create or select the <a href="/article/illz8off8q-connect-to-service-now">ServiceNow
    Connector</a> you want to use.</p><p>Select the ServiceNow <strong>Ticket Type</strong>.</p><p>Enter
    the <strong>Issue Number</strong>.</p><h3>Step 2: Set Approval Criteria</h3><p>The <strong>Approval
    Criteria</strong> in the step determines if the Pipeline or stage is approved
    or rejected.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/h1so82u9ub/1640003318519/screenshot-2021-12-20-at-5-58-11-pm.png"
    style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure><div
    class="note-callout">Whether the Pipeline/stage stops executing depends on the
    stage or step <a href="/article/0zvnn5s1ph-define-a-failure-strategy-on-stages-and-steps">Failure
    Strategy</a>.</div><p>You can specify criteria using <strong>Conditions</strong> and/or <strong>JEXL
    Expression</strong>. If you use them in combination, they both must evaluate to <code>True</code> for
    the step to be successful.</p><p>In <strong>Conditions</strong>, you can use the
    ServiceNow ticket related fields to define approval criteria.</p><p>In <strong>JEXL
    Expression</strong>, you can use <a href="https://commons.apache.org/proper/commons-jexl/reference/syntax.html"
    target="_blank">JEXL expressions</a>. You can use a JEXL expression if the field
    is set to <strong>Fixed value</strong> or <strong>Expression</strong>.</p><h3>Option:
    Set Rejection Criteria</h3><p>In <strong>Optional Configuration</strong>, in <strong>Rejection
    Criteria</strong>, you can define criteria for rejecting the approval.</p><p>If
    you add rejection criteria it is used in addition to the settings in <strong>Approval
    Criteria</strong>.</p><h3>Option: Advanced Settings</h3><p>In <strong>Advanced</strong>,
    you can use the following options:</p><ul><li><a href="/article/nnuf8yv13o-select-delegates-with-selectors#option_select_a_delegate_for_a_step_using_tags">Delegate
    Selector</a></li><li><a href="https://ngdocs.harness.io/article/i36ibenkq2-step-skip-condition-settings">Step
    Skip Condition Settings</a></li><li><a href="https://ngdocs.harness.io/article/htrur23poj-step-failure-strategy-settings">Step
    Failure Strategy Settings</a></li></ul><h3>Step 3: Apply and Test</h3><p>Click <strong>Apply
    Changes</strong>. The ServiceNow approval step is added to the stage.</p><p>Run
    the Pipeline.</p><p>When the ServiceNow Approval step is reached, you can see
    its approval and rejection criteria:</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/h1so82u9ub/1640006368709/screenshot-2021-12-20-at-6-44-48-pm.png"
    style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure><h3>Review:
    Issue Expressions</h3><p>You can use <code>&lt;+ticket&gt;</code> to refer to
    the value in the <strong>JEXL Expression</strong> setting.</p><p>For example, <code>&lt;+ticket.state.displayValue&gt;
    == &#34;New&#34;</code> in the Approval Criteria, <strong>JEXL Expression</strong> checks
    to see if the status of the ticket is <strong>New.</strong></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/h1so82u9ub/1640004463342/screenshot-2021-12-20-at-6-17-02-pm.png"
    style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure><p><code>state</code> is
    a ticket field. You can use any ticket field.</p><h3>See Also</h3><ul><li><a href="/article/fkvso46bok-adding-harness-approval-stages">Using
    Manual Harness Approval Stages</a></li><li><a href="/article/43pzzhrcbv-using-harness-approval-steps-in-cd-stages">Using
    Manual Harness Approval Steps in CD Stages</a></li></ul><p></p>'
  slug: service-now-approvals
  tags:
  - ServiceNow
  - Pipelines
  - Approvals
  is_live: true
