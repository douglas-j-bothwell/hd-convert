type: article
article_id: 2lhfk506r8
user_id: mfr0nxh4be
category_id: 2d7y1cr09y
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Adding Jira Approval Stages and Steps
slug: adding-jira-approval-stages
description: Use Jira issues to approve or reject a Pipeline or stage at any point
  in its execution.
short_version: Use Jira issues to approve or reject a Pipeline or stage at any point
  in its execution.
tags: []
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: ""
  source: API
  triggered_at: 2022-09-13T22:21:47.953572Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Adding Jira Approval Stages and Steps
  description: Use Jira issues to approve or reject a Pipeline or stage at any point
    in its execution.
  short_version: Use Jira issues to approve or reject a Pipeline or stage at any point
    in its execution.
  body: '<p>You can use Jira issues to approve or reject a Pipeline or stage at any
    point in its execution.</p><p>During deployment, a Jira issue&#39;s fields are
    evaluated according to criteria you define and its approval/rejection determines
    if the Pipeline or stage may proceed.</p><p>The <strong>Jira Approval</strong>
    step can be added in Jira Approval stages or in CD stages. The Jira Approval step
    prevents the stage execution from proceeding without an approval.</p><p>For example,
    in a <a href="https://ngdocs.harness.io/article/mog5tnk5pi-create-a-kubernetes-blue-green-deployment">Kubernetes
    Blue Green Deployment</a>, you might want to add an approval step between the
    Stage Deployment step, where the new app version is deployed to the staging environment,
    and the Swap Primary with Stage step, where production traffic is routed to the
    pods for the new version.</p><div class="note-callout">Looking to create or update
    Jira issues? See <a href="https://ngdocs.harness.io/article/yu40zr6cvm-create-jira-issues-in-cd-stages">Create
    Jira Issues in CD Stages</a>, <a href="https://ngdocs.harness.io/article/urdkli9e74-update-jira-issues-in-cd-stages">Update
    Jira Issues in CD Stages</a>.</div><h3>Before You Begin</h3><ul><li><a href="/article/e6s32ec7i7-connect-to-jira">Connect
    to Jira</a></li><li><a href="/article/yu40zr6cvm-create-jira-issues-in-cd-stages">Create
    Jira Issues in CD Stages</a></li><li><a href="/article/urdkli9e74-update-jira-issues-in-cd-stages">Update
    Jira Issues in CD Stages</a></li></ul><h3>Visual Summary</h3><p>The following
    video shows you how to use the Jira Create, Jira Update, and Jira Approval steps:</p><div
    class="hd--embed" data-provider="YouTube" data-thumbnail="https://i.ytimg.com/vi/xVeICozz4lU/hqdefault.jpg"><iframe
    width="200" height="150" src="https://www.youtube.com/embed/xVeICozz4lU?feature=oembed"
    frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media;
    gyroscope; picture-in-picture" allowfullscreen=""></iframe></div><h3>Limitations</h3><ul><li>Harness
    supports only Jira fields of type <code>Option</code>, <code>Array</code>, <code>Any</code>, <code>Number</code>, <code>Date</code>,
    and <code>String</code>. Harness does not integrate with Jira fields that manage
    users, issue links, or attachments. This means that Jira fields like Assignee
    and Sprint are not accessible in Harness&#39; Jira integration.</li></ul><h3>Review:
    Jira Approval Stages vs Steps</h3><p>You can use Jira Approvals in two ways:</p><ul><li><strong>Jira
    Approval step:</strong> you can add a Jira Approval step to any CD or Approval
    stage.</li><li><strong>Jira Approval stage:</strong> the Jira Approval stage includes
    Jira Create, Jira Approval, and Jira Update steps:</li></ul><p></p><figure><img
    src="https://files.helpdocs.io/i5nl071jo5/articles/2lhfk506r8/1624574708529/clean-shot-2021-06-24-at-15-44-54.png"/></figure><p>You
    do not need to use the Jira Create and Jira Update steps with the Jira Approval
    step, but they are included in the Jira Approval stage because many users want
    to create a Jira issue, approve/reject based on its settings, and then update
    the Jira issue all in one stage.</p><p>You can also achieve this simply by using
    the Jira Create, Jira Approval, and Jira Update steps within a non-Approval stage.</p><p>The
    Jira Create and Jira Update steps are described in other topics. This topic describes
    the Jira Approval step only.</p><p>See:</p><ul><li><a href="/article/yu40zr6cvm-create-jira-issues-in-cd-stages">Create
    Jira Issues in CD Stages</a></li><li><a href="/article/urdkli9e74-update-jira-issues-in-cd-stages">Update
    Jira Issues in CD Stages</a></li></ul><h3>Step 1: Add a Jira Approval Step</h3><p>In
    a CD or Approval stage, click <strong>Add Step</strong>, and then click <strong>Jira
    Approval</strong>.</p><p>When you add a Jira Approval stage, Harness automatically
    adds Jira Create, Jira Approval, and Jira Update steps. We&#39;ll only cover the
    Jira Approval step here.</p><p>In <strong>Name</strong>, enter a name that describes
    the step.</p><p>In <strong>Timeout</strong>, enter how long you want Harness to
    try to complete the step before failing (and initiating the stage or step <a href="/article/0zvnn5s1ph-define-a-failure-strategy-on-stages-and-steps">Failure
    Strategy</a>).</p><p>You can use <code><strong>w</strong></code>  for week, <code><strong>d</strong></code>  for
    day, <code><strong>h</strong></code>  for hour, <code><strong>m</strong></code>  for
    minutes, <code><strong>s</strong></code>  for seconds and <code><strong>ms</strong></code> for
    milliseconds. For example, 1d for one day.</p><p>Jira communication can take a
    few minutes. Do not use a brief timeout.</p><div class="note-callout">The maximum
    is 3w 3d 20h 30m.</div><p>In <strong>Jira Connector</strong>, create or select
    the <a href="/article/e6s32ec7i7-connect-to-jira">Jira Connector</a> to use.</p><p>In
    <strong>Project</strong>, select the Jira project that contains the issue you
    want to evaluate.</p><p>In <strong>Issue Key</strong>, enter the Jira issue key
    of the issue you want to evaluate.</p><h3>Option: Use an Expression in Issue Key</h3><p>In
    <strong>Issue Key</strong>, you can use an expression to reference the Key ID
    from another Jira Create or Jira Update step.</p><p>The Jira Create or Jira Update
    step you want to reference must be before the Jira Approval step that references
    it in the Pipeline and stage.</p><p>First, identify the step where you want to
    get the ID from.</p><div class="note-callout">You&#39;ll have to close the Jira
    Approval step to get the the ID from the previous step. An ID is required, so
    you can just enter any number for now and click <strong>Save</strong>.</div><p>In
    the Pipeline, click <strong>Execution History</strong>.</p><p>Select a successful
    execution, and click the Jira Create/Update step in the execution.</p><p>Click
    the <strong>Output</strong> tab, locate the <strong>Key</strong> setting, and
    click the copy button.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/urdkli9e74/1624558389534/clean-shot-2021-06-24-at-11-12-58.png"/></figure><p>The
    expression will look something like this:</p><p><code>&lt;+pipeline.stages.Jira_Stage.spec.execution.steps.jiraCreate.issue.key&gt;</code></p><p>Now
    you have the expression that references the key ID from this step.</p><p>Go back
    to your Jira Approval step. You can just select <strong>Edit Pipeline</strong>.</p><p>In
    <strong>Issue Key</strong>, select <strong>Expression</strong>.</p><p></p><figure><img
    src="https://files.helpdocs.io/i5nl071jo5/articles/2lhfk506r8/1624576045521/clean-shot-2021-06-24-at-16-07-15.png"/></figure><p>In
    <strong>Issue Key</strong>, paste in the expression you copied from the previous
    Jira Create/Update step.</p><p>Now this Jira Approval step will use the issue
    created by the Jira Create/Update step.</p><div class="note-callout">Some users
    can forget that when you use a Jira Create step it creates a <u>new</u>, independent
    Jira issue every time it is run. If you are using the same issue ID in Jira Approval,
    you are approving using a new issue every run.</div><h3>Step 2: Set Approval Criteria</h3><p>The
    <strong>Approval Criteria</strong> in the step determines if the Pipeline or stage
    is approved or rejected.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/2lhfk506r8/1624576828708/clean-shot-2021-06-24-at-16-20-21.png"/></figure><div
    class="note-callout">Whether the Pipeline/stage stops executing depends on the
    stage or step <a href="/article/0zvnn5s1ph-define-a-failure-strategy-on-stages-and-steps">Failure
    Strategy</a>.</div><p>You can specify criteria using <strong>Conditions</strong>
    and/or <strong>JEXL Expression</strong>. If you use them in combination they both
    must evaluate to <code>True</code> for the step to be successful.</p><p>In <strong>Conditions</strong>,
    you simply use the Jira Field, Operator, and Value to define approval criteria.</p><p>In
    <strong>JEXL Expression</strong>, you can use <a href="https://commons.apache.org/proper/commons-jexl/reference/syntax.html"
    target="_blank">JEXL expressions</a>. You can use a JEXL expression if the field
    is set to <strong>Fixed value</strong>, <strong>Runtime input</strong>, or <strong>Expression</strong>.</p><h3>Option:
    Set Rejection Criteria</h3><p>In <strong>Optional Configuration</strong>, in <strong>Rejection
    Criteria</strong>, you can define criteria for rejecting the approval.</p><p>If
    you add rejection criteria it is used in addition to the settings in <strong>Approval
    Criteria</strong>.</p><h3>Option: Advanced Settings</h3><p>In Advanced, you can
    use the following options:</p><ul><li><a href="/article/i36ibenkq2-step-skip-condition-settings">Step
    Skip Condition Settings</a></li><li><a href="/article/htrur23poj-step-failure-strategy-settings">Step
    Failure Strategy Settings</a></li></ul><p></p><h3>Step 3: Apply and Test</h3><p>Click
    <strong>Apply Changes</strong>. The Jira Update step is added to the stage.</p><p>Run
    the Pipeline.</p><p>When the Jira Approval step is reached, you can see its approval
    and rejection criteria:</p><p></p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/2lhfk506r8/1624577480045/clean-shot-2021-06-24-at-16-31-07.png"/></figure><p>You
    can also click the <strong>JIRA Ticket Pending Approval</strong> link to open
    the ticket.</p><p>The step can take a few minutes to receive information from
    Jira.</p><h3>Review: Issue Expressions</h3><p>You can use <code>&lt;+issue&gt;</code>
    to refer to the value in the <strong>Issue Key</strong> setting.</p><p>For example,
    <code>&lt;+issue.Status&gt; == &#34;Done&#34;</code> in the Approval Criteria
    <strong>JEXL Expression</strong> checks to see in the status of the issue in Issue
    Key is <strong>Done</strong>:</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/2lhfk506r8/1624657108562/clean-shot-2021-06-25-at-14-38-11.png"/></figure><p><code>Status</code>
    is an issue field. You can use any issue field.</p><h3>See Also</h3><ul><li><a
    href="/article/fkvso46bok-adding-harness-approval-stages">Using Manual Harness
    Approval Stages</a></li><li><a href="/article/43pzzhrcbv-using-harness-approval-steps-in-cd-stages">Using
    Manual Harness Approval Steps in CD Stages</a></li></ul><p></p>'
  slug: adding-jira-approval-stages
  tags: []
  is_live: true
