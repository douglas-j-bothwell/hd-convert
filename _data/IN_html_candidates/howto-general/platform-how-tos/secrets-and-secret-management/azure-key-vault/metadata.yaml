type: article
article_id: 53jrd1cv4i
user_id: 2te4j9f9g7
category_id: 48wnu4u0tj
author:
  name: Rashmi Nanda Sahoo
  profile_image: https://www.gravatar.com/avatar/b7bfd905f8714099535f2ff657fa3975?d=mm&s=150
title: Add an Azure Key Vault Secret Manager
slug: azure-key-vault
description: This document explains steps to add and use Azure Key Vault to store
  and use encrypted secrets, such as access keys.
short_version: This document explains steps to add and use Azure Key Vault to store
  and use encrypted secrets, such as access keys.
tags:
- Secrets Management
- Platform
- azure
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: ""
  source: API
  triggered_at: 2022-09-12T03:50:24.103458Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Add an Azure Key Vault Secret Manager
  description: This document explains steps to add and use Azure Key Vault to store
    and use encrypted secrets, such as access keys.
  short_version: This document explains steps to add and use Azure Key Vault to store
    and use encrypted secrets, such as access keys.
  body: '<p>To store and use encrypted secrets (such as access keys) and files, you
    can add an Azure Key Vault Secret Manager.</p><h3>Before You Begin</h3><ul><li>See
    Harness <a href="/article/hngrlb7rd6-harness-secret-manager-overview">Secret Manager
    Overview</a>.</li><li>See <a href="https://docs.microsoft.com/en-us/azure/key-vault/general/overview">About
    Azure Key Vault</a> by Microsoft.</li><li>See <a href="https://docs.microsoft.com/en-us/azure/key-vault/general/basic-concepts">Azure
    Key Vault Basic Concepts</a>.</li><li>Make sure you have set up an Azure account.</li><li>Make
    sure you have <strong>View</strong> and <strong>Create/Edit</strong> permissions
    for secrets.</li></ul><h3>Review: Secret Manager Overview</h3><p>For a full overview
    of how your secrets are used with the Secrets Managers you configure in Harness,
    please see <a href="/article/hngrlb7rd6-harness-secret-manager-overview">Harness
    Secrets Management Overview</a> and <a href="/article/320domdle1-harness-security-faqs">Harness
    Security FAQs</a>.</p><p>Here&#39;s a visual summary:</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/53jrd1cv4i/1652464280315/image.png"/></figure><h3>Limitations</h3><ul><li>Key
    Vault stores and manages secrets as sequences of octets (8-bit bytes), with a
    maximum size of 25k bytes each. For more information, see <a href="https://docs.microsoft.com/en-us/azure/key-vault/secrets/about-secrets">Azure
    Key Vault secrets</a>.</li></ul><h3>Visual Overview</h3><p>Azure Key Vault safeguards
    cryptographic keys and secrets, encrypting authentication keys, storage account
    keys, data encryption keys, .pfx files, and passwords.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/53jrd1cv4i/1623393632575/screenshot-2021-06-11-at-12-09-45-pm.png"
    style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure><h3>Step
    1: Create Azure Reader Role</h3><p>To enable Harness to later fetch your Azure
    vaults (in Step 7 below), you must first set up a <strong>Reader</strong> role
    in Azure. You can do this two ways:</p><ul><li> Azure Portal</li><li> PowerShell
    Command</li></ul><h3>Step 2: Create a Reader Role in Azure</h3><p>To create a
    <strong>Reader</strong> role in the Azure portal UI:</p><p>Navigate to Azure&#39;s
    <strong>Subscriptions</strong> page.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/53jrd1cv4i/1623394114616/screenshot-2021-06-11-at-12-16-26-pm.png"
    style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure><p>Under
    <strong>Subscription name</strong>, select the subscription where your vaults
    reside.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/2nv0gy1wnh/1585695399595/image.png"
    style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure><div
    class="tip-callout"><strong>Tip:</strong> Copy and save the <strong>Subscription
    ID</strong>. You can paste this value into Harness Manager below at Option: Enter
    Subscription.</div><p>Select your <strong>Subscription’s Access control (IAM)</strong>
    property.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/2nv0gy1wnh/1585528480442/image.png"
    style="max-height:35%;max-width:35%" data-hd-height="35%" data-hd-width="35%"/></figure><p>On
    the resulting <strong>Access control (IAM)</strong> page, select <strong>Add a
    role assignment</strong>.</p><p>In the resulting right pane, set the <strong>Role</strong>
    to <strong>Reader</strong>.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/2nv0gy1wnh/1585529001796/image.png"
    style="max-height:35%;max-width:35%" data-hd-height="35%" data-hd-width="35%"/></figure><p>Accept
    the default value: <strong>Assign access to</strong>: <strong>Azure AD user</strong>,
    <strong>group, or service principal</strong>.</p><p>In the <strong>Select</strong>
    drop-down, select the name of your Azure App registration.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/2nv0gy1wnh/1585529163155/image.png"
    style="max-height:35%;max-width:35%" data-hd-height="35%" data-hd-width="35%"/></figure><p>Click
    <strong>Save</strong>.</p><p>On the <strong>Access control (IAM)</strong> page,
    select the <strong>Role assignments</strong> tab. Make sure your new role now
    appears under the <strong>Reader</strong> group.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/2nv0gy1wnh/1585529477508/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><div
    class="tip-callout">Microsoft Azure&#39;s <a href="https://docs.microsoft.com/en-us/azure/cost-management-billing/manage/add-change-subscription-administrator#to-assign-a-user-as-an-administrator"
    target="_blank">Manage subscriptions</a> documentation adds details about the
    above procedure but focuses on the <strong>Administrator</strong> rather than
    the <strong>Reader</strong> role.</div><h4>PowerShell Command</h4><p>You can also
    create a <strong>Reader</strong> role programmatically via this PowerShell command,
    after gathering the required parameters:</p><pre>New-AzRoleAssignment -ObjectId
    &lt;object_id&gt; -RoleDefinitionName &#34;Reader&#34; -Scope /subscriptions/&lt;subscription_id&gt;</pre><p></p><p>For
    details and examples, see Microsoft Azure&#39;s <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/role-assignments-powershell#application-at-a-subscription-scope"
    target="_blank">Add or remove role assignments</a> documentation.</p><h3>Step
    3: Configure Secret Manager in Harness</h3><p>Select your <strong>Account</strong> or <strong>Organization</strong>
    or <strong>Project.</strong></p><p>Select <strong>Connectors</strong> under <strong>ACCOUNT
    SETUP/ORG SETUP/PROJECT SETUP.</strong></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/53jrd1cv4i/1623397246580/screenshot-2021-06-11-at-1-09-24-pm.png"
    style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure><p>Click <strong>New
    Connector.</strong> The <strong>Connectors</strong> page appears<strong>.</strong></p><p>Scroll
    down to <strong>Secret Managers</strong> and click <strong>Azure Key Vault</strong>.</p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/53jrd1cv4i/1658122632903/screenshot-2022-07-18-at-11-03-57-am.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Enter
    a <strong>Name</strong> for the secret manager.</p><p>You can choose to update
    the <strong>ID</strong> or let it be the same as your secret manager&#39;s name.
    For more information, see <a href="https://ngdocs.harness.io/article/li0my8tcz3-entity-identifier-reference">Entity
    Identifier Reference</a>.</p><p>Enter <strong>Description</strong> and <strong>Tags</strong>
    for your secret manager.</p><p>Click <strong>Continue</strong>.</p><p>In the <strong>Details</strong>
    page, enter Client ID, Tenant ID corresponding to the fields highlighted below
    in the Azure UI:</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/2nv0gy1wnh/1585627547567/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>To
    provide these values:</p><ul><li>In Azure, navigate to the <strong>Azure Active
    Directory</strong> &gt; <strong>App registrations</strong> page, then select your
    App registration. (For details, see Azure&#39;s <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-v1-add-azure-ad-app"
    target="_blank">Quickstart: Register an application with the Microsoft identity
    platform</a>.)</li><li>Copy the <strong>Application (client) ID</strong> for the
    Azure App registration you are using, and paste it into the Harness dialog&#39;s
    <strong>Client ID</strong> field.</li><li>Copy the <strong>Directory (tenant)
    ID</strong> of the Azure Active Directory (AAD) where you created your application,
    and paste it into the Harness dialog&#39;s <strong>Tenant ID</strong> field. (For
    details, see Microsoft Azure&#39;s <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal#get-values-for-signing-in"
    target="_blank">Get values for signing in</a> topic.)</li><li>In the <strong>Subscription</strong>
    field, you can optionally enter your Azure Subscription ID (GUID).</li></ul><p>To
    find this ID, navigate to Azure&#39;s <strong>Subscriptions</strong> page, as
    outlined above in <a href="/article/53jrd1cv4i-azure-key-vault#create_azure_reader_role">Step
    1: Create Azure Reader Role</a>. From the resulting list of subscriptions, copy
    the <strong>Subscription ID</strong> beside the subscription that contains your
    vaults.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/2nv0gy1wnh/1585625743106/image.png"
    style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure><div
    class="tip-callout">If you do not enter a GUID, Harness uses the default subscription
    for the <a href="#step_4">Client ID</a> you&#39;ve provided above.</div><p>Click
    <strong>Create or Select a Secret</strong> in the <strong>Key</strong> field.
    For detailed steps on creating a new secret, see <a href="/article/osfw70e59c">Add
    Text Secrets</a>.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/53jrd1cv4i/1625567758590/screenshot-2021-07-06-at-4-05-05-pm.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>The
    secret that you reference here should have the Azure authentication key as the
    <strong>Secret Value</strong>. The below image shows the creation of a secret
    with Azure authentication key as its value:</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/53jrd1cv4i/1625567933099/screenshot-2021-07-06-at-4-03-24-pm.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><p>To
    create and exchange the azure authentication key, perform the following steps:</p><ul><li>Navigate
    to Azure&#39;s <strong>Certificates &amp; secrets</strong> page. (For details,
    see Microsoft Azure&#39;s <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-create-service-principal-portal#get-application-id-and-authentication-key"
    target="_blank">Create a new application secret</a> documentation.)</li><li>In
    the resulting page’s <strong>Client secrets</strong> section, select <strong>New client
    secret</strong>.</li></ul><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/2nv0gy1wnh/1585535715641/image.png"
    style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure><ul><li>Enter
    a <strong>Description</strong> and expiration option, then click <strong>Add</strong>.</li></ul><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/2nv0gy1wnh/1585536012676/image.png"
    style="max-height:100%;max-width:100%" data-hd-height="100%" data-hd-width="100%"/></figure><ul><li>Find
    your new key in the <strong>Client secrets</strong> section, and copy its value
    to your clipboard.</li></ul><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/2nv0gy1wnh/1585536424303/image.png"
    style="max-height:100%;max-width:100%" data-hd-height="100%" data-hd-width="100%"/></figure><div
    class="note-callout">This is your only chance to view this key&#39;s value in
    Azure. Store the value somewhere secure, and keep it on your clipboard.</div><p></p><p>Click <strong>Fetch
    Vault</strong>.</p><p>After a slight delay, the <strong>Vault</strong> drop-down
    list populates with vaults corresponding to your client secret. Select the Vault
    you want to use.</p><p>Click <strong>Save and Continue</strong>.</p><h3>Step 4:
    Test Connection</h3><p>Once the Test Connection succeeds, click Finish. You can
    now see the Connector in Connectors.</p><details><summary>Important: Test Connection
    fails</summary><div>Harness tests connections by creating a dummy secret in the
    Secret Manager or Vault. For the Test Connection to function successfully, make
    sure you have Create permission for secrets.<br/>The Test Connection fails if
    you do not have Create permission. However, Harness still creates the Connector
    for you. You may use this Connector to read secrets, if you have View permissions.</div></details><p></p>'
  slug: azure-key-vault
  tags:
  - Secrets Management
  - Platform
  - azure
  is_live: true
