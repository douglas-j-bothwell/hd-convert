<p></p><div class="note-callout">Currently, this feature is behind the feature flag <code>NG_CUSTOM_STAGE</code>. Contact <a href="mailto:support@harness.io" target="_blank">Harness Support</a> to enable the feature.</div><p>This topic describes how to set up a Custom stage.</p><p>Harness has pre-defined stages for the most common release operations, such as Build (CI), Deploy (CD), and Approval stages; however, there are times when you need to add a stage to your Pipeline that performs other operations and don&#39;t require the pre-defined settings of CI, CD, or Approvals.</p><p>For example, ad hoc provisioning or jobs that need to run before a deployment stage. This is when a Custom stage is useful.</p><p>Unlike the standard Build, Deploy, or Approval stages, a Custom stage has no pre-defined functionality or requirements. The Custom stage provides flexibility to support any use case outside of the standard stages and doesn&#39;t require the pre-defined settings of CI, CD, or Approvals.</p><div class="note-callout">The steps available in a Custom stage are also available in standard stages.</div><h3>Before You Begin</h3><ul><li><a href="/article/hv2758ro4e-learn-harness-key-concepts">Learn Harness&#39; Key Concepts</a></li><li><a href="/article/2chyf1acil-add-a-stage">Add a Stage</a></li></ul><h3>Limitations</h3><ul><li>The Custom stage is available in all modules that use Pipelines (CI, CD, Feature Flags).</li><li>Steps available in the Custom stage are also available in Build, Deploy, or Approval stages, but CI and CD-specific steps, like a Rolling Deployment, are not available in the Custom stage.</li><li>Licensing is applied to the steps in Custom stage. For example, CD Steps such as the HTTP step are available inside Custom stage only if you have CD license.</li><li>There is no Rollback functionality in a Custom stage.<ul><li>Rollbacks can be achieved via conditional execution. For example, run a step only is something failed/succeeded previously.</li></ul></li><li>You can select which Delegate to use for each step in a Custom stage using the step&#39;s <strong>Delegate Selector</strong> setting. If this setting is not used, then Harness will select a Delegate using its standard selection process. See <a href="/article/2k7lnc7lvl-delegates-overview">Delegates Overview</a>.</li><li>Custom stage can be used as a template like other stage types. Step templates can be used inside a Custom stage, and the Pipeline containing the Custom stage can also be used as a Template.</li></ul><h3>Visual Summary</h3><p>The following video provides a quick overview of the Custom stage.</p><p></p><div class="hd--embed" data-provider="YouTube" data-thumbnail="https://i.ytimg.com/vi/5w8M5x6Bh4M/hqdefault.jpg"><iframe width="200" height="150" src="https://www.youtube.com/embed/5w8M5x6Bh4M?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div><h3>Step 1: Add a Custom Stage</h3><p>In your Pipeline, click <strong>Add Stage</strong>, and then click <strong>Custom Stage</strong>.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/o60eizonnn/1654289450868/clean-shot-2022-06-03-at-13-50-18.png"/></figure><p>Enter a name for the stage. Harness automatically adds an Id (<a href="/article/li0my8tcz3-entity-identifier-reference">Entity Identifier</a>) for the stage.</p><p>Click <strong>Set Up Stage</strong>.</p><p>The new stage is created and the Execution section is displayed.</p><p>Let&#39;s look at adding stage variables to the <strong>Overview</strong> section first.</p><h3>Option: Add Stage Variables</h3><p>Once you&#39;ve created a stage, its settings are in the <strong>Overview</strong> tab.</p><p>In <strong>Advanced</strong>, you can add <strong>Stage Variables</strong>.</p><p>Stage variables are custom variables you can add and reference in your stage and Pipeline. They&#39;re available across the Pipeline. You can override their values in later stages.</p><p>You can even reference stage variables in the files fetched at runtime.</p><p>You reference stage variables <strong>within their stage</strong> using the expression <code>&lt;+stage.variables.[variable name]&gt;</code>.</p><p>You reference stage variables <strong>outside their stage</strong> using the expression <code>&lt;+pipeline.stages.[stage Id].variables.[variable name]&gt;</code>.</p><p>See <a href="/article/lml71vhsim-harness-variables">Built-in and Custom Harness Variables Reference</a>.</p><h3>Step 2: Add Execution Steps</h3><p>In <strong>Execution</strong>, click <strong>Add Step</strong>, and add whatever steps you need.</p><p>These steps are also available in CI, CD, and Approval stages.</p><p>For details on the different steps, see:</p><ul><li><a href="https://ngdocs.harness.io/category/y6gyszr0kl">General CD</a></li><li><a href="/article/k5lu0u6i1i-using-shell-scripts">Using Shell Scripts in CD Stages</a></li><li><a href="/article/zh49vfdy0a-harness-template-library">Create an HTTP Step Template</a></li><li><a href="https://ngdocs.harness.io/category/bz4zh3b75p">Approvals</a></li><li><a href="/article/dmlf8w2aeh-synchronize-deployments-using-barriers">Synchronize Deployments using Barriers</a></li><li><a href="/article/xy8zsn8fa3-add-a-governance-policy-step-to-a-pipeline">Add a Policy Engine Step to a Pipeline</a></li><li><a href="/article/w6i5f7cpc9-terraform-how-tos">Terraform How-tos</a></li></ul><p>CI and CD-specific steps, like a Rolling Deployment, are not available in the Custom stage.</p><h3>Option: Configure Advanced Settings</h3><p>In <strong>Advanced</strong>, you can use the following options:</p><ul><li><a href="https://ngdocs.harness.io/article/i36ibenkq2-step-skip-condition-settings">Stage Conditional Execution Settings</a></li><li><a href="https://ngdocs.harness.io/article/htrur23poj-step-failure-strategy-settings">Step Failure Strategy Settings</a></li></ul><h3>See Also</h3><ul><li><a href="/article/s3wrqjsg43-add-a-stage-template">Create a Stage Template</a></li></ul><p></p>