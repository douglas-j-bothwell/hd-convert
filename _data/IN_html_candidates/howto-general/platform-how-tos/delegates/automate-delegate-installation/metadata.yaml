type: article
article_id: 9deaame3qz
user_id: mfr0nxh4be
category_id: 9i5thr0ot2
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Automate Delegate Installation
slug: automate-delegate-installation
description: Automate Delegate installation and registration.
short_version: Automate Delegate installation and registration.
tags: []
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: ""
  source: API
  triggered_at: 2022-07-06T21:49:34.235497Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Automate Delegate Installation
  description: Automate Delegate installation and registration.
  short_version: Automate Delegate installation and registration.
  body: '<p>You can automate Delegate installation and registration by duplicating
    the downloaded Delegate config file, renaming the Delegate, and applying the new
    file. You can script this process to duplicate Delegates as needed.</p><p>When
    you apply the new Delegate file it will register with Harness under the new name.</p><p>This
    topic will describe how to duplicate, rename, and register a new Delegate manually,
    but you will likely want to script this process.</p><p>In this topic:</p><ul><li><a
    href="https://ngdocs.harness.io/article/9deaame3qz-automate-delegate-installation#before_you_begin">Before
    You Begin</a></li><li><a href="https://ngdocs.harness.io/article/9deaame3qz-automate-delegate-installation#review_automation_and_high_availability_ha">Review:
    Automation and High Availability (HA)</a></li><li><a href="https://ngdocs.harness.io/article/9deaame3qz-automate-delegate-installation#limitations">Limitations</a></li><li><a
    href="https://ngdocs.harness.io/article/9deaame3qz-automate-delegate-installation#step_1_duplicate_the_delegate_config_file">Step
    1: Duplicate the Delegate Config File</a></li><li><a href="https://ngdocs.harness.io/article/9deaame3qz-automate-delegate-installation#step_2_rename_the_new_delegate">Step
    2: Rename the New Delegate</a><ul><li><a href="https://ngdocs.harness.io/article/9deaame3qz-automate-delegate-installation#kubernetes_delegate_renaming">Kubernetes
    Delegate Renaming</a></li><li><a href="https://ngdocs.harness.io/article/9deaame3qz-automate-delegate-installation#docker_delegate_renaming">Docker
    Delegate Renaming</a></li></ul></li><li><a href="https://ngdocs.harness.io/article/9deaame3qz-automate-delegate-installation#step_3_install_the_new_delegate">Step
    3: Install the New Delegate</a></li><li><a href="https://ngdocs.harness.io/article/9deaame3qz-automate-delegate-installation#see_also">See
    Also</a></li></ul><p></p><h3>Before You Begin</h3><ul><li><a href="/article/2k7lnc7lvl-delegates-overview">Delegates
    Overview</a></li><li><a href="/article/f9bd10b3nj-install-a-kubernetes-delegate">Install
    a Kubernetes Delegate</a></li><li><a href="/article/cya29w2b99-install-a-docker-delegate">Install
    the Harness Docker Delegate</a></li></ul><p></p><h3>Review: Automation and High
    Availability (HA)</h3><p>Delegate Automation isn&#39;t required for all High Availability
    (HA) scenarios. Let&#39;s review Delegate HA and when automation might be beneficial.</p><p>You
    might need to install multiple Delegates depending on how many tasks you do concurrently,
    and on the compute resources you are providing to each Delegate. Typically, you
    will need one Delegate for every 300-500 service instances.</p><p>In addition
    to compute considerations, you can enable High Availability (HA) for Harness Delegates.
    HA simply involves installing multiple Delegates in your environment.</p><p>For
    example, in Kubernetes deployments, you can set up two Kubernetes Delegates, each
    in its own pod in the same target K8s cluster. Simply edit the Kubernetes Delegate
    spec you download from Harness, <strong>harness-kubernetes.yaml</strong>, to have
    multiple <code>replicas</code>:</p><pre class="hljs yaml">...<br/>apiVersion:
    apps/v1beta1<br/>kind: StatefulSet<br/>metadata:<br/>  labels:<br/>    harness.io/app:
    harness-delegate<br/>    harness.io/account: xxxx<br/>    harness.io/name: test<br/>  name:
    test-zeaakf<br/>  namespace: harness-delegate<br/>spec:<br/>  replicas: 2<br/>  selector:<br/>    matchLabels:<br/>      harness.io/app:
    harness-delegate<br/>...</pre><p></p><p>In this case, you do not need automation.
    Simply adding more <code>replicas</code> will accomplish HA.</p><div class="warning-callout">For
    the Kubernetes Delegate, you only need one Delegate in the cluster. Simply increase
    the number of replicas, and nothing else. Do not add another Delegate to the cluster
    in an attempt to achieve HA.</div><div class="note-callout">If you want to install
    Kubernetes Delegates in separate clusters, do not use the same <strong>harness-kubernetes.yaml</strong> and
    name for both Delegates. Download a new Kubernetes YAML spec from Harness for
    each Delegate you want to install. This will avoid name conflicts.</div><div class="note-callout">In
    every case, the Delegates need to be identical in terms of permissions, keys,
    connectivity, etc.</div><p>With two or more Delegates running in the same target
    environment, HA is provided by default. One Delegate can go down without impacting
    Harness&#39; ability to perform deployments. If you want more availability, you
    can set up three Delegates to handle the loss of two Delegates, and so on.</p><h3>Limitations</h3><ul><li>Two
    Delegates in different locations with different connectivity do not support HA.
    For example, if you have a Delegate in a Dev environment and another in a Prod
    environment, the Dev Delegate will not communicate with the Prod Delegate or vice
    versa. If either Delegate went down, Harness would not operate in their environment.</li></ul><h3>Step
    1: Duplicate the Delegate Config File </h3><div class="note-callout">These steps
    assume you have already installed and registered a Delegate. If you haven&#39;t,
    see the <a href="/category/9i5thr0ot2">Delegate installation topics</a>.</div><p>Duplicate
    the config file for a Delegate you have installed and registered with your Harness
    account.</p><p>Ensure that the Delegate environment variables are set correctly.</p><p>The
    Delegate config file contains environment variables for account, Organization,
    and Project. The account variable is always set with your Harness account Id.</p><p>If
    your Delegate is registered at the account level, then the Organization and Project
    variables will be empty. If your Delegate is registered at the Organization level,
    then the Project variable will be empty. </p><p>If your Delegate config file uses
    other environment variables, review them to make certain that you want them duplicated.
    </p><div class="note-callout">The Delegate Environment Variables are described
    in the relevant Delegate installation topics.</div><h3>Step 2: Rename the New
    Delegate</h3><p>How you rename the Delegate depends on the type of Delegate. For
    Docker Delegates, you simply rename one environment variable in the Docker compose
    file.</p><p>For the Kubernetes Delegate, you need to multiple instances of the
    name.</p><h4>Kubernetes Delegate Renaming</h4><p>In the Kubernetes Delegate config
    file, several labels must be updated:</p><ul><li><code>Secret.metadata.name</code></li><li><code>StatefulSet.metadata.labels.harness.io/name</code></li><li><code>StatefulSet.metadata.name</code></li><li><code>StatefulSet.metadata.spec.selector.matchLabels.harness.io/name</code></li><li><code>StatefulSet.metadata.spec.template.metadata.labels.harness.io/name</code></li><li><code>StatefulSet.metadata.spec.template.spec.env.name:
    DELEGATE_NAME</code></li></ul><p>The <code>DELEGATE_NAME</code> environment variable
    looks like this:</p><pre>...<br/>        - name: DELEGATE_NAME<br/>          value:
    foo<br/>...</pre><p></p><h4>Docker Delegate Renaming</h4><p>To rename the Docker
    Delegate, simply rename the value for the <code>DELEGATE_NAME</code> environment
    variable.</p><pre>...<br/>    - DELEGATE_NAME=my-new-delegate<br/>...</pre><p></p><h3>Step
    3: Install the New Delegate</h3><p>Once the name(s) in the Delegate are updated,
    you can apply the Delegate and it will install and register with Harness.</p><h3>See
    Also</h3><ul><li><a href="/article/yte6x6cyhn-run-scripts-on-delegates">Run Scripts
    on Delegates</a></li></ul><p></p><p></p><p></p><p></p>'
  slug: automate-delegate-installation
  tags: []
  is_live: true
