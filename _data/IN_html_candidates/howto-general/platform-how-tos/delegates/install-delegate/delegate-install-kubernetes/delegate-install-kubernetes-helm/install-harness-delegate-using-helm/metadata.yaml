type: article
article_id: zo44dwgmin
user_id: u10w77i7vp
category_id: lq51sve5jz
author:
  name: Katherine Enos
  profile_image: https://www.gravatar.com/avatar/854cdb03d99ded9ecd30fa9cf06a5298?d=mm&s=150
title: Install Harness Delegate Using Helm
slug: install-harness-delegate-using-helm
description: Harness Delegate is a service that runs in the target environment for
  a deployment – typically a local network, a VPC, or a cluster. Harness Delegate
  connects artifacts, infrastructure, and providers…
short_version: Harness Delegate is a service that runs in the target environment for
  a deployment – typically a local network, a VPC, or a cluster. Harness Delegate
  connects artifacts, infrastructure, and providers…
tags: []
show_toc: false
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: ""
  source: API
  triggered_at: 2022-09-07T22:06:07.276661Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Install Harness Delegate Using Helm
  description: ""
  short_version: ""
  body: '<p>Harness Delegate is a service that runs in the target environment for
    a deployment – typically a local network, a VPC, or a cluster. Harness Delegate
    connects artifacts, infrastructure, and providers with Harness Manager, and is
    responsible for performing deployment operations.</p><p>This document explains
    how to install Harness Delegate using the <a href="https://helm.sh/">Helm</a>
    package manager.</p><h3>Install Process</h3><p>Harness Delegate for Helm is deployed
    by using an installer. This document describes the requirements for the process,
    explains the screens of the installer, and provides steps you can use to verify
    or troubleshoot the process.</p><p>By default, Harness Delegate installs and runs
    with cluster root access.</p><h3>Requirements</h3><p>Harness Delegate for Helm
    has the following requirements.</p><h4>Permissions</h4><p>Harness Delegate for
    Helm requires the following access and permissions:</p><ul><li>A machine configured
    for access to the Harness SaaS URL: <code>https://app.harness.io</code>.</li><li>Access
    to the target Kubernetes cluster with installation by application manifest (YAML)
    or Helm chart.</li><li>A <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/"
    target="_blank"><strong>ClusterRole</strong></a> that permits creation of the
    following:<ul><li>A namespace to host Harness Delegate</li><li><a href="https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/deployment-v1/"
    target="_blank"><strong>Deployment</strong></a> resources, including the <a href="https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/stateful-set-v1/"
    target="_blank"><strong>StatefulSet</strong></a> objects required to manage Harness
    Delegate</li></ul></li></ul><p>For more information about the permissions you
    need to install a Delegate, see <a href="https://docs.harness.io/article/f9bd10b3nj-install-a-kubernetes-delegate#review_delegate_role_requirements"
    target="_blank">Review: Delegate Role Requirements</a>.</p><h4>Compute Resources</h4><p>The
    compute resources that the Delegate workload requires depend on the scale of your
    deployment and the number of replica pods to be deployed.</p><ul><li><strong>Deploy
    to laptop:</strong> 0.5 CPU with 2.0 GB memory</li><li><strong>Small-scale deployment:</strong>
    1.0 CPU with 4.0 GB memory</li><li><strong>Medium-scale deployment:</strong> 2.0
    CPU with 8.0 GB memory</li><li><strong>Large-scale deployment:</strong> 4.0 CPU
    with 16.0 GB memory</li></ul><h3>Installation</h3><p>Harness Delegate for Helm
    is installed by deploying a Helm chart. The installation process requires you
    to configure the deployment and, if you are using a proxy, to configure proxy
    settings. Harness deploys the Delegate and listens for a heartbeat to confirm
    the Delegate is running. If you receive a message that the Delegate could not
    be installed, see the final section of this document for troubleshooting information.</p><p>For
    basic information on Harness Delegate, see <a href="https://docs.harness.io/article/2k7lnc7lvl-delegates-overview"
    target="_blank">Delegate Requirements and Limitations</a>.</p><h4>Configure the
    Deployment</h4><ol><li>Select the <strong>Kubernetes</strong> option.<figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/zo44dwgmin/1660169076429/helm-install-1.png"/></figure></li></ol><p></p><ol><li
    style="counter-increment:li 1" start="2">Review <strong>Kubernetes Prerequisites</strong>
    to ensure that your cluster can support the deployment. Click <strong>Continue</strong>.<figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/zo44dwgmin/1660169137939/helm-install-2.png"/></figure></li><li>In
    <strong>Delegate Name</strong>, give your Delegate a name. The Delegate name is
    populated into the <strong>ID</strong> field.<br/>A valid Delegate name is a lowercase
    character string that does not begin or end with a number. You can use the dash
    mark (“-”) to separate segments of the string; other special characters are not
    permitted. Delegate names must be unique in the cluster.</li><li>(Optional) Click
    the pencil icon to change the identifier of the Delegate resource.</li><li>(Optional)
    Click <strong>+ Description</strong> to create a description to be associated
    with the Delegate.</li><li>(Optional) Click <strong>+ Tags</strong> to label the
    Delegate resource with tags. This increases searchability.</li><li>Select the
    size of the deployment.<br/>The size of the deployment determines the CPU and
    memory resources allocated to running the Delegate. The following table summarizes
    the options.</li></ol><table><tbody><tr><td><p><strong>Size</strong></p></td><td><p><strong>Replicas</strong></p></td><td><p><strong>CPU/Memory</strong></p></td><td><p><strong>Description</strong></p></td></tr><tr><td><p><strong>Laptop</strong></p></td><td><p>1</p></td><td><p>0.5/2.0
    GB</p></td><td><p>Run up to 2 parallel deployments or builds.</p><p>For production
    workloads.</p></td></tr><tr><td><p><strong>Small</strong></p></td><td><p>2</p></td><td><p>1.0/4.0
    GB</p></td><td><p>Run up to 10 parallel deployments or builds.</p><p>For small-scale
    production workloads.</p></td></tr><tr><td><p><strong>Medium</strong></p></td><td><p>4</p></td><td><p>2.0/8.0
    GB</p></td><td><p>Run up to 20 parallel deployments or builds.</p><p>For medium-scale
    production workloads.</p></td></tr><tr><td><p><strong>Large</strong></p></td><td><p>8</p></td><td><p>4.0/16.0
    GB</p></td><td><p>Run up to 40 parallel deployments or builds.</p><p>For large-scale
    production workloads.</p></td></tr></tbody></table><p></p><ol><li style="counter-increment:li
    7" start="8">Select the <strong>Helm Chart</strong> installer option. Harness
    Delegate for Helm is installed using a Helm chart.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/zo44dwgmin/1660169172050/helm-install-3.png"/></figure></li></ol><p></p><ol><li
    style="counter-increment:li 8" start="9">In <strong>Delegate Tokens</strong>,
    specify the one or more token names to be associated with the Delegate. In the
    example above, <code>default_token</code> is specified.</li><li>In <strong>Delegate
    Permissions</strong>, select the permissions you want to grant the Delegate.</li></ol><table><tbody><tr><td><p><strong>User
    role</strong></p></td><td><p><strong>Scope</strong></p></td><td><p><strong>read/write</strong></p></td><td><p><strong>Description</strong></p></td></tr><tr><td><p>Install
    Delegate with cluster-wide read/write access</p></td><td><p>cluster</p></td><td><p>read/write</p></td><td><p>The
    Delegate is installed with cluster-wide access in the namespace you are prompted
    to specify during the installation process.</p><p>This Delegate binds to the default
    <strong>cluster-admin</strong> <a href="https://kubernetes.io/docs/reference/kubernetes-api/authorization-resources/cluster-role-v1/"
    target="_blank">ClusterRole</a>. The Delegate reads and writes tasks across all
    namespaces in the cluster.</p></td></tr><tr><td><p>Install Delegate with cluster-wide
    read access</p></td><td><p>cluster</p></td><td><p>read</p></td><td><p>The Delegate
    is installed with cluster-wide access in the namespace you are prompted to specify
    during the installation process.</p><p>This Delegate binds to the default <strong>view</strong>
    <a href="https://kubernetes.io/docs/reference/kubernetes-api/authorization-resources/cluster-role-v1/"
    target="_blank">ClusterRole</a> and is limited to the performance of read-only
    task in the cluster.</p></td></tr><tr><td><p>Install Delegate with specific namespace
    access</p></td><td><p>namespace</p></td><td><p>read/write</p></td><td><p>The Delegate
    is installed with namespace access in the namespace you specify during the installation
    process.</p><p>This requires modification of the command-line instruction to specify
    installation and operation of the Delegate in the given namespace.</p></td></tr></tbody></table><p>For
    detailed information about Kubernetes default user roles, see <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/"
    target="_blank">Using RBAC Authorization</a> in <a href="https://kubernetes.io/docs/home/"
    target="_blank">Kubernetes Documentation</a>.</p><h3>Configure Proxy Settings</h3><p>The
    configuration of proxy settings is an optional step in the installation process.
    You can download the Delegate YAML and configure settings to modify how the Delegate
    connects to Harness Manager. Skip this step if your environment is not configured
    to use the Kubernetes proxy service.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/zo44dwgmin/1660091292310/helm-install-4.png"/></figure><p>Proxy
    settings are configured using the following process:</p><ul><li>Download the Delegate
    YAML.</li><li>Open the YAML file and configure the desired proxies.</li><li>Save
    and install the modified YAML file.</li></ul><p>For more information about how
    proxies work in Kubernetes, see <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Service</a>
    in <a href="https://kubernetes.io/docs/home/">Kubernetes Documentation</a>.</p><h4>Delegate
    Proxy Settings</h4><p>The following proxies determine how Harness Delegate connects
    to Harness Manager. If <code>PROXY_MANAGER</code> is set to <code>true</code>,
    any other proxy settings are ignored.</p><p>For in-cluster Delegates with configured
    proxies, the <code>noProxy</code> value must be the master IP address of the cluster.
    This allows the Delegate to bypass the proxy for in-cluster connections.</p><p></p><table><tbody><tr><td><p><strong>Value</strong></p></td><td><p><strong>Description</strong></p></td></tr><tr><td><p><code>proxyHost</code></p></td><td><p>The
    host name address of the proxy, for example, <code>proxy.example.com.</code></p></td></tr><tr><td><p><code>proxyPort</code></p></td><td><p>The
    proxy port number to which Harness Delegate connects.</p></td></tr><tr><td><p><code>proxyUser</code></p></td><td><p>The
    name of the service account to be authenticated for proxy access.</p></td></tr><tr><td><p><code>proxyPassword</code></p></td><td><p>The
    password for the service account to be authenticated.</p></td></tr><tr><td><p><code>proxyScheme</code></p></td><td><p>The
    network addressing scheme that the proxy uses. This must be HTTP or HTTPS.</p></td></tr><tr><td><p><code>noProxy</code></p></td><td><p>A
    comma-separated list of domain suffixes that are not subject to proxy, for example,
    <code>.example.com</code>.</p></td></tr></tbody></table><p></p><p><strong>To configure
    Delegate proxy settings</strong></p><ol><li>Click <strong>Download YAML File</strong>.</li><li>Navigate
    to the download location and open the <code>harness-helm-values.yaml</code> file.</li><li>Modify
    the proxy settings and save the file.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/zo44dwgmin/1660091821420/helm-install-5.png"/></figure></li></ol><p>For
    information on using proxy settings with Helm Delegate, see <a href="https://docs.harness.io/article/5ww21ewdt8-configure-delegate-proxy-settings"
    target="_blank">Configure Delegate Proxy Settings</a>.</p><h4>Deploy and Verify</h4><p>Deploy
    the configured Harness Delegate using the <code>helm</code> CLI from a machine
    configured for access to the target cluster. A successful deployment is confirmed
    by listening for a heartbeat. The installer monitors the process and displays
    status messages.</p><p><strong>To deploy Harness Delegate</strong></p><ol><li>Copy
    and run the provided commands.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/zo44dwgmin/1660169241755/helm-install-6.png"/></figure></li></ol><p></p><p>Harness
    Manager waits for a heartbeat to confirm that Harness Delegate is installed and
    running.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/zo44dwgmin/1660092362747/checking-for-heartbeat.png"
    style="max-height:60%;display:block;margin-left:0;margin-right:auto" data-hd-height="60%"
    data-hd-align="left"/></figure><p>Installation could take several minutes.</p><ol><li
    style="counter-increment:li 1" start="2">If Harness Delegate was successfully
    installed, click <strong>Done</strong>.<br/>If Harness Delegate cannot be installed,
    the following message appears:<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/zo44dwgmin/1660169282753/delegate-not-installed.png"/></figure></li></ol><p>If
    the Delegate cannot be installed, see the following section for information on
    common problems.</p><h3>Troubleshooting</h3><p>Installation failures can result
    from common problems including unhealthy pods and a lack of compute resources.</p><p>You
    can retrieve the information required to triage and resolve most failure conditions
    with the following <code>kubectl</code> instructions.</p><p></p><table><tbody><tr><td><p><strong>To
    check</strong></p></td><td><p><strong>Use</strong> <code><strong>kubectl</strong></code>
    <strong>command</strong></p></td><td><p><strong>To resolve</strong></p></td></tr><tr><td><p><strong>Delegate
    pod status</strong></p></td><td><p><code>kubectl describe pods -n &lt;namespace&gt;</code></p><p><code>kubectl
    describe pod &lt;podname&gt;</code></p><p><code>kubectl describe pod_name -n &lt;namespace&gt;</code></p></td><td><p>Check
    to ensure the pod is ready and available.</p><p>Check pod status to confirm that
    the Delegate pod was scheduled to a node and is running.</p><p>Resolve issues
    that keep pods in Pending or Waiting status.</p><p>If the state of the pod is
    <code>CrashLoopBackoff.Kubernetes Cluster Resources are not available</code>,
    increase the cluster resources for CPU units and memory.</p><p>See <a href="https://kubernetes.io/docs/home/"
    target="_blank">Debug Pods</a> in <a href="https://kubernetes.io/docs/home/" target="_blank">Kubernetes
    Documentation</a>.</p></td></tr><tr><td><p><strong>Delegate logs</strong></p></td><td><p><code>kubectl
    logs -f &lt;harnessDelegateName&gt; -n &lt;namespace&gt;</code></p></td><td><p>Examine
    the logs for the namespace.</p><p>See <a href="https://kubernetes.io/docs/tasks/debug/debug-cluster/"
    target="_blank">Troubleshooting Clusters</a> in <a href="https://kubernetes.io/docs/home/"
    target="_blank">Kubernetes Documentation</a>.</p></td></tr></tbody></table><p></p><p>When
    the issue is resolved, apply the Delegate YAML a second time.</p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/zo44dwgmin/1660169324773/helm-install-6.png"/></figure><p></p><p></p><p>From
    <strong>Apply YAML and verify connection</strong>, copy the instructions to the
    command line.</p><p>For further information on troubleshooting, see <a href="https://docs.harness.io/article/jzklic4y2j-troubleshooting"
    target="_blank">Troubleshooting Harness</a>.</p><h3>Delegate Field Reference</h3><p>The
    following table lists and describes fields and values that are used by Harness
    Delegate for Helm.</p><p></p><table><tbody><tr><td><p><strong>Field</strong></p></td><td><p><strong>Configurable</strong></p></td><td><p><strong>Description</strong></p></td></tr><tr><td><p><strong>accountId</strong></p></td><td><p>No</p></td><td><p>The
    ID of the service account associated with the target cluster.</p></td></tr><tr><td><p><strong>delegateToken</strong></p></td><td><p>No</p></td><td><p>The
    secret that identifies the account.</p></td></tr><tr><td><p><strong>delegateName</strong></p></td><td><p>Yes</p></td><td><p>A
    user-specified name for the Delegate consisting of lowercase alphanumeric characters.
    A hyphen (&#34;-&#34;) is permitted as a character separator. The name must not
    begin or end with a number.</p><p>Example: <code>my-sample-delegate</code></p></td></tr><tr><td><p><strong>delegateDockerImage</strong></p></td><td><p>No</p></td><td><p>The
    location and name of the Docker image that contains the Delegate.</p></td></tr><tr><td><p><strong>managerEndpoint</strong></p></td><td><p>No</p></td><td><p>The
    HTTPS location of the manager endpoint.</p></td></tr><tr><td><p><strong>tags</strong></p></td><td><p>Yes</p></td><td><p>A
    comma-separated list of tags that identify the Delegate.</p></td></tr><tr><td><p><strong>description</strong></p></td><td><p>Yes</p></td><td><p>A
    description of the Delegate.</p></td></tr><tr><td><p><strong>k8sPermissionsType</strong></p></td><td><p>Yes</p></td><td><p>The
    <strong>ClusterRole</strong> granted the Delegate.</p><p>Specify one of the following
    valid values: <code>CLUSTER_ADMIN</code>, <code>CLUSTER_VIEWER</code>, <code>NAMESPACE_ADMIN</code>.</p><p>Specify
    <code>CLUSTER_ADMIN</code> for cluster-wide read/write privileges.</p><p>Specify
    <code>CLUSTER_VIEWER</code> for cluster-wide view privileges.</p><p>Specify <code>NAMESPACE_ADMIN</code>
    to restrict the Delegate to read/write access to a given namespace.</p></td></tr><tr><td><p><strong>replicas</strong></p></td><td><p>No</p></td><td><p>The
    desired number of pods that run the Delegate.</p><p>The default value depends
    on the size of the deployment that is selected in the installer.</p></td></tr><tr><td><p><strong>cpu</strong></p></td><td><p>No</p></td><td><p>The
    CPU resource units allocated to the Delegate.</p><p>The default value depends
    on the size of the deployment that is selected in the installer.</p></td></tr><tr><td><p><strong>memory</strong></p></td><td><p>No</p></td><td><p>The
    desired amount of memory resources allocated to the Delegate.</p><p>The default
    value depends on the size of the deployment that is selected in the installer.</p></td></tr><tr><td><p><strong>initScript</strong></p></td><td><p>Yes</p></td><td><p>The
    path and filename to an optional initialization script that runs before the Delegate
    starts.</p></td></tr><tr><td><p><strong>javaOpts</strong></p></td><td><p>Yes</p></td><td><p>Specify
    the <code>JAVA_OPTS</code> environment variable to pass custom settings to the
    JVM.</p></td></tr></tbody></table><p></p><p>The following table lists and describes
    additional configurable fields in the values.yaml file.</p><p></p><table><tbody><tr><td><p><strong>Field</strong></p></td><td><p><strong>Description</strong></p></td></tr><tr><td><p><strong>serviceAccount.name</strong></p></td><td><p>Specify
    this field to set a user-specified name for the service account. Otherwise, the
    service name is the <em>chartname</em>, <code>harness-delegate-ng</code>.</p></td></tr><tr><td><p><strong>serviceAccount.annotations</strong></p></td><td><p>Use
    this field to annotate the service account with metadata.</p><p>For information
    about annotations, see <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/"
    target="_blank">Annotations</a> in <a href="https://kubernetes.io/docs/home/"
    target="_blank">Kubernetes Documentation</a>.</p></td></tr><tr><td><p><strong>autoscaling</strong></p></td><td><p>Use
    this object to enable and specify pod autoscaling. To enable autoscaling, <strong>autoscaling.enabled</strong>
    must be set to <code>true</code>. By default, this field is set to <code>false</code>.</p><p></p><p>For
    information on autoscaling, see <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/"
    target="_blank">Horizontal Pod Autoscaling</a> in <a href="https://kubernetes.io/docs/home/"
    target="_blank">Kubernetes Documentation</a>.</p></td></tr><tr><td><p><strong>pollForTasks</strong></p></td><td><p>Set
    this value to <code>true</code> to enable polling for tasks using REST API methods.
    By default, this value is set to <code>false</code> and the use of a socket connection
    is assumed.</p></td></tr><tr><td><p><strong>upgrader</strong></p></td><td><p>Set
    <strong>upgrader.enabled</strong> to <code>true</code> to enable automatic upgrading
    of the Delegate image by Harness.</p><p></p></td></tr></tbody></table><p></p>'
  slug: install-harness-delegate-using-helm
  tags: []
  is_live: true
