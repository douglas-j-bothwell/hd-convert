type: article
article_id: omydtsrycn
user_id: mfr0nxh4be
category_id: 9i5thr0ot2
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Secure Delegates with Tokens
slug: secure-delegates-with-tokens
description: Secure Delegate to Harness communication by replacing the default Delegate
  token with new tokens.
short_version: Secure Delegate to Harness communication by replacing the default Delegate
  token with new tokens.
tags: []
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: ""
  source: API
  triggered_at: 2022-07-06T22:34:45.250176Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Secure Delegates with Tokens
  description: Secure Delegate to Harness communication by replacing the default Delegate
    token with new tokens.
  short_version: Secure Delegate to Harness communication by replacing the default
    Delegate token with new tokens.
  body: '<p>Delegate tokens are used by Harness to encrypt communication between Harness
    Delegates and the Harness Manager. By default, when a new Harness account is created,
    all Harness Delegates in that account include the same token.</p><p>You can further
    secure Delegate to Harness communication by replacing the default Delegate token
    with new tokens. You can add and revoke Delegate tokens per your governance policies
    and replace revoked tokens with custom tokens when needed.</p><p>In this topic:</p><ul><li><a
    href="https://ngdocs.harness.io/article/omydtsrycn-secure-delegates-with-tokens#before_you_begin">Before
    You Begin</a></li><li><a href="https://ngdocs.harness.io/article/omydtsrycn-secure-delegates-with-tokens#step_1_generate_a_new_token">Step
    1: Generate a New Token</a><ul><li><a href="https://ngdocs.harness.io/article/omydtsrycn-secure-delegates-with-tokens#generate_a_token_when_creating_a_delegate">Generate
    a Token when Creating a Delegate</a></li><li><a href="https://ngdocs.harness.io/article/omydtsrycn-secure-delegates-with-tokens#generate_a_token_without_creating_a_delegate_2">Generate
    a Token without Creating a Delegate</a></li></ul></li><li><a href="https://ngdocs.harness.io/article/omydtsrycn-secure-delegates-with-tokens#option_update_and_restart_existing_delegate">Option:
    Update and Restart Existing Delegate</a><ul><li><a href="https://ngdocs.harness.io/article/omydtsrycn-secure-delegates-with-tokens#kubernetes_delegate">Kubernetes
    Delegate</a></li><li><a href="https://ngdocs.harness.io/article/omydtsrycn-secure-delegates-with-tokens#docker_delegate">Docker
    Delegate</a></li></ul></li><li><a href="https://ngdocs.harness.io/article/omydtsrycn-secure-delegates-with-tokens#option_revoke_tokens">Option:
    Revoke Tokens</a></li></ul><h3>Before You Begin</h3><ul><li><a href="/article/re8kk0ex4k-delegate-installation-overview">Delegate
    Installation Overview</a></li><li><a href="/article/cya29w2b99-install-a-docker-delegate">Install
    a Docker Delegate</a></li><li><a href="/article/f9bd10b3nj-install-a-kubernetes-delegate">Install
    a Kubernetes Delegate</a></li></ul><p></p><h3>Step 1: Generate a New Token</h3><p>You
    can generate a new token when you create a Delegate or as a separate process.</p><h4>Generate
    a Token when Creating a Delegate</h4><p>When you create a new Delegate, you can
    generate a new token.</p><p>In <strong>Delegate Setup</strong>, in <strong>Delegate
    Tokens</strong>, click <strong>Add</strong>, and then name and apply the new token:</p><figure><img
    src="https://files.helpdocs.io/i5nl071jo5/articles/omydtsrycn/1647384869537/clean-shot-2022-03-15-at-15-54-03.png"/></figure><p>The
    new token is created and its value is copied to your system clipboard. The new
    token also appears in the list using the name you gave it.</p><p>Save the new
    token value. You cannot retrieve the token value after this.</p><p>Now you can
    update the Delegate(s) with the new token.</p><p>In <strong>Delegate Tokens</strong>,
    select the new token.</p><h4>Generate a Token without Creating a Delegate</h4><p>In
    Harness, click <strong>Project Setup &gt; Delegates</strong> in a Project or <strong>Account
    Settings &gt; Account Resources &gt; Delegates</strong> for the entire account.</p><p>Click
    <strong>Tokens</strong>. Here you can see, create, and revoke all Delegate tokens.</p><p>Click
    <strong>New Token</strong>.</p><p>Here&#39;s an Account Settings example:</p><figure><img
    src="https://files.helpdocs.io/i5nl071jo5/articles/omydtsrycn/1647384471625/clean-shot-2022-03-15-at-15-46-52.png"/></figure><p></p><p>Enter
    a name for the new token, and then click <strong>Apply</strong>.</p><p>You can
    copy the token and save it somewhere safe, if needed.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/omydtsrycn/1647384579220/clean-shot-2022-03-15-at-15-49-24.png"/></figure><p>The
    new token is created and its value is copied to your system clipboard. The new
    token also appears in the list using the name you gave it.</p><p>Save the new
    token value. You cannot retrieve the token value after this.</p><p>When you install
    a new Delegate, you can select the token to use:</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/omydtsrycn/1647384785437/clean-shot-2022-03-15-at-15-50-53.png"/></figure><h3>Option:
    Update and Restart Existing Delegate</h3><p>You can update an existing Delegate
    with a new token value and then restart the Delegate.</p><h4>Kubernetes Delegate</h4><p>The
    Delegate is set up using the <strong>harness-delegate.yaml</strong> you downloaded
    originally.</p><p>Edit the <strong>harness-delegate.yaml</strong> you downloaded
    originally with the new token and then run <code>kubectl apply -f harness-delegate.yaml</code>
    to restart the Delegate pods.</p><p>Paste the token in the Delegate <code>ACCOUNT_SECRET</code>
    setting in the <code>StatefulSet</code> spec:</p><pre>...<br/>---<br/><br/>apiVersion:
    apps/v1<br/>kind: StatefulSet<br/>...<br/>        env:<br/>...<br/>        - name:
    ACCOUNT_SECRET<br/>          value: [enter new token here]<br/>...</pre><p></p><p>Run
    <code>kubectl apply -f harness-delegate.yaml</code></p><p>The Delegate pods get
    restarted automatically. The pods will restart and take the updated settings.</p><h4>Docker
    Delegate</h4><p>You will destroy and recreate the container using the <strong>docker-compose.yml</strong>
    you downloaded originally.</p><p>Paste the token in the Delegate settings:</p><pre>version:
    &#34;3.7&#34;<br/>services:<br/>  harness-ng-delegate:<br/>    restart: unless-stopped<br/>    deploy:<br/>      resources:<br/>        limits:<br/>          cpus:
    &#34;0.5&#34;<br/>          memory: 2048M<br/>    image: harness/delegate:latest<br/>    environment:<br/>      -
    ACCOUNT_ID=12345678910<br/>      - ACCOUNT_SECRET=[enter new token here]<br/>      -
    MANAGER_HOST_AND_PORT=https://app.harness.io<br/>      - WATCHER_STORAGE_URL=https://app.harness.io/public/pro<br/>...</pre><p></p><p>Create
    a new container: <code>docker-compose -f docker-compose.yaml up -d</code>.</p><p>You
    can verify that the environment variable has the new token using <code>docker
    exec [container ID] env</code>.</p><h3>Option: Revoke Tokens</h3><p>On the <strong>Tokens</strong>
    page, click <strong>Revoke</strong> to revoke any token.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/omydtsrycn/1647385557250/clean-shot-2022-03-15-at-16-05-24.png"/></figure><p>ClickÂ <strong>Revoke</strong>.
    The token is revoked. The Harness Manager will not accept connections from any
    Delegates using this revoked token.</p><p></p>'
  slug: secure-delegates-with-tokens
  tags: []
  is_live: true
