<p>You can trigger Harness Pipelines in response to a new Helm chart version being added to an HTTP Helm repo.</p><p>For example, every time a new Helm chart is pushed to an HTTP Helm repo, it triggers a CD Pipeline that deploys it automatically.</p><p>Helm Chart Triggers simply listen to the repo where one or more of the Helm charts in your Pipeline are hosted.</p><p>You can set conditions on the Triggers, such as matching one or more chart versions.</p><p>This Trigger is a simple way to automate deployments for new Helm charts.</p><h3>Before You Begin</h3><ul><li>You should be familiar with Harness CD Pipelines for Helm charts, such as the one you create in the <a href="/article/cifa2yb19a-helm-cd-quickstart">Helm CD Quickstart</a>.</li></ul><h3>Limitations</h3><p>The following limitations apply to Helm Chart Triggers.</p><h4>Runtime Input Required</h4><p>You can only use a Helm Chart Trigger if you have added Helm chart in the Stage&#39;s <strong>Service Definition</strong>, and the <strong>Chart Version</strong> setting in the HTTP Helm chart details in a <a href="/article/f6yobn7iq0-runtime-inputs">Runtime Input</a> (<code>&lt;+input&gt;</code>).</p><p>Here&#39;s the Helm Chart in the Stage&#39;s <strong>Service Definition</strong>:</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/54eqk0d1bd/1637360691141/clean-shot-2021-11-19-at-14-24-43.png"/></figure><p>And here is the <strong>Chart Version</strong> setting in the HTTP Helm store:</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/54eqk0d1bd/1637361901349/clean-shot-2021-11-19-at-14-44-41.png"/></figure><p>If the Chart Version is not a Runtime Input, you will not be able to select the Helm chart in the Helm Chart Trigger.</p><h4>OCI Helm Registries not Supported with Triggers</h4><p>You <u>cannot</u> use <a href="/article/xxvnk67c5x-connect-to-an-artifact-repo">OCI Helm Registries</a> with <a href="/article/54eqk0d1bd-trigger-pipelines-on-new-helm-chart">Helm Chart Triggers</a>.</p><p></p><h3>Visual Summary</h3><p>This 4min video walks you through building a new Helm chart version and pushing it to Nexus using curl, and then having an On New Helm Chart Trigger execute a CD Pipeline to deploy the new version automatically.</p><p></p><div class="hd--embed" data-provider="Custom"><iframe width="560" height="315" src="https://www.youtube.com/embed/AX4lHbBJVrg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div><h3>Review: Chart Polling</h3><p>Once you have created a Trigger to listen for new Helm chart versions, Harness will poll for new charts continuously.</p><p>Polling is immediate because Harness uses a perpetual task framework that constantly monitors for new versions.</p><h4>Input Sets and Artifacts</h4><p>When you create a Trigger, you can select <a href="/article/3fqwa8et3d-input-sets">Input Sets</a> to apply to the Pipeline when the Trigger is executed.</p><p>If the Input Set you select has a <a href="/article/f6yobn7iq0-runtime-inputs">Fixed Value</a> for <strong>Chart Version</strong> (for example, <strong>0.1.4</strong>), the Trigger will work, but it will not select the new chart version. Instead, Harness will select the chart version with the <strong>Chart Version</strong> value in the Input Set (<strong>0.1.4</strong>).</p><p>Instead, in the Input Set&#39;s <strong>Chart Version</strong> setting, use the expression <code>&lt;+trigger.manifest.build&gt;</code>.</p><p>The Input Set option is for settings other than the <strong>Chart Version</strong> setting of the chart you want to pull. For example, the Artifact Server.</p><h3>Step 1: Create Trigger</h3><p>Select a Harness Pipeline that includes a Helm Chart in the Stage&#39;s <strong>Service Definition</strong>.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/54eqk0d1bd/1637365105015/clean-shot-2021-11-19-at-15-38-18.png"/></figure><p>See <a href="/article/cifa2yb19a-helm-cd-quickstart">Helm CD Quickstart</a> for details on adding Helm Charts to a Stage&#39;s <strong>Service Definition</strong>.</p><p>Click <strong>Triggers</strong>.</p><p>Click <strong>New Trigger</strong>.</p><p>Click the <strong>Helm Chart</strong> Trigger listed under <strong>Manifest</strong>.</p><p>In <strong>Configuration</strong>, in <strong>Name</strong>, enter a name for the Trigger.</p><h3>Step 2: Select Helm Chart</h3><p>In <strong>Listen on New Artifact</strong>, click <strong>Select Manifest</strong>. If this setting is not enabled, it is because the <strong>Chart Version</strong> setting is not a <a href="/article/f6yobn7iq0-runtime-inputs">Runtime Input</a> (<code>&lt;+input&gt;</code>).</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/54eqk0d1bd/1637365460015/clean-shot-2021-11-19-at-15-44-03.png"/></figure><p>In <strong>Select a Manifest Reference</strong>, select the Helm chart for this Trigger to listen for and click <strong>Select</strong>.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/54eqk0d1bd/1637365520547/clean-shot-2021-11-19-at-15-45-09.png"/></figure><p>In <strong>Configure Manifest Runtime Inputs</strong>, provide values for any Runtime inputs you have in your Helm Chart settings, and click <strong>Apply</strong>. The Helm chart listener is added:</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/54eqk0d1bd/1637365582624/clean-shot-2021-11-19-at-15-46-03.png"/></figure><p>Click <strong>Continue</strong>.</p><h3>Step 3: Set Conditions</h3><p>In <strong>Conditions</strong>, enter any conditions that must be matched in order for the Trigger to execute. For example, the Helm version number.</p><h4>Regex and Wildcards</h4><p>You can use wildcards in the condition&#39;s value and you can select <strong>Regex</strong>.</p><p>For example, if the build is <code>todolist-v2.0</code>:</p><ul><li>With Regex <u>not selected</u>, both <code>todolist*</code> or <code>*olist*</code> will match.</li><li>With Regex selected, the regex <code>todolist-v\d.\d</code> will match.</li></ul><p>If the regex expression does not result in a match, Harness ignores the value.</p><p>Harness supports standard Java regex. For example, if Regex is enabled and the intent is to match filename, the wildcard should be <code>.*</code> instead of simply a wildcard <code>*</code>. If you wanted to match all of the files that end in <code>-DEV.tgz</code> you would enter <code>.*-DEV\.tgz</code>.</p><h3>Step 4: Select Pipeline Inputs</h3><p>If your Pipeline uses <a href="/article/3fqwa8et3d-input-sets">Input Sets</a>, you can select the Input Set to use when the Trigger executes the Pipeline.</p><p>For example, here&#39;s an Input Set:</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/54eqk0d1bd/1637611023704/clean-shot-2021-11-22-at-11-56-55.png"/></figure><p>The <code>&lt;+trigger.manifest.build&gt;</code> is used for <strong>Chart Version</strong> to ensure that the new chart version that executed the Trigger is used for the deployment.</p><p>If you use a <a href="/article/f6yobn7iq0-runtime-inputs">Fixed Value</a> for <strong>Chart Version</strong> (for example, <strong>0.1.2</strong>), the Trigger will work when a new chart appears, but it will not select the new chart version. Instead, Harness will select the version with the <strong>Chart Version</strong> value in the Input Set (<strong>0.1.2</strong>).</p><p>The Input Set option is for settings other than the <strong>Chart Version</strong> setting. For example, the Artifact Server.</p><h3>Step 5: Test Trigger</h3><p>Once your Trigger is set up, click <strong>Create Trigger</strong>. The new Trigger is listed.</p><p>Once the Pipeline is executed using the Trigger, in <strong>Deployments</strong>, you can see the Trigger and the user who initiated the deployment.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/54eqk0d1bd/1637611452929/clean-shot-2021-11-22-at-12-00-47.png"/></figure><p>If you look at the Trigger in your Pipeline again you can see its activation records:</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/54eqk0d1bd/1637611494208/clean-shot-2021-11-22-at-12-04-34.png"/></figure><p>And these records are also in the Trigger details:</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/c1eskrgngf/1637277613270/clean-shot-2021-11-18-at-15-19-26-2-x.png"/></figure><p></p><p>You can test the Trigger by pushing a new chart version to your Helm Chart registry.</p><div class="note-callout">You can build and push to your registry using Harness CIE. See <a href="/article/x0d77ktjw8-ci-pipeline-quickstart">CI Pipeline Quickstart</a>.</div><p>Here&#39;s a simple curl example using a Nexus repo that works as a Helm chart HTTP server.</p><p>Add repo:</p><pre>helm repo add nexus_http https://nexus3.dev.example.io/repository/&lt;repo_name&gt;/ --username &#39;&lt;username&gt;&#39; --password &#39;&lt;password&gt;&#39;</pre><p></p><p>Fetch chart:</p><pre>helm fetch nexus_http/&lt;chart_name&gt;</pre><p></p><p>Next, update the version in your chart.</p><p>Package the chart:</p><pre>helm package &lt;filename&gt;</pre><p></p><p>Push the new version to the Helm HTTP Server:</p><pre>curl -u &lt;username&gt;:&lt;password&gt; https://nexus3.dev.example.io/repository/&lt;repo_name&gt;/ --upload-file &lt;chart_name&gt;-&lt;chart_version&gt;.tgz -v</pre><p></p><p>Now your Helm chart HTTP server should have the new version of the Helm chart.</p><p>Here&#39;s a simple CD Pipeline that deploys that new version to a Kubernetes cluster. You&#39;ll have to replace the Project name and the <code>&lt;+input&gt;</code> Runtime Input for some settings with your own Connectors and credentials.</p><details><summary>CD Pipeline YAML</summary><div><pre>pipeline:<br/>    name: On Manifest Changes<br/>    identifier: On_Manifest_Changes<br/>    projectIdentifier: CD_Examples<br/>    orgIdentifier: default<br/>    tags: {}<br/>    stages:<br/>        - stage:<br/>              name: Deploy<br/>              identifier: Deploy<br/>              description: &#34;&#34;<br/>              type: Deployment<br/>              spec:<br/>                  serviceConfig:<br/>                      serviceRef: helmchart<br/>                      serviceDefinition:<br/>                          type: Kubernetes<br/>                          spec:<br/>                              variables: []<br/>                              manifests:<br/>                                  - manifest:<br/>                                        identifier: helmtest<br/>                                        type: HelmChart<br/>                                        spec:<br/>                                            store:<br/>                                                type: Http<br/>                                                spec:<br/>                                                    connectorRef: &lt;+input&gt;<br/>                                            chartName: &lt;+input&gt;<br/>                                            chartVersion: &lt;+input&gt;<br/>                                            helmVersion: V3<br/>                                            skipResourceVersioning: false<br/>                  infrastructure:<br/>                      infrastructureDefinition:<br/>                          type: KubernetesDirect<br/>                          spec:<br/>                              connectorRef: &lt;+input&gt;<br/>                              namespace: default<br/>                              releaseName: release-&lt;+INFRA_KEY&gt;<br/>                      allowSimultaneousDeployments: false<br/>                      environmentRef: helmtest<br/>                  execution:<br/>                      steps:<br/>                          - step:<br/>                                name: Rollout Deployment<br/>                                identifier: rolloutDeployment<br/>                                type: K8sRollingDeploy<br/>                                timeout: 10m<br/>                                spec:<br/>                                    skipDryRun: false<br/>                      rollbackSteps:<br/>                          - step:<br/>                                name: Rollback Rollout Deployment<br/>                                identifier: rollbackRolloutDeployment<br/>                                type: K8sRollingRollback<br/>                                timeout: 10m<br/>                                spec: {}<br/>              tags: {}<br/>              failureStrategies:<br/>                  - onFailure:<br/>                        errors:<br/>                            - AllErrors<br/>                        action:<br/>                            type: StageRollback</pre></div></details><p></p><p>Finally here&#39;s the Trigger in the CD Pipeline that executes the Pipeline when a new chart version is pushed to the repo. You&#39;ll have to replace the Project name and the <code>&lt;+input&gt;</code> Runtime Input for some settings with your own Connectors and credentials.</p><details><summary>CD Pipeline Trigger YAML</summary><div><pre>trigger:<br/>    name: Chart Trigger<br/>    identifier: Chart_Trigger<br/>    enabled: true<br/>    orgIdentifier: default<br/>    projectIdentifier: CD_Examples<br/>    pipelineIdentifier: On_Manifest_Changes<br/>    source:<br/>        type: Manifest<br/>        spec:<br/>            stageIdentifier: Deploy<br/>            manifestRef: helmtest<br/>            type: HelmChart<br/>            spec:<br/>                store:<br/>                    type: Http<br/>                    spec:<br/>                        connectorRef: &lt;+input&gt;<br/>                chartName: +input&gt;<br/>                chartVersion: &lt;+trigger.manifest.version&gt;<br/>                helmVersion: V3<br/>                skipResourceVersioning: false<br/>    inputYaml: |<br/>        pipeline:<br/>            identifier: On_Manifest_Changes<br/>            stages:<br/>                - stage:<br/>                      identifier: Deploy<br/>                      type: Deployment<br/>                      spec:<br/>                          serviceConfig:<br/>                              serviceDefinition:<br/>                                  type: Kubernetes<br/>                                  spec:<br/>                                      manifests:<br/>                                          - manifest:<br/>                                                identifier: +input&gt;<br/>                                                type: HelmChart<br/>                                                spec:<br/>                                                    store:<br/>                                                        type: Http<br/>                                                        spec:<br/>                                                            connectorRef: &lt;+input&gt;<br/>                                                    chartName: todolist<br/>                                                    chartVersion: &lt;+trigger.manifest.version&gt;<br/>                                                    helmVersion: V3<br/>                                                    skipResourceVersioning: false<br/>            properties:<br/>                ci:<br/>                    codebase:<br/>                        build:<br/>                            type: branch<br/>                            spec:<br/>                                branch: &lt;+trigger.branch&gt;</pre></div></details><h3>Option: Enable or Disable Trigger</h3><p>You can enable or disable Triggers using the Enabled toggle:</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/c1eskrgngf/1637278018604/clean-shot-2021-11-18-at-15-26-38-2-x.png"/></figure><h3>Option: Reuse Trigger YAML to Create New Triggers</h3><p>You can reuse Triggers by copying and pasting Trigger YAML. This can be helpful when you have advanced Conditions you don&#39;t want to set up each time.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/54eqk0d1bd/1637612549910/clean-shot-2021-11-22-at-12-21-57.png"/></figure><h3>See Also</h3><ul><li><a href="/article/4z9mf24m1b-schedule-pipelines-using-cron-triggers">Schedule Pipelines using Triggers</a></li><li><a href="/article/hndnde8usz-triggering-pipelines">Trigger Pipelines using Git Events</a></li></ul><p></p>