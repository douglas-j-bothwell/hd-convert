<p>You can use OneLogin to provision users and groups in Harness.</p><p>Harness&#39; SCIM integration enables OneLogin to serve as a single identity manager for adding and removing users. This is especially efficient for managing large numbers of users.</p><p>This topic describes how to set up OneLogin provisioning for Harness Users and User Groups.</p><h3>Before You Begin</h3><ul><li>This topic assumes you understand the System for Cross-domain Identity Management (SCIM). For an overview, see the article <a href="https://medium.com/@pamodaaw/system-for-cross-domain-identity-management-scim-def45ea83ae7" target="_blank">Introduction to System for Cross-domain Identity Management (SCIM)</a>.</li><li><a href="https://ngdocs.harness.io/article/hv2758ro4e-learn-harness-key-concepts">Learn Harness&#39; Key Concepts</a></li><li><a href="https://ngdocs.harness.io/article/vz5cq0nfg2-rbac-in-harness">Access Management (RBAC) Overview</a></li><li>Make sure you are an Administrator in your OneLogin account and have the <strong>Account Admin</strong> permissions in Harness.</li><li>Make sure you have a Harness <a href="/article/tdoad7xrh9-add-and-manage-api-keys">API Key</a> and a valid Token under it. The API Key must have all permissions on the Users and User Groups.</li></ul><h3>Limitations</h3><p>This integration does not support updating a provisioned user&#39;s <strong>Email</strong> in OneLogin. Once the user is provisioned in Harness, the user&#39;s email address must remain the same. If you change the email address in OneLogin and then try to remove the user from Harness, the removal will fail.</p><p>Once a user is provisioned in Harness, you cannot delete the user in the Harness Manager. You must delete the user in OneLogin.</p><p>The provisioned user cannot use the Harness OneLogin app to log into Harness unless OneLogin is also set up for <a href="https://docs.harness.io/article/zy8yjcrqzg-single-sign-on-sso-with-saml#saml_sso_with_one_login">OneLogin SAML authentication in Harness</a>. They must use their email address and password.</p><h3>Step 1: Add Harness App to OneLogin​</h3><p>The first step is adding the Harness app to your OneLogin <strong>Applications</strong>.</p><ol><li>In <strong>Applications</strong>, click <strong>Add App</strong>.</li><li>Search for <strong>Harness</strong>. The Harness Application appears.</li><li>Click the Harness app to open its Configuration page and click <strong>Save</strong>.</li></ol><p>When you are done, the Harness OneLogin app appears.</p><p>For more information on adding apps, see OneLogin&#39;s documentation: <a href="https://onelogin.service-now.com/support/?id=kb_article&amp;sys_id=6ac91143db109700d5505eea4b9619a2#add" target="_blank">Introduction to App Management</a>.</p><h3>Step 2: SCIM Base URL</h3><p>Next, add a special Harness account URL to the OneLogin app&#39;s SCIM Base URL.</p><ol><li>Log into your Harness account.</li><li>Copy the Harness account ID from the <strong>Account Overview</strong> of your Harness account.<figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/y402mpkrxq/1643000203837/screenshot-2022-01-24-at-10-24-06-am.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li><li>Add your account ID to the end of the following URL: <code>https://app.harness.io/gateway/ng/api/scim/account/&lt;account_ID&gt;</code></li></ol><div class="note-callout">For Harness On-Prem, the URL will use your custom domain name and <code>gateway</code> is omitted. For example, if your On-Prem domain name is <strong>harness.mycompany.com</strong>: <code>https://harness.mycompany.com/ng/api/scim/account/&lt;account_ID&gt;</code></div><ol><li style="counter-increment:li 3" start="4">Copy the full URL.</li><li>In OneLogin, open the Harness OneLogin app.</li><li>Click <strong>Configuration</strong>.</li><li>In <strong>SCIM Base URL</strong>, paste the Harness URL you copied.</li></ol><p>Next, we will use a Harness API access key for the <strong>SCIM Bearer Token</strong> setting in your Harness OneLogin app.</p><h3>Step 3: SCIM Bearer Token</h3><p>The SCIM Bearer Token value is used to authenticate requests and responses sent between the OneLogin SCIM provisioning service and Harness.</p><ol><li>In Harness Manager, create an API token by following the instructions in <a href="/article/tdoad7xrh9-add-and-manage-api-keys">Add and Manage API Keys</a>.</li><li>Copy the new API token.</li><li>In OneLogin, paste the API token in the <strong>SCIM Bearer Token</strong> setting in your Harness OneLogin app.</li><li>Ensure that the API Status is enabled and click <strong>Save</strong>.</li></ol><h3>Step 4: Set Up Harness OneLogin App Provisioning</h3><p>Next, you will set the required provisioning settings for the Harness OneLogin app.</p><p>Ensure these settings are set up exactly as shown below.</p><ol><li>In the Harness OneLogin app, click <strong>Provisioning</strong>.</li><li>In <strong>Workflow</strong>, ensure the following are selected:</li></ol><ul><li>Enable provisioning</li><li>Create user</li><li>Delete user</li><li>Update user</li><li>When users are deleted in OneLogin, or the user&#39;s app access is removed, perform the below action: <strong>Delete</strong>.</li><li>When user accounts are suspended in OneLogin, perform the following action: <strong>Suspend</strong>.</li></ul><p>When you are done, it will look like this:</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/y402mpkrxq/1643001118253/screenshot-2022-01-24-at-10-41-07-am.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><ol><li style="counter-increment:li 2" start="3">Click <strong>Save</strong>.</li></ol><h3>Option: Provision OneLogin Users to Harness</h3><p>Next, we will add users to the Harness OneLogin app. Once OneLogin SSO is enabled in Harness, these users will be provisioned in Harness automatically.</p><ol><li>In OneLogin, click <strong>Users</strong>.</li><li>Click a user.</li><li>In <strong>User Info</strong>, ensure that the user has <strong>First name</strong>, <strong>Last name</strong>, and <strong>Email</strong> completed.</li></ol><div class="note-callout">Only <strong>First name</strong>, <strong>Last name</strong>, and <strong>Email</strong> are permitted for Harness OneLogin SCIM provisioning. Do not use any additional User Info settings.</div><ol><li style="counter-increment:li 3" start="4">Click <strong>Applications</strong>.</li><li>In the <strong>Applications</strong> table, click the add button <strong>(+)</strong>.</li><li>In the <strong>Assign new login</strong> settings, select the Harness OneLogin App and click <strong>Continue</strong>.</li><li>In <strong>NameID</strong>, enter the email address for the user. This is the same email address in the <strong>NameID</strong> setting.</li><li>Click <strong>Save</strong>. The status in the <strong>Applications</strong> table is now <strong>Pending</strong>.</li><li>Click <strong>Pending</strong>. The <strong>Create User in Application</strong> settings appear.</li><li>Click <strong>Approve</strong>. The Provisioning status will turn to Provisioned.</li></ol><p>If provisioning fails, you might see something like the following error:</p><figure><a href="https://files.helpdocs.io/kw8ldg1itf/articles/3hmfr07oz9/1586905852981/image.png"><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3hmfr07oz9/1586905852981/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></a></figure><p>The most common reason is incorrect <strong>SCIM Base URL</strong> or <strong>SCIM Bearer Token</strong> settings in the OneLogin app.</p><h3>Verify Provisioning in Harness</h3><p>Now that you have provisioning confirmation from OneLogin, let&#39;s verify that the provisioned user is in Harness.</p><ol><li>In Harness, click <strong>Account Settings</strong>, and then select <strong>Access Control</strong>.</li><li>Click <strong>Users</strong>.</li><li>Locate the provisioned user.<figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/y402mpkrxq/1643004054951/screenshot-2022-01-24-at-11-29-09-am.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li></ol><p>The provisioned users will receive an email invite from Harness to sign up and log in.</p><h3>Option: Provision OneLogin Roles to Harness Groups</h3><p>You can create, populate, and delete Harness User Groups using OneLogin.</p><div class="note-callout">Due to OneLogin currently not supporting group deletion via SCIM, you must remove User Groups using OneLogin. If you try to delete OneLogin-provisioned User Groups within Harness, you will get the error message, <code>Cannot Delete Group Imported From SCIM</code>. Once the group is removed from OneLogin, contact Harness Support to have it removed from Harness.</div><p>To perform Harness User Group provisioning using OneLogin, you assign the Harness OneLogin app and OneLogin users to a OneLogin role.</p><p>Next, you create a rule in the Harness OneLogin app that creates groups in Harness using the role.</p><p>The OneLogin roles become User Groups in Harness.</p><div class="note-callout">You cannot provision OneLogin users to Harness User Groups if they are already provisioned in Harness. Simply remove them from Harness and then provision them using the step below.</div><h4>Add User Provisioning to the Harness OneLogin App</h4><ol><li>Ensure the Harness OneLogin app is added and configured as described in steps 1 through 5 in this topic.</li><li>In OneLogin, open the Harness OneLogin app.</li><li>In <strong>Parameters</strong>, in <strong>Optional Parameters</strong>, click on <strong>Groups</strong>.</li><li>In <strong>Edit Field Groups</strong>, select <strong>Include in User Provisioning</strong> and click <strong>Save</strong>.</li><li>Click <strong>Save</strong> to save the Harness OneLogin app.</li></ol><p>Next, we&#39;ll create the OneLogin role that will be used as your Harness User Group.</p><h4>Create OneLogin Role</h4><ol><li>In OneLogin, click <strong>Users</strong> and select <strong>Roles</strong>.</li><li>Click <strong>New Role</strong>.</li><li>Enter a name for the new role and click <strong>Save</strong>.</li><li>In <strong>Roles</strong>, open the new role.</li><li>Click <strong>Users</strong>.</li><li>In <strong>Check existing or add new users to this role</strong>, enter the name(s) of the users to add.</li><li>When you have located each user name, click <strong>Check</strong>.</li><li>For each user, click <strong>Add to Role</strong>. When you are done, the user(s) are listed in <strong>Users Add Manually</strong>.</li><li>Click <strong>Save</strong>. You are returned to the Roles page.</li><li>Open the role.</li><li>In the role, click <strong>Applications</strong>.</li><li>Click the <strong>Add Apps</strong> button.</li><li>In <strong>Select Apps to Add</strong>, click the Harness OneLogin app.</li><li>Click <strong>Save</strong>.</li></ol><p>Now that the role has users and the Harness OneLogin app, we can add the Harness OneLogin app to each OneLogin user.</p><h4>Add Harness OneLogin app to Users</h4><p>For each of the OneLogin users you have added to the role, you will now add the Harness OneLogin app.</p><ol><li>In OneLogin, click <strong>Users</strong>, and then select each user you want to add.</li><li>On the user&#39;s page, click <strong>Applications</strong>.</li><li>Click the <strong>Add App</strong> button.</li><li>In <strong>Assign new login</strong>, select the Harness OneLogin app, and click <strong>Continue</strong>.</li><li>In the <strong>Edit</strong> settings, in <strong>Groups</strong>, select the role you created and click <strong>Add</strong>.</li><li>Click <strong>Save</strong>.</li></ol><p>Now that each user is associated with the Harness OneLogin app and role, you will learn /add a rule to the Harness OneLogin app. The rule will set groups in the Harness OneLogin app using the role you created.</p><h4>Add Rule to Harness OneLogin App</h4><p>Next, you create a rule in the Harness OneLogin app to create groups using the role you created.</p><ol><li>Click <strong>Application</strong>, and then select the Harness OneLogin app.</li><li>In the app, click <strong>Rules</strong>.</li><li>Click <strong>Add Rule</strong>.</li><li>Name the rule.</li><li>In <strong>Actions</strong>, select <strong>Set Groups in [Application name]</strong>.</li><li>Select <strong>Map from OneLogin</strong>.</li><li>In <strong>For each</strong>, select <strong>role</strong>.</li><li>In <strong>with value that matches</strong>, enter the name of the role you create or enter the regex <code>.*</code>.</li><li>Click <strong>Save</strong>.</li><li>Click <strong>Save</strong> to save the app.</li></ol><div class="note-callout">If you have created users prior to adding the mapping rule, click Reapply Mappings in your Harness application User settings:</div><p>Now that the app has a rule to set groups in Harness using the role you created, you can begin provisioning users using the app.</p><h4>Provision Users in Application</h4><p>Each of the OneLogin users that you added the Harness OneLogin app to can now be provisioned.</p><ol><li>In the Harness OneLogin app, click <strong>Users</strong>. The users are listed as <strong>Pending</strong>.</li><li>Click each user and then click <strong>Approve</strong>.</li></ol><p>The Provisioning State for each user is changed to <strong>Provisioned</strong>.</p><h4>See the Provisioned User Group in Harness</h4><p>Now that you have provisioned users using the Harness OneLogin app, you can see the new group and users in Harness.</p><ol><li>In Harness, click <strong>Access Management</strong>.</li><li>Click <strong>User Groups</strong>.</li><li>Locate the name of the User Group. It is named after the role you created. Click the <strong>User Group</strong>.</li></ol><p>You can see the User Group and Users that are provisioned.</p><p>Repeat the steps in this process for additional users.</p><h3>What If I Already Have App Integration for Harness FirstGen?</h3><p>If you currently have a Harness FirstGen App Integration setup in your IDP and are now trying to set up one for Harness NextGen, make sure the user information is also included in the FirstGen App Integration before attempting to log into Harness NG through SSO.</p><div class="note-callout">Harness authenticates users using either the FirstGen App Integration or the NextGen App Integration. If you have set up both, Harness continues to use your existing App Integration in FirstGen to authenticate users that attempt to log in using SSO.</div><p>Let us look at the following example:</p><ol><li>An App Integration is already set up for FirstGen with 2 users as members:<br/><code>user1@example.com</code> and <code>user2@example.com</code>.</li><li>Now you set up a separate App Integration for Harness NextGen and add <code>user1@example.com</code> and <code>user_2@example.com</code> as the members.</li><li>You provision these users to Harness NextGen through SCIM.</li><li><code>user1@example.com</code> and <code>user_2@example.com</code> try to log in to Harness NextGen through SSO.</li><li>The FirstGen App Integration is used for user authentication.<br/><code>user1@example.com</code> is a member of the FirstGen App Integration and hence is authenticated and successfully logged in to Harness NextGen.<br/><code>user_2@example.com</code> is not a member of the FirstGen App Integration, hence the authentication fails and the user cannot log in to Harness NextGen.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/umv2xdnofv/1659510080231/screenshot-2022-08-03-at-12-30-23-pm.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li></ol><h3>Assign Permissions Post-Provisioning</h3><p>Permissions can be assigned manually or via the Harness API:</p><ul><li><a href="https://ngdocs.harness.io/article/tsons9mu0v-add-roles">Add and Manage Roles</a></li><li><a href="https://ngdocs.harness.io/article/yp4xj36xro-add-resource-groups">Add and Manage Resource Groups</a></li><li><a href="https://ngdocs.harness.io/article/yaornnqh0z-permissions-reference">Permissions Reference</a></li></ul><p></p>