<p>This topic describes the default (built-in) and custom Harness expressions, as well as the prefixes used to identify user-created variables. This list will be periodically updated when new expressions are added to Harness.</p><div class="note-callout">Looking for how-tos? See <a href="https://docs.harness.io/category/bp8t5hf922-expressions-howtos">Variable Expressions How-tos</a>.</div><h3>Variable Expression Basics</h3><p>Let&#39;s quickly review what Harness built-in and custom variable expressions are and how they work.</p><h4>What is a Harness Variable Expression?</h4><p>Harness variables are a way to refer to something in Harness, such as an entity name or a configuration setting. At Pipeline runtime, Harness evaluates all variables and replaces them with the resulting value.</p><p>Harness variables are powerful because they let you template configuration information, Pipeline settings, and values in your scripts, and they enable your Pipelines to pass information between Stages and settings.</p><p>When you use a variable, you add it as an expression.</p><p>Harness expressions are identified using the <code>&lt;+...&gt;</code> syntax. For example, <code>&lt;+pipeline.name&gt;</code> references the name of the Pipeline where the expression is evaluated.</p><p>The content between the <code>&lt;+...&gt;</code> delimiters is passed on to the <a href="http://commons.apache.org/proper/commons-jexl/" target="_blank">Java Expression Language (JEXL)</a> where it is evaluated. Using JEXL, you can build complex variable expressions that use JEXL methods. For example, here&#39;s an expression that uses Webhook Trigger payload information:</p><pre>&lt;+trigger.payload.pull_request.diff_url&gt;.contains(&#34;triggerNgDemo&#34;) || &lt;+trigger.payload.repository.owner.name&gt; == &#34;wings-software&#34;</pre><p></p><p>Harness pre-populates many variables, as documented below, and you can set your own variables in the form of context output from <a href="/article/k5lu0u6i1i-using-shell-scripts">shell scripts</a> and other steps.</p><h4>FQNs and Expressions</h4><p>Everything in Harness can be referenced by a Fully Qualified Name (FQN) expression.</p><p>The FQN is the path to a setting in the YAML of your Pipeline:</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1626460127786/clean-shot-2021-07-16-at-11-27-50.png"/></figure><p>You can select the expression for a setting or value in the Pipeline editor or execution.</p><p>You don&#39;t need to build the expression yourself. Harness provides multiple places where you can copy the variable expression.</p><p>For example, you can click the copy button in a Pipeline execution to get the expressions of settings and values.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1626460634169/clean-shot-2021-07-16-at-11-36-13.png"/></figure><p>When building a Pipeline in Pipeline Studio, you can copy the FQN of a setting using <strong>Variables</strong>.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1649181175482/clean-shot-2022-04-05-at-10-51-10.png"/></figure><p></p><p></p><h4>Stage-level and Pipeline-level Expressions</h4><p>Every section and step in a stage contains input information you can reference as expressions.</p><p>Click <strong>Variables</strong> in the Pipeline to view all the inputs and copy their expressions.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1649181175482/clean-shot-2022-04-05-at-10-51-10.png"/></figure><p>There are two expressions for each input:</p><ul><li><strong>Stage-level:</strong> use this option to reference the input anywhere in its Stage.</li><li><strong>Pipeline-level:</strong> begins with <code>pipeline.stages</code>. Use this option to reference the input anywhere in the Pipeline.</li></ul><h4>Expression Example</h4><p>Here is a simple example of a Shell Script step echoing some common variable expressions:</p><pre class="hljs yaml">echo &#34;Harness account name: &#34;&lt;+account.name&gt;<br/><br/>echo &#34;Harness comp name: &#34;&lt;+account.companyName&gt;<br/><br/>echo &#34;pipeline executionId: &#34;&lt;+pipeline.executionId&gt;<br/><br/>echo &#34;pipeline sequenceId: &#34;&lt;+pipeline.sequenceId&gt;<br/><br/>echo &#34;stage name: &#34;&lt;+stage.name&gt;<br/><br/>echo &#34;service name: &#34;&lt;+service.name&gt;<br/><br/>echo &#34;service variables: &#34;&lt;+service.variables.example_var&gt; <br/><br/>echo &#34;artifact image: &#34;&lt;+artifact.image&gt;<br/><br/>echo &#34;artifact.imagePath: &#34;&lt;+artifact.imagePath&gt;<br/><br/>echo &#34;environment name: &#34;&lt;+environment.name&gt;<br/><br/>echo &#34;infrastructure connectorRef: &#34;&lt;+infra.connectorRef&gt;<br/><br/>echo &#34;infrastructure namespace: &#34;&lt;+infra.namespace&gt;<br/><br/>echo &#34;infrastructure releaseName: &#34;&lt;+infra.releaseName&gt;</pre><p></p><p>Here is an example of the output:</p><pre class="hljs yaml">Harness account name: Harness.io<br/><br/>Harness comp name: Harness.io<br/><br/>pipeline executionId: T4a7uBs7T-qWhNTr-LnFDw<br/><br/>pipeline sequenceId: 16<br/><br/>stage name: dev<br/><br/>service name: nginx<br/><br/>service variables: foo<br/><br/>artifact image: index.docker.io/library/nginx:stable<br/><br/>artifact.imagePath: library/nginx<br/><br/>environment name: quickstart<br/><br/>infrastructure connectorRef: account.harnesstestpmdemocluster<br/><br/>infrastructure namespace: default<br/><br/>infrastructure releaseName: docs<br/><br/>Command completed with ExitCode (0)</pre><p></p><h4>Input and Output Variable Expressions</h4><p>You can reference the inputs and outputs of any part of your Pipeline.</p><ul><li><strong>Input variable expressions</strong> reference the values and setting selections you made in your Pipeline.</li><li><strong>Output variable expressions</strong> reference the results of a Pipeline execution.</li></ul><p>You can reference inputs in Pipeline <strong>Variables</strong>:</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1649196318704/clean-shot-2022-04-05-at-15-05-06.png"/></figure><h5>Input and Output Variable Expressions in Executions</h5><p>Inputs and outputs are displayed for every part of the Pipeline execution.</p><p>Here&#39;s the inputs and outputs for a Kubernetes Rollout Deployment step:</p><table><tbody><tr><td><p><strong>Inputs</strong></p></td><td><p><strong>Outputs</strong></p></td></tr><tr><td><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1649195147236/clean-shot-2022-04-05-at-14-43-31.png"/></figure></td><td><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1649195140680/clean-shot-2022-04-05-at-14-43-47.png"/></figure></td></tr></tbody></table><p></p><p>You can copy the expressions for the names or values of any input or output.</p><p></p><table><tbody><tr><td><p><strong>Name</strong></p></td><td><p><strong>Value</strong></p></td></tr><tr><td><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1649195886590/clean-shot-2022-04-05-at-14-57-48.png"/></figure></td><td><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1649195906759/clean-shot-2022-04-05-at-14-58-14.png"/></figure></td></tr></tbody></table><p></p><p>Here are the <strong>Name</strong> and <strong>Value</strong> expressions for the <code>podIP</code> setting:</p><ul><li>Name:<pre class="hljs yaml">&lt;+pipeline.stages.Deploy_Service.spec.execution.steps.rolloutDeployment.deploymentInfoOutcome.serverInstanceInfoList[0].podIP&gt;</pre></li><li>Value: <code>10.100.0.6</code></li></ul><h4>Using Expressions in Settings</h4><p>You can use Harness variable expressions in most settings.</p><p>When you select <strong>Expression</strong> in a setting, you type <code>&lt;+</code> and a value and the list of available variables appears:</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1643669031564/image.png"/></figure><p>Simply click a variable expression name to use it as the value for this setting.</p><p>At runtime, Harness will replace the variable with the runtime value.</p><p>You can also paste in expressions that don&#39;t appear. Such as expressions that reference settings in previous Stages.</p><p>See <a href="/article/f6yobn7iq0-runtime-inputs">Fixed Values, Runtime Inputs, and Expressions</a>.</p><h4>Only Use Expressions After They&#39;ll Be Resolved</h4><p>When Harness encounters an expression during Pipeline execution, it tries to resolve it with the information it has at that point in the execution. Consequently, you can only use an expression after Harness has the required information. If you try to use an expression before Harness has its information, it will fail.</p><p>In this illustration, you can see how the information in each section of the Stage are referenced:</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1649182620007/clean-shot-2022-04-05-at-11-08-03.png"/></figure><p>Here&#39;s how you reference the information in each of these sections:</p><ul><li><strong>Service expressions</strong> can only be used <u>after</u> Harness has progressed through the <strong>Service</strong> section of the Pipeline.<ul><li><strong>Service</strong> expressions they can be used in <strong>Infrastructure</strong> and <strong>Execution</strong>.</li></ul></li><li><strong>Infrastructure expressions</strong> can only be used <u>after</u> Harness has progressed through the <strong>Infrastructure</strong> section of the Pipeline.<ul><li>In <strong>Infrastructure</strong>, you can reference <strong>Service</strong> settings.</li><li>Since <strong>Execution</strong> follows <strong>Infrastructure</strong>, you can reference <strong>Infrastructure</strong> expressions in <strong>Execution</strong>.</li></ul></li><li><strong>Execution expressions</strong> apply to steps in <strong>Execution</strong>.<ul><li>Each step&#39;s <strong>Execution</strong> expressions can only be used after Harness has progressed through that step in the <strong>Execution</strong> section:<figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1649183263909/clean-shot-2022-04-05-at-11-23-11.png"/></figure></li></ul></li></ul><h5>Variable Expressions in Conditional Execution Settings</h5><p>Stages and Steps support variable expressions in the JEXL conditions of their <strong>Conditional Execution</strong> settings.</p><p>You can only use variable expressions in the JEXL conditions that can be resolved <u>before</u> the stage.</p><p>Since <strong>Conditional Execution</strong> settings are used to determine <u>if</u> the stage should be run, you cannot use variable expressions that can&#39;t be resolved <u>until</u> the stage is run.</p><p>For more information on Conditional Execution, see <a href="/article/i36ibenkq2-step-skip-condition-settings">Stage and Step Conditional Execution Settings</a>.</p><h3>Variable Expression Limitations and Restrictions</h3><p>Review the following variable expression limitations and restrictions to avoid errors when using variable expressions.</p><h4>Scope</h4><p>Harness permits variables only within their scope. You will not see a variable available in a field where it cannot be used.</p><p>You cannot refer to a Pipeline step&#39;s expressions <u>within the same step</u>.</p><p>For example, if you have an HTTP step with the Id <code>foo</code> you cannot use the expression <code>&lt;+execution.steps.foo.spec.url&gt;</code> to reference the HTTP URL <u>within that same step</u>. Put another way, you can only reference a step&#39;s settings from a different step.</p><h4>Variable Value Size</h4><p>A variable value (the evaluated expression) is limited to 256 KB.</p><h4>Scripts Within Expressions</h4><p>You cannot write scripts within an expression <code>&lt;+...&gt;</code>. For example, the following script will not work:</p><pre class="hljs javascript">if ((x * 2) == 5) { &lt;+pipeline.name = abc&gt;; } else { &lt;+pipeline.name = def&gt;; }</pre><h4>Variable Names Across the Pipeline</h4><p><u>Variables names must be unique in the same Stage.</u> You can use the same variable names in different Stages in the same Pipeline or other Pipelines.</p><h4>Hyphens in Variable Names</h4><p>Do not use hyphens (dashes) in variable names, as some Linux distributions and deployment-related software do not allow them. Also, it can cause issues with headers.</p><p>For example, <code>&lt;+execution.steps.httpstep.spec.headers.x-auth&gt;</code> will not work.</p><p>As a workaround, you can put the variable name in <code>[&#34;...&#34;]</code>, like this:</p><p><code>&lt;+execution.steps.httpstep.spec.headers[&#34;x-auth&#34;]&gt;</code></p><p>This also works for nested expressions:</p><p><code>&lt;+execution.steps.httpstep.spec.newHeaders[&#34;x-auth&#34;][&#34;nested-hyphen-key&#34;]&gt;</code></p><p><code>&lt;+execution.steps.httpstep.spec.newHeaders[&#34;x-auth&#34;].nonhyphenkey&gt;</code></p><h4>Variable Expression Name Restrictions</h4><p>A variable name is the <u>name</u> in the variable expression, such as <code>foo</code> in <code>&lt;+stage.variables.foo&gt;</code>.</p><p>Variable names may only contain <code>a-z, A-Z, 0-9, _</code>. They cannot contain hyphens or dots.</p><div class="note-callout">Certain platforms and orchestration tools, like Kubernetes, have their own naming restrictions. For example, Kubernetes doesn&#39;t allow underscores. Make sure that whatever expressions you use resolve to the allowed values of your target platforms.</div><h4>Reserved Words</h4><p>The following keywords are reserved, and cannot be used as a variable name or property:</p><p><code>or and eq ne lt gt le ge div mod not null true false new var return shellScriptProvisioner</code></p><p>See <a href="https://people.apache.org/~henrib/jexl-3.0/reference/syntax.html" target="_blank">JEXL grammar details</a>.</p><h3>Built-in CIE Codebase Variables Reference</h3><p>In Harness, you set up your <a href="/article/6vks5ym7sq-edit-a-ci-pipeline-codebase-configuration">Codebase</a> by connecting to a Git repo using a Harness <a href="/article/tbm2hw6pr6-git-connector-settings-reference">Connector</a> and cloning the code you wish to build and test in your Pipeline.</p><p>Harness also retrieves your Git details and presents them in your Build stage once a Pipeline is run.</p><p>Using Harness built-in expressions, you can refer to the various attributes of your Codebase in Harness stages.</p><p>Here is a simple example of a Shell Script step echoing some common Codebase variable expressions:</p><pre class="hljs bash">echo &lt;+codebase.commitSha&gt;<br/>echo &lt;+codebase.targetBranch&gt;<br/>echo &lt;+codebase.sourceBranch&gt;<br/>echo &lt;+codebase.prNumber&gt;<br/>echo &lt;+codebase.prTitle&gt;<br/>echo &lt;+codebase.commitRef&gt;<br/>echo &lt;+codebase.repoUrl&gt;<br/>echo &lt;+codebase.gitUserId&gt;<br/>echo &lt;+codebase.gitUserEmail&gt;<br/>echo &lt;+codebase.gitUser&gt;<br/>echo &lt;+codebase.gitUserAvatar&gt;<br/>echo &lt;+codebase.pullRequestLink&gt;<br/>echo &lt;+codebase.pullRequestBody&gt;<br/>echo &lt;+codebase.state&gt;</pre><p></p><p>See <a href="/article/576gjpak61-built-in-cie-codebase-variables-reference">Built-in CIE Codebase Variables Reference</a>.</p><h3>Account</h3><h4>&lt;+account.identifier&gt;</h4><p>The entity <a href="/article/li0my8tcz3-entity-identifier-reference">identifier</a> of the Harness account.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1649179647454/clean-shot-2022-04-05-at-10-26-48.png"/></figure><p></p><h4>&lt;+account.name&gt;</h4><p>Harness account name.</p><h4>&lt;+account.companyName&gt;</h4><p>The name of the company for the account.</p><h4>Custom Account Variables</h4><p>See <a href="/article/f3450ye0ul-add-a-variable">Add Account, Org, and Project-level Variables</a>.</p><h3>Org</h3><h4>&lt;+org.identifier&gt;</h4><p>The entity <a href="/article/li0my8tcz3-entity-identifier-reference">identifier</a> of an organization.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1649179758424/clean-shot-2022-04-05-at-10-28-48.png"/></figure><h4>&lt;+org.name&gt;</h4><p>The name of the Org.</p><h4>&lt;+org.description&gt;</h4><p>The description of the Org.</p><h4>Custom Org Variables</h4><p>See <a href="/article/f3450ye0ul-add-a-variable">Add Account, Org, and Project-level Variables</a>.</p><h3>Project</h3><h4>&lt;+project.name&gt;</h4><p>The name of the Harness Project.</p><h4>&lt;+project.description&gt;</h4><p>The description of the Harness Project.</p><h4>&lt;+project.tags&gt;</h4><p>All Harness Tags attached to the Project.</p><h4>&lt;+project.identifier&gt;</h4><p>The entity <a href="/article/li0my8tcz3-entity-identifier-reference">identifier</a> of the Harness Project.</p><h4>Custom Project Variables</h4><p>See <a href="/article/f3450ye0ul-add-a-variable">Add Account, Org, and Project-level Variables</a>.</p><h3>Pipeline</h3><h4>Pipeline-level Variables</h4><p>Here&#39;s a quick video that explains how to create and reference Pipeline, Stage, and Service variables:</p><p></p><div class="hd--embed" data-provider="YouTube" data-thumbnail="https://i.ytimg.com/vi/lqbmO6EVGuU/hqdefault.jpg"><iframe width="200" height="150" src="https://www.youtube.com/embed/lqbmO6EVGuU?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div><p></p><h4>&lt;+pipeline.identifier&gt;</h4><p>The <a href="/article/li0my8tcz3-entity-identifier-reference">Entity Identifier</a> (Id) for the Pipeline.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1649179565977/clean-shot-2022-04-05-at-10-25-54.png"/></figure><h4>&lt;+pipeline.executionId&gt;</h4><p>Every execution of a Pipeline is given a universally unique identifier (UUID). The UUID can be referenced anywhere.</p><p>For example, in the following execution URL the UUID follows <code>executions</code> and is <code>kNHtmOaLTu66f_QNU-wdDw</code>:</p><pre>https://app.harness.io/ng/#/account/12345678910/cd/orgs/default/projects/CD_Quickstart/pipelines/Helm_Quickstart/executions/kNHtmOaLTu66f_QNU-wdDw/pipeline</pre><h4>&lt;+pipeline.name&gt;</h4><p>The name of the current Pipeline.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1646254690149/clean-shot-2022-03-02-at-12-58-02.png"/></figure><h4>&lt;+pipeline.sequenceId&gt;</h4><p>The incremental sequential ID for the execution of a Pipeline. A <code>&lt;+pipeline.executionId&gt;</code> does not change, but a <code>&lt;+pipeline.sequenceId&gt;</code> is incremented with each run of the Pipeline.</p><p>The first run of a Pipeline receives a sequence ID of 1 and each subsequent execution is incremented by 1.</p><p>For CD Pipelines the ID is named Execution. For CI Pipelines the ID is named Builds.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1618605514345/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>You can use <code>&lt;+pipeline.sequenceId&gt;</code> to tag a CI build when you push it to a repo, and then use <code>&lt;+pipeline.sequenceId&gt;</code> to pull the same build and tag in a subsequent stage. See <a href="/article/x0d77ktjw8-ci-pipeline-quickstart">CI Pipeline Quickstart</a>.</p><h4>&lt;+pipeline.startTs&gt;</h4><p>The start time of a Pipeline execution in <a href="https://www.epoch101.com/" target="_blank">Unix Epoch format</a>. See <a href="/category/oya6qhmmaw">Trigger How-tos</a>.</p><h4>&lt;+pipeline.triggerType&gt;</h4><p>The type of Trigger. See <a href="/category/oya6qhmmaw">Trigger How-tos</a>.</p><h4>&lt;+pipeline.triggeredBy.name&gt;</h4><p>The name of the user or the Trigger name if the Pipeline is triggered using a Webhook. See <a href="/article/hndnde8usz-triggering-pipelines">Trigger Pipelines using Git Events</a>.</p><div class="note-callout">If a user name is not present in the event payload, the <code>&lt;+pipeline.triggeredBy.name&gt;</code> expression will resolve as empty. For example, in the SaaS edition of Bitbucket, a user name is not present.</div><h4>&lt;+pipeline.triggeredBy.email&gt;</h4><p>The email of the user who triggered the Pipeline. This returns NULL if the Pipeline is triggered using a webhook. See <a href="/category/oya6qhmmaw">Trigger How-tos</a>.</p><h3>Deployment Status</h3><p>Deployment status values are a Java enum. The list of values can be seen in the Deployments <strong>Status</strong> filter:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/lml71vhsim/1657643717451/clean-shot-2022-07-12-at-09-35-08.png"/></figure><p>You can use any status value in a JEXL condition. For example, <code>&lt;+pipeline.stages.stage1.status&gt; == &#34;FAILED&#34;</code>.</p><h3>Stage</h3><h4>Stage-level Variables</h4><p>Here&#39;s a quick video that explains how to create and reference Pipeline, Stage, and Service variables:</p><p></p><div class="hd--embed" data-provider="YouTube" data-thumbnail="https://i.ytimg.com/vi/lqbmO6EVGuU/hqdefault.jpg"><iframe width="200" height="150" src="https://www.youtube.com/embed/lqbmO6EVGuU?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div><p></p><p>Once you&#39;ve created a stage, its settings are in the <strong>Overview</strong> tab. For example, here&#39;s the <strong>Overview</strong> tab for a Deploy stage:</p><figure><a href="https://files.helpdocs.io/i5nl071jo5/articles/2chyf1acil/1631221583537/clean-shot-2021-09-09-at-14-06-11.png"><img src="https://files.helpdocs.io/i5nl071jo5/articles/2chyf1acil/1631221583537/clean-shot-2021-09-09-at-14-06-11.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></a></figure><p>In <strong>Advanced</strong>, you can add <strong>Stage Variables</strong>.</p><p>Stage variables are custom variables you can add and reference in your stage and Pipeline. They&#39;re available across the Pipeline. You can override their values in later stages.</p><p>You can even reference stage variables in the files fetched at runtime.</p><p>For example, you could create a stage variable <code>name</code> and then reference its identifier in the Kubernetes values.yaml file used by this stage: <code>name: &lt;+stage.variables.name&gt;</code>:</p><pre class="hljs properties">name: &lt;+stage.variables.name&gt;<br/>replicas: 2<br/><br/>image: &lt;+artifact.image&gt;<br/>...</pre><p>When you run this Pipeline, the value for <code>name</code> is used for the values.yaml file. The value can be a Fixed Value, Expression, or Runtime Input.</p><p>You reference stage variables <strong>within their stage</strong> using the expression <code>&lt;+stage.variables.[variable name]&gt;</code>.</p><p>You reference stage variables <strong>outside their stage</strong> using the expression <code>&lt;+pipeline.stages.[stage name].variables.[variable name]&gt;</code>.</p><h4>&lt;+stage.name&gt;</h4><p>The name of the stage where the expression is evaluated.</p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1618605849908/image.png"/></figure><h4>&lt;+stage.description&gt;</h4><p>The description of the stage where the expression is evaluated.</p><h4>&lt;+stage.tags&gt;</h4><p>The tags on the stage where the expression is evaluated. See <a href="/article/i8t053o0sq-tags-reference">Tags Reference</a>.</p><p>These tags are different from Docker image tags.</p><h4>&lt;+stage.identifier&gt;</h4><p>The <a href="/article/li0my8tcz3-entity-identifier-reference">entity identifier</a> of the stage where the expression is evaluated.</p><h3>Service</h3><h4>Service-level Variables</h4><p>Here&#39;s a quick video that explains how to create and reference Pipeline, Stage, and Service variables:</p><p></p><div class="hd--embed" data-provider="YouTube" data-thumbnail="https://i.ytimg.com/vi/lqbmO6EVGuU/hqdefault.jpg"><iframe width="200" height="150" src="https://www.youtube.com/embed/lqbmO6EVGuU?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div><p></p><h4>&lt;+serviceConfig.serviceDefinition.spec.variables.[var_name]&gt;</h4><p>The value of the Service-level variable in <code>[var_name]</code>.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1618606756670/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Use expression anywhere <u>after</u> the Service step in the Pipeline.</p><p>To reference the variables, click the copy button:</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1646250696897/clean-shot-2022-03-02-at-11-50-56.png"/></figure><p>There are two options:</p><ul><li><strong>Copy variable name:</strong> use this option if you will only be referencing this variable in the <u>current Stage</u>. Expression:<ul><li><code>&lt;+serviceConfig.serviceDefinition.spec.variables.[name]&gt;</code></li></ul></li><li><strong>Copy fully qualified name:</strong> use this option if you will be referencing this variable in <u>another Stage</u>. Example:<ul><li><code>&lt;+pipeline.stages.[stage_name].spec.serviceConfig.serviceDefinition.spec.variables.[name]&gt;</code></li></ul></li></ul><p>You can use these expressions in any setting in your Pipeline. You simply select the Expression option and enter the expression:</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1646251253132/clean-shot-2022-03-02-at-12-00-15.png"/></figure><p>To override the Service variable in a script, you simply reference its name and use a new value.</p><h4>&lt;+service.name&gt;</h4><p>The name of the Service where the expression is evaluated.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1618606597410/image.png"/></figure><h4>&lt;+service.description&gt;</h4><p>The description of the Service where the expression is evaluated.</p><h4>&lt;+service.tags&gt;</h4><p>The tags on the Service where the expression is evaluated.</p><p>To reference a specific tag use <code>&lt;+service.tags.[tag_key]&gt;</code>.</p><h4>&lt;+service.identifier&gt;</h4><p>The <a href="/article/li0my8tcz3-entity-identifier-reference">entity identifier</a> of the Service where the expression is evaluated.</p><h3>Artifact</h3><div class="warning-callout">If an artifact expression is a manifest or step, you will be prompted to select an artifact at runtime. This is true even if the Stage does not deploy an artifact (such as a Custom Stage or a Stage performing a <a href="/article/uiqe6jz9o1-kustomize-quickstart">Kustomize</a> deployment). If you want to reference an artifact that isn&#39;t the primary deployment artifact without being prompted, you can use an expression with quotes, like <code>docker pull &lt;+artifact&lt;+&#34;.metadata.image&#34;&gt;&gt;</code>.</div><p>The artifact expressions will resolve to settings and values specified in a Service&#39;s <strong>Artifacts</strong> section.</p><p></p><table><tbody><tr><td><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1654889309232/clean-shot-2022-06-10-at-12-28-17.png"/></figure></td><td><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1654889338923/clean-shot-2022-06-10-at-12-28-42.png"/></figure></td></tr></tbody></table><p></p><p>For example, here&#39;s how the common artifact expressions resolve for a Kubernetes deployment with a Docker image on Docker Hub:</p><ul><li><strong>&lt;+artifact.tag&gt;:</strong> <code>stable</code></li><li><strong>&lt;+artifact.image&gt;:</strong> <code>index.docker.io/library/nginx:stable</code></li><li><strong>&lt;+artifact.imagePath&gt;:</strong> <code>library/nginx</code></li><li><strong>&lt;+artifact.imagePullSecret&gt;:</strong> <code>eJjcmV0em1hbiIsInBhc3N3b3JkIjoiIzhDNjk3QVhUdSJ9fQ==:</code></li><li><strong>&lt;+artifact.type&gt;:</strong> <code>DockerRegistry</code></li><li><strong>&lt;+artifact.connectorRef&gt;:</strong> <code>DockerHub</code></li></ul><p>Here&#39;s a script you can add to a <a href="/article/k5lu0u6i1i-using-shell-scripts">Shell Script</a> step to view the artifact info:</p><pre>echo &#34;artifact.tag: &#34;&lt;+artifact.tag&gt;<br/>echo &#34;artifact.image: &#34;&lt;+artifact.image&gt;<br/>echo &#34;artifact.imagePath: &#34;&lt;+artifact.imagePath&gt;<br/>echo &#34;artifact.imagePullSecret: &#34;&lt;+artifact.imagePullSecret&gt;<br/>echo &#34;artifact.type: &#34;&lt;+artifact.type&gt;<br/>echo &#34;artifact.connectorRef: &#34;&lt;+artifact.connectorRef&gt;</pre><p>Here&#39;s the example log from the deployment:</p><pre class="hljs yaml">Executing command ...<br/>artifact.tag: stable<br/>artifact.image: index.docker.io/library/nginx:stable<br/>artifact.imagePath: library/nginx<br/>artifact.imagePullSecret: eyJodHRwczovL2luZGV4LmRvY2tlci5pby92MS8iOnsidXNlcm5hbWUiOiJjcmV0em1hbiIsInBhc3N3b3JkIjoiIzhDNjk3QVhUdSJ9fQ==<br/>artifact.type: DockerRegistry<br/>artifact.connectorRef: DockerHub<br/>Command completed with ExitCode (0)</pre><h4>&lt;+artifact.tag&gt;</h4><p>Not Harness Tags. This expression evaluates to the tags on the artifact pushed, pulled, or deployed. For example, AMI tags, or if you are deploying Docker image <code>nginx:stable-perl</code> then <code>stable-perl</code> is the tag.</p><h4>&lt;+artifact.image&gt;</h4><p>The full location to the image. For example, <code>docker.io/bitnami/nginx:1.22.0-debian-11-r0</code>.</p><p>To see just the image name, use <code>&lt;+artifact.imagePath&gt;</code>.</p><p>You use <code>&lt;+artifact.image&gt;</code> or <code>&lt;+artifact.imagePath&gt;</code> is your Values YAML file when you want to deploy an artifact you have added to the <strong>Artifacts</strong> section of a CD stage Service Definition.</p><p>For example, here&#39;s the <strong>Artifacts</strong> section with an artifact:</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1654794302581/clean-shot-2022-06-09-at-10-04-06.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Here&#39;s the Values YAML file referencing the artifact in <strong>Artifacts</strong>:</p><pre>name: example<br/>replicas: 2<br/><br/>image: &lt;+artifact.image&gt;<br/># dockercfg: &lt;+artifact.imagePullSecret&gt;<br/><br/>createNamespace: true<br/>namespace: &lt;+infra.namespace&gt;<br/><br/>...</pre><p></p><p>See <a href="/article/qvlmr4plcp-example-kubernetes-manifests-using-go-templating">Example Kubernetes Manifests using Go Templating</a>.</p><h4>&lt;+artifact.imagePath&gt;</h4><p>The image name, such as <code>nginx</code>. To see the entire image location use <code>&lt;+artifact.image&gt;</code>.</p><h4>&lt;+artifact.imagePullSecret&gt;</h4><p>If some cases, your Kubernetes cluster might not have the permissions needed to access a private Docker registry. For these cases, the values.yaml or manifest file in Service Definition <strong>Manifests</strong> section must use the <code>dockercfg</code> parameter.</p><p>If the Docker image is added in the Service Definition <strong>Artifacts</strong> section, then you reference it like this: <code>dockercfg: &lt;+artifact.imagePullSecret&gt;</code>.</p><p>values.yaml:</p><pre>name: &lt;+stage.variables.name&gt;<br/>replicas: 2<br/><br/>image: &lt;+artifact.image&gt;<br/>dockercfg: &lt;+artifact.imagePullSecret&gt;<br/><br/>createNamespace: true<br/>namespace: &lt;+infra.namespace&gt;<br/>...</pre><p></p><p>See <a href="/article/o1gf8jslsq-pull-an-image-from-a-private-registry-for-kubernetes">Pull an Image from a Private Registry for Kubernetes</a>.</p><h4>&lt;+artifact.type&gt;</h4><p>The type of repository used to add this artifact in the Service <strong>Artifacts</strong>. For example, Dockerhub, Ecr, or Gcr.</p><h4>&lt;+artifact.connectorRef&gt;</h4><p>The <a href="/article/li0my8tcz3-entity-identifier-reference">entity identifier</a> for the Connector used to connect to the artifact repo.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1618853879567/image.png"/></figure><h4>Sidecar Artifacts</h4><p>Sidecar artifact expressions use the <strong>Sidecar Identifier</strong> to reference the sidecar artifact.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1626198223332/image.png"/></figure><p>The sidecar identifier is set when you add the sidecar artifact. It can bee seen in the artifact listing:</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1626198237211/image.png"/></figure><p>Here are the sidecar expressions:</p><ul><li><code>&lt;+artifacts.sidecars.[sidecar_identifier].imagePath&gt;</code></li><li><code>&lt;+artifacts.sidecars.[sidecar_identifier].image&gt;</code></li><li><code>&lt;+artifacts.sidecars.[sidecar_identifier].type&gt;</code></li><li><code>&lt;+artifacts.sidecars.[sidecar_identifier].tag&gt;</code></li><li><code>&lt;+artifacts.sidecars.[sidecar_identifier].connectorRef&gt;</code></li></ul><h3>Environment</h3><h4>&lt;+env.name&gt;</h4><p>The name of the stage Environment.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1633967533563/clean-shot-2021-10-11-at-08-52-05.png"/></figure><h4>&lt;+env.identifier&gt;</h4><p>The <a href="/article/li0my8tcz3-entity-identifier-reference">entity identifier</a> of the stage&#39;s Environment.</p><h4>&lt;+env.description&gt;</h4><p>The description of the Environment.</p><h4>&lt;+env.type&gt;</h4><p>The Environment Type, such as Production or Non-Production.</p><h3>Infrastructure</h3><h4>&lt;+infra.connectorRef&gt;</h4><p>The name of the Connector used in the Infrastructure Definition.</p><h4>&lt;+INFRA_KEY&gt;</h4><p>The infrastructure key. The key is a unique string that identifies a deployment target infrastructure. It is typically used in the <strong>Release Name</strong> setting to add labels to release for tracking.</p><p>For example, in a Deploy stage&#39;s Infrastructure Definition, the <code>&lt;+INFRA_KEY&gt;</code> is used in the <strong>Release Name</strong> to give the release a unique name:</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1628812766089/clean-shot-2021-08-12-at-16-59-07.png"/></figure><p>When you deploy, Harness adds the Release Name as a label. For example, in a Kubernetes deployment you can see <code>harness.io/release-name=release-2f9eadcc06e2c2225265ab3cbb1160bc5eacfd4f</code>:</p><pre>...<br/>Pod Template:<br/>  Labels:  app=hello<br/>           deployment=hello<br/>           harness.io/release-name=release-2f9eadcc06e2c2225265ab3cbb1160bc5eacfd4f<br/>  Containers:<br/>   the-container:<br/>    Image:      monopole/hello:1<br/>...</pre><p></p><p>Harness can now track the release for comparisons and rollback.</p><h4>&lt;+infra.namespace&gt;</h4><p>The namespace used in the Infrastructure Definition.</p><h4>&lt;+infra.releaseName&gt;</h4><p>The release name used in the Infrastructure Definition.</p><h3>Triggers</h3><h4>&lt;+trigger.artifact.build&gt;</h4><p>Resolves to the artifact version (such as a Docker Tag) that initiated an <a href="/article/c1eskrgngf-trigger-on-a-new-artifact">On New Artifact Trigger</a>.</p><p>When you add an On New Artifact Trigger, you select the artifact to listen on and its <strong>Tag</strong> setting is automatically populated with <code>&lt;+trigger.artifact.build&gt;</code>.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/lml71vhsim/1649116353229/clean-shot-2022-04-04-at-16-51-54.png"/></figure><p>The <code>&lt;+trigger.artifact.build&gt;</code> is used for <strong>Tag</strong> to ensure that the new artifact version that executed the Trigger is used for the deployment.</p><p>When a new tag is added to the artifact, the Trigger is fired and the Pipeline executes. Harness then resolves <code>&lt;+trigger.artifact.build&gt;</code> to the tag that fired the Trigger. This ensures that the new tag is used when pulling the artifact and that version is deployed.</p><h4>Git Trigger and Payload Expressions</h4><p>Harness includes built-in expressions for referencing trigger details such as a PR number.</p><p>For example:</p><ul><li><code>&lt;+trigger.type&gt;</code><ul><li>Webhook.</li></ul></li><li><code>&lt;+trigger.sourceRepo&gt;</code><ul><li>Github, Gitlab, Bitbucket, Custom</li></ul></li><li><code>&lt;+trigger.event&gt;</code><ul><li>PR, PUSH, etc.</li></ul></li></ul><p>For a complete list, see <a href="/article/rset0jry8q-triggers-reference">Triggers Reference</a>.</p><h4>Triggers and RBAC</h4><p>Harness RBAC is applied to Triggers in Harness, but it is not applied to the repos used by the Triggers.</p><p>For example, you might have an <a href="/article/c1eskrgngf-trigger-on-a-new-artifact">On New Artifact Trigger</a> that is started when a new artifact is added to the artifact repo. Or a <a href="/article/hndnde8usz-triggering-pipelines">Webhook Trigger</a> that is started when a PR is merged.</p><p>In Harness, you can select who is able to create and use these Triggers within Harness, but you must use your repos&#39; RBAC to control who can add the artifacts or initiate the events that start the Harness Trigger.</p><h3>Kubernetes</h3><h4>${HARNESS_KUBE_CONFIG_PATH}</h4><p>The path to a Harness-generated kubeconfig file containing the credentials you provided to Harness. The credentials can be used by kubectl commands by exporting its value to the KUBECONFIG environment variable.</p><p>Harness only generates this kubeconfig file when a Delegate is outside of the target cluster and is making a remote connection. When you set up the Kubernetes Cluster Connector to connect to the cluster, you select the <strong>Specify master URL and credentials</strong> option. The master URL and credentials you supply in the Connector are put in the kubeconfig file and used by the remote Delegate to connect to the target cluster.</p><p>Consequently, you can only use <code>${HARNESS_KUBE_CONFIG_PATH}</code> when you are using a Delegate outside the target cluster and a Kubernetes Cluster Connector with the <strong>Specify master URL and credentials</strong> option.</p><p>If you are running the script using an in-cluster Delegate with the <strong>Use the credentials of a specific Harness Delegate</strong> credentials option, then there are no credentials to store in a kubeconfig file since the Delegate is already an in-cluster process.</p><p>You can use this variable in a <a href="/article/k5lu0u6i1i-using-shell-scripts">Shell Script</a> step to set the environment variable at the beginning of your kubectl script:</p><p><code>export KUBECONFIG=${HARNESS_KUBE_CONFIG_PATH}</code></p><p>For example:</p><pre>export KUBECONFIG=${HARNESS_KUBE_CONFIG_PATH} kubectl get pods -n default</pre><p></p><div class="note-callout">The <code>${HARNESS_KUBE_CONFIG_PATH}</code> expression can be used in scripts in Shell Script steps. It cannot be used in other scripts such as a Terraform script.</div><h3>Tag Expressions</h3><p>You can reference Tags using Harness expressions.</p><p>You simply reference the tagged entity and then use <code>tags.[tag name]</code>, like <code>&lt;+pipeline.tags.docs&gt;</code></p><p>For example, here are several different references:</p><ul><li><code>&lt;+pipeline.tags.[tag name]&gt;</code></li><li><code>&lt;+stage.tags.[tag name]&gt;</code></li><li><code>&lt;+pipeline.stages.s1.tags.[tag name]&gt;</code></li><li><code>&lt;+serviceConfig.service.tags.[tag name]&gt;</code></li></ul><h3>See Also</h3><ul><li><a href="/article/576gjpak61-built-in-cie-codebase-variables-reference" target="_blank">Codebase Variables Reference</a></li><li><a href="/article/f6yobn7iq0-runtime-inputs">Fixed Values, Runtime Inputs, and Expressions</a>.</li></ul><p></p>