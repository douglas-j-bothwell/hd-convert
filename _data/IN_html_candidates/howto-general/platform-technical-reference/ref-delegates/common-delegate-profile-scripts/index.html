<p>You can run scripts on Harness Delegate pods/hosts/containers to install applications or run commands.</p><div class="note-callout">Running scripts is described in <a href="/article/yte6x6cyhn-run-scripts-on-delegates">Install Software on the Delegate with Initialization Scripts</a>.</div><p>This topic provides information on script availability and some common Delegate initialization scripts.</p><h3>Limitations</h3><ul><li>When editing or deleting scripts, any binaries installed as part of the earlier scripts are not removed automatically. If you need to remove them, then restart or clean up the pod/VM.</li><li>You cannot use Harness secrets in scripts since there is no connectivity to Harness at the time when the script is run (before the Delegate registers with Harness).</li></ul><h3>Review: What Can I Run In a Script?</h3><p>You can add any commands supported on the host/container/pod running the Delegate. Linux shell commands are most common. If kubectl, Helm, or Docker is running on the host/container/pod where you install the Delegate, then you can use their commands. The Kubernetes and Docker Delegates include Helm.</p><p>The base image for the Delegate is Ubuntu 18.04 or later, and so any default Ubuntu packages may be used in the Delegate script.</p><h4>Legacy Delegates</h4><p><a href="/article/f9bd10b3nj-install-a-kubernetes-delegate">Legacy Delegates</a> include curl, tar, and unzip as part of their installation package, and so you may use cURL, tar, and unzip in your Delegate scripts without installing them. The following script will work without having to install any packages:</p><pre class="hljs python">usr/bin/apt-get install -y python<br/>curl &#34;https://s3.amazonaws.com/aws-cli/awscli-bundle.zip&#34; -o &#34;awscli-bundle.zip&#34;<br/>unzip awscli-bundle.zip<br/>./awscli-bundle/install -b ~/bin/aws</pre><h4>Immutable Delegates</h4><p><a href="/article/4zzg5qitkv-immutable-delegate-overview">Immutable Delegates</a> include curl and tar.</p><h4>When is the Script Executed?</h4><p>Delegate scripts are applied under the following conditions:</p><ul><li><strong>New Delegate</strong> - If you add a Delegate script when you create the Delegate, the commands are executed before the Delegate is started.</li><li><strong>Running Delegate</strong> - If you apply a Delegate script to a running Delegate, either by applying it as a new script or by switching the Delegate’s current script, the script commands are executed when the Delegate is restarted, but before the Delegate comes up.</li></ul><h3>Terraform</h3><p>Here is an example of a script for installing Terraform:</p><pre># Install TF<br/>curl -O -L  https://releases.hashicorp.com/terraform/0.12.25/terraform_0.12.25_linux_amd64.zip<br/>unzip terraform_0.12.25_linux_amd64.zip<br/>mv ./terraform /usr/bin/<br/># Check TF install<br/>terraform --version</pre><h3>Helm 2</h3><p>Installing Helm and Tiller in the Delegate&#39;s cluster:</p><pre># Add the Helm version that you want to install<br/>HELM_VERSION=v2.14.0<br/># v2.13.0<br/># v2.12.0<br/># v2.11.0<br/><br/>export DESIRED_VERSION=${HELM_VERSION}<br/><br/>echo &#34;Installing Helm $DESIRED_VERSION ...&#34;<br/><br/>curl https://raw.githubusercontent.com/kubernetes/helm/master/scripts/get | bash<br/><br/># If Tiller is already installed in the cluster <br/>helm init --client-only<br/><br/># If Tiller is not installed in the cluster<br/># helm init</pre><div class="note-callout"><code>DESIRED_VERSION</code> is used by a function in the <a href="https://raw.githubusercontent.com/kubernetes/helm/master/scripts/get" target="_blank">Helm install script</a>.</div><p>If Helm is being installed in a cluster outside of the Delegate&#39;s cluster ensure that the <strong>kubeconfig</strong> in the Delegate cluster is pointing to the correct cluster using:</p><pre>kubectl config current-context cluster_name</pre><div class="note-callout">If you are using TLS for communication between Helm and Tiller, ensure that you use the <code>--tls</code> parameter with your commands. For more information, see <a href="https://docs.helm.sh/using_helm/#using-ssl-between-helm-and-tiller" target="_blank">Using SSL Between Helm and Tiller</a> from Helm, and the section <strong>Securing your Helm Installation</strong> in that document.</div><p>Here is an example of how to add a Helm chart from a private repo using secrets <code>repoUsername</code> and <code>repoPassword</code> from Harness <a href="/article/osfw70e59c-add-use-text-secrets">Text Secrets</a>.</p><pre># Other installation method<br/># curl https://raw.githubusercontent.com/helm/helm/master/scripts/get&gt; get_helm.sh<br/># chmod 700 get_helm.sh<br/># ./get_helm.sh<br/><br/>curl https://raw.githubusercontent.com/helm/helm/master/scripts/get | bash<br/><br/>helm init --client-only<br/><br/>helm repo add --username &lt;+secrets.getValue(&#34;repoUsername&#34;)&gt; --password &lt;+secrets.getValue(&#34;repoPassword&#34;)&gt; nginx https://charts.bitnami.com/bitnami<br/><br/>helm repo update</pre><h3>Helm 3</h3><p>You do not need to add a script for Helm 3. Harness includes Helm 3 support in any Delegate that can connect to the target Kubernetes cluster.</p><h3>Pip</h3><div class="note-callout">Ensure that you run <code>apt-get update</code> before running any <code>apt-get</code> commands.</div><pre>apt-get update<br/># Install pip<br/>apt-get -y install python-pip<br/># Check pip install<br/>pip -v</pre><h3>Unzip</h3><div class="note-callout">Ensure that you run <code>apt-get update</code> before running any <code>apt-get</code> commands.</div><pre>apt-get update<br/># Install Unzip<br/>apt-get install unzip</pre><h3>AWS CLI</h3><p>The following script installs the <a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-linux.html" target="_blank">AWS CLI version 2</a> on the Delegate host.</p><pre># Install AWS CLI<br/>curl &#34;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip&#34; -o &#34;awscliv2.zip&#34;<br/>unzip awscliv2.zip<br/>./awscli-bundle/install -b ~/bin/aws<br/># install<br/>sudo ./aws/install<br/># Check AWS CLI install<br/>aws --version</pre><h3>AWS Describe Instance</h3><p>The following script describes the EC2 instance based on its private DNS hostname:</p><pre>aws ec2 describe-instances --filters &#34;Name=network-interface.private-dns-name,Values=ip-10-0-0-205.ec2.internal&#34; --region &#34;us-east-1&#34;</pre><p></p><p>The value for the <code>Values</code> parameter is simply the hostname of the Delegate.</p><h3>AWS List All Instances in a Region</h3><p>The following script will list all of the EC2 instances in the region you supply:</p><pre>aws ec2 describe-instances --query &#39;Reservations[*].Instances[*].[InstanceId,State.Name,InstanceType,PrivateIpAddress,PublicIpAddress,Tags[?Key==`Name`].Value[]]&#39; --region &#34;us-east-1&#34; --output json | tr -d &#39;\n[] &#34;&#39; | perl -pe &#39;s/i-/\ni-/g&#39; | tr &#39;,&#39; &#39;\t&#39; | sed -e &#39;s/null/None/g&#39; | grep &#39;^i-&#39; | column -t</pre><h3>Git CLI</h3><div class="note-callout">Ensure that you run <code>apt-get update</code> before running any <code>apt-get</code> commands.</div><pre>apt-get update<br/># Install Git with auto approval<br/>yes | apt-get install git<br/># Check git install<br/>git --version</pre><h3>Cloud Foundry CLI</h3><div class="tip-callout">Harness supports Cloud Foundry CLI version 6 only. Support for version 7 is pending.</div><p>Below is one example of CF CLI installation, but the version of the CF CLI you install on the Delegate should always match the PCF features you are using in your Harness PCF deployment.</p><p>For example, if you are using buildpacks in your manifest.yml in your Harness Service, the CLI you install on the Delegate should be version 3.6 or later.</p><p>Here is an example script to install the Cloud Foundry CLI on a Delegate:</p><pre>sudo wget -O /etc/yum.repos.d/cloudfoundry-cli.repo https://packages.cloudfoundry.org/fedora/cloudfoundry-cli.repo<br/><br/>sudo yum -y install cf-cli</pre><p>The <code>-y</code> parameter is needed for a prompt.</p><p>When the script has been applied and you click the timestamp for the Delegate the output will be similar to this:</p><pre>Running transaction<br/>  Installing : cf-cli-6.46.1-1.x86_64                                       1/1 <br/>  Verifying  : cf-cli-6.46.1-1.x86_64                                       1/1 <br/><br/>Installed:<br/>  cf-cli.x86_64 0:6.46.1-1                                                      <br/><br/>Complete!</pre><p>For information on installing the CLI on different distributions, see <a href="https://docs.pivotal.io/pivotalcf/2-3/cf-cli/install-go-cli.html">Installing the cf CLI</a> from PCF.</p><h3>Docker Installation</h3><p>To install Docker on the Delegate, use the following script:</p><pre>apt-get update<br/>apt-get install -y apt-utils dnsutils docker</pre><div class="note-callout">Ensure that you run <code>apt-get update</code> before running any <code>apt-get</code> commands.</div><h3>PowerShell</h3><p>You can run PowerShell scripts on a Harness Delegate, even though the Delegate must be run on Linux. Linux supports PowerShell using <a href="https://docs.microsoft.com/en-us/powershell/scripting/install/installing-powershell-core-on-windows?view=powershell-7" target="_blank">PowerShell core</a>.</p><p>For steps on creating your script, see <a href="https://docs.microsoft.com/en-us/powershell/scripting/install/installing-powershell-core-on-linux?view=powershell-7" target="_blank">Installing PowerShell on Linux</a> from Microsoft.</p><p>Whatever scripts you run must be supported by the version of PowerShell you install.</p><p>Here is an example for Ubuntu 16.04:</p><pre># Download the Microsoft repository GPG keys<br/>wget -q https://packages.microsoft.com/config/ubuntu/16.04/packages-microsoft-prod.deb<br/><br/># Register the Microsoft repository GPG keys<br/>sudo dpkg -i packages-microsoft-prod.deb<br/><br/># Update the list of products<br/>sudo apt-get update<br/><br/># Install PowerShell<br/>sudo apt-get install -y powershell<br/><br/># Start PowerShell<br/>pwsh</pre><p></p><p>If apt-get is not installed on your Delegate host, you can use snap (<code>snap install powershell --classic</code>). See <a href="http://ubuntuhandbook.org/index.php/2018/07/install-powershell-snap-ubuntu-18-04/" target="_blank">Install PowerShell Easily via Snap in Ubuntu 18.04</a>.</p><p></p>