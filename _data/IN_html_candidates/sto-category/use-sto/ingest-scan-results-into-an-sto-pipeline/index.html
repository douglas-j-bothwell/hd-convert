<p>You can run scans in a separate Run step, or outside Harness entirely, and ingest the results into your pipelines. This enables you to create advanced workflows that aren&#39;t possible with orchestrated scans. You can run custom scans with advanced settings that address specific security requirements. You can ingest results from multiple scans into the same pipeline, aggregate and deduplicate the data, and view all your results in a single pane of glass.</p><p>STO also supports a generic JSON format if you want to to ingest data from tools that do not currently have STO integrations. For more information, go to <a href="https://docs.harness.io/article/ymkcm5lypf" target="_blank">Custom Scanners Reference</a>.</p><p> To ingest scan results from outside a Security step, you set up your pipeline as follows:</p><ul><li>A Run step saves scan results to a shared folder. The step might run the scan locally or download results from an external source.</li><li>A Security step ingests the results from the shared folder. Then it analyzes, deduplicates, and displays the results.</li></ul><h3>Example Workflow</h3><p>The following example describes how to scans a local image using <a href="https://aquasecurity.github.io/trivy/dev/docs/">Aqua Trivy</a>, a popular open-source scanner, and ingest the results. A Run step installs Trivy; then it scans the image and saves the output to a shared folder. A Security step then ingests the output file.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/d24n34qdbk/1663169627027/ingestion-only-pipeline-trivy.png"/></figure><p></p><ol><li>In your Harness pipeline, go to the Overview tab of the security stage and enter a shared path such as <code>/shared/customer_artifacts</code>.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/ijkyokxrot/1661880426879/sto-pipeline-shared-path.png" style="max-height:50%;max-width:50%;display:block;margin-left:0;margin-right:auto" data-hd-height="50%" data-hd-width="50%" data-hd-align="left"/></figure></li><li>Add a Run step that save the results to the shared folder.<br/>You can run a scan in this step or copy results from an external scan. In either case, the results file needs to be in the <code>/shared/customer_artifacts/</code> folder where the Security step can access it.<br/>In this example, the Run step installs the Trivy software, runs a scan, and saves the output to <code>/shared/customer_artifacts/aqua.json</code>.<br/>For <a href="https://docs.harness.io/article/0k0iubnzql#scanners_target_types_and_scan_approach" target="_blank">supported scanners</a>, STO can ingest the default data format for the published tool.<br/><pre class="hljs yaml">apt-get update -y<br/>apt-get install wget apt-transport-https gnupg lsb-release -y<br/>wget -qO - https://aquasecurity.github.io/trivy-repo/deb/public.key | apt-key add -<br/>echo deb https://aquasecurity.github.io/trivy-repo/deb $(lsb_release -sc) main | tee -a /etc/apt/sources.list.d/trivy.list<br/>apt-get update -y<br/>apt-get install trivy -y<br/>trivy -v<br/>trivy -q image --timeout 20m -f json -o /shared/customer_artifacts/aqua.json redhat/ubi8-minimal:latest</pre></li><li>Add a Security step and configure the scanner to ingest the results of the scan.<br/>These settings are required:<ol><li><code>policy_type</code> = <code>ingestionOnly</code></li><li><code>scan_type</code> = The object type to scan: <code>container</code>, <code>repository</code>, <code>instance</code>, or <code>configuration</code></li><li><code>product_name</code> = The <code>product_name</code> strings such <code>aqua-trivy</code>, <code>bandit</code>, <code>snyk</code>, <code>sonarqube</code>, etc.</li><li><code>product_config_name</code>: One of the <code>product_config_name</code> strings for the supported scanner.</li><li><code>manual_upload_filename</code>: The filename of the issues data file generated by the scanner.</li><li><code>customer_artifacts_path</code>: The shared folder for the issues data file.</li></ol>To ingest the Trivy scan results, we configure the step as follows:<ol><li><code>policy_type</code> = <code>ingestionOnly</code></li><li><code>scan_type</code> = <code>container</code></li><li><code>product_name</code> = <code>aqua-trivy</code></li><li><code>product_config_name</code> = <code>default</code></li><li><code>customer_artifacts_path</code> = <code>/shared/customer_artifacts</code></li><li><code>manual_upload_filename</code> = <code>aqua.json</code></li></ol></li><li>Specify any additional settings required for your specific scanner and the scanned object. Go to <a href="Security Step Settings Reference" target="_blank">Security Step Settings Reference</a>.<br/>For the Trivy scan, we need to specify additional information about the scanned object:<ol><li><code>container_type</code> = <code>docker_v2</code></li><li><code>container_project</code> = <code>&lt;</code><em><code>project</code></em><code>&gt;/&lt;</code><em><code>image</code></em><code>&gt;: &lt;</code><em><code>tag</code></em><code>&gt;</code><br/>For example: <code>docker pull redhat/ubi8-minimal:latest</code></li><li><code>container_tag</code> = <code>latest</code></li></ol></li></ol><h3>YAML Pipeline Example</h3><p>The following example is based on the example workflow described in this topic.</p><details><summary>trivy-ingestion-only-pipeline-example.yml</summary><div><pre class="hljs yaml">  pipeline:<br/>  projectIdentifier: my-project-id<br/>  orgIdentifier: my-org-id<br/>  identifier: aquatrivyingestionOnly<br/>  name: aqua-trivy-ingestionOnly<br/>  tags: {}<br/>  properties:<br/>    ci:<br/>      codebase:<br/>        connectorRef: $GIT_REPO_CONNECTOR<br/>        build: &lt;+input&gt;<br/>  stages:<br/>    - stage:<br/>        name: build<br/>        identifier: build<br/>        type: CI<br/>        spec:<br/>          cloneCodebase: true<br/>          infrastructure:<br/>            type: KubernetesDirect<br/>            spec:<br/>              connectorRef: $K8S_DELEGATE_CONNECTOR<br/>              namespace: $K8S_DELEGATE_NAMESPACE<br/>              automountServiceAccountToken: true<br/>              nodeSelector: {}<br/>              os: Linux<br/>          sharedPaths:<br/>            - /var/run<br/>            - /shared/customer_artifacts<br/>          serviceDependencies:<br/>            - identifier: dind<br/>              name: dind<br/>              type: Service<br/>              spec:<br/>                connectorRef: $DOCKER_HUB_CONNECTOR<br/>                image: docker:dind<br/>                privileged: true<br/>                entrypoint:<br/>                  - dockerd-entrypoint.sh<br/>          execution:<br/>            steps:<br/>              - step:<br/>                  type: Run<br/>                  name: runTrivyScan<br/>                  identifier: runTrivy<br/>                  spec:<br/>                    connectorRef: $DOCKER_HUB_CONNECTOR<br/>                    image: ubuntu:20.04<br/>                    shell: Sh<br/>                    command: |-<br/>                      apt-get update -y<br/>                      apt-get install wget apt-transport-https gnupg lsb-release -y<br/>                      wget -qO - https://aquasecurity.github.io/trivy-repo/deb/public.key | apt-key add -<br/>                      echo deb https://aquasecurity.github.io/trivy-repo/deb $(lsb_release -sc) main | tee -a /etc/apt/sources.list.d/trivy.list<br/>                      apt-get update -y<br/>                      apt-get install trivy -y<br/>                      trivy -v<br/>                      trivy -q image --timeout 20m -f json -o /shared/customer_artifacts/aqua.json redhat/ubi8-minimal:latest<br/>              - step:<br/>                  type: Security<br/>                  spec:<br/>                    privileged: true<br/>                    settings:<br/>                      scan_type: container<br/>                      product_name: aqua-trivy<br/>                      product_config_name: default<br/>                      policy_type: ingestionOnly<br/>                      container_type: docker_v2<br/>                      container_tag: latest<br/>                      container_project: redhat/ubi8-minimal<br/>                      customer_artifacts_path: /shared/customer_artifacts<br/>                      manual_upload_filename: aqua.json<br/>                    imagePullPolicy: Always<br/>                    resources:<br/>                      limits:<br/>                        memory: 1024Mi<br/>                        cpu: 1000m<br/>                  name: ingestTrivyData<br/>                  identifier: aqua_trivy<br/><br/>  </pre></div></details><h3>See Also</h3><ul><li><a href="https://docs.harness.io/article/cjqnd71y07" target="_blank">STO Ingestion Workflows</a></li><li><a href="https://docs.harness.io/article/ymkcm5lypf" target="_blank">Ingest Results from Custom or Unsupported Scanners</a></li><li><a href="https://docs.harness.io/article/0k0iubnzql" target="_blank">Security Step Settings Reference</a></li></ul><p></p>