<p>This tutorial shows you how to use the Harness Security Testing Orchestration (STO) module to perform code security scanning in a Harness Pipeline. You&#39;ll set up a Pipeline with one scanner, run scans, analyze the results, and learn the key features of STO.</p><p>This tutorial covers standalone or &#34;audit-only&#34; workflows that don&#39;t require any other Harness components. In <a href="https://docs.harness.io/article/zy4h4ch6dh" target="_blank">Tutorial 2</a>, you&#39;ll learn how to integrate STO into Harness CI and CD workflows and protect your repos, containers, and artifacts from vulnerabilities automatically.</p><h3>Objectives</h3><p>You&#39;ll learn how to:</p><ol><li>Run the Pipeline and analyze the security issues found by the scanner.</li><li>Create a baseline branch and use the baseline to identify new issues in a development branch vs. inherited issues in the baseline.</li><li>View issue details in the Harness UI and use these details to pinpoint and resolve issues in your code.</li></ol><h3>Before You Begin</h3><p>You must perform all the required steps in <a href="https://docs.harness.io/article/rlbw5luj4h" target="_blank">Set Up Harness for STO</a>. This topic describes how to do the following:</p><ol><li>Install a delegate in a Kubernetes cluster.</li><li>Create connectors to your Git and DockerHub repos</li><li>Create a pipeline with a Docker-in-Docker service and a Security step that runs a Bandit scan on a repo.</li><li>Add an STO Stage to a Pipeline.</li><li>Add a scanner to your Stage, configure it, and define the target to scan.</li></ol><p>You will use a clone of this pipeline in these tutorials.</p><h3>Review: Ingestion Workflows</h3><p>STO supports three different workflows to ingest scan results into a pipeline:</p><ul><li><a href="#orchestrated_workflows">Orchestrated workflows</a> — A Security step runs a scan with predefined settings and ingests the results. This tutorial illustrates an orchestrated workflow. <br/>This is the simplest method to implement. STO supports orchestrated scans for Trivy, Bandit, SonarQube, and other popular tools.</li><li><a href="#ingestion-only-workflows">Ingestion-Only workflows</a> — Run a scan in a Run step, or outside the pipeline, and save in a shared folder. A Security step then ingests the results.<br/>This provides the most flexibility. You can ingest results from highly targeted scan that address specific use case. You can also ingest results from scanners that currently have no STO integration.</li><li> <a href="#data-load-workflows">Data-Load workflows</a> — A Security step downloads and ingests results from an external scanner.<br/>This workflow is supported for scanners that provide methods for transferring data programmatically.</li></ul><h3>Review: Scanner Coverage</h3><p>See <strong>Security Testing Orchestration</strong> in <a href="/article/1e536z41av-supported-platforms-and-technologies">Supported Platforms and Technologies</a>.</p><h3>Stand-Alone STO Workflows</h3><p>You&#39;re a developer, working in various development branches and merging your code updates. You want to make sure you don&#39;t introduce any new vulnerabilities when you merge your code into a target branch. Using STO, you can scan your repo automatically and then use the results to pinpoint and fix your vulnerabilties before you do any merge.</p><p>This Pipeline has only one scanner but you can easily add more later. For the list of supported scanners, see <a href="https://docs.harness.io/article/0k0iubnzql" target="_blank">Security Step Settings Reference</a>.</p><h4>Clone your STO base pipeline</h4><ol><li>Go to the project with the <a href="https://docs.harness.io/article/rlbw5luj4h#create-an-sto-pipeline">base STO pipeline</a> project.</li><li>Click the top-right menu, choose <strong>Clone</strong>, and save the new pipeline as <strong>STO Tutorial 1</strong>.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/yvy4pmt8bw/1661620474762/clone-pipeline.png" style="display:block;margin-left:0;margin-right:auto" data-hd-align="left"/></figure></li></ol><h4>Scan Step Configuration</h4><p>Let&#39;s look at the bandit step to see how it&#39;s configured.</p><ol><li>In your new pipeline, go to <strong>securityTestStage</strong> and open the banditScan step.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/yvy4pmt8bw/1661620568451/sto-setup-run-step-settings.png" style="display:block;margin-left:0;margin-right:auto" data-hd-align="left"/></figure></li><li>Let&#39;s review the settings.</li></ol><table><tbody><tr><td><p><strong>Setting</strong></p></td><td><p><strong>Value</strong></p></td><td><p><strong>Description</strong></p></td></tr><tr><td><p>policy_type</p></td><td><p>orchestratedScan</p></td><td><p>Indicates that this is an orchestrated scan as opposed to a ingestion-only or data-upload scan.</p></td></tr><tr><td><p>scan_type</p></td><td><p>repository</p></td><td><p>Indicates that this is a repo scan. A repo scan has certain requirements, which are provided in the <strong>repository_*</strong> settings.</p></td></tr><tr><td><p>repository_project</p></td><td><p>dvpwa</p></td><td><p>Name of the repo project.</p></td></tr><tr><td><p>repository_branch</p></td><td><p>&lt;+codebase.branch&gt;</p></td><td><p>This Harness expression resolves to the branch selected in the Codebase (the default branch).</p></td></tr><tr><td><p>product_name</p></td><td><p>bandit</p></td><td><p>The name of the scan tool.</p></td></tr><tr><td><p>product_config_name</p></td><td><p>bandit-default</p></td><td><p>The config to use with the tool.</p></td></tr></tbody></table><p></p><h4>Viewing Security Test Results</h4><div class="note-callout"><strong>Key Concept: Test Targets</strong><br/>Every instance of a scanner has a specific <em>target</em>, which is the object it is set up to scan. It might be a repo, a container, or an instance. This pipeline uses the bandit scanner. In this pipeline, the scanner&#39;s target is the repo <a href="https://github.com/williamwissemann/dvpwa" target="_blank">https://github.com/williamwissemann/dvpwa</a> (specified in the Codebase for this pipeline).</div><p>Now that you&#39;ve set up the pipeline, you can run a scan and view the detected issues.</p><ol><li>Click <strong>Save</strong>, and then click <strong>Run</strong>.</li><li>Select <strong>Git Branch</strong>, enter <strong>master</strong> for the branch name, and then click <strong>Run Pipeline</strong>.</li><li>When the pipeline finishes, click the <strong>Security Tests</strong> tab to see the dashboard.</li></ol><p>The <strong>Security Tests</strong> tab shows the issues that the scanner found in the test target, categorized by severity. The scanner found two issues, one critical and one medium, in the master branch.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/qhgshfw3mg/1659194816563/00-tests-master-branch.png" style="max-height:80%;max-width:80%;display:block;margin-left:0;margin-right:auto" data-hd-height="80%" data-hd-width="80%" data-hd-align="left"/></figure><p></p><h4>Setting Baselines</h4><div class="note-callout"><strong>Key Concept: Baseline</strong><br/>A <em>baseline</em> is a specific instance of a test target and the security issues in that instance. It is the object that you are looking to update, such as the target branch or an image with a specific tag.<br/><br/>As a developer, you want to ensure that your merge or update doesn&#39;t introduce any new issues. To do this, you create a baseline for your test target and compare your scans against the baseline.</div><ol><li>Click <strong>Security Tests</strong> (left menu) &gt; <strong>Test Targets</strong>.</li><li>For the <strong>dvpwa</strong> target, click <strong>Baseline for Comparison</strong> and select <strong>master</strong> in the pulldown menu.</li></ol><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/qhgshfw3mg/1659037469899/01-a-tests-demo-001-select-baseline.png"/></figure><p></p><h4>Fixing Vulnerabilities</h4><div class="note-callout"><strong>Key Concept: Deduplication</strong><br/>When Harness processes the security issues identified in a scan, it deduplicates the results. <em>Deduplication</em> is the aggregation of multiple occurrences with the same root cause into one issue. This means that each security issue you see in the <strong>Security Tests</strong> page is unique and requires its own resolution.</div><p>Suppose you&#39;re developing a new feature. You create a new branch DEMO-001 from the master branch. You want to see if your branch has any security issues that aren&#39;t in master.</p><ul><li>Run your pipeline again with <strong>DEMO-001</strong> as the branch name.</li><li>When the pipeline finishes, go to the <strong>Security</strong> <strong>Tests</strong> tab.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/t57yct5guh/1659417052038/01-tests-demo-001-branch-v-2.png" style="display:block;margin-left:0;margin-right:auto" data-hd-align="left"/></figure></li></ul><p>Your branch has 5 new security issues: 2 critical, 2 medium, 1 low.</p><div class="note-callout"><strong>Key Concept: To troubleshoot an issue, go to Issue Details</strong><br/>The Issue Details pane has the information you need to troubleshoot and fix your security vulnerabilities.</div><ul><li>In the Issues table (bottom left), click the first row for the critical issue <strong>subprocess_popen_with_shell_equals_true</strong>. The Issue Details pane opens.</li></ul><table><tbody><tr><td><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/t57yct5guh/1659417002614/01-b-tests-demo-001-branch-issue-details-v-3.png" style="max-height:80%;max-width:80%;display:block;margin-left:auto;margin-right:0" data-hd-height="80%" data-hd-width="80%" data-hd-align="right"/></figure></td><td><ul><li>The <strong>Severity Score</strong> is based on the <a href="https://nvd.nist.gov/vuln-metrics/cvss">NIST Common Vulnerability Scoring System</a> (CVSS) version 3.0:<ul><li>None 0.0</li><li>Low 0.1 - 3.9</li><li>Medium 4.0 - 6.9</li><li>High 7.0 - 8.9</li><li>Critical 9.0 - 10.0</li></ul></li><li>The <strong>Occurrences List</strong> shows all occurrences of this specific issue in the test target</li></ul></td></tr></tbody></table><ul><li>Examine the Occurrences List for this issue. Note that, to eliminate this vulnerability from the repo, you can need to fix multiple occurrences in multiple files:<ul><li><strong>Occurrence 1:</strong> Line 39 in <code>/sqli/dao/review.py</code></li><li><strong>Occurrence 2:</strong> Line 57 in <code>/sqli/dao/course.py</code></li><li>etc.</li></ul></li></ul><p></p><h3>Congratulations!</h3><p>In this tutorial you&#39;ve learned how to set up a scanner, create a baseline, analyze scan results, and use the data collected by STO to pinpoint and fix vulnerabilities <em>before</em> you merge your code updates.</p><p>Proceed to <a href="https://docs.harness.io/article/zy4h4ch6dh" target="_blank">Tutorial 2</a> to learn how you can use STO to protect repos, images, and artifacts from vulnerabilities automatically.</p><h3>See Also</h3><ul><li><a href="https://docs.harness.io/article/cjqnd71y07" target="_blank">STO Ingestion Workflows</a></li><li><a href="https://docs.harness.io/article/wk018r6x3g">Run an Orchestrated Scan in an STO Pipeline</a></li><li><a href="https://docs.harness.io/article/wk018r6x3g" target="_blank">Ingest Scan Results into an STO Pipeline</a></li><li><a href="https://docs.harness.io/article/0k0iubnzql" target="_blank">Security Step Settings Reference</a></li></ul><p></p>