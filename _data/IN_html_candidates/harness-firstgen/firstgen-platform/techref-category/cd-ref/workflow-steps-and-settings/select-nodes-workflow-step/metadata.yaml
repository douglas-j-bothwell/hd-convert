type: article
article_id: 9h1cqaxyp9
user_id: mfr0nxh4be
category_id: idvvqrrfr9
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Select Nodes Workflow Step
slug: select-nodes-workflow-step
description: The Select Nodes step selects the target hosts from the Infrastructure
  Definition you defined. You can choose to select a specific host or simply specify
  the number of instances to select with the In…
short_version: The Select Nodes step selects the target hosts from the Infrastructure
  Definition you defined. You can choose to select a specific host or simply specify
  the number of instances to select with the In…
tags: []
show_toc: false
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: Article updated
  source: API
  triggered_at: 2022-02-03T23:50:41.157301Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Select Nodes Workflow Step
  description: ""
  short_version: ""
  body: '<p>The Select Nodes step selects the target hosts from the <a href="/article/v3l3wqovbe-infrastructure-definitions">Infrastructure
    Definition</a> you defined. You can choose to select a specific host or simply
    specify the number of instances to select with the Infrastructure Definition criteria.</p><p>The
    Select Nodes step is used before the <a href="/article/2q8vjxdjcq-install-workflow-step">Install
    step</a>, which installs the application on the hosts or instances you selected.</p><div
    class="note-callout">You cannot use <a href="https://docs.harness.io/article/9dvxcegm90-variables">Harness
    expressions</a> as parameters in the Select Nodes step.</div><h3>Limitation</h3><p>Use
    the <strong>Select Nodes</strong> step once per phase only. You cannot use <strong>Select
    Nodes</strong> more than once per phase.</p><h3>Select Specific Hosts</h3><p>If
    you want to enter the specific hosts on which to deploy, select <strong>Yes</strong>.</p><p>If
    you want Harness to select the hosts using your Infrastructure Definition, and
    for you to set the number of instances, select <strong>No</strong>.</p><h3>Host
    Names</h3><p>If you choose <strong>Yes</strong> in <strong>Select specific hosts?</strong>,
    click in <strong>Host Name(s)</strong> to select the specific target hosts for
    the deployment. Harness will obtain the host names or hosts that match the criteria
    of your Infrastructure Definition.</p><p>The following image shows an <strong>Infrastructure
    Definition</strong> specifying an AWS Region, VPC, and Tags (<strong>Name:doc-target</strong>),
    the EC2 instance that meets that criteria, and the host name in the Node Select
    dialog.</p><figure><a href="https://files.helpdocs.io/kw8ldg1itf/articles/7xoulhbcj6/1580333800017/image.png"><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/7xoulhbcj6/1580333800017/image.png"/></a></figure><h3>Option:
    Select Host Not in Infrastructure Definition</h3><div class="note-callout">Currently,
    this feature is behind the feature flag <code>DEPLOY_TO_INLINE_HOSTS</code> and
    available in SSH and WinRM deployments only. Contact <a href="mailto:support@harness.io"
    target="_blank">Harness Support</a> to enable the feature.</div><p>The nodes that
    appear in the Select Nodes <strong>Host Name(s)</strong> setting are taken from
    the Workflow&#39;s Infrastructure Definition, but you can enter in alternate or
    additional nodes. </p><p>In the following example, host1 and host2 are from the
    Workflow&#39;s Infrastructure Definition, and the remaining hosts are entered
    manually.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/ax6mntmp3s/1643931866004/clean-shot-2022-02-03-at-15-44-16-2-x.png"/></figure><p>You
    can also enter <a href="/article/766iheu1bk-add-workflow-variables-new-template">Workflow
    variable expressions</a> that are resolved at runtime. The Workflow variables
    can be a list of hosts.</p><h3>Instances</h3><p>In <strong>Instances</strong>,
    enter the number of instances to use. Remember that Harness is deploying to <em>existing</em> instances
    as defined in your Infrastructure Definition. Ensure that there are enough instances
    that meet your criteria.</p><h3>Instance Unit Type</h3><p>Select Count or Percentage.</p><h3>Exclude
    instances from future phases</h3><p>When the <strong>Exclude instances from future
    phases</strong> setting is selected (recommended), the instance(s) selected by
    this <strong>Node Select</strong> step will not be eligible for selection by any
    future <strong>Node Select</strong> step.</p><p>In cases where you want to perform
    a one-time operation using a node and then deploy to all nodes in later phases,
    you might want to leave <strong>Exclude instances from future phases</strong> unselected.</p><h3
    id="undefined">Select Nodes and Canary Deployments</h3><p>While this topic discusses
    a Basic Workflow deployment, <strong>Select Nodes</strong> can be used in a Canary
    Workflow deployment also.</p><p>In a Canary Workflow deployment for an SSH Service,
    you use multiple Phases, each with a <strong>Node Select</strong> step to deploy
    to a percentage of target hosts:</p><ol><li>Phase 1: Node Select: Instances: 25%</li><li>Phase
    2: Node Select: Instances: 50%</li><li>Phase 3: Node Select: Instances: 75%</li><li>Phase
    4: Node Select: Instances: 100%</li></ol><p>Node Select will look like this in
    Phase 1:</p><figure><a href="https://files.helpdocs.io/kw8ldg1itf/articles/7xoulhbcj6/1580333880608/image.png"><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/7xoulhbcj6/1580333880608/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></a></figure><p>And
    like this in Phase 2:</p><figure><a href="https://files.helpdocs.io/kw8ldg1itf/articles/7xoulhbcj6/1580333897252/image.png"><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/7xoulhbcj6/1580333897252/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></a></figure><p>The <strong>Instances</strong> setting
    is cumulative not additive. So using 25% at each phase will not equal 100%. Each
    successive <strong>Node Select</strong> incorporates all <strong>Node Select</strong> <strong>Instances</strong> settings
    before it. To reach 100%, your <strong>Instances</strong> setting at each phase
    must include the previous percentage (25%, 50%, 75%, 100%).</p><p>The same is
    true for using Count instead of Percentage. If you use multiple <strong>Node Select</strong> steps
    in multiple Workflow phases (as in a Canary Workflow) using 1 Count at each of
    4 phases will not equal 4 instances. Each successive <strong>Node Select</strong> incorporates
    all <strong>Node Select</strong> <strong>Instances</strong> settings before it.
    To reach 4 instances, your <strong>Instances</strong> setting at each phase must
    include the previous count (1, 2, 3, 4).</p><div class="note-callout">When the <strong>Exclude
    instances from future phases</strong> setting is selected (recommended for Canary
    deployments), the instance(s) selected by this <strong>Node Select</strong> step
    will not be eligible for selection by any future <strong>Node Select</strong> step.</div><h3>See
    Also</h3><ul><li><a href="/article/2q8vjxdjcq-install-workflow-step">Install Workflow
    Step</a></li><li><a href="/article/6pwni5f9el-traditional-deployments-overview">Traditional
    Deployments Overview</a></li></ul><p></p>'
  slug: select-nodes-workflow-step
  tags: []
  is_live: true
