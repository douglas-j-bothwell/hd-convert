<p>If a Harness Kubernetes deployment fails, Harness will rollback to the last successful version of your workload.</p><div class="note-callout">Please review the <a href="/article/ttn8acijrz-versioning-and-annotations">Kubernetes Versioning and Annotations</a> topic. It explains how Harness names and versions Kubernetes releases.</div><h3>Identifying Deployments for Rollback</h3><p>All Harness entities have Ids. You can see them in the URL of each entity. For example, here is a Service URL where you can see the Id <code>GmukVkNJRhqX53JEzI-3UQ</code> after <code>services</code>:</p><pre>https://app.harness.io/#/account/OgiB4-xETamKNVAz-wQRwk/app/zPM4lB-jSqmpIrMk7WLvWw/services/GmukVkNJRhqX53JEzI-3UQ/details</pre><p></p><p>Harness identifies a Kubernetes deployment using a combination of Workflow Id and Infrastructure Mapping (<code>inframapping</code>). Infrastructure Mapping is a unique combination of Service Id, Infrastructure Id, Cluster Name, and Namespace.</p><h3>Rollback with Workflow Id and Infrastructure Mapping </h3><p>When a Harness Kubernetes Workflow deployment fails, rollback is initiated. </p><p>Rollback fetches the last successful deployment with the <u>current</u> Workflow Id and Infrastructure Mapping.</p><h3>Rollback with Any Workflow and Infrastructure Mapping </h3><p></p><div class="note-callout">Currently, this feature is behind the feature flag <code>INFRA_MAPPING_BASED_ROLLBACK_ARTIFACT</code>. Contact <a href="mailto:support@harness.io" target="_blank">Harness Support</a> to enable the feature.</div><p>In some cases, you might want to run multiple Workflows with the same Infrastructure Mapping (Service Id, Infrastructure Id, Cluster Name, and Namespace), but not tie the rollback artifact to a specific Workflow Id.</p><p>Instead, you want to tie the rollback artifact to just the Infrastructure Mapping because multiple Workflows are using that Infrastructure Mapping.</p><p>So, when rollback occurs for a Workflow + Infrastructure Mapping, Harness fetches from <u>last successful</u> Workflow execution of <u>any Workflow</u> using the current Infrastructure Mapping.</p><p>For example, if two different Workflows, w1 and w2, are using same Infrastructure Mapping, then the rollback artifact can come from <u>last successful</u> execution of either of w1 or w2.</p><h3>Workload Rollback Only</h3><div class="note-callout"><strong>Rollback rolls back workloads only.</strong> If there are other objects or operations executed in your Workflow or Pipeline, Harness does not roll those back.</div><p>See <a href="/article/6ujb3c70fh">What Can I Deploy in Kubernetes?</a>.</p><h3>Scaling and Rollback</h3><p>Each time Harness deploys, the deployment gets new replicas that get scaled up and the old replicas are scaled down.</p><p>By default, Kubernetes keeps the last 10 revisions as <a href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/" target="_blank">ReplicaSets</a>.</p><p>When Harness performs rollback it identifies which revision number to use (<code>rollback-to</code>). Harness identifies that last successful ReplicaSet, and selects it to be scaled up.</p><h3>Rollback and Artifacts</h3><p>The artifact(s) used for the replicas that are scaled up as part of rollback are simply the artifact(s) from the time that version was deployed.</p><h3>Blue/Green Rollbacks</h3><p>In the case of Blue/Green, the resources are not versioned because a Blue/Green deployment uses <strong>rapid rollback</strong>: network traffic is simply routed back to the original instances.</p><p>You do not need to redeploy previous versions of the service/artifact and the instances that comprised their environment.</p><h3>Rollback Command</h3><p>You can add a <strong>Rollback Deployment</strong> command to the <strong>Rollback Steps</strong> in your Workflow to roll back the workloads deployed by the <strong>Rollout Deployment</strong> step.</p><p>Simply add this command to the <strong>Rollback Steps</strong> in a Workflow where you want to initiate a rollback. Note that this command applies to the deployments of the Rollout Deployment command, and not the <a href="/article/4vjgmjcj6z-deploy-manifests-separately-using-apply-step">Apply Step</a> command.</p><h3>See Also</h3><ul><li><a href="/article/7in9z2boh6-kubernetes-quickstart">Kubernetes Quickstart</a></li><li><a href="/article/pc6qglyp5h-kubernetes-deployments-overview">Kubernetes How-tos</a></li><li><a href="/article/wnr5n847b1-kubernetes-overview">Kubernetes Deployments Overview</a></li></ul><p></p>