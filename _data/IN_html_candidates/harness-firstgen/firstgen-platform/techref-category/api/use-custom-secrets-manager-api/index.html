<p></p><div class="note-callout">Currently, this feature is behind the Feature Flag <code>CUSTOM_SECRETS_MANAGER</code>. Contact <a href="mailto:support@harness.io" target="_blank">Harness Support</a> to enable the feature.</div><p></p><p>Harness provides first-class support and built-in integration for the most common secret managers. If you are using a <a href="/article/au38zpufhr">secret manager</a> that Harness does provide first-class support for, you can configure and use your secret manager by using the Harness Custom Secrets Manager.</p><p>This topic describes how to create, update, and delete a Custom Secrets Manager using the Harness API.</p><p>For steps on setting up a Custom Secret Manager using the Harness UI, see <a href="/article/ejaddm3ddb">Add and Use a Custom Secrets Manager</a>.</p><p>In this topic:</p><ul><li><a href="/article/9grbkf5d1k-use-custom-secrets-manager-api#before_you_begin">Before You Begin</a></li><li><a href="#review_read_only_secret_manager">Review: Read-Only Secret Manager</a></li><li><a href="/article/9grbkf5d1k-use-custom-secrets-manager-api#create_a_custom_secrets_manager">Create a Custom Secrets Manager</a><ul><li><a href="/article/9grbkf5d1k-use-custom-secrets-manager-api#request">Request</a></li><li><a href="/article/9grbkf5d1k-use-custom-secrets-manager-api#query_variables">Query Variables</a></li></ul></li><li><a href="/article/9grbkf5d1k-use-custom-secrets-manager-api#update_a_custom_secrets_manager">Update a Custom Secrets Manager</a><ul><li><a href="/article/9grbkf5d1k-use-custom-secrets-manager-api#request_2">Request</a></li><li><a href="/article/9grbkf5d1k-use-custom-secrets-manager-api#query_variables_2">Query Variables</a></li></ul></li><li><a href="/article/9grbkf5d1k-use-custom-secrets-manager-api#delete_a_custom_secrets_manager">Delete a Custom Secrets Manager</a><ul><li><a href="/article/9grbkf5d1k-use-custom-secrets-manager-api#request_3">Request</a></li><li><a href="/article/9grbkf5d1k-use-custom-secrets-manager-api#query_variables_3">Query Variables</a></li></ul></li></ul><h3>Before You Begin</h3><ul><li>Review the <a href="/article/tm0w6rruqv">Harness API</a></li><li>Review <a href="/article/au38zpufhr">Secrets Management Overview</a></li><li><a href="/article/ejaddm3ddb">Add and Use a Custom Secrets Manager</a></li></ul><h3>Review: Read-Only Secret Manager</h3><p>Harness Custom Secrets Manager is a read-only Secrets Manager. Harness can read/decrypt secrets, but it cannot write secrets to the Custom Secrets Manager.</p><h3>Create a Custom Secrets Manager</h3><p>A Custom Secrets Manager is created using a shell script.</p><p>You can choose to run the shell script on a <strong>Harness Delegate</strong> or on a <strong>target host</strong>. In either case, the API mutation remains the same., but the query variables are different.</p><p>Use this query to create a Custom Secrets Manager.</p><h4>Request</h4><p>You create a Secret Manager using the mutation <code>createSecretManager</code>.</p><pre class="hljs graphql">mutation CreateSecretManagerMutation($secretManagerInput: CreateSecretManagerInput!) {<br/>  createSecretManager(input: $secretManagerInput) {<br/>    secretManager {<br/>      id<br/>    }<br/>  }<br/>}<br/></pre><h4>Query Variables</h4><p>Use these query variables if you want to run the shell script on a Harness Delegate. The <code>secretManagerType</code> parameter identifies the type of Secret Manager to create while the <code>executeOnDelegate</code> parameter identifies that the shell script will run on a Harness Delegate.</p><pre class="hljs graphql">{<br/>        &#34;secretManagerInput&#34;: {<br/>            &#34;secretManagerType&#34;: &#34;CUSTOM&#34;,<br/>            &#34;customSecretManagerInput&#34;: {<br/>                &#34;name&#34;: &#34;DocExampleSecretManager&#34;,<br/>                &#34;delegateSelectors&#34;: [],<br/>                &#34;testVariables&#34;: [<br/>                    {<br/>                        &#34;name&#34;: &#34;key&#34;,<br/>                        &#34;value&#34;: &#34;xxxx&#34;<br/>                    },<br/>                    {<br/>                        &#34;name&#34;: &#34;engineName&#34;,<br/>                        &#34;value&#34;: &#34;xxxx&#34;<br/>                    },<br/>                    {<br/>                        &#34;name&#34;: &#34;path&#34;,<br/>                        &#34;value&#34;: &#34;xxxx&#34;<br/>                    }<br/>                ],<br/>                &#34;isConnectorTemplatized&#34;: false,<br/>                &#34;executeOnDelegate&#34;: true,<br/>                &#34;templateId&#34;: &#34;xxxxxxxxxxxxxxxxxxxxxx&#34;,<br/>                &#34;host&#34;: null,<br/>                &#34;commandPath&#34;: &#34;/tmp&#34;,<br/>                &#34;connectorId&#34;: null,<br/>                &#34;usageScope&#34;: {<br/>                    &#34;appEnvScopes&#34;: [<br/>                        {<br/>                            &#34;application&#34;: {<br/>                                &#34;filterType&#34;: &#34;ALL&#34;<br/>                            },<br/>                            &#34;environment&#34;: {<br/>                                &#34;filterType&#34;: &#34;PRODUCTION_ENVIRONMENTS&#34;<br/>                            }<br/>                        }<br/>                    ]<br/>                }<br/>            }<br/>        }<br/>    }</pre><p></p><p>The following example shows the query variables to use if you want to run the shell script on a target host.</p><pre class="hljs graphql">{<br/>    &#34;secretManagerInput&#34;: {<br/>        &#34;secretManagerType&#34;: &#34;CUSTOM&#34;,<br/>        &#34;customSecretManagerInput&#34;: {<br/>            &#34;name&#34;: &#34;DocExampleSecretManager&#34;,<br/>            &#34;delegateSelectors&#34;: [],<br/>            &#34;testVariables&#34;: [<br/>                {<br/>                    &#34;name&#34;: &#34;key&#34;,<br/>                    &#34;value&#34;: &#34;xxxx&#34;<br/>                },<br/>                {<br/>                    &#34;name&#34;: &#34;engineName&#34;,<br/>                    &#34;value&#34;: &#34;xxxx&#34;<br/>                },<br/>                {<br/>                    &#34;name&#34;: &#34;path&#34;,<br/>                    &#34;value&#34;: &#34;xxxx&#34;<br/>                }<br/>            ],<br/>            &#34;isConnectorTemplatized&#34;: false,<br/>            &#34;executeOnDelegate&#34;: false,<br/>            &#34;templateId&#34;: &#34;xxxxxxxxxxxxxxxxxxxx&#34;,<br/>            &#34;host&#34;: &#34;10.0.0.17&#34;,<br/>            &#34;commandPath&#34;: &#34;/xxxx/xxxxxxx&#34;,<br/>            &#34;connectorId&#34;: &#34;xxxxxxxxxx&#34;,<br/>            &#34;usageScope&#34;: {<br/>                &#34;appEnvScopes&#34;: [<br/>                    {<br/>                        &#34;application&#34;: {<br/>                            &#34;filterType&#34;: &#34;ALL&#34;<br/>                        },<br/>                        &#34;environment&#34;: {<br/>                            &#34;filterType&#34;: &#34;PRODUCTION_ENVIRONMENTS&#34;<br/>                        }<br/>                    }<br/>                ]<br/>            }<br/>        }<br/>    }<br/>}</pre><h3>Update a Custom Secrets Manager</h3><p>Use this simple query to update your Custom Secrets Manager.</p><h4>Request</h4><p>You update a Secret Manager using the mutation <code>updateSecretManager</code>.</p><pre class="hljs graphql">mutation UpdateSecretManagerMutation($input: UpdateSecretManagerInput!) {<br/>  updateSecretManager(input: $input) {<br/>    secretManager {<br/>      name<br/>      id<br/>    }<br/>  }<br/>}</pre><h4>Query Variables</h4><p>The query variables use the following syntax, with <code>secretManagerId</code> parameter and <code>secretManagerType</code> parameter identifying the Secret Manager to update.</p><pre class="hljs graphql">{<br/>    &#34;input&#34;: {<br/>        &#34;secretManagerId&#34;: &#34;xxxxxxxxxx&#34;,<br/>        &#34;secretManagerType&#34;: &#34;CUSTOM&#34;,<br/>        &#34;customSecretManagerInput&#34;: {<br/>            &#34;name&#34;: &#34;DocExampleSecretManager_updated1&#34;,<br/>            &#34;delegateSelectors&#34;: [],<br/>            &#34;testVariables&#34;: [<br/>                {<br/>                    &#34;name&#34;: &#34;key&#34;,<br/>                    &#34;value&#34;: &#34;xxxx&#34;<br/>                },<br/>                {<br/>                    &#34;name&#34;: &#34;engineName&#34;,<br/>                    &#34;value&#34;: &#34;xxxx&#34;<br/>                },<br/>                {<br/>                    &#34;name&#34;: &#34;path&#34;,<br/>                    &#34;value&#34;: &#34;xxxx&#34;<br/>                }<br/>            ],<br/>            &#34;isConnectorTemplatized&#34;: false,<br/>            &#34;executeOnDelegate&#34;: true,<br/>            &#34;templateId&#34;: &#34;xxxxxxxxxxxxxxxxxxxxx&#34;,<br/>            &#34;host&#34;: null,<br/>            &#34;commandPath&#34;: &#34;/tmp&#34;,<br/>            &#34;connectorId&#34;: null,<br/>            &#34;usageScope&#34;: {<br/>                &#34;appEnvScopes&#34;: [<br/>                    {<br/>                        &#34;application&#34;: {<br/>                            &#34;filterType&#34;: &#34;ALL&#34;<br/>                        },<br/>                        &#34;environment&#34;: {<br/>                            &#34;filterType&#34;: &#34;PRODUCTION_ENVIRONMENTS&#34;<br/>                        }<br/>                    }<br/>                ]<br/>            }<br/>        }<br/>    }<br/>}</pre><h3>Delete a Custom Secrets Manager</h3><p>Use this simple query to delete a Custom Secrets Manager.</p><h4>Request</h4><p>You delete a Secret Manager using the mutation <code>deleteSecretManager</code>.</p><pre class="hljs graphql">mutation DeleteSecretManagerMutation($input: DeleteSecretManagerInput!){<br/>  deleteSecretManager(input: $input){<br/>   clientMutationId<br/>  }<br/>}</pre><h4>Query Variables</h4><p>The query variables use the following syntax, with <code>secretManagerId</code> parameter identifying the Secret Manager to delete.</p><pre class="hljs json">{<br/>  &#34;input&#34;: {<br/>    &#34;clientMutationId&#34;: &#34;xPxNsOusEaAsdQifDdGxx&#34;,<br/>    &#34;secretManagerId&#34;: &#34;xxxxxxxxxx&#34;<br/>  }<br/>}</pre><p></p><p></p>