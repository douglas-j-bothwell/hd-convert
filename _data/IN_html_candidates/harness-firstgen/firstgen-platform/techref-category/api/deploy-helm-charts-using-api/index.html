<p>As discussed in <a href="/article/p5om530pe0-deploy-a-helm-chart-as-an-artifact">Deploy Helm Charts</a>, you can deploy the Helm chart without adding your artifact to Harness.</p><p>Instead, the Helm chart identifies the artifact. Harness installs the chart, gets the artifact from the repo, and then installs the artifact. We call this aÂ <em>Helm chart deployment</em>.</p><p>This topic explains how to set up a Helm chart deployment using the Harness GraphQL API.</p><p>In this topic:</p><ul><li><a href="https://docs.harness.io/article/sbvn6uwcq1-deploy-helm-charts-using-api#before_you_begin">Before You Begin</a></li><li><a href="https://docs.harness.io/article/sbvn6uwcq1-deploy-helm-charts-using-api#option_create_harness_helm_chart_deployment">Option: Create Harness Helm Chart Deployment</a></li><li><a href="https://docs.harness.io/article/sbvn6uwcq1-deploy-helm-charts-using-api#step_1_specify_helm_chart_version_and_start_execution">Step 1: Specify Helm Chart Version and Start Execution</a></li><li><a href="https://docs.harness.io/article/sbvn6uwcq1-deploy-helm-charts-using-api#step_2_query_the_execution">Step 2: Query the Execution</a></li><li><a href="https://docs.harness.io/article/sbvn6uwcq1-deploy-helm-charts-using-api#option_create_and_update_trigger">Option: Create and Update Trigger</a></li></ul><h3>Before You Begin</h3><ul><li><a href="/article/p5om530pe0-deploy-a-helm-chart-as-an-artifact">Deploy Helm Charts</a>: review this topic to learn how to create a Helm chart deployment using the Harness Manager UI.</li></ul><h3>Option: Create Harness Helm Chart Deployment</h3><p>This topic covers how to specify the Helm chart as artifact when you execute your Workflow or Pipeline manually or programmatically via the API, including API Triggers.</p><p>If this is your first Helm chart deployment, follow the steps in <a href="/article/p5om530pe0-deploy-a-helm-chart-as-an-artifact">Deploy Helm Charts</a> to create the Helm Chart as Artifact deployment.</p><p>Next, you will use the API to execute this deployment and specify the chart version to use.</p><h3>Step 1: Specify Helm Chart Version and Start Execution</h3><p>You execute the Workflow or Pipeline using the mutation <code>StartExecutionInput.serviceInputs</code>. You specify the Helm chart and version using <code>manifestValueInput</code>.</p><p>You will need the Application Id, Workflow Id (<code>entityId</code>), Service name, Manifest Source <strong>Display Name</strong> from the Service, and chart version number.</p><p>Here is an example:</p><pre class="hljs graphql">mutation{<br/>  startExecution(input: {applicationId: &#34;mtvPmU4AQ6aHrtjItnh1OQ&#34;<br/>  entityId: &#34;AZAlHrc7TNeSwPTcvcjAtg&#34;<br/>  executionType: WORKFLOW<br/>  serviceInputs: {<br/>    name: &#34;Kubernetes Example&#34;<br/>    manifestValueInput: {<br/>      valueType: VERSION_NUMBER<br/>      versionNumber: {<br/>        appManifestName: &#34;aerospike&#34;<br/>        versionNumber: &#34;0.1.5&#34;<br/>      }<br/>    }<br/>  }}){<br/>    execution{<br/>      id<br/>      status<br/>    }<br/>  }<br/>}</pre><p></p><p>The execution status appears:</p><pre>{<br/>  &#34;data&#34;: {<br/>    &#34;startExecution&#34;: {<br/>      &#34;execution&#34;: {<br/>        &#34;id&#34;: &#34;rFtzYRNuSJ66mQ6dAViqqg&#34;,<br/>        &#34;status&#34;: &#34;RUNNING&#34;<br/>      }<br/>    }<br/>  }<br/>}</pre><p></p><h3>Step 2: Query the Execution</h3><p>You can query the Workflow or Pipeline executions to get the artifact sources used using <code>ExecutionInputs.serviceManifestInputs</code>.</p><p>Here&#39;s an example of a Workflow query:</p><pre class="hljs graphql">query{<br/>  executionInputs(applicationId: &#34;mtvPmU4AQ6aHrtjItnh1OQ&#34;<br/>  entityId: &#34;AZAlHrc7TNeSwPTcvcjAtg&#34;<br/>  executionType: WORKFLOW){<br/>    serviceManifestInputs{<br/>      id<br/>      name<br/>      artifactType<br/>      artifactSources {<br/>        artifacts(limit:10){<br/>          nodes{<br/>            artifactSource {<br/>              id<br/>            }<br/>          }<br/>        }<br/>      }<br/>    }<br/>  }<br/>}</pre><h3>Option: Create and Update Trigger</h3><p>To create a Trigger for a Workflow or Pipeline, the Trigger Condition must be <code>conditionType: ON_NEW_MANIFEST</code>.</p><p>You use <code>TriggerConditionInput.manifestConditionInput</code> to specify the chart version and App Manifest.</p><p>This is the same as selecting these in the UI:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/sbvn6uwcq1/1625857917350/clean-shot-2021-07-09-at-12-11-26.png"/></figure><p></p><p>Here&#39;s a Pipeline Trigger example:</p><pre class="hljs graphql">mutation{<br/>  createTrigger(input: {<br/>    applicationId: &#34;YHgzTw6_QI6TtHjJ8FZbfQ&#34;<br/>    name: &#34;Test-trigger-11342&#34;<br/>    condition: {<br/>      conditionType: ON_NEW_MANIFEST<br/>      manifestConditionInput: {<br/>        versionRegex: &#34;1.3.*&#34;<br/>        appManifestId: &#34;SIQku8n5QSS33WYN7Qa1iw&#34;<br/>      }<br/>    }<br/>    action: {<br/>      entityId: &#34;_zPc3iTRS2q-ui1rwIVrEw&#34;<br/>      executionType: PIPELINE<br/>      variables: [<br/>        {<br/>          name: &#34;Environment&#34;<br/>          variableValue: <br/>          {<br/>            type:NAME<br/>            value:&#34;prod&#34;<br/>          }<br/>        }<br/>        {<br/>          name: &#34;Service&#34;<br/>          variableValue: <br/>          {<br/>            type:NAME<br/>            value:&#34;&#34;<br/>          }<br/>        }	<br/>        {<br/>          name: &#34;InfraDefinition_KUBERNETES&#34;<br/>          variableValue: <br/>          {<br/>            type:NAME<br/>            value:&#34;&#34;<br/>          }<br/>        }	<br/>      ]<br/>      manifestSelections: {<br/>        manifestSelectionType:LAST_DEPLOYED<br/>        pipelineId:&#34;_zPc3iTRS2q-ui1rwIVrEw&#34;<br/>        versionRegex:&#34;&#34;<br/>        workflowId:&#34;&#34;<br/>        serviceId: &#34;-shnKF_iRZ-cCI8eXvtgrg&#34;<br/>      }<br/>      artifactSelections: {<br/>        artifactSelectionType: LAST_DEPLOYED_PIPELINE<br/>        serviceId: &#34;-shnKF_iRZ-cCI8eXvtgrg&#34;<br/>        pipelineId:&#34;_zPc3iTRS2q-ui1rwIVrEw&#34;<br/>      }<br/>    }<br/>  }){<br/>    trigger{<br/>      id<br/>      name<br/>      description<br/>      createdAt<br/>      createdBy{<br/>        email<br/>        name<br/>      }<br/>    }<br/>  }<br/>}</pre><p></p><p>To update or query the Trigger for the chart information, you need the Trigger Id or name. You can query for these using the Application Id:</p><pre>{<br/>  triggers(filters: [{application: {operator: EQUALS, values: [&#34;mtvPmU4AQ6aHrtjItnh1OQ&#34;]}}], limit: 100, offset: 2) {<br/>    nodes {<br/>      id<br/>      name<br/>    }<br/>  }<br/>}</pre><p></p><p>To update the Trigger, use the Trigger name:</p><pre>mutation{<br/>  updateTrigger(input: {<br/>    applicationId: &#34;YHgzTw6_QI6TtHjJ8FZbfQ&#34;<br/>    name: &#34;Test-trigger-11342&#34;<br/>    condition: {<br/>      conditionType: ON_NEW_MANIFEST<br/>      manifestConditionInput: {<br/>        versionRegex: &#34;1.3.*&#34;<br/>        appManifestId: &#34;SIQku8n5QSS33WYN7Qa1iw&#34;<br/>      }<br/>    }<br/>    action: {<br/>      entityId: &#34;_zPc3iTRS2q-ui1rwIVrEw&#34;<br/>      executionType: PIPELINE<br/>      variables: [<br/>        {<br/>          name: &#34;Environment&#34;<br/>          variableValue: <br/>          {<br/>            type:NAME<br/>            value:&#34;prod&#34;<br/>          }<br/>        }<br/>        {<br/>          name: &#34;Service&#34;<br/>          variableValue: <br/>          {<br/>            type:NAME<br/>            value:&#34;&#34;<br/>          }<br/>        }	<br/>        {<br/>          name: &#34;InfraDefinition_KUBERNETES&#34;<br/>          variableValue: <br/>          {<br/>            type:NAME<br/>            value:&#34;&#34;<br/>          }<br/>        }	<br/>      ]<br/>      manifestSelections: {<br/>        manifestSelectionType:LAST_DEPLOYED<br/>        pipelineId:&#34;_zPc3iTRS2q-ui1rwIVrEw&#34;<br/>        versionRegex:&#34;&#34;<br/>        workflowId:&#34;&#34;<br/>        serviceId: &#34;-shnKF_iRZ-cCI8eXvtgrg&#34;<br/>      }<br/>      artifactSelections: {<br/>        artifactSelectionType: LAST_DEPLOYED_PIPELINE<br/>        serviceId: &#34;-shnKF_iRZ-cCI8eXvtgrg&#34;<br/>        pipelineId:&#34;_zPc3iTRS2q-ui1rwIVrEw&#34;<br/>      }<br/>    }<br/>  }){<br/>    trigger{<br/>      id<br/>      name<br/>      description<br/>      createdAt<br/>      createdBy{<br/>        email<br/>        name<br/>      }<br/>    }<br/>  }<br/>}</pre><p></p><p>To query the Trigger, use the Trigger Id:</p><pre>query{<br/>  trigger(triggerId: &#34;TRIGGER_ID&#34;){<br/>    id<br/>    name<br/>    condition{<br/>     triggerConditionType<br/>			... on OnNewManifest{<br/>        appManifestId<br/>        serviceId<br/>        versionRegex<br/>      }<br/>    }<br/>    action{<br/>      manifestSelections{<br/>        manifestSelectionType<br/>        serviceId<br/>        serviceName<br/>        ...on LastCollectedManifest{<br/>          appManifestId<br/>          versionRegex<br/>        }<br/>      }<br/>    }<br/>  }<br/>}</pre><p></p><p>The output will provide the chart information:</p><pre>{<br/>  &#34;data&#34;: {<br/>    &#34;trigger&#34;: {<br/>      &#34;id&#34;: &#34;ezwJDT_BRN2yPiQGyv2YRA&#34;,<br/>      &#34;name&#34;: &#34;test1&#34;,<br/>      &#34;condition&#34;: {<br/>        &#34;triggerConditionType&#34;: &#34;NEW_MANIFEST&#34;,<br/>        &#34;appManifestId&#34;: &#34;McaUBAo7SBKFUYYgOHg_cA&#34;,<br/>        &#34;serviceId&#34;: &#34;mwuH-qpATZCi6APZe9Zjkg&#34;,<br/>        &#34;versionRegex&#34;: null<br/>      },<br/>      &#34;action&#34;: {<br/>        &#34;manifestSelections&#34;: [<br/>          {<br/>            &#34;manifestSelectionType&#34;: &#34;LAST_COLLECTED&#34;,<br/>            &#34;serviceId&#34;: &#34;mwuH-qpATZCi6APZe9Zjkg&#34;,<br/>            &#34;serviceName&#34;: &#34;K8s_WithArtifactManifestYES&#34;,<br/>            &#34;appManifestId&#34;: &#34;McaUBAo7SBKFUYYgOHg_cA&#34;,<br/>            &#34;versionRegex&#34;: null<br/>          },<br/>          {<br/>            &#34;manifestSelectionType&#34;: &#34;LAST_COLLECTED&#34;,<br/>            &#34;serviceId&#34;: &#34;e89AtMBsRXmSJhala5kh7w&#34;,<br/>            &#34;serviceName&#34;: &#34;ExpressionSupport HELM V2&#34;,<br/>            &#34;appManifestId&#34;: &#34;odcpa_Q2TnSZKQ4bJcrjaw&#34;,<br/>            &#34;versionRegex&#34;: null<br/>          }<br/>        ]<br/>      }<br/>    }<br/>  }<br/>}</pre><p></p><p></p>