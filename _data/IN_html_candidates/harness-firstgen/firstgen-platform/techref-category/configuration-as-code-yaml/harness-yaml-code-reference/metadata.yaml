type: article
article_id: 21kgaw4h86
user_id: mfr0nxh4be
category_id: iucs9fawif
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Harness YAML Code Reference
slug: harness-yaml-code-reference
description: Learn the YAML code keys and values used in the Harness Manager code
  editor to describe Harness Services, Environments, Workflows, and other components.
short_version: Learn the YAML code keys and values used in the Harness Manager code
  editor.
tags:
- YAML
- Secrets management
- Vault
- index.yaml
- Defaults.yaml
- Install.yaml
- barrier
- HTTP
- approval
- Usage Scope
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: Article updated
  source: API
  triggered_at: 2022-01-24T22:28:36.321331Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Harness YAML Code Reference
  description: Learn the YAML code keys and values used in the Harness Manager code
    editor to describe Harness Services, Environments, Workflows, and other components.
  short_version: Learn the YAML code keys and values used in the Harness Manager code
    editor.
  body: |-
    <div class="warning-callout">YAML schema for some Workflow, Pipeline, and Triggers have changed. See <a href="/article/wkp9blw8pf-recent-yaml-schema-changes">Recent YAML Schema Changes</a>.</div><p>This document describes the YAML code keys and values used in the Harness Manager code editor to describe Harness Services, Environments, Workflows, and other components.</p><p>For how-tos on using YAML in Harness, see <a href="/article/htvzryeqjw-configuration-as-code">Configuration as Code Overview</a>.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1578089758408/image.png"/></figure><p>For each YAML file described in this document, the default keys are listed with example values and commented descriptions, for example:</p><pre class="hljs yaml">harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: ACCOUNT_DEFAULTS # The ACCOUNT_DEFAULTS value identifies the file type. <br/><br/>defaults:<br/><br/>- name: myCompany # The default name for the account.<br/><br/>  value: Product Harness Account # A description of the Harness account.</pre><div class="note-callout">All files must have the <strong>.yaml</strong> file extension. The .yml extension is not supported.</div><h3>Harness and YAML</h3><p>Harness supports the <a href="https://yaml.org/spec/1.2/spec.html" target="_blank">YAML spec version 1.2</a>. The YAML spec does not identify invalid characters, just the reserved characters # &gt; -. As long as there are single or double quotes around a string, it is allowed by YAML; however, Harness has requirements for what values can be used for different YAML keys. The best way to test is to use the value in the UI and see if an error occurs.</p><h3>Harness Code and Git Repositories</h3><p>You can sync Harness YAML with your Git repo. You can sync individual Applications or your entire Harness configuration. For more information, see <a href="/article/htvzryeqjw-configuration-as-code">Configuration as Code</a>.</p><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;what_s_code_is_required&#34;&gt;&lt;/span&gt;"><p><span id="what_s_code_is_required"></span></p>
    </div><h3>What Code Is Required?</h3><p>Unless mentioned, all default folders displayed in the Harness Manager code editor are required. The required files and YAML keys depend on your configuration. When in doubt, consult the Harness Manager UI and look for required fields, marked with as asterisk (*).</p><div class="note-callout">If you sync your Harness Application with a Git repo and then delete a required file in Git and sync with Harness, the file is not replaced by Harness.</div><h3>Encrypted Information in YAML</h3><p>By default, Harness encrypts secrets such as passwords, files, and keys in Amazon KMS. In the YAML, you will see something like this:</p><pre class="hljs yaml">fileName: amazonkms:_A1B2C3D4E5</pre><p>This is the KMS record for the secret that Harness has created and stored in the KMS vault. This record has the information needed to connect and retrieve the secret from KMS.</p><p>You can also set Harness to use other secrets managers, such as HashiCorp Vault and AWS Secrets Manager.</p><p>In the Harness UI, you can reference pre-existing secrets in Vault and AWS Secrets Manager using a path, as described in <a href="https://docs.harness.io/article/au38zpufhr-secret-management#referencing_existing_secrets">Referencing Existing Secrets</a>.</p><h4>HashiCorp Vault</h4><p>For HashiCorp Vault, you can also use the Harness YAML editor to reference pre-existing secrets in Vault using a fully-qualified path, such as <code>hashicorpvault://LocalVault/foo/bar/mysecret#mykey</code>. The scheme <code>hashicorpvault://</code> is needed to distinguish a Vault secret from other secret references. It is followed by the name of the Vault secret manager. In the following example, <code>LocalVault</code>:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1558723202353/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><h3>RBAC and YAMl Editor in Harness Manager</h3><p>Harness applies RBAC to the YAML Editor in Harness Manager.</p><p>The account and Application permissions configured in a Harness User Group determines what account and Application YAML is displayed in the YAML Editor.</p><p>See <a href="/article/ven0bvulsj-users-and-permissions">Managing Users and Groups (RBAC)</a>.</p><p>If you have synched your account or Application with Git, as described in <a href="/article/htvzryeqjw-configuration-as-code">Configuration as Code</a>, your Git provider RBAC settings apply on the Git side.</p><h3>Defaults.yaml for Account</h3><p>The Defaults.yaml file describes the Harness account defaults. It contains the following fields:</p><pre class="hljs yaml">harnessApiVersion: &#39;1.0&#39; # The Harness API version number. You cannot edit this value.<br/><br/>type: ACCOUNT_DEFAULTS # The ACCOUNT_DEFAULTS value identifies the file type. <br/><br/>defaults:<br/><br/>- name: myCompany # The default name for the account.<br/><br/>  value: Product Harness Account # A description of the Harness account.</pre><h3>Harness API Version</h3><p>You can edit <code>harnessApiVersion</code> in any YAML file but it does not have any impact.</p><h3>Applications</h3><p>This folder contains all of the Harness applications in your Harness account. For more information on Applications, see <a href="/article/bucothemly-application-configuration">Application Checklist</a>.</p><h4>Application folder</h4><p>Each Harness Application is contained in a folder using its Application name.</p><h4>Index.yaml for Application</h4><p>The index.yaml file describes the Application.</p><pre class="hljs yaml">harnessApiVersion: &#39;1.0&#39; # The Harness API version number. You cannot edit this value.<br/><br/>type: APPLICATION # The file type.<br/><br/>description: A sample To-Do List application # The description of the Application.</pre><h4>Defaults.yaml for Application</h4><p>The Defaults.yaml file in an Application folder contains the Application-wide variables. For more information, see <a href="/article/9dvxcegm90-variables">Variables and Expressions in Harness</a>.</p><pre class="hljs yaml">harnessApiVersion: &#39;1.0&#39; # The Harness API version number. You cannot edit this value.<br/><br/>type: APPLICATION_DEFAULTS # The file type.<br/><br/>defaults: # Application-wide variables collection.<br/><br/>- name: BACKUP_PATH # The environment variable for the backup path on the host running the Harness Delegate.<br/><br/>  value: $HOME/${app.name}/${service.name}/${env.name}/backup/${timestampId}<br/><br/>- name: STAGING_PATH # The environment variable for the staging path on the host running the Harness Delegate.<br/><br/>  value: $HOME/${app.name}/${service.name}/${env.name}/staging/${timestampId}<br/><br/>- name: RUNTIME_PATH # The environment variable for the runtime path on the host running the Harness Delegate.<br/><br/>  value: $HOME/${app.name}/${service.name}/${env.name}/runtime<br/><br/>- name: WINDOWS_RUNTIME_PATH # The environment variable for the runtime path on the Windows host running the Harness Delegate.<br/><br/>  value: &#39;%USERPROFILE%\${app.name}\${service.name}\${env.name}\runtime&#39;</pre><h3>Services</h3><p>The folders and files under <strong>Services</strong> define each Harness Service used in the Application. For more information, see <a href="/article/eb3kfl8uls-service-configuration">Add a Service</a>.</p><h4>Service Folder</h4><p>Each Service in the Application is contained in a folder using its name, such as <strong>Harness Sample App</strong>. All folders and files that define the Service are contained in the Service&#39;s folder.</p><h4>Index.yaml for Service</h4><p>The primary file for the Service. Its contents depend on the Service type, such as Docker Image or JAR, and the configuration.</p><p>Here is an example a Index.yaml for a Docker Image Service:</p><pre class="hljs yaml">harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: SERVICE # The file type.<br/><br/>artifactType: DOCKER # The Service type.<br/><br/>configMapYaml: |- # The Kubernetes ConfigMap block.<br/><br/>  kubectl describe configmaps my-config<br/><br/>  Name:           my-config<br/><br/>  Namespace:      default<br/><br/>  Labels:         &lt;none&gt;<br/><br/>  Annotations:    &lt;none&gt;<br/><br/>  Data<br/><br/>  ====<br/><br/>  my.properties:        158 bytes<br/><br/>configVariables: # User-added config variables.<br/><br/>- name: foo<br/><br/>  value: bar<br/><br/>  valueType: TEXT<br/><br/>helmValueYaml: | # The Helm values.yaml block.<br/><br/>  # Enter your Helm value YAML<br/><br/>  # ---<br/><br/>  namespace : ${NAMESPACE}</pre><h4>Deployment Specifications</h4><p>This folder contains the Service-specific container specifications. For example, a Service that contains a Kubernetes Container Specification will display that specification in this folder.</p><p>A service that uses an ECS Container Specification and Service Specification will display those specs in this folder.</p><p>Here is a Kubernetes Container Specification with the default comments removed:</p><pre class="hljs yaml">harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: KUBERNETES # The Deployment Specification type.<br/><br/>advancedConfig: | # This block contains the Kubernetes deployment specification.<br/><br/>  # Enter your Controller YAML spec below.<br/><br/>  # ---<br/><br/>  apiVersion: &#34;extensions/v1beta1&#34;<br/><br/>  kind: &#34;Deployment&#34;<br/><br/>  metadata:<br/><br/>    annotations: {}<br/><br/>    finalizers: <br/><br/>    labels: {}<br/><br/>    ownerReferences: <br/><br/>  spec:<br/><br/>    replicas: 0<br/><br/>    template:<br/><br/>      metadata:<br/><br/>        annotations: {}<br/><br/>        finalizers: <br/><br/>        labels: {}<br/><br/>        ownerReferences: <br/><br/>      spec:<br/><br/>        containers:<br/><br/>        - args: <br/><br/>          command: <br/><br/>          env: <br/><br/>          envFrom: <br/><br/>          image: &#34;${DOCKER_IMAGE_NAME}&#34;<br/><br/>          name: &#34;${CONTAINER_NAME}&#34;<br/><br/>          ports: <br/><br/>          volumeMounts: <br/><br/>        hostAliases: <br/><br/>        imagePullSecrets:<br/><br/>        - name: &#34;${SECRET_NAME}&#34;<br/><br/>        initContainers: <br/><br/>        nodeSelector: {}<br/><br/>        tolerations: <br/><br/>        volumes: </pre><h4>Artifact Servers</h4><p>This folder contains the Artifact Sources for the Service. Here is an Artifact Source that uses an SFTP Artifact Server to obtain files matching the regex pattern <strong>Downloads\todo*.*zip</strong>:</p><pre class="hljs yaml">harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: SFTP # The Artifact Source type.<br/><br/>artifactPaths: # The artifact path on the SFTP server.<br/><br/>- Downloads\todo*.*zip # Regex path.<br/><br/>metadataOnly: true # Harness will only obtain metadata for the artifact.<br/><br/>serverName: SFTP-Local # The name of the Artifact Server selected.</pre><p>Here is an Artifact Source that uses a Docker Registry Artifact Server to obtain an Nginx artifact:</p><pre class="hljs yaml">harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: DOCKER # The Artifact Source type.<br/><br/>imageName: library/nginx # The Docker image registry and image name.<br/><br/>metadataOnly: true # Harness will only obtain metadata for the artifact.<br/><br/>serverName: registry_hub_docker_com # The name of the Artifact Server selected.</pre><h4>Commands</h4><p>This folder contains the scripts for commands that are in the Service, such as Bash and PowerShell scripts. Here is an example of some common scripts:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1627510333687/clean-shot-2021-07-28-at-15-12-06.png"/></figure><p>Here is the code for the Install.yaml file that contains the Install script:</p><pre class="hljs yaml">harnessApiVersion: &#39;1.0&#39;<br/>type: OTHER<br/>commandUnitType: COMMAND<br/>commandUnits:<br/>- command: echo &#34;this is an exec command&#34;<br/>  commandUnitType: EXEC<br/>  deploymentType: SSH<br/>  name: Exec<br/>  scriptType: BASH<br/>  workingDirectory: dir<br/>- artifactVariableName: artifact<br/>  commandUnitType: SCP<br/>  deploymentType: SSH<br/>  destinationDirectoryPath: $WINGS_RUNTIME_PATH<br/>  name: SCP<br/>  source: ARTIFACTS<br/>- command: |2-<br/><br/>    # Execute as root and pass environment variables<br/>    # su -p -<br/><br/>    # Execute as root via user credentials (with root privileges)<br/>    # sudo -E su -p -<br/><br/>    # The following variables are absolute paths defined as:<br/>    # ${HOME}/${appName}/${serviceName}/${serviceTemplateName}/[runtime|backup|staging]<br/><br/>    mkdir -p &#34;$WINGS_RUNTIME_PATH&#34;<br/>    mkdir -p &#34;$WINGS_BACKUP_PATH&#34;<br/>    mkdir -p &#34;$WINGS_STAGING_PATH&#34;<br/>  commandUnitType: SETUP_ENV<br/>  deploymentType: SSH<br/>  name: Setup Env<br/>  scriptType: BASH<br/>  workingDirectory: dir<br/>- command: |-<br/>    docker login --username=&#34;$DOCKER_USER_ID&#34; --password=&#34;$DOCKER_USER_PASSWORD&#34;<br/>    docker run -d -it &#34;$DOCKER_IMAGE&#34;<br/>    docker logout<br/>  commandUnitType: DOCKER_START<br/>  deploymentType: SSH<br/>  name: Docker Start<br/>  scriptType: BASH<br/>- command: docker ps -a -q --filter ancestor=$IMAGE | xargs docker stop<br/>  commandUnitType: DOCKER_STOP<br/>  deploymentType: SSH<br/>  name: Docker Stop<br/>  scriptType: BASH<br/>- artifactVariableName: artifact<br/>  commandUnitType: DOWNLOAD_ARTIFACT<br/>  deploymentType: SSH<br/>  name: Download Artifact<br/>  scriptType: BASH<br/>  workingDirectory: ${app.defaults.RUNTIME_PATH}<br/>- command: |-<br/>    set -x<br/>    pgrep -f &#34;\-Dcatalina.home=$WINGS_RUNTIME_PATH/tomcat&#34;<br/>  commandUnitType: PROCESS_CHECK_RUNNING<br/>  deploymentType: SSH<br/>  name: Process Running<br/>  scriptType: BASH<br/>- command: |-<br/>    set -x<br/>    pgrep -f &#34;\-Dcatalina.home=$WINGS_RUNTIME_PATH/tomcat&#34;<br/>    rc=$?<br/>    if [ &#34;$rc&#34; -eq 0 ]<br/>    then<br/>    exit 1<br/>    fi<br/>  commandUnitType: PROCESS_CHECK_STOPPED<br/>  deploymentType: SSH<br/>  name: Process Stopped<br/>  scriptType: BASH<br/>- command: |-<br/>    set -x<br/>    nc -v -z -w 5 localhost 8080<br/>    rc=$?<br/>    if [ &#34;$rc&#34; -eq 0 ]<br/>    then<br/>    exit 1<br/>    fi<br/>  commandUnitType: PORT_CHECK_CLEARED<br/>  deploymentType: SSH<br/>  name: Port Cleared<br/>  scriptType: BASH<br/>- command: |-<br/>    set -x<br/>    nc -v -z -w 5 localhost 8080<br/>  commandUnitType: PORT_CHECK_LISTENING<br/>  deploymentType: SSH<br/>  name: Port Listening<br/>  scriptType: BASH<br/>targetToAllEnv: true</pre><h4>Template Library Commands</h4><p>The <strong>Commands</strong> folder displays different YAML keys to indicate that a script is linked from the <a href="/article/ygi6d8epse-use-templates">Template Library</a>. For example, the following script named <strong>JSON to Environment Variables</strong> is linked to the <strong>JSON to Environment Variables</strong> script in the Template Library:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1548457936737/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Here is the YAML for the script:</p><pre class="hljs yaml">harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: START # The script type.<br/><br/>commandUnitType: COMMAND # This is a Linux command.<br/><br/>commandUnits: # Linux command units. The grep and subsequent commands and printed on one line.<br/><br/>- command: grep -Eo &#39;.*:.*?[^\\]&#34;&#39; ${ArtifactFileName} | sed &#39;s/\&#34;//g&#39; | awk -F&#39;:&#39; &#39;{print &#34;export &#34; $1 &#34;=\&#34;&#34; $2 &#34;\&#34;&#34;}&#39; &gt; __dummy.sh &amp;&amp; . ./__dummy.sh &amp;&amp; rm __dummy.sh<br/><br/>  commandUnitType: EXEC # Exec command unit. <br/><br/>  deploymentType: SSH # Remote machine execute.<br/><br/>  name: Exec # The name of the command in the GUI.<br/><br/>  scriptType: BASH # Script language.<br/><br/>  workingDirectory: $RuntimePath # Environment variable.<br/><br/>targetToAllEnv: true # Apply to all Harness Environments.<br/><br/># The following path is the location of the template in the user&#39;s Template Library<br/><br/>templateUri: johndoe/Generic Commands/Json to Environment Variables:latest<br/><br/>templateVariables: # Variable used in the template<br/><br/>- name: RuntimePath<br/><br/>  value: foo<br/><br/>- name: ArtifactFileName<br/><br/>  value: bar</pre><h4>Config Files</h4><p>This folder contains the files added to the Config Files section of a Service. Here is an example with a text file and an encrypted PDF file.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1548457982586/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Here is an example of the YAML file for an encrypted file in Config Files:</p><pre>harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: CONFIG_FILE # The YAML file type.<br/><br/>checksumType: MD5 # The hash function type.<br/><br/>description: encrypted-file-example # The description provided by the user.<br/><br/>encrypted: true # Encrypted file boolean value.<br/><br/>fileName: amazonkms:_gzC7yG5RAaC4kZNafymow # Harness KMS encryptedRecords entry used to decrypt file.<br/><br/>targetFilePath: encrypted-config-file-example.enc # The original filename.<br/><br/>targetToAllEnv: true </pre><h3>Environments</h3><p>The folders and files under Environments define each Harness Environments used in the Application. For more information, see Add an Environment.</p><h4>Environments Folder</h4><p>Each Environment in the Application is contained in a folder using its name, such as <strong>QAEnv</strong>. All folders and files that define the Environment are contained in the Environment&#39;s folder.</p><h4>Index.yaml for Environment</h4><p>The primary file for an Environment. Here is a sample Index.yaml for a Non-Production Environment:</p><pre>harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: ENVIRONMENT  # The file type.<br/><br/>environmentType: NON_PROD # The Environment type.</pre><p>Variable Overrides and, in the case of Kubernetes, ConfigMap YAML Overrides, are stored in the Index.yaml file. For example, here is a <strong>Service Configuration Overrides</strong> section of an <strong>Environment</strong> that contains simple <strong>Variable Overrides</strong> and <strong>ConfigMap YAML Overrides</strong> entries:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1548458090126/image.png"/></figure><p>The Index.yaml example we used above now includes these variable overrides, highlighted below:</p><pre class="hljs yaml">harnessApiVersion: &#39;1.0&#39;<br/><br/>type: ENVIRONMENT<br/><br/>configMapYamlByServiceTemplateId:<br/><br/>  tRmkVK3yQieFTlXrWqe7Cg: &#39;# configMap Override&#39;<br/><br/>environmentType: NON_PROD<br/><br/>variableOverrides: # Override Variables<br/><br/>- name: foo # Configuration variable name.<br/><br/>  serviceName: MyService # Service for the overridden variable.<br/><br/>  value: foo-override<br/><br/>  valueType: TEXT # Text type.<br/><br/>- name: SecretVar # Configuration variable name.<br/><br/>  serviceName: JAR-service # Service for the overridden variable.<br/><br/>  value: amazonkms:2St-1zmsTeWFBtNqVqZvkg # Harness KMS encryptedRecords entry used to decrypt value.<br/><br/>  valueType: ENCRYPTED_TEXT # Encrypted text type.</pre><h4>Infrastructure Definition</h4><p>The <strong>Infrastructure Definition</strong> file is named with the Infrastructure Definition name and describes the Infrastructure Definition settings.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1568322170172/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><pre>harnessApiVersion: &#39;1.0&#39;<br/>type: INFRA_DEFINITION<br/>cloudProviderType: AWS<br/>deploymentType: AWS_LAMBDA<br/>infrastructure:<br/>- type: AWS_AWS_LAMBDA<br/>  cloudProviderName: aws_playground<br/>  iamRole: arn:aws:iam::448640225317:role/service-role/TestAwsLamdaRole<br/>  region: us-east-1<br/>  securityGroupIds:<br/>  - sg-05e7b8b9cad94b393<br/>  subnetIds:<br/>  - subnet-05788710b1b06b6b1<br/>  - subnet-0c945c814c09c9aed<br/>  vpcId: vpc-00a7e8ea4fd1ffd9d<br/>scopedServices:<br/>- AWS Lambda</pre><p>The scopedServices section lists the Harness Services that can use this Infrastructure Definition. Each Service must be entered on a new like, like this:</p><pre>scopedServices:<br/>- AWS Lambda<br/>- Lambda Example</pre><h4>Service Verification</h4><p>The files in this folder are for the <a href="/article/dajt54pyxd-24-7-service-guard-overview">24/7 Service Guard Overview</a> verification configurations. Each configuration has its own file. Here is an example of a 24x7 Service Guard verification:</p><pre>harnessApiVersion: &#39;1.0&#39; # The Harness API version number. <br/><br/>type: ELK # The Verification Provider type. <br/><br/>alertEnabled: false # Boolean value for enabling the alerts. <br/><br/>alertThreshold: 0.5 # Threshold value to reach for triggering the alerts. <br/><br/>baselineEndMinute: -1 # End time for baseline data.<br/><br/>baselineStartMinute: -1 # Start time for baseline data.<br/><br/>connectorName: ELK # Name of the Connector. <br/><br/>enabled24x7: false # Boolean value for enabling the settings. <br/><br/>hostnameField: host # Name of the host for which you want logs. <br/><br/>index: filebeat-* # Index value to search. <br/><br/>messageField: message # The field by which messages are usually indexed. <br/><br/>query: &#39;*exception_____*&#39; # The API Query required to retrieve the metric value. <br/><br/>serviceName: Kub_ser1 # Name of the Service. <br/><br/>timestampField: &#39;@timestamp&#39; # Timestamp field in the Elasticsearch record. <br/><br/>timestampFormat: yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSSX # Format for the timestamp field in the Elasticsearch record. <br/></pre><h4>Config Files</h4><p>File Overrides in the Service Configuration Overrides of an Environment are listed in the Config Files folder. Here is a File Override in the UI:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1548458354988/image.png"/></figure><p>The YAML file added for each File Override is named the same as the variable name. Here is the YAML in the file named after the variable, bar.yaml:</p><pre>harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: CONFIG_FILE_OVERRIDE # The type of override.<br/><br/>checksumType: MD5 The hash function type.<br/><br/>encrypted: false # Boolean for whether the file in encrypted.<br/><br/>fileName: bar # Name of the Service file to override.<br/><br/>serviceName: MyService # Name of the Service containing the file to override.<br/><br/>targetFilePath: bar # The file path or name of the file overridden.</pre><h4>Values</h4><p>The Service Configuration Overrides for ConfigMap YAML Overrides and Helm Values YAML Overrides are listed in the Values folder, under a Services folder, followed by a folder named using the Service name.</p><p>The ConfigMap YAML Overrides is named Index.yaml. Here is an example:</p><pre>harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: APPLICATION_MANIFEST_VALUES_ENV_SERVICE_OVERRIDE # Type of override.<br/><br/>storeType: Local  # Where the file is stored. Local means the Harness Data Store.</pre><div class="note-callout">The values for the ConfigMap YAML Overrides are located in the Index.yaml for the Environment, as described in <a href="#index_yaml_for_environment">Index.yaml for Environment</a>.</div><p>The Helm Values YAML Overrides is named values.yaml, and simply contains a Helm values.yaml file contents, for example:</p><pre># Helm values override<br/>harness:<br/>  helm:<br/>    chart:<br/>      name: nginx<br/>      version: 1.0.1<br/>      url: https://charts.bitnami.com/bitnami</pre><h3>Workflows</h3><p>This folder contains all Workflows for the Application. Each Workflow is in its own YAML file named after the Workflow name. Workflow YAML files have different key-value pairs depending on their configuration. We include to simple examples below. The order of the YAML does not always reflect the order of Workflow steps, commands, or deployment operations.</p><p>Here is the UI of a Basic Workflow of SSH deployment type:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1548458633189/image.png"/></figure><p>Below is the Workflow YAML for the Basic Workflow SSH deployment type with all of its sections collapsed. Each section is discussed later in the document.</p><pre>harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: BASIC # The Workflow type.<br/><br/>description: This is the workflow description. # Workflow description.<br/><br/>envName: QAEnv # Environment used by the Workflow.<br/><br/>failureStrategies: # Failure Strategy<br/><br/>- executionScope: WORKFLOW<br/><br/>notificationRules: # Notification Strategy<br/><br/>- conditions:<br/><br/>phases: # Workflow Steps<br/><br/>- type: SSH # Deployment Type, SSH.<br/><br/>preDeploymentSteps: # Pre-deployment check for Service artifacts.<br/><br/>- type: ARTIFACT_CHECK<br/><br/>rollbackPhases: # Rollback Steps.<br/><br/>- type: SSH<br/><br/>templatized: false # Identifies in the Workflow is templatized.<br/><br/>userVariables: # Workflow variables.<br/><br/>- type: TEXT</pre><p>The following sections describe the YAML for each of the Workflow sections.</p><h4>Pre-Deployment Steps</h4><p>Pre-deployment steps are simple checks for artifacts in Basic Workflows. Here is an example of pre-deployment steps for the Basic Workflow with SSH deployment type:</p><pre>preDeploymentSteps:<br/><br/>- type: ARTIFACT_CHECK<br/><br/>  name: Artifact Check</pre><h4>Basic Workflow Phases</h4><p>Workflows deployment steps are are broken into phases. A Basic Workflow is one phase. A Canary Workflow can be two or more phases.</p><p>Here is an example of a single phase in a Basic Workflow SSH deployment type. It contains a Select Nodes and a Jenkins step:</p><pre>phases:<br/>- type: SSH<br/>  computeProviderName: aws-docs-vars<br/>  daemonSet: false<br/>  infraDefinitionName: amazon web services- aws-docs-vars - AWS - us-east-1<br/>  name: Phase 1<br/>  phaseSteps:<br/>  - type: INFRASTRUCTURE_NODE<br/>    name: Prepare Infra<br/>    steps:<br/>    - type: AWS_NODE_SELECT<br/>      name: Select Nodes<br/>      properties:<br/>        excludeSelectedHostsFromFuturePhases: true<br/>        instanceCount: 3<br/>        instanceUnitType: COUNT<br/>        specificHosts: false<br/>    stepsInParallel: false<br/>  - type: DISABLE_SERVICE<br/>    name: Disable Service<br/>    stepsInParallel: false<br/>  - type: DEPLOY_SERVICE<br/>    name: Deploy Service<br/>    steps:<br/>    - type: JENKINS<br/>      name: Jenkins<br/>      properties:<br/>        jenkinsConfigId: Ze7ZvAFtSHOuDB5U_0wTQQ<br/>        jobName: HarshJenkins/harshjain12-patch-1<br/>        jobNameAsExpression: false<br/>        jobParameters: null<br/>        sweepingOutputName: null<br/>        sweepingOutputScope: null<br/>        timeoutMillis: 600000<br/>    stepsInParallel: false<br/>  - type: ENABLE_SERVICE<br/>    name: Enable Service<br/>    stepsInParallel: false<br/>  - type: VERIFY_SERVICE<br/>    name: Verify Service<br/>    stepsInParallel: false<br/>  - type: WRAP_UP<br/>    name: Wrap Up<br/>    stepsInParallel: false<br/>  provisionNodes: false<br/>  serviceName: SSH<br/>  statefulSet: false<br/>preDeploymentSteps:<br/>- type: ARTIFACT_CHECK<br/>  name: Artifact Check<br/>rollbackPhases:<br/>- type: SSH<br/>  computeProviderName: aws-docs-vars<br/>  daemonSet: false<br/>  infraDefinitionName: amazon web services- aws-docs-vars - AWS - us-east-1<br/>  name: Rollback Phase 1<br/>  phaseNameForRollback: Phase 1<br/>  phaseSteps:<br/>  - type: DISABLE_SERVICE<br/>    name: Disable Service<br/>    phaseStepNameForRollback: Enable Service<br/>    statusForRollback: SUCCESS<br/>    stepsInParallel: false<br/>  - type: STOP_SERVICE<br/>    name: Stop Service<br/>    phaseStepNameForRollback: Deploy Service<br/>    statusForRollback: SUCCESS<br/>    steps:<br/>    - type: COMMAND<br/>      name: Stop<br/>      properties:<br/>        commandName: Stop<br/>    stepsInParallel: false<br/>  - type: DEPLOY_SERVICE<br/>    name: Deploy Service<br/>    phaseStepNameForRollback: Deploy Service<br/>    statusForRollback: SUCCESS<br/>    stepsInParallel: false<br/>  - type: ENABLE_SERVICE<br/>    name: Enable Service<br/>    phaseStepNameForRollback: Disable Service<br/>    statusForRollback: SUCCESS<br/>    stepsInParallel: false<br/>  - type: VERIFY_SERVICE<br/>    name: Verify Service<br/>    phaseStepNameForRollback: Deploy Service<br/>    statusForRollback: SUCCESS<br/>    stepsInParallel: false<br/>  - type: WRAP_UP<br/>    name: Wrap Up<br/>    stepsInParallel: false<br/>  provisionNodes: false<br/>  serviceName: SSH<br/>  statefulSet: false<br/>templatized: false</pre><h4>Canary Workflow Phases</h4><p>Canary Workflows typically use two phases. The first phase deploys the microservice is a small number of instances and, once successful, the microservice is deployed to all instances.</p><p>Here is the first phase of a Canary Workflow of Kubernetes deployment type in the UI:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1548458928006/image.png"/></figure><p>Here is an example of the two phases of a Canary Workflow of Kubernetes deployment type:phases:</p><pre>harnessApiVersion: &#39;1.0&#39;<br/>type: CANARY<br/>concurrencyStrategy: INFRA<br/>envName: prod<br/>failureStrategies:<br/>- executionScope: WORKFLOW<br/>  failureTypes:<br/>  - APPLICATION_ERROR<br/>  repairActionCode: ROLLBACK_WORKFLOW<br/>  retryCount: 0<br/>notificationRules:<br/>- conditions:<br/>  - FAILED<br/>  executionScope: WORKFLOW<br/>  notificationGroupAsExpression: false<br/>  userGroupAsExpression: false<br/>  userGroupIds:<br/>  - 1ZUJQSLVQky0eXumi1yHzQ<br/>phases:<br/>- type: KUBERNETES<br/>  computeProviderName: Harness Sample K8s Cloud Provider<br/>  daemonSet: false<br/>  infraDefinitionName: To-Do List K8s<br/>  name: CANARY<br/>  phaseSteps:<br/>  - type: K8S_PHASE_STEP<br/>    name: Deploy<br/>    steps:<br/>    - type: K8S_CANARY_DEPLOY<br/>      name: Canary Deployment<br/>      properties:<br/>        instanceUnitType: COUNT<br/>        instances: &#39;1&#39;<br/>    stepsInParallel: false<br/>  - type: K8S_PHASE_STEP<br/>    name: Verify<br/>    stepsInParallel: false<br/>  - type: K8S_PHASE_STEP<br/>    name: Wrap Up<br/>    steps:<br/>    - type: K8S_DELETE<br/>      name: Canary Delete<br/>      properties:<br/>        instanceUnitType: COUNT<br/>        resources: ${k8s.canaryWorkload}<br/>    stepsInParallel: false<br/>  provisionNodes: false<br/>  serviceName: To-Do List K8s<br/>  statefulSet: false<br/>- type: KUBERNETES<br/>  computeProviderName: Harness Sample K8s Cloud Provider<br/>  daemonSet: false<br/>  infraDefinitionName: To-Do List K8s<br/>  name: Primary<br/>  phaseSteps:<br/>  - type: K8S_PHASE_STEP<br/>    name: Deploy<br/>    steps:<br/>    - type: K8S_DEPLOYMENT_ROLLING<br/>      name: Rollout Deployment<br/>    stepsInParallel: false<br/>  - type: K8S_PHASE_STEP<br/>    name: Verify<br/>    stepsInParallel: false<br/>  - type: K8S_PHASE_STEP<br/>    name: Wrap Up<br/>    stepsInParallel: false<br/>  provisionNodes: false<br/>  serviceName: To-Do List K8s<br/>  statefulSet: false<br/>rollbackPhases:<br/>- type: KUBERNETES<br/>  computeProviderName: Harness Sample K8s Cloud Provider<br/>  daemonSet: false<br/>  infraDefinitionName: To-Do List K8s<br/>  name: Rollback CANARY<br/>  phaseNameForRollback: CANARY<br/>  phaseSteps:<br/>  - type: K8S_PHASE_STEP<br/>    name: Deploy<br/>    phaseStepNameForRollback: Deploy<br/>    statusForRollback: SUCCESS<br/>    stepsInParallel: false<br/>  - type: K8S_PHASE_STEP<br/>    name: Wrap Up<br/>    phaseStepNameForRollback: Wrap Up<br/>    stepsInParallel: false<br/>  provisionNodes: false<br/>  serviceName: To-Do List K8s<br/>  statefulSet: false<br/>- type: KUBERNETES<br/>  computeProviderName: Harness Sample K8s Cloud Provider<br/>  daemonSet: false<br/>  infraDefinitionName: To-Do List K8s<br/>  name: Rollback Primary<br/>  phaseNameForRollback: Primary<br/>  phaseSteps:<br/>  - type: K8S_PHASE_STEP<br/>    name: Deploy<br/>    phaseStepNameForRollback: Deploy<br/>    statusForRollback: SUCCESS<br/>    steps:<br/>    - type: K8S_DEPLOYMENT_ROLLING_ROLLBACK<br/>      name: Rollback Deployment<br/>    stepsInParallel: false<br/>  - type: K8S_PHASE_STEP<br/>    name: Wrap Up<br/>    phaseStepNameForRollback: Wrap Up<br/>    stepsInParallel: false<br/>  provisionNodes: false<br/>  serviceName: To-Do List K8s<br/>  statefulSet: false<br/>templatized: false</pre><p></p><h4>Failure Strategy</h4><p>The Failure Strategy YAML describes the steps Harness will take when a Workflow deployment fails and meets the Failure Strategy criteria.</p><p>Here is what the default Failure Strategy looks like in the UI:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1548459004088/image.png"/></figure><p></p><p>Here is the YAML for the default Failure Strategy:</p><pre>failureStrategies: # Failure Strategy settings.<br/>- executionScope: WORKFLOW<br/>  failureTypes:<br/>  - APPLICATION_ERROR # Default strategy.<br/>  repairActionCode: ROLLBACK_WORKFLOW<br/>  retryCount: 0</pre><p>Here is another Failure Strategy with all Failure Criteria selected:</p><pre>- executionScope: WORKFLOW<br/>  failureTypes:<br/>  - CONNECTIVITY<br/>  - AUTHENTICATION<br/>  - VERIFICATION_FAILURE<br/>  - APPLICATION_ERROR<br/>  repairActionCode: ROLLBACK_WORKFLOW<br/>  retryCount: 0</pre><h4>Notification Strategy</h4><p>The Notification Strategy describes which Harness Users and/or Groups to notify when a Workflow has failed, succeeded, or reached other criteria.</p><p>Here is the default Notification Strategy in the UI:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1548459078125/image.png"/></figure><p>Here is the YAML for the default Notification Strategy:</p><pre>notificationRules: # Notification Strategy settings.<br/>- conditions:<br/>  - FAILED # Default strategy.<br/>  executionScope: WORKFLOW<br/>  notificationGroupAsExpression: false<br/>  notificationGroups:<br/>  - Account Administrator # User to notify.</pre><h4>Rollback Steps</h4><p>The following are Rollback steps in case of a deployment failure or if rollback is part of a Failure Strategy. Here are the Rollback steps in the UI:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1548459151761/image.png" style="max-height:25%;max-width:25%" data-hd-height="25%" data-hd-width="25%"/></figure><p></p><p>Here is the YAML for the Rollback Steps:</p><pre>rollbackPhases: <br/><br/>- type: SSH # Execute on target host.<br/><br/>  computeProviderName: local # Cloud Provider name.<br/><br/>  daemonSet: false # Used by Kubernetes Workflow type only, hence false.<br/><br/>  infraDefinitionName: Physical Data Center- local-DataCenter_SSH # Environment Infrastructure Definition used.<br/><br/>  name: Rollback Phase 1 <br/><br/>  phaseNameForRollback: Phase 1<br/><br/>  phaseSteps:<br/><br/>  - type: DISABLE_SERVICE<br/><br/>    name: Disable Service<br/><br/>    phaseStepNameForRollback: Enable Service<br/><br/>    statusForRollback: SUCCESS<br/><br/>    stepsInParallel: false<br/><br/>  - type: STOP_SERVICE<br/><br/>    name: Stop Service<br/><br/>    phaseStepNameForRollback: Deploy Service<br/><br/>    statusForRollback: SUCCESS<br/><br/>    steps:<br/><br/>    - type: COMMAND<br/><br/>      name: Stop<br/><br/>      properties:<br/><br/>        commandName: Stop<br/><br/>    stepsInParallel: false<br/><br/>  - type: DEPLOY_SERVICE<br/><br/>    name: Deploy Service<br/><br/>    phaseStepNameForRollback: Deploy Service<br/><br/>    statusForRollback: SUCCESS<br/><br/>    steps:<br/><br/>    - type: COMMAND<br/><br/>      name: Install<br/><br/>      properties:<br/><br/>        commandName: Install<br/><br/>    stepsInParallel: false<br/><br/>  - type: ENABLE_SERVICE<br/><br/>    name: Enable Service<br/><br/>    phaseStepNameForRollback: Disable Service<br/><br/>    statusForRollback: SUCCESS<br/><br/>    stepsInParallel: false<br/><br/>  - type: VERIFY_SERVICE<br/><br/>    name: Verify Service<br/><br/>    phaseStepNameForRollback: Deploy Service<br/><br/>    statusForRollback: SUCCESS<br/><br/>    stepsInParallel: false<br/><br/>  - type: WRAP_UP<br/><br/>    name: Wrap Up<br/><br/>    stepsInParallel: false<br/><br/>  provisionNodes: false<br/><br/>  serviceName: JAR-service<br/><br/>  statefulSet: false # Used by Kubernetes Workflow type only, hence false.</pre><p></p><h4>Verification Steps</h4><p>Verification Steps are used to apply Harness Continuous Verification to your deployment. Here is a Splunk Verification Step in the UI:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1548459213587/image.png"/></figure><p>Here is the YAML for the same step:</p><pre>  - type: VERIFY_SERVICE # Workflow section type.<br/><br/>    name: Verify Service # Workflow section name in UI. <br/><br/>    steps:<br/><br/>    - type: SPLUNKV2 # Verification step type.<br/><br/>      name: Splunkv2 # Verification step name in UI.<br/><br/>      properties: # Settings for the Splunk step.<br/><br/>        hostnameTemplate: ${host.hostName} # Expression for the target hostname label in JSON.<br/><br/>        analysisServerConfigId: nxaEMN00SXa0Y8X5woZCQA # Verification Provider ID.<br/><br/>        query: &#39;*exception*&#39; # Query for the term exception.<br/><br/>        analysisTolerance: MEDIUM # Algorithm Sensitivity is Moderate.<br/><br/>        comparisonStrategy: COMPARE_WITH_PREVIOUS # Baseline for risk analysis.<br/><br/>        executeWithPreviousSteps: true # Run in parallel with previous Verify Service steps.<br/><br/>        hostnameField: host # JSON label for host/container.<br/><br/>        timeDuration: &#39;15&#39; # Analysis time duration in minutes</pre><h4>Workflow Variables</h4><p>Here is an example of a Workflow variable in the UI:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1548459337229/image.png"/></figure><p>Here is the YAML for the variable:</p><pre>userVariables:<br/><br/>- type: TEXT # Type of variable. Number and email are also supported.<br/><br/>  description: My variable. # Description, but not value.<br/><br/>  fixed: true # Boolean for if the var is Fixed and will not be changed.<br/><br/>  mandatory: true # Boolean for required variable that must be used for the Workflow to deploy. <br/><br/>  name: foo # Variable name.<br/><br/>  value: bar # Variable value.</pre><h4>Common Workflow Commands</h4><p>The Workflow commands you use varies according to your Workflow and deployment type, but there are some common commands that are used by most Workflows.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1548459381537/image.png"/></figure><p>The following YAML lists examples for common commands:</p><p><strong>Barrier:</strong></p><pre>- type: BARRIER # Command type.<br/><br/>  name: Barrier # Name of command in UI.<br/><br/>  properties:<br/><br/>    identifier: deploy-checkout-and-shop # Barrier name, used by all related Barriers in other Workflows.<br/><br/>    timeoutMillis: 600000 # Timeout for Barrier waiting for other Workflow Barriers.</pre><p><strong>HTTP:</strong> You can link to or copy the HTTP command template from the Template Library. Here is the YAML for a copied HTTP template:</p><pre>- type: HTTP # HTTP command type.<br/><br/>      name: HTTP # Name of command in the UI.<br/><br/>      properties:<br/><br/>        method: GET # HTTP request method.<br/><br/>        socketTimeoutMillis: 10000 # Period to wait between packets before timing out.<br/><br/>        header: &#39;content-type: application/json&#39; # Content-Type entity header. <br/><br/>        assertion: ${httpResponseCode}==200 # HTTP response code to check for.<br/><br/>        executeWithPreviousSteps: false<br/><br/>        url: http://app.example.io # The URL for the HTTP request.</pre><p>Here is the YAML for a linked HTTP template:</p><pre>- type: HTTP # HTTP command type.<br/><br/>      name: Health Check # Name of the command in the UI.<br/><br/>      properties:<br/><br/>        method: GET # HTTP request method.<br/><br/>        socketTimeoutMillis: 10000 # Period to wait between packets before timing out.<br/><br/>        header: &#39;content-type: application/json&#39; # Content-Type entity header.<br/><br/>        assertion: ${httpResponseCode}==${ResponseCode} # HTTP response code compared to value below.<br/><br/>        executeWithPreviousSteps: false<br/><br/>        url: ${Url} # The URL variable for the HTTP request, value below.<br/><br/>      templateUri: JohnDoe/HTTP Verifications/Health Check:latest # Template location in Template Library.<br/><br/>      templateVariables: # Variables used in linked template.<br/><br/>      - name: Url # Variable name, referenced above.<br/><br/>        value: http://app.example.io # URL for variable.<br/><br/>      - name: ResponseCode # Variable name, referenced above. <br/><br/>        value: &#39;200&#39; # Response code value.</pre><p><strong>Approval:</strong></p><pre>- type: APPROVAL # Approval command type.<br/><br/>  name: Approval # Name of command in UI.<br/><br/>  properties:<br/><br/>    userGroups: <br/><br/>      - WA3Al7jsQ3a5IF-_yjsf_Q # ID of User Group for approval.<br/><br/>      timeoutMillis: 1800000 # How long to wait for approval before failing.</pre><p>Start, Stop, Install. These three common commands are grouped because their YAML is basically the same and there is little configuration in the UI or YAML.</p><pre>- type: COMMAND # Step type.<br/><br/>      name: Start # Name of command in the UI.<br/><br/>      properties:<br/><br/>        commandName: Start # Command name in Harness.<br/><br/>    - type: COMMAND # Step type.<br/><br/>      name: Stop # Name of command in the UI.<br/><br/>      properties:<br/><br/>        commandName: Stop # Command name in Harness.<br/><br/>    - type: COMMAND # Step type.<br/><br/>      name: Install # Name of command in the UI.<br/><br/>      properties:<br/><br/>        commandName: Install # Command name in Harness.</pre><p></p><p></p><h4>Triggers with Workflows</h4><p>If you rename a Workflow in Git and sync that change with Harness, Triggers are maintained because a duplicate Workflow is created.</p><h3>Pipelines</h3><p>This folder contains all Pipelines for the Application. Each Pipeline is in its own YAML file named after the Pipeline name.</p><p>Here is an example for a Pipeline named Example-Pipeline, displayed in the UI:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1548459541033/image.png"/></figure><p>It&#39;s YAML file is named Example-Pipeline.yaml:</p><pre>harnessApiVersion: &#39;1.0&#39; # Harness API version.<br/><br/>type: PIPELINE # YAML file type.<br/><br/>description: This is an example pipeline for YAML. # Pipeline description.<br/><br/>pipelineStages: # Each pipeline stage is a separate type.<br/><br/>- type: ENV_STATE # First stage, Execution Step.<br/><br/>  name: Basic-Build # Name given to stage.<br/><br/>  parallel: false # Boolean for Executed in Parallel option.<br/><br/>  workflowName: Basic-Example # Workflow executed in this stage.<br/><br/>- type: APPROVAL # Second stage, Approval Step.<br/><br/>  name: Approval 1 # Name given to stage.<br/><br/>  parallel: false<br/><br/>  properties:<br/><br/>    userGroups:<br/><br/>    - DocExample # Name of User Group for approval.<br/><br/>    timeoutMillis: 604800000 # How long to wait for approval before failing.<br/><br/>    approvalStateType: USER_GROUP # Approval requires User Group.<br/><br/>- type: ENV_STATE # Third stage, Execution Step.<br/><br/>  name: QA # Name given to stage.<br/><br/>  parallel: false<br/><br/>  workflowName: Canary-Example # Workflow executed in this stage.</pre><p></p><p></p><h4>Limitations</h4><ul><li>If you rename a Pipeline in Git and sync that change with Harness, any Triggers using that Pipeline are deleted.</li><li>If you rename a Workflow in Git and sync that change with Harness, Triggers are maintained because a duplicate that Pipeline are deleted.</li></ul><h3>Triggers</h3><div class="warning-callout">YAML-based Triggers are not enabled by default. Once enabled, Trigger YAML can be synced with Git. See <a href="/article/htvzryeqjw-configuration-as-code">Configuration as Code</a>.<br/><br/>To enable Trigger YAML, contact <a href="mailto:support@harness.io">Harness Support</a>.</div><p>This folder contains all the Triggers for the Application. Each Trigger is in its own YAML file named after the Trigger&#39;s name.</p><p>Here is an example for a Trigger named <strong>On New Artifact</strong>, displayed in the UI:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1560454481912/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Here is the YAML for the Trigger:</p><pre>harnessApiVersion: &#39;1.0&#39;<br/>type: TRIGGER<br/>artifactSelections:<br/>- regex: false<br/>  serviceName: NGINX<br/>  type: ARTIFACT_SOURCE<br/>executionName: VarExample<br/>executionType: Workflow<br/>triggerCondition:<br/>- type: NEW_ARTIFACT<br/>  artifactStreamName: harness_todolist-sample<br/>  regex: false<br/>  serviceName: Variable Examples</pre><h4>Sync YAML-based Triggers Once Enabled</h4><p>For Git-synced Harness Applications, once you have YAML-based Triggers enabled, you must sync your Application to sync your existing Triggers with your repo.</p><p>Locate your Harness Application, and click its sync button:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1588612557233/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>For details on syncing, see <a href="/article/htvzryeqjw-configuration-as-code">Configuration as Code</a>.</p><h4>Limitations</h4><ul><li>If you rename a Pipeline or Service in Git and sync that change with Harness, any Triggers using that Pipeline or Service (manifest or artifact) are deleted.</li><li>If you rename a Workflow in Git and sync that change with Harness, Triggers are maintained because a duplicate Workflow is created.</li></ul><h3>Infrastructure Provisioners</h3><p>This folder contains all Infrastructure Provisioners for the Application. Each Infrastructure Provisioner is in its own YAML file named after the Infrastructure Provisioner name.</p><p>Here is an example for a CloudFormation Infrastructure Provisioners named CF-Test, displayed in the UI:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1548459702633/image.png"/></figure><p>Here is the YAML for the CF-Test Infrastructure Provisioner:</p><pre>harnessApiVersion: &#39;1.0&#39; # Harness API version.<br/><br/>type: CLOUD_FORMATION # YAML file type.<br/><br/>description: Description for CF Provisioner.<br/><br/>mappingBlueprints: # Provisioner settings.<br/><br/>- cloudProviderType: AWS # Amazon S3 Cloud Provider.<br/><br/>  deploymentType: ECS # Amazon ECS deployment type.<br/><br/>  nodeFilteringType: AWS_ECS_EC2 # Internal Harness label.<br/><br/>  properties: # Service Mappings.<br/><br/>  - name: ecsCluster # Field label for ECS cluster. <br/><br/>    value: example # Name of ECS cluster to use.<br/><br/>  serviceName: ecs-replica # Harness Service to use.<br/><br/>name: CF-Test # Name of Infrastructure Provisioner.<br/><br/>sourceType: TEMPLATE_URL # Template reference type.<br/><br/>templateFilePath: https://s3.amazon.aws.com/path # URL of template.<br/><br/>variables: # Variables used in the template.<br/><br/>- name: foo # Variable name.<br/><br/>  valueType: TEXT # Variable type.</pre><h3>Usage Scope</h3><p>Many Harness configuration components, such as Cloud Providers, provide <strong>Usage Scope</strong> that enables you to scope the Applications and Environments that may use the component. In YAML, Usage Scope has the same YAML settings across all Cloud Providers, and so we will describe it here and ignore it when describing the specific components, such as Cloud Providers.</p><p>Here is what Usage Scope looks like in the UI, scoped to three Applications and Environments:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1548459900477/image.png"/></figure><p>Here is the same example in YAML:</p><pre>usageRestrictions: # Usage Scope section.<br/><br/>  appEnvRestrictions: # Application scopes are in this block.<br/><br/>  - appFilter:<br/><br/>      entityNames:<br/><br/>      - File-Based # Name of Application.<br/><br/>      filterType: SELECTED # Application is selected.<br/><br/>    envFilter:<br/><br/>      filterTypes:<br/><br/>      - NON_PROD # Scoped to Non-Production Environments.<br/><br/>  - appFilter:<br/><br/>      entityNames:<br/><br/>      - ECS Example # Name of Application.<br/><br/>      filterType: SELECTED<br/><br/>    envFilter:<br/><br/>      entityNames:<br/><br/>      - stage-ecs # Scoped to the Environment named stage-ecs.<br/><br/>      filterTypes:<br/><br/>      - SELECTED<br/><br/>  - appFilter:<br/><br/>      entityNames:<br/><br/>      - k8s-helm # Name of Application.<br/><br/>      filterType: SELECTED<br/><br/>    envFilter:<br/><br/>      entityNames:<br/><br/>      - gke-K8s-Helm # Scoped to the Environment named gke-K8s-Helm.<br/><br/>      filterTypes:<br/><br/>      - SELECTED</pre><h3>Cloud Providers</h3><p>This folder contains all of the Cloud Providers configured for your Harness account. Details on Cloud Providers can be found in Add Cloud Providers. Each Cloud Provider&#39;s Display Name is used to name the YAML file under this folder.</p><p>Below are YAML examples for the most common Cloud Providers.</p><h4>Amazon Web Services</h4><p>You can authenticate the connection to the AWS Cloud Provider using AWS Access Keys or by using the same IAM role used by the Harness Delegate installed in the AWS VPC. Both methods are displayed below.</p><p>Here is the YAML for an AWS Cloud Provider that uses Access Key and Secret Key credentials to authenticate the connection:</p><div class="note-callout">Just as with the Harness UI, the Harness Code Editor does not expose the AWS Secret Key. The <code>secretKey</code> setting in the AWS Cloud Provider YAML is the Harness KMS vault record Harness uses to encrypt and decrypt the Secret Key you provide.</div><pre>harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: AWS # The CLoud Provider type.<br/><br/>accessKey: AKIAI36JN2OJAO7TBKQQ # The AWS Access Key used for credentials.<br/><br/>secretKey: amazonkms:z4d1c57FRKuMkCkSHEG3oQ # Secret Key record from KMS vault.<br/><br/>...<br/><br/>useEc2IamCredentials: false # The Assume IAM Role on Delegate option is not enabled.</pre><p>When the <strong>Assume IAM Role on Delegate</strong> option has been selected and authentication is performed using the IAM role used by the Delegate, the <code>useEc2IamCredentials</code> value is true and the Delegate tag used it listed:</p><pre>...<br/><br/>tag: AWS-Delegate # Delegate Tag used to select the Delegate.<br/><br/>useEc2IamCredentials: true</pre><p>You will still see a <code>secretKey</code> placeholder label, but it not used.</p><h4>Google Cloud Platform</h4><p>The Google Cloud Platform Cloud Provider is authenticated using an account service key file, that Harness encrypts in the Harness KMS vault, or the vault of your choice. Here is the YAML for a Google Cloud Platform Cloud Provider.</p><pre>harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: GCP # Cloud Provider type.<br/><br/>serviceAccountKeyFileContent: amazonkms:WU6O9p_cTu2WHCtddJuqlQ # Secret file record from KMS vault.</pre><h4>Physical Data Center</h4><p>Authentication for the Physical Data Center Cloud Provider is done using networking information when the Cloud Provider is used in an Infrastructure Definition. As a result, the YAML is brief:</p><pre>harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: PHYSICAL_DATA_CENTER # The Cloud provider type.</pre><h4>Kubernetes Cluster</h4><p>The Kubernetes Cluster Cloud Provider can be authenticated using the Inherit Cluster Details from selected Delegate option or manually.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1548460191867/image.png"/></figure><p>Below is the YAML for a Kubernetes Cluster Cloud Provider authenticated using the <strong>Inherit Cluster Details from selected Delegate</strong> option. Although it does not use manual authentication (the <strong>Enter Cluster Details manually</strong> option), there are placeholders for the manual authentication values, and they are also commented on below:</p><pre>type: KUBERNETES_CLUSTER # The Cloud Provider type.<br/><br/>caCert: safeharness:aKFQ61NHS-KwxkgcUi7nJw # Certificate authority root certificate. <br/><br/>clientCert: safeharness:Av_sfbl9S6WLp8_xUB7k9A # Client certificate for the cluster.<br/><br/>clientKey: safeharness:OUCICHVIRii-Y-aasf24eA # Key for the client certificate.<br/><br/>clientKeyPassphrase: safeharness:VxxFpo5gRxSC-5_n6c-9zA # Client key passphrase encrypted by Harness.<br/><br/>delegateName: harness-demo # Delegate Tag used to select the Delegate.<br/><br/>password: amazonkms:xxxxxxxxxxxxxxxxxx # Basic auth password in KMS vault.<br/><br/>skipValidation: false # Skip Validation option not selected.<br/><br/>...<br/><br/>useKubernetesDelegate: true # Inherit creds from Delegate option selected.<br/><br/>username: johndoe@harness.io # Username and password for the Kubernetes cluster.</pre><h4>Microsoft Azure</h4><p>The Microsoft Azure Cloud Provider authentication is performed using application, client, and project information.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1548460283929/image.png"/></figure><p>Here is the YAML for a Microsoft Azure Cloud Provider:</p><pre>harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: AZURE # The Cloud Provider type.<br/><br/>clientId: 2d0ae000-e0dd-0000-97f8-f6ae330abf82 # Client/Application ID for the Azure app registration.<br/><br/>key: amazonkms:CvfInvfkl2mjeFuUJ-xB7l # Authentication key for application.<br/><br/>tenantId: c279b8cb-5e93-4k12-bse4-730dfd74e906 # ID of the Azure Active Directory (AAD).</pre><h4>Pivotal Cloud Foundry</h4><p>You authenticate a PCF Cloud Provider using a PCF user account with Admin, Org Manager, or Space Manager role.</p><p>Here is the YAML for a PCF Cloud Provider:</p><pre>harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: PCF  # Cloud Provider type.<br/><br/>endpointUrl: api.run.pivotal.io # API endpoint URL.<br/><br/>password: amazonkms:xxxxxxxxxxxxxxxxxx # Password for the PCF account.<br/><br/>...<br/><br/>username: johndoe@harness.io # Username for the PCF account.</pre><h3>Artifact Servers</h3><p>Artifact Servers are configured using the URL of the Artifact Server and authenticated using accounts or tokens.</p><div class="note-callout">Amazon AWS and Google Cloud Platform are added to Harness as Cloud Providers, but they may also be used as Artifact Servers.</div><h4>Jenkins</h4><p>Jenkins is configured using the URL of Jenkins server and either a Username and Password/Jenkins API token or a Bearer Token (HTTP Header).</p><p>Here is the YAML for the Jenkins Artifact Server:</p><pre>harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: JENKINS # The Artifact Server type.<br/><br/>authMechanism: UserName/Password # The authentication option selected.<br/><br/>password: amazonkms:xxxxxxxxxxxxxxxxxx # Password entry in KMS vault.<br/><br/>token: safeharness:xxxxxxxxxxxxxxxxxx # Token encrypted by Harness.<br/><br/>url: https://jenkinsint.harness.io # Jenkins server URL.<br/><br/>username: wingsbuild # Username for Jenkins account.</pre><h4>Bamboo</h4><p>Bamboo Artifact Servers are configured using the Bamboo server URL and authenticated using a Bamboo user account.</p><p>Here is the YAML for a Bamboo Artifact Server:</p><pre>harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: BAMBOO # The Artifact Server type.<br/><br/>password: amazonkms:xxxxxxxxxxxxxxxxxx # Password entry in KMS vault.<br/><br/>url: http://ec2-18-000-00-000.compute-1.amazonaws.com:8085 # Bamboo server URL.<br/><br/>username: wingsbuild # Bamboo account username.</pre><h4>Docker Registry</h4><p>Docker Registry Artifact Servers are configured using the Docker Registry server URL and authenticated using a Docker Registry user account.</p><p>Here is the YAML for a Docker Registry Artifact Server:</p><pre>harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: DOCKER # The Artifact Server type.<br/><br/>password: amazonkms:xxxxxxxxxxxxxxxxxx # Password entry in KMS vault.<br/><br/>url: https://registry.hub.docker.com/v2/ # Docker Registry URL.<br/><br/>username: johndoe # Docker Registry account username.</pre><h4>Nexus</h4><p>Nexus Artifact Servers are configured using the Nexus server URL and authenticated using a Nexus user account.</p><p>Here is the YAML for a Nexus Artifact Server:</p><pre>harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: NEXUS # The Artifact Server type.<br/><br/>password: amazonkms:xxxxxxxxxxxxxxxxxx # Password entry in KMS vault.<br/><br/>url: https://nexus2.harness.io # Nexus server URL.<br/><br/>username: admin # Nexus account username.</pre><h4>Artifactory</h4><p>Artifactory Artifact Servers are configured using the Artifactory server URL and authenticated using a Artifactory user account.</p><p>Here is the YAML for a Artifactory Artifact Server:</p><pre>harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: ARTIFACTORY  # The Artifact Server type.<br/><br/>password: safeharness:xxxxxxxxxxxxxxxxxx # Password entry in KMS vault.<br/><br/>url: https://harness.jfrog.io/harness # Artifactory server URL.<br/><br/>username: admin # Artifactory account username.</pre><h4>SMB</h4><p>SMB Servers are configured using the SMB server URL and authenticated using a user account.</p><p>YAML for the SMB Artifact Server is under development.</p><h4>SFTP</h4><p>SFTP Artifact Servers are configured using the SFTP server URL and authenticated using a SFTP user account.</p><p>YAML for the SFTP Artifact Server is under development.</p><h3>Collaboration Providers</h3><p>This folder contains all of the Collaboration Providers configured for your Harness account. Details on Collaboration Providers can be found in <a href="/article/cv98scx8pj-collaboration-providers">Add Collaboration Providers</a>. Each Collaboration Provider&#39;s <strong>Display Name</strong> is used to name the YAML file under this folder.</p><p>Collaboration Providers are configured using the URL of the Collaboration Providers and authenticated using accounts or tokens.</p><h4>SMTP</h4><p>To connect to the SMTP Collaboration Provider, Harness uses a SMTP host address and port number, along with a username and password for the SMTP account. Here is the YAML for a SMTP Collaboration Provider:</p><pre>harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: SMTP # The Collaboration Provider type.<br/><br/>fromAddress: noreply@harness.io # The email address to show when sending emails.<br/><br/>host: smtp.sendgrid.net # SMTP server.<br/><br/>password: amazonkms:xxxxxxxxxxxxxxxxxx # Password entry in KMS vault.<br/><br/>port: 465 # SMTP port. You can use 25, 465, 587.<br/><br/>useSSL: true # Connection is made over TLS.<br/><br/>username: johndoe # Username for the SMTP account.</pre><h4>Slack</h4><p>The Slack Collaboration Provider uses a Slack Webhook URL to connect to Slack. Here is the YAML for a Slack Collaboration Provider:</p><pre>harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: SLACK # The Collaboration Provider type.<br/><br/>outgoingWebhookUrl: https://hooks.slack.com/services/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 # Slack-generated Webhook URL</pre><h3>Verification Providers</h3><p>Verification Providers are added using the URL of the Verification Provider API server, and account credentials such as username/password or API and application keys. We&#39;ll look at two examples, AppDynamics and New Relic.</p><p>AppDynamics uses a username and password to authenticate the connection.</p><pre>harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: APP_DYNAMICS # The Verification Provider type.<br/><br/>accountName: harness-test # The AppDynamics account.<br/><br/>controllerUrl: https://harness-test.saas.appdynamics.com/controller # AppD Controller URL.<br/><br/>password: amazonkms:xxxxxx-xxxxx # User password entry in KMS vault.<br/><br/>username: john@harness.io # Username for AppD account.</pre><p>New Relic uses an API key and, optionally, an account key to authenticate the connection.</p><pre>harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: NEW_RELIC # The Verification Provider type.<br/><br/>apiKey: amazonkms:xxxxxx-xxxxx # API key entry in KMS vault.</pre><h3>Notification Groups</h3><p>Notification Groups simply use email addresses and Slack channels to notify people when a Workflow is complete as part of the Workflow Notification Strategy. Each Notification Group you create is given its own YAML file named using the Display Name in the UI.</p><p>Here is a sample Notification Group in the UI:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1548460725742/image.png"/></figure><p>Here is the YAML for that Notification Group:</p><pre>harnessApiVersion: &#39;1.0&#39; # The Harness API version number.<br/><br/>type: NOTIFICATION_GROUP # The file type.<br/><br/>addresses:<br/><br/>- addresses:<br/><br/>  - channel1 # Slack channel.<br/><br/>  channelType: SLACK # Channel type.<br/><br/>- addresses:<br/><br/>  - john@harness.io # Email address.<br/><br/>  channelType: EMAIL # Channel type.<br/><br/>defaultNotificationGroupForAccount: &#39;false&#39; # Boolean for whether the group is the default.</pre><h3>Source Repo Providers</h3><p>Harness Source Repo Providers connect your Harness account with your Git platform accounts to synchronize your Harness account and Applications and pull important files, such as Helm charts, Kubernetes manifests, and Terraform scripts.</p><p>The <code>password</code> label contains the path to the secret in the Secret Manager you have set up and used in Harness.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/21kgaw4h86/1591737159424/image.png"/></figure><h3>YAML and JSON in Harness Manager</h3><p>Harness uses YAML as the code for configuration, but wherever your deployment environment uses JSON, you can enter it in Harness. For example, AWS ECS uses JSON for configuration, and so when configuring ECS in Harness, the Harness settings are configured using YAML, but the ECS settings are configured using JSON. This way, you can easily leverage your existing JSON from your environments.</p>
  slug: harness-yaml-code-reference
  tags:
  - YAML
  - Secrets management
  - Vault
  - index.yaml
  - Defaults.yaml
  - Install.yaml
  - barrier
  - HTTP
  - approval
  - Usage Scope
  is_live: true
