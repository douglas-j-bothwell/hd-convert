type: article
article_id: 4n3595l6in
user_id: wz6xkfcc9i
category_id: ll7h8ktlwe
author:
  name: Chakravarthy Tenneti
  profile_image: https://www.gravatar.com/avatar/790db061bb8f8fb094e4d4b19a390f3b?d=mm&s=150
title: Add Microsoft Azure Cloud Provider
slug: add-microsoft-azure-cloud-provider
description: Connect the Microsoft Azure cloud provider where you will deploy your
  services using Harness.
short_version: Connect the Microsoft Azure cloud provider where you will deploy your
  services using Harness.
tags:
- Microsoft Azure
- Azure
- Cloud Provider
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: ""
  source: API
  triggered_at: 2022-07-06T19:01:47.971329Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Add Microsoft Azure Cloud Provider
  description: Connect the Microsoft Azure cloud provider where you will deploy your
    services using Harness.
  short_version: Connect the Microsoft Azure cloud provider where you will deploy
    your services using Harness.
  body: '<p>This topic explains how to connect to the Microsoft Azure cloud where
    you will deploy your applications or virtual machine scale set (VMSS) using Harness.</p><p>You
    add Cloud Providers to your Harness Account and then reference them when defining
    deployment environments.</p><p>In this topic:</p><ul><li><a href="#before_you_begin">Before
    You Begin</a></li><li><a href="#visual_summary">Visual Summary</a></li><li><a
    href="https://docs.harness.io/article/4n3595l6in-add-microsoft-azure-cloud-provider#review_permissions">Review:
    Permissions</a></li><li><a href="#step_1_add_the_cloud_provider">Step 1: Add the
    Cloud Provider</a></li><li><a href="#step_2_gather_the_required_information">Step
    2: Gather the Required Information</a></li><li><a href="#step_3_client_id">Step
    3: Client ID</a></li><li><a href="#step_4_tenant_id">Step 4: Tenant ID</a></li><li><a
    href="#step_5_select_encrypted_key">Step 5: Select Encrypted Key</a></li><li><a
    href="https://docs.harness.io/article/4n3595l6in-add-microsoft-azure-cloud-provider#artifact_support_for_download_and_copy">Artifact
    Support for Download and Copy</a></li></ul><h3>Before You Begin</h3><ul><li>See <a
    href="/article/4o7oqwih6h-harness-key-concepts">Harness Key Concepts</a>.</li></ul><p></p><h3>Visual
    Summary</h3><p>Here&#39;s an overview of the Microsoft Azure Cloud Provider settings.</p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/whwnovprrb/1587759421405/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><p></p><h3>Review:
    Permissions</h3><p>This section assume you are familiar with Azure RBAC.</p><p>For
    security reasons, Harness uses an application object and service principal rather
    than a user identity. The process is described in <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal"
    target="_blank">How to: Use the portal to create an Azure AD application and service
    principal that can access resources</a> from Azure.</p><p>Briefly, the process
    is:</p><ol><li>Register an application with Azure AD and create a service principal.</li><li>Assign
    a role to the Azure application.<br/>You assign the role depending on the scope
    you want to use (Azure subscription or resource group). Typically, an Azure subscription
    is used.<br/>You use the scope to assign a role to the Azure application.<br/>The
    role you assign depends on which Azure resource Harness will use (ACR, AKS, etc).
    See the list below these steps.<br/>You will use the same scope on the resource
    Harness will use. For example, your ACR container registry will use the same Azure
    subscription that you used to assign a role to the Azure application.</li><li>Get
    the application&#39;s tenant and app/client ID values for signing in.</li><li>Create
    a new application secret.</li><li>Use the tenant ID, app/client ID, and new application
    secret in the Harness Azure Cloud Provider.</li></ol><p>Make sure the following
    permissions are assigned to the roles.</p><h4>Azure Container Repository (ACR)</h4><div
    class="note-callout">Currently, Harness supports <strong>public</strong> ACR repos.
    Harness will be supporting private repos soon. Contact <a href="https://harness.io/contact-sales"
    target="_blank">Harness Sales</a> for more information.</div><p>The <strong>Reader</strong>
    role must be assigned. <strong>This is the minimum requirement.</strong></p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/4n3595l6in/1618946221348/image.png"/></figure><p>You
    must provide the <strong>Reader</strong> role in the role assignment at the <strong>Subscription</strong>
    level used by the Application ID entered in the Cloud Provider. The application
    needs permission to list <strong>all</strong> container registries.</p><p>Some
    common mistakes:</p><ul><li>If you put the Reader role in a different IAM section
    of Azure.</li><li>If you provide only the <strong>AcrPull</strong> role instead
    of <strong>Reader</strong>. It might appear that the AcrPull role gives access
    to a specific registry, but Harness needs to list <strong>all</strong> registries.</li></ul><div
    class="note-callout">Harness supports 500 images from an ACR repo. If you do not
    see some of your images you might have exceeded this limit. This is the result
    of an Azure API limitation.<br/><br/>If you connect to an ACR repo via the platform
    agnostic <a href="/article/tdj2ghkqb0-add-docker-registry-artifact-servers">Docker
    Registry</a>, the limit is 100.</div><h4>Azure Kubernetes Services (AKS)</h4><p>There
    are two options for connecting Harness to your target AKS cluster:</p><ul><li><strong>Recommend:</strong>
    Install a <a href="/article/0hn6vdpeqz-install-kubernetes-delegate">Kubernetes
    Delegate</a> in the target AKS cluster and use it for authentication in a Harness
    <a href="/article/l68rujg6mp-add-kubernetes-cluster-cloud-provider">Kubernetes
    Cluster Cloud Provider</a>. The Harness Kubernetes Cluster Cloud Provider is platform-agnostic.<br/>With
    this method, AKS permissions are not required at all. This is recommended.</li><li>As
    an alternative, use the Harness Azure Cloud Provider as described in this topic.
    The <strong>Owner</strong> role must be assigned.</li></ul><h4>Azure Web Apps</h4><p>The
    <strong>Contributor</strong> role must be assigned. This is the minimum requirement.</p><h4>Azure
    Virtual Machines for IIS and SSH Deployments</h4><p>The <strong>Reader</strong>
    role must be assigned. This is the minimum requirement.</p><p>This role is only
    used by the Harness Delegate when it uses the Azure APIs to discover target VMs.</p><p>For
    IIS deployments, Harness uses a WinRM connection for credentials. See <a href="/article/9fqa1vgar7-add-win-rm-connection-credentials">Add
    WinRM Connection Credentials</a>.</p><p>For SSH deployments, Harness uses SSH
    keys for credentials. See <a href="/article/gsp4s7abgc-add-ssh-keys">Add SSH Keys</a>.</p><h4>Azure
    Resource Management (ARM)</h4><p></p><div class="note-callout">Currently, this
    feature is behind a Feature Flag. Contact <a href="mailto:support@harness.io"
    target="_blank">Harness Support</a> to enable the feature. Feature Flags can only
    be removed for Harness Professional and Essentials editions. Once the feature
    is released to a general audience, it is available for Trial and Community Editions.</div><p></p><p>The
    roles required depend on the scope type of your ARM template:</p><ul><li><strong>Resource
    group:</strong> requires the <strong>Contributor</strong> role.</li><li><strong>Subscription:</strong>
    requires the <strong>Contributor</strong> role.</li><li><strong>Management group:</strong>
    requires the <strong>Contributor</strong> role.</li><li><strong>Tenant:</strong>
    requires the <strong>Contributor</strong> or <strong>Owner</strong> role. For
    example, creating a Tenant requires the <strong>Contributor</strong> role, but
    the <strong>Owner</strong> role is required to create role assignments.</li><li><strong>Key
    Vault access:</strong> to enable access to Key Vaults from the ARM templates you
    use in Harness, make sure you select the <strong>Azure Resource Manager for template
    deployment</strong> option in the Key Vault Access Policy.</li></ul><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/qhnnq1mks3/1615404158395/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><div
    class="note-callout">The Azure roles provided in the Cloud Provider must allow
    Harness to provision the Azure resources in your ARM templates. For example, to
    create a policy assignment, the <strong>Resource Policy Contributor</strong> role
    is required.</div><h4>Azure Blueprint</h4><p></p><div class="note-callout">Currently,
    this feature is behind a Feature Flag. Contact <a href="mailto:support@harness.io"
    target="_blank">Harness Support</a> to enable the feature. Feature Flags can only
    be removed for Harness Professional and Essentials editions. Once the feature
    is released to a general audience, it is available for Trial and Community Editions.</div><p>In
    Azure, the permissions required to create and delete Blueprints are listed in
    <a href="https://docs.microsoft.com/en-us/azure/governance/blueprints/overview#permissions-in-azure-blueprints"
    target="_blank">Permissions in Azure Blueprints</a> from Azure.</p><p>The Azure
    roles required on the service principal used by Harness depend on the scope type
    of your Blueprint definition.</p><h5>Management Scope</h5><ul><li><strong>System-assigned
    managed identity:</strong><ul><li><strong>Contributor</strong> role at the management
    group scope where the Blueprint definitions will be created and published</li><li><strong>Owner</strong>
    role at subscription scope where the assignment will be done.</li></ul></li><li><strong>System-assigned
    user identity:</strong><ul><li><strong>Contribute</strong> role at the management
    group scope where Blueprint definitions will be created and published<br/>Harness
    does not manage the right and lifecycle of a user-managed identity. You will need
    to manage the user-managed identity.</li></ul></li></ul><h5>Subscription Scope</h5><ul><li><strong>System-assigned
    managed identity:</strong><ul><li><strong>Owner</strong> role at the subscription
    scope.</li></ul></li><li><strong>System-assigned user identity:</strong><ul><li><strong>Contribute</strong>
    role to create and publish the Blueprint definition.<br/>Harness does not manage
    the right and lifecycle of a user-managed identity. You are responsible for managing
    the right and lifecycle of a user-managed identity that is in charge of assignment.</li></ul></li></ul><h3>Step
    1: Add the Cloud Provider</h3><p>To add a cloud provider to your Harness account,
    do the following:</p><ol><li>Click <strong>Setup</strong>, and then click <strong>Cloud
    Providers</strong>.</li><li>Click <strong>Add Cloud Provider</strong> and select
    <strong>Microsoft Azure</strong>.</li></ol><p>The <strong>Add Microsoft Azure
    Cloud Provider</strong> panel appears.</p><h3>Step 2: Gather the Required Information</h3><p>In
    Microsoft Azure, you can find the information you need in the App registration
    <strong>Overview</strong> page:</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1567028367061/image.png"/></figure><p></p><h3>Step
    3: Client ID</h3><p>This is the <strong>Client/</strong><strong>Application ID</strong>
    for the Azure app registration you are using. It is found in the Azure Active
    Directory <strong>App registrations</strong>. For more information, see <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-v1-add-azure-ad-app"
    target="_blank">Quickstart: Register an app with the Azure Active Directory v1.0
    endpoint</a> from Microsoft.</p><p>To access resources in your Azure subscription,
    you must assign the Azure App registration using this Client ID to a role in that
    subscription. Later, when you set up an Azure service infrastructure in a Harness
    environment, you will select a subscription.</p><p>If the Azure App registration
    using this Client ID is not assigned a role in a subscription, no subscriptions
    will be available.</p><p>For more information, see <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal#assign-the-application-to-a-role"
    target="_blank">Assign the application to a role</a> and <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal"
    target="_blank">Use the portal to create an Azure AD application and service principal
    that can access resources</a> from Microsoft.</p><h3>Step 4: Tenant ID</h3><p>The
    <strong>Tenant ID</strong> is the ID of the Azure Active Directory (AAD) in which
    you created your application. This is also called the <strong>Directory ID</strong>.
    For more information, see <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-create-service-principal-portal#get-tenant-id"
    target="_blank">Get tenant ID</a> and <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal"
    target="_blank">Use the portal to create an Azure AD application and service principal
    that can access resources</a> from Azure.</p><h3>Step 5: Select Encrypted Key</h3><div
    class="note-callout">For secrets and other sensitive settings, select or create
    a new <a href="/article/ygyvp998mu-use-encrypted-text-secrets">Harness Encrypted
    Text secret</a>.</div><p>This is the authentication key for your application.
    This is found in <strong>Azure Active Directory</strong>, <strong>App Registrations</strong>.
    Click the App name. Click <strong>Certificates &amp; secrets</strong>, and then
    click <strong>New client secret</strong>.</p><p></p><figure><a href="https://files.helpdocs.io/kw8ldg1itf/other/1567028538937/image.png"><img
    src="https://files.helpdocs.io/kw8ldg1itf/other/1567028538937/image.png" style="max-height:50%;max-width:50%"
    data-hd-height="50%" data-hd-width="50%"/></a></figure><p>You cannot view existing
    secret values, but you can create a new key. For more information, see <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal#create-a-new-application-secret"
    target="_blank">Create a new application secret</a> from Azure.</p><h3>Artifact
    Support for Download and Copy</h3><p>See <a href="/article/qluiky79j8-service-types-and-artifact-sources">Service
    Types and Artifact Sources</a>.</p>'
  slug: add-microsoft-azure-cloud-provider
  tags:
  - Microsoft Azure
  - Azure
  - Cloud Provider
  is_live: true
