type: article
article_id: 0hn6vdpeqz
user_id: mfr0nxh4be
category_id: gyd73rp7np
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Install the Harness Kubernetes Delegate
slug: install-kubernetes-delegate
description: The Harness Delegate is a service you run in your deployment target environment,
  such as your local network, VPC, or cluster. The Delegate connects all of your artifact,
  infrastructure, collaboration…
short_version: The Harness Delegate is a service you run in your deployment target
  environment, such as your local network, VPC, or cluster. The Delegate connects
  all of your artifact, infrastructure, collaboration…
tags: []
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: ""
  source: API
  triggered_at: 2022-07-12T17:40:38.338676Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Install the Harness Kubernetes Delegate
  description: ""
  short_version: ""
  body: '<p>The Harness Delegate is a service you run in your deployment target environment,
    such as your local network, VPC, or cluster. The Delegate connects all of your
    artifact, infrastructure, collaboration, verification and other providers with
    the Harness Manager.</p><p>Most importantly, the Delegate performs all deployment
    operations.</p><p>There are several types of Delegates. This topic describes how
    to install the Kubernetes Delegate.</p><div class="note-callout">If you want to
    run multiple Delegates on the same or different clusters, see <a href="/article/up3w9d8zd0-automate-harness-kubernetes-delegate-setup">Automate
    Harness Kubernetes Delegate Setup</a>.</div><h3>Before You Begin</h3><ul><li>
    <a href="/article/4o7oqwih6h-harness-key-concepts">Harness Key Concepts</a></li><li>
    <a href="/article/h9tkwmkrm7-delegate-installation">Harness Delegate Overview</a></li><li>
    <a href="/article/lwynqsgxt9-delegate-requirements-and-limitations">Delegate Requirements
    and Limitations</a></li></ul><h3>Limitations</h3><p>Currently, Harness Kubernetes
    Delegates do not install with the default settings in GKE Auto Pilot Mode. Please
    use the Manual mode when creating the cluster to make sure it meets the Delegate
    requirements.</p><h3>Visual Summary</h3><p>The following diagram shows how the
    Delegate enables Harness to integrate with all of your deployment resources:</p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/8o4cwqj1kv/1596840107816/image.png"/></figure><h3>Step
    1: Download the Kubernetes Delegate</h3><ol><li>Log into Harness.</li><li>In the
    Harness Manager, click <strong>Setup</strong>, and then click <strong>Harness
    Delegates</strong>.</li><li>In the <strong>Delegate</strong> tab, click <strong>Install
    Delegate</strong>.</li><li>In <strong>Download Type</strong>, select <strong>Kubernetes
    YAML</strong>.</li><li>In <strong>Name</strong>, enter a name for your Delegate.</li><li>In
    <strong>Profile</strong>, select a Delegate Profile. See <a href="/article/yd4bs0pltf-run-scripts-on-the-delegate-using-profiles">Run
    Scripts on the Delegate using Profiles</a>.</li></ol><div class="note-callout">A
    Delegate Profile is mandatory. The <strong>Primary</strong> Profile is the default
    and contains no script. You can add a script to it, or create and apply new Profiles
    for your Delegate.</div><ol><li style="counter-increment:li 7" start="8">Click
    <strong>Download</strong> or <strong>Copy Download Link</strong>.</li></ol><h3>Step
    2: Apply the Delegate Spec</h3><ol><li style="counter-increment:li 0" start="1">Ensure
    the host where you run the Delegate meets the <a href="/article/lwynqsgxt9-delegate-requirements-and-limitations">Delegate
    Requirements and Limitations</a>.</li><li>Open a terminal and navigate to where
    the Delegate file is located.</li><li>If you downloaded the Delegate, extract
    the YAML file&#39;s folder from the download and then navigate to the <strong>harness-delegate-kubernetes</strong> folder
    that you extracted:</li></ol><pre>tar -zxvf harness-delegate-kubernetes.tar.gz<br/><br/>cd
    harness-delegate-kubernetes</pre><p>You will connect to your cluster using the
    terminal so you can simply copy the YAML file over.</p><ol><li style="counter-increment:li
    3" start="4">Log into your Kubernetes cluster.</li><li>Let&#39;s quickly confirm
    that the cluster you created can connect to the Harness platform. Enter the following
    command:<pre class="hljs nginx">wget -p https://app.harness.io/ -O /dev/null</pre>A
    successful connection will display the following:<pre class="hljs nginx">HTTP
    request sent, awaiting response... 200 OK</pre></li><li>Next, install the Harness
    Delegate using the <strong>harness-delegate.yaml</strong> file you just downloaded.
    In the terminal connected to your cluster, run this command:<pre class="hljs cs">kubectl
    apply -f harness-delegate.yaml</pre>If you are not using your terminal to connect
    to your cluster, just copy the <strong>harness-delegate.yaml</strong> file to
    the cluster and run the command.</li><li>Run this command to verify that the Delegate
    pod was created:<pre class="hljs cs">kubectl get pods -n harness-delegate</pre>It
    will take a moment for the Delegate to appear in <strong>Harness Delegates</strong> page.</li></ol><p>The
    <strong>Delegates</strong> page provides a list of installed Delegates. The information
    displayed includes:</p><ul><li>Hostname.</li><li>IP Address.</li><li>Status.</li><li>Last
    heartbeat. This is the last time the Delegate communicated with the Harness Manager.
    The Delegate pings the Manager once per minute.</li><li>Available Versions</li><li>
    <a href="/article/c3fvixpgsl-select-delegates-for-specific-tasks-with-selectors">Selectors</a></li><li>
    <a href="/article/yd4bs0pltf-run-scripts-on-the-delegate-using-profiles">Profiles</a></li><li>
    <a href="/article/hw56f9nz7q-scope-delegates-to-harness-components-and-commands">Scopes</a></li></ul><p>Now
    you&#39;re ready to connect Harness to your artifact servers, clusters, and so
    on.</p><div class="note-callout">When you onboard your own applications, you might
    need to install multiple Delegates, depending on their workloads, network segmentation,
    and firewall zones. Typically, you will need one Delegate for every 300-500 service
    instances across your applications, and will need one Delegate in each subnet
    or zone.</div><h3>Installation Example: Google Cloud Platform</h3><p>The following
    steps describe how to install the Kubernetes Delegate in a Kubernetes cluster
    in Google Cloud Platform. The steps assume you have Google Cloud SDK installed,
    as it is used to execute gcloud command-line commands. For more information on
    installing the Google Cloud SDK, see <a href="https://cloud.google.com/sdk/docs/#install_the_latest_cloud_sdk_version"
    target="_blank">Install the Latest Cloud SDK version</a> from Google.</p><div
    class="note-callout">A Kubernetes cluster in Google Cloud Platform has a variety
    of settings that are different from other vendors. For example, when creating
    your cluster in Google Cloud Platform, you might need to add more or less CPUs
    or RAM to your nodes than you would with another cloud vendor or an Internal cluster.</div><ol><li>Sign
    up for a <a href="https://cloud.google.com/free/?gclid=EAIaIQobChMI7q3r8Krr3gIVvh-tBh2F0AOuEAAYASABEgLMI_D_BwE"
    target="_blank">free tier Google Cloud Platform account</a>.</li><li>In Google
    Cloud Platform, create a Kubernetes cluster.<ol><li>In <strong>Kubernetes Engine</strong>,
    click <strong>CREATE CLUSTER</strong>.</li><li>Click <strong>My first cluster</strong>.</li><li>Click
    <strong>CUSTOMIZE</strong>.</li><li>Enter the following:<br/><strong>Name:</strong>
    Enter the name for the cluster.<br/><strong>Zone:</strong> Select the default
    Compute Engine compute zone, as the location type is Zonal.</li><li>Click <strong>NEXT</strong>.</li><li>In
    <strong>Set release channel</strong>, click <strong>NEXT</strong>.</li><li>In
    <strong>Choose low-cost resources</strong>, in <strong>Machine Configuration</strong>,
    enter the following:<br/><strong>Machine family:</strong> GENERAL-PURPOSE.<br/><strong>Series:</strong>
    N1.<br/><strong>Machine type:</strong> n1-standard-4 (4 vCPU, 15 GB memory)</li><li>Select
    <strong>Enable autoscaling</strong>, and enter the following:<br/><strong>Minimum
    number of nodes:</strong> 3<br/><strong>Maximum number of nodes:</strong> 8</li><li>Click
    <strong>NEXT</strong>.<br/>The settings will look something like this:<figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/0hn6vdpeqz/1603227794423/image.png"/></figure></li><li>Click
    <strong>Create</strong> to create the cluster. It will take a few minutes to create
    the Kubernetes cluster.</li></ol></li><li>When the cluster is created, click the
    <strong>Connect</strong> button.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/h9tkwmkrm7/1542995949723/image.png"/></figure></li><li>In
    the <strong>Connect to the cluster</strong> dialog, copy the <strong>Command-line
    access</strong> command.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/h9tkwmkrm7/1542996065180/image.png"/></figure></li><li>On
    your local machine, open a Terminal, and paste the command, and press <strong>Enter</strong>.
    You are now connected to the Kubernetes cluster.<br/><br/>By default, your cluster
    should be able to connect to the Internet. If you run into errors, ensure the
    GCE firewall isn’t blocking port 22 to your VMs. For more information, see <a
    href="https://kubernetes.io/docs/tasks/debug/debug-application/debug-running-pod/"
    target="_blank">Debug Running Pods</a> from Kubernetes.<ol><li>Let&#39;s quickly
    confirm that the cluster you created can connect to the Harness platform. Enter
    the following command:<br/><br/><code>wget -p https://app.harness.io/ -O /dev/null</code><br/>A
    successful connection will display the following output:<br/><code>Resolving app.harness.io
    (app.harness.io)... 35.197.53.196</code><br/><code>Connecting to app.harness.io
    (app.harness.io)|35.197.53.196|:443... connected.</code><br/><code>HTTP request
    sent, awaiting response... 200 OK</code></li></ol></li><li>Download the Kubernetes
    Delegate from Harness as described above.</li><li>Install the Delegate in your
    cluster:<ol><li>In the <strong>Terminal</strong> you used to connect to the Kubernetes
    cluster, navigate to the folder where you downloaded the Harness Delegate YAML
    file.<br/>For example, <code>cd ~/Downloads</code>.</li><li>Extract the YAML file:
    <code>tar -zxvf harness-delegate-kubernetes.tar.gz</code>.</li><li>Navigate to
    the <strong>harness-delegate</strong> folder that was created:<br/><code>cd harness-delegate-kubernetes</code></li><li>Paste
    the following installation command into the Terminal and press enter:<br/><code>kubectl
    apply -f harness-delegate.yaml</code><br/>You will see the following output (this
    delegate is named <strong>k8s-test</strong>):<br/><code>namespace/harness-delegate
    created</code><br/><code>clusterrolebinding.rbac.authorization.k8s.io/harness-delegate-cluster-admin
    created</code><br/><code>statefulset.apps/k8s-test-vutpmk created</code></li><li>Run
    this command to verify that the Delegate pod was created:<br/><code>kubectl get
    pods -n harness-delegate</code><br/><br/>You will see output with the status <strong>Pending</strong>.
    The <strong>Pending</strong> status simply means that the cluster is still loading
    the pod.</li></ol></li><li>Wait a few moments for the cluster to finish loading
    the pod and for the Delegate to connect to Harness Manager.</li><li>In <strong>Harness
    Manager</strong>, in the <strong>Harness Delegates</strong> page, the new Delegate
    will appear. You can refresh the page if you like.</li></ol><div class="note-callout">StatefulSets
    is used for the the Kubernetes Delegate to ensure the same pod name is used each
    time a pod is scheduled.</div><p>You can also open a shell session to a Delegate
    pod using the following command:</p><p><code>kubectl exec -n harness-delegate
    &lt;pod_name&gt; -it -- /bin/bash</code></p><p></p><h3>See Also</h3><ul><li>For
    all the topics related to the Harness Delegate, see <a href="/category/gyd73rp7np-manage-delegates">Manage
    Harness Delegates</a>.</li><li>Delegate are used to provide credentials for some
    Harness <a href="/article/whwnovprrb-cloud-providers">Cloud Providers</a>.</li></ul><p></p>'
  slug: install-kubernetes-delegate
  tags: []
  is_live: true
