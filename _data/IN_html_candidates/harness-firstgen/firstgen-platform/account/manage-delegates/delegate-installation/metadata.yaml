type: article
article_id: h9tkwmkrm7
user_id: mfr0nxh4be
category_id: gyd73rp7np
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Harness Delegate Overview
slug: delegate-installation
description: Covers Harness Delegate installation, requirements, tags, proxy settings,
  scope, availability, and task assignments. Also covers Delegate Profiles and secrets
  management.
short_version: Installing the Harness Delegate is the first step in setting up Harness.
tags:
- '''getValue'''
- Delegate
- Tags
- HA
- high availability
- install
- Delegate requirements
- Delegate tags
- Delegate scope
- proxy settings
- Delegate Profile
- Secrets management
- heartbeat
show_toc: true
is_private: false
is_published: true
is_featured: true
stale_status:
  is_stale: false
  reason: ""
  source: API
  triggered_at: 2022-09-08T15:50:29.198029Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Harness Delegate Overview
  description: Covers Harness Delegate installation, requirements, tags, proxy settings,
    scope, availability, and task assignments. Also covers Delegate Profiles and secrets
    management.
  short_version: Installing the Harness Delegate is the first step in setting up Harness.
  body: '<div class="tip-callout">This content is for Harness <a href="https://docs.harness.io/article/1fjmm4by22">FirstGen</a>.
    Switch to <a href="/article/2k7lnc7lvl-delegates-overview">NextGen</a>.</div><p>The
    Harness Delegate is a service you run in your local network or VPC to connect
    all of your artifact, infrastructure, collaboration, verification and other providers
    with the Harness Manager.</p><p>As explained in <a href="/article/4o7oqwih6h-harness-key-concepts">Harness
    Key Concepts</a>, when you set up Harness for the first time, you install a Harness
    Delegate in your target infrastructure (for example, Kubernetes cluster, ECS cluster,
    EC2 subnet, Pivotal Cloud Foundry space, etc). Once the Delegate is installed,
    you can set up the resources and model your release process.</p><p>Most importantly,
    the Delegate performs all deployment operations.</p><div class="note-callout">For
    all the topics related to the Harness Delegate, see <a href="/category/gyd73rp7np-manage-delegates">Manage
    Harness Delegates</a>.</div><p>In this article:</p><ul><li> <a href="#limitations_and_requirements">Limitations
    and Requirements</a></li><li> <a href="#what_data_does_the_delegate_send_to_the_harness_manager">What
    Data does the Delegate Send to the Harness Manager?</a></li><li> <a href="#where_do_i_install_the_delegate">Where
    do I Install the Delegate?</a></li><li> <a href="#install_the_harness_delegate">Install
    the Harness Delegate</a></li><li> <a href="#how_does_harness_manager_identify_delegates">How
    Does Harness Manager Identify Delegates?</a></li><li> <a href="#how_does_harness_manager_pick_delegates">How
    Does Harness Manager Pick Delegates?</a></li><li> <a href="#delegate_high_availability_ha">Delegate
    High Availability (HA)</a></li><li> <a href="#delegate_proxy_settings">Delegate
    Proxy Settings</a></li><li> <a href="#delegate_scope">Delegate Scope</a></li><li>
    <a href="#delegate_profiles">Delegate Profiles</a></li><li> <a href="#delegate_selectors">Delegate
    Selectors</a></li><li> <a href="#delegate_log_file">Delegate Log File</a></li><li>
    <a href="#add_self_signed_certificates_for_delegate_connections">Add Self-Signed
    Certificates for Delegate Connections</a></li><li> <a href="#troubleshooting">Troubleshooting</a></li></ul><h3>Limitations
    and Requirements</h3><p>See <a href="/article/lwynqsgxt9-delegate-requirements-and-limitations">Delegate
    Requirements and Limitations</a>.</p><h3>What Data does the Delegate Send to the
    Harness Manager?</h3><p>The Delegate and the Harness Manager (via SaaS) establish
    a Secure WebSocket channel (WebSocket over TLS) to send new Delegate task event
    notifications (not the tasks themselves) and exchange connection heartbeats. </p><ul><li><strong>Heartbeat</strong>
    - The Delegate sends a <a href="https://en.wikipedia.org/wiki/Heartbeat_(computing)"
    target="_blank">heartbeat</a> to let the Harness Manager know that it is running.</li><li><strong>Deployment
    data</strong> - The information from the API executions the Delegate performs
    are sent to the Manager for display in the <strong>Deployments</strong> page.</li><li><strong>Time
    series and log data for Continuous Verification</strong> - The Delegate connects
    to the verification providers you have configured and sends their data to the
    Manager for display in Harness Continuous Verification.</li></ul><h3>Where do
    I Install the Delegate?</h3><ul><li><strong>Evaluating Harness</strong> - When
    evaluating Harness, you might want to install the Delegate locally. Ensure that
    it has access to the artifact sources, deployment environments, and verification
    providers you want to use with Harness.</li><li><strong>Development, QA, and Production</strong>
    - The Delegate should be installed behind your firewall and in the same VPC as
    the micro-services you are deploying. The Delegate must have access to the artifact
    servers, deployment environments, and cloud providers it needs.</li></ul><h3>Install
    the Harness Delegate</h3><p>See the following topics:</p><ul><li> <a href="/article/igftn7rrtg-delegate-installation-overview">Delegate
    Installation Overview</a></li><li> <a href="/article/0hn6vdpeqz-install-kubernetes-delegate">Install
    the Harness Kubernetes Delegate</a></li><li> <a href="/article/8o4cwqj1kv-install-shellscript-delegate">Install
    the Harness Shell Script Delegate</a></li><li> <a href="/article/oiy5fxawzq-install-ecs-delegate">Install
    the Harness ECS Delegate</a></li><li> <a href="/article/6n7fon8rit-using-the-helm-delegate">Install
    the Harness Helm Delegate</a></li><li> <a href="/article/hnvvwbhbdu-install-docker-delegate">Install
    the Harness Docker Delegate</a></li></ul><h3>How Does Harness Manager Identify
    Delegates?</h3><p>All Delegates are identified by your Harness account ID. But,
    depending on the type of Delegate, there are additional factors.</p><p>For Delegates
    running on virtual machines, such as the Shell Script and Docker Delegates running
    on an AWS EC2 instance, the Delegate is identified by the combination of <strong>Hostname</strong>
    and <strong>IP</strong>:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/h9tkwmkrm7/1560383229070/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Therefore,
    if the hostname or IP changes on the VM, the Delegate cannot be identified by
    the Harness Manager. The IP used is the private IP. The Delegate connects to the
    Harness Manager, but the Harness Manager does not initiate a connection to the
    Delegate, and so the public IP address of the Delegate is not needed, typically.</p><p>For
    Kubernetes and ECS Delegates, the IP can change if a pod is rescheduled, for example.
    Consequently, Kubernetes Delegates are identified by a suffix using a unique six
    letter code in their <strong>Hostname</strong> (the first six letters that occur
    in your account ID):</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/h9tkwmkrm7/1560383507971/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>ECS
    Delegates are identified by the <strong>Hostname</strong> entered when the ECS
    Delegate Task Spec is downloaded:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/h9tkwmkrm7/1560465943276/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><h3>How
    Does Harness Manager Pick Delegates?</h3><p>When a task is ready to be assigned,
    the Harness Manager first validates its lists of Delegates to see which Delegate
    should be assigned the task.</p><p>The following information describes how the
    Harness Manager validates and assigns tasks to a Delegate:</p><ul><li><strong>Heartbeats</strong>
    - Running Delegates send heartbeats to the Harness Manager in 1 minute intervals.
    If the Manager does not have a heartbeat for a Delegate when a task is ready to
    be assigned, it will not assign the task to that Delegate.</li><li><strong>Selectors
    and Scoping</strong> - For more information, see <a href="#delegate_selectors">Delegate
    Selectors</a>, <a href="https://harness.helpdocs.io/article/h9tkwmkrm7-delegate-installation#delegate_scope">Delegate
    Scope</a>, and <a href="/article/nzuhppobyg-map-tasks-to-delegates-and-profiles">Map
    Tasks to Delegates and Profiles</a>.</li><li><strong>Whitelisting</strong> - Once
    a Delegate has been validated for a task, it is whitelisted for that task and
    will likely be used again for that task. The whitelisting criteria is the URL
    associated with the task, such as a connection to a cloud platform, repo, or API.
    A Delegate is whitelisted for all tasks using that URL. The Time-To-Live (TTL)
    for the whitelisting is 6 hours, and the TTL is reset with each successful task
    validation.</li><li><strong>Blacklisting</strong> - If a Delegate fails to perform
    a task that Delegate is blacklisted for that task and will not be tried again.
    TTL is 5 minutes. This is true if there is only one Delegate and even if the Delegate
    is selected for that task with a Selector, such as with a Shell Script command
    in a Workflow.</li></ul><h3>Delegate High Availability (HA)</h3><p>You might need
    to install multiple Delegates depending on how many Continuous Delivery tasks
    you do concurrently, and on the compute resources you are providing to each Delegate.
    Typically, you will need one Delegate for every 300-500 service instances across
    your applications.</p><p>In addition to compute considerations, you can enable
    High Availability (HA) for Harness Delegates. HA simply involves installing multiple
    Delegates in your environment.</p><p>For example, in Kubernetes deployments, you
    can set up two Kubernetes Delegates, each in its own pod in the same target K8s
    cluster. Simply edit the Kubernetes Delegate spec you download from Harness, <strong>harness-kubernetes.yaml</strong>,
    to have multiple replicas:</p><pre>...<br/>apiVersion: apps/v1beta1<br/>kind:
    StatefulSet<br/>metadata:<br/>  labels:<br/>    harness.io/app: harness-delegate<br/>    harness.io/account:
    xxxx<br/>    harness.io/name: test<br/>  name: test-zeaakf<br/>  namespace: harness-delegate<br/>spec:<br/>  replicas:
    2<br/>  selector:<br/>    matchLabels:<br/>      harness.io/app: harness-delegate<br/>...</pre><p></p><div
    class="warning-callout">For the Kubernetes Delegate, you only need one Delegate
    in the cluster. Simply increase the number of replicas, and nothing else. Do not
    add another Delegate to the cluster in an attempt to achieve HA.</div><div class="note-callout">If
    you want to install Kubernetes Delegates in separate clusters, do not use the
    same <strong>harness-kubernetes.yaml</strong> and name for both Delegates. Download
    a new Kubernetes YAML spec from Harness for each Delegate you want to install.
    This will avoid name conflicts.</div><p></p><p>For ECS deployments, set up two
    ECS Delegates as separate services in the same target ECS cluster. For Shell Script
    Delegates in AWS for example, set up two Delegate instances in the same target
    VPC.</p><div class="note-callout">In every case, the Delegates need to be identical
    in terms of permissions, keys, connectivity, etc.</div><p>With two or more Delegates
    running in the same target environment, HA is provided by default. One Delegate
    can go down without impacting Harness&#39; ability to perform deployments. If
    you want more availability, you can set up three Delegates to handle the loss
    of two Delegates, and so on.</p><p>Two Delegates in different locations with different
    connectivity do not support HA. For example, if you have a Delegate in a Dev environment
    and another in a Prod environment, the Dev Delegate will not communicate with
    the Prod Delegate or vice versa. If either Delegate went down, Harness would not
    operate in their environment.</p><h3>Delegate Proxy Settings</h3><p>See <a href="/article/pfim3oig7o-configure-delegate-proxy-settings">Configure
    Delegate Proxy Settings</a>.</p><h3><span style="font-weight:400">Delegate Scope</span></h3><p>See
    <a href="/article/hw56f9nz7q-scope-delegates-to-harness-components-and-commands">Scope
    Delegates to Harness Components and Commands</a>.</p><h3>Delegate Profiles</h3><div
    class="note-callout">A Delegate Profile is mandatory. The <a href="/article/2uhtcqzaio-approve-or-reject-harness-delegates">Primary
    Profile</a> is the default and contains no script. You can add a script to it,
    or create and apply new Profiles for your Delegate.</div><p>A Delegate Profile
    enables you to run a startup script on the host/container/pod for a Harness Delegate
    when the Delegate is installed. You can create a single Delegate Profile and apply
    it to multiple Delegates.</p><p>See the following Delegate Profile topics:</p><ul><li>
    <a href="/article/yd4bs0pltf-run-scripts-on-the-delegate-using-profiles">Run Scripts
    on the Delegate using Profiles</a></li><li> <a href="/article/imzgiz9h41-use-a-secret-in-a-delegate-profile">Use
    Secrets in a Delegate Profile</a></li><li> <a href="/article/nxhlbmbgkj-common-delegate-profile-scripts">Common
    Delegate Profile Scripts</a></li><li> <a href="/article/2uhtcqzaio-approve-or-reject-harness-delegates">Approve
    or Reject Harness Delegates</a></li></ul><h3>Delegate Selectors</h3><div class="note-callout">Delegate
    Selectors were formerly called Tags. Now, <em>Tags</em> refers only to tagging
    Harness Application components as described in <a href="/article/nrxfix3i58-tags">Using
    Tags</a>.</div><p>When Harness makes a connection via its Delegates, it will select
    the best Delegate according to <a href="#how_does_harness_manager_pick_delegates">How
    Does Harness Manager Pick Delegates?</a>.</p><p>To ensure a specific Delegate
    is used by a Harness entity, you can add Selectors to Delegates and then reference
    the Selectors in commands and configurations.</p><p>See <a href="/article/c3fvixpgsl-select-delegates-for-specific-tasks-with-selectors">Select
    Delegates with Selectors</a> and <a href="/article/nzuhppobyg-map-tasks-to-delegates-and-profiles">Map
    Tasks to Delegates and Profiles</a>.</p><h3>Delegate Log File</h3><p>The Delegate
    creates a new log file each day, named <strong>delegate.log</strong>, and its
    maximum size is 50MB.</p><p>Every day the log file is saved with the day&#39;s
    date and a new log file is created.</p><p>If a log file grows beyond 50MB in a
    day, the log file is renamed with today&#39;s date and a new log file is created.</p><p>Harness
    keeps log files for today and the previous 10 days (up to one 1GB).</p><h4>Delegate
    Log Parameters</h4><p>Here are some examples of the common Delegate log parameters
    and what they mean:</p><ul><li><strong>CPU Process:</strong> current CPU load
    of the Delegate JVM process (0% - 100%).</li><li><strong>CPU System:</strong>
    current CPU load of the overall system (0% - 100%).</li><li><strong>Max Executing
    Task Count:</strong> maximum number of parallel executing tasks since the last
    performance printout (not including validation tasks).</li><li><strong>Max Executing
    Future Count:</strong> same as <strong>Max Executing Task Count</strong>, but
    holds different data used by Harness.</li><li><strong>Max Validating Task Count:</strong>
    maximum number of validation tasks since last performance printout.</li><li><strong>Max
    Validating Future Count:</strong> same <strong>Max Validating Task Count</strong>,
    but holds different data used by Harness.</li></ul><h3>Add Self-Signed Certificates
    for Delegate Connections</h3><p>See <a href="/article/8bj3v5jqzk-add-self-signed-certificates-for-delegate-connections">Add
    Self-Signed Certificates for Delegate Connections</a>.</p><h3>Troubleshooting</h3><p>See
    <a href="/article/g9o2g5jbye-troubleshooting-harness">Troubleshooting</a>.</p>'
  slug: delegate-installation
  tags:
  - '''getValue'''
  - Delegate
  - Tags
  - HA
  - high availability
  - install
  - Delegate requirements
  - Delegate tags
  - Delegate scope
  - proxy settings
  - Delegate Profile
  - Secrets management
  - heartbeat
  is_live: true
