type: article
article_id: yd4bs0pltf
user_id: mfr0nxh4be
category_id: gyd73rp7np
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Run Scripts on Delegates using Profiles (Deprecated)
slug: run-scripts-on-the-delegate-using-profiles
description: Using Profiles is Deprecated. Please use Run Initialization Scripts on
  Delegates. A Delegate Profile enables you to run a startup script on the host/container/pod
  for a Harness Delegate when the Dele…
short_version: Using Profiles is Deprecated. Please use Run Initialization Scripts
  on Delegates. A Delegate Profile enables you to run a startup script on the host/container/pod
  for a Harness Delegate when the Dele…
tags: []
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: ""
  source: API
  triggered_at: 2022-07-06T18:58:21.701784Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Run Scripts on Delegates using Profiles (Deprecated)
  description: ""
  short_version: ""
  body: '<div class="warning-callout">Using Profiles is Deprecated. Please use <a
    href="/article/ul6qktixip-run-initialization-scripts-on-delegates">Run Initialization
    Scripts on Delegates</a>.</div><p>A Delegate Profile enables you to run a startup
    script on the host/container/pod for a Harness Delegate when the Delegate is installed,
    or any time after that. You can create a single Delegate Profile and apply it
    to multiple Delegates.</p><div class="note-callout">A Delegate Profile is mandatory.
    The Primary Profile is the default and contains no script. You can add a script
    to it, or create and apply new Profiles for your Delegate.</div><h3>Review: Delegate
    Profile Summary</h3><p>A Delegate Profile lets you install and run script and
    software every time a Harness Delegate is added.</p><p>To do this, you could create
    a Delegate Profile containing the commands for installing and running the software.</p><p>Each
    time you add a Delegate, you can apply the profile.</p><p>When the Delegate is
    started, the commands to install and run the software are executed.</p><p>For
    example, a Delegate Profile that installs Terraform:</p><pre>curl -O -L https://releases.hashicorp.com/terraform/0.11.13/terraform_0.11.13_linux_amd64.zip<br/>unzip
    terraform_0.11.13_linux_amd64.zip<br/>sudo mv terraform /usr/local/bin/<br/>terraform
    --version</pre><p>For examples of Delegate Profile scripts, see <a href="/article/nxhlbmbgkj-common-delegate-profile-scripts">Common
    Delegate Profile Scripts</a>.</p><h4>Primary Profile</h4><p>Your Harness account
    comes with a default Primary Profile. When you install a new Delegate and it registers
    with Harness, the Primary Profile is added to that Delegate automatically.</p><p>It
    cannot be renamed or deleted.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/h9tkwmkrm7/1586560944301/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>You
    can add any script to the Primary Profile, and apply it to any Delegate.</p><h4>Profile
    Approvals</h4><p>When you create a Profile you can require that its use be approved
    by a member of the Harness Account Administrator group.</p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/h9tkwmkrm7/1588958608354/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>When
    this option is selected, and Delegate that uses this Profile will appear with
    a <strong>Pending Approval</strong> option in the <strong>Harness Delegates</strong>
    page.</p><p>If you reject the Delegate, it is not registered with Harness and
    does not appear in the list.</p><p>See <a href="/article/2uhtcqzaio-approve-or-reject-harness-delegates">Approve
    or Reject Harness Delegates</a>.</p><h4>What Can I Run In a Profile?</h4><p>You
    can add any commands supported on the host/container/pod running the Delegate.
    Linux shell commands are most common. If kubectl, Helm, or Docker is running on
    the host/container/pod where you install the Delegate, then you can use their
    commands.</p><p>The base image for the Delegate is Ubuntu 18.04 or later, and
    so any default Ubuntu packages may be used in the Delegate Profile script.</p><p>All
    Delegates include cURL and unzip as part of their installation package, and so
    you may use cURL and unzip in your Delegate Profile scripts without installing
    them. The following script will work without having to install any packages:</p><pre>usr/bin/apt-get
    install -y python<br/>curl &#34;https://s3.amazonaws.com/aws-cli/awscli-bundle.zip&#34;
    -o &#34;awscli-bundle.zip&#34;<br/>unzip awscli-bundle.zip<br/>./awscli-bundle/install
    -b ~/bin/aws</pre><h4>When is the Profile Executed?</h4><p>Delegate Profiles are
    applied under the following conditions:</p><ul><li><strong>New Delegate</strong>
    - If you add a Delegate Profile when you create the Delegate, the profile commands
    are executed after the Delegate is started.</li><li><strong>Running Delegate</strong>
    - If you apply a Delegate Profile to a running Delegate, either by applying it
    as a new profile or switching the Delegate’s current profile, the profile commands
    are executed immediately.</li><li><strong>Edited Profile</strong> - If you edit
    a Delegate Profile, the new commands in the profile are applied to all Delegates
    using the profile.</li></ul><h4>Profile Timeouts</h4><p>The profile execution
    timeout limit is 10 minutes.</p><h3>Step 1: Create a Delegate Profile</h3><p>To
    create a Delegate Profile, do the following:</p><ol><li>In <strong>Harness</strong>,
    click <strong>Setup</strong>.</li><li>Click <strong>Harness Delegates</strong>.</li><li>Click
    <strong>Delegate Profiles</strong>, and then click <strong>Add Delegate Profiles</strong>.
    The <strong>Manage Delegate Profile</strong> dialog appears.</li><li>In <strong>Display</strong>
    <strong>Name</strong>, enter a name for the profile.</li><li>In <strong>Startup
    Script</strong>, enter the script you want to run when the profile is applied,
    such as when the Delegate is started.<br/>For <strong>Delegate Requires Approval</strong>,
    see <a href="/article/2uhtcqzaio-approve-or-reject-harness-delegates">Approve
    or Reject Harness Delegates</a>.</li><li>Click <strong>Submit</strong>. The profile
    is created. Now you can apply the profile to new or existing Delegates.</li></ol><h3>Option:
    Secrets in Profiles</h3><p>You can use Harness encrypted text and file secrets
    in your Profile script. This is very common for usernames and passwords.</p><p>To
    use a secret in a Delegate Profile, the secret&#39;s <strong>Usage Scope</strong>
    must be set to <strong>Scope to Account</strong>.</p><p>See <a href="/article/e5q9qcho4y-restrict-secrets-usage">Restrict
    Secrets Usage</a> and <a href="/article/imzgiz9h41-use-a-secret-in-a-delegate-profile">Use
    Secrets in a Delegate Profile</a>.</p><h3>Option: Add a Selector to a Delegate
    Profile</h3><p>You can add a Selector to a Delegate Profile and then when you
    apply the Profile to a Delegate, the Delegate inherits the Selector.</p><p>This
    provides a dynamic way to add and remove Selectors to a Delegate, and ensure that
    any Delegate with the Selector also uses a specific Profile.</p><p>This enables
    you to use the Selector in a <a href="/article/1fjrjbau7x-capture-shell-script-step-output">Shell
    Script step</a>, or anywhere else you use Delegate Selectors, and be confident
    that the Delegate selected also has the Delegate Profile.</p><p>When the Profile
    is removed from the Delegate, the Selector is also removed.</p><p>A Delegate Profile
    Selector does not apply the Profile. It is simply a method of adding/removing
    Profile-specific Selectors dynamically.</p><h3>Step 2: Applying a Profile</h3><p>You
    can apply a profile in the following ways:</p><ul><li><strong>Kubernetes and ECS
    Task Delegate</strong> - For a Harness Kubernetes or ECS Task Delegate, you can
    apply a profile when you download the Kubernetes YAML file or ECS Task Spec for
    the Delegate, or after the Delegate is installed and running.</li><li><strong>Shell
    Script and Docker Image Delegate</strong> - For the Harness Shell Script and Docker
    Image delegates, you download, install, and run the Delegates first, and then
    apply the profile using the Harness Manager.</li></ul><p>To apply a profile to
    an existing Delegate, do the following:</p><ol><li>Locate the Delegate to which
    you want to apply the profile.</li><li>Do one of the following:</li><li>Click
    the dropdown menu next to <strong>Profile</strong> and then click the profile
    you want applied to the Delegate.</li><li>In the confirmation dialog, click <strong>Confirm</strong>.</li></ol><h4>Notes</h4><ul><li>It
    might take a few minutes to apply the new profile.</li><li>When switching profiles,
    any binaries installed as part of the earlier profile are not removed automatically.
    If you need to remove them, then restart the Kubernetes pod hosting the Kubernetes
    Delegate or manually clean up the VM hosting the Shell or Docker delegate.</li><li>To
    remove a profile from a Delegate, click <strong>Select Profile</strong>, and then
    click another Profile, such as the default <strong>Primary</strong> Profile. Delegates
    must always have a profile. You can use the Primary Profile as a blank default.</li></ul><h4>Profile
    Logs</h4><p>You can view the execution log of the Profile script for each Delegate.
    For example, we&#39;ll use a Profile that simply prints out its environment variables
    using <code>printenv</code>.</p><p>The date next to the Profile name is a timestamped
    link to the script execution log. Click the link to see the log:</p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/h9tkwmkrm7/1554829487188/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><h3>Step
    3: Manage Profiles</h3><p>When you update a Delegate Profile, the changes are
    applied to the Delegates using the profile.</p><p>You can also delete a profile
    and it will be removed from the Delegates using it.</p><div class="note-callout">When
    editing or deleting profiles, any binaries installed as part of the earlier profile
    are not removed automatically. If you need to remove them, then restart the Kubernetes
    pod hosting the Kubernetes Delegate or manually clean up the VM hosting the Shell
    or Docker Delegate.</div><h3>See Also</h3><ul><li> <a href="/article/imzgiz9h41-use-a-secret-in-a-delegate-profile">Use
    Secrets in a Delegate Profile</a></li></ul><p></p>'
  slug: run-scripts-on-the-delegate-using-profiles
  tags: []
  is_live: true
