<p>The Delegate setup files enable you to run startup scripts on the host/container/pod for a Harness Delegate when the Delegate is installed.</p><p>You can also add script after the Delegate is installed, and then simply restart the Delegate.</p><p>This topic describes how to set up the Delegate config files for running scripts.</p><h3>Before You Begin</h3><ul><li><a href="/article/igftn7rrtg-delegate-installation-overview">Delegate Installation Overview</a></li><li><a href="/article/0hn6vdpeqz-install-kubernetes-delegate">Install the Harness Kubernetes Delegate</a></li><li><a href="/article/hnvvwbhbdu-install-docker-delegate">Install the Harness Docker Delegate</a></li></ul><h3>Limitations</h3><ul><li>When editing or deleting scripts, any binaries installed as part of the earlier scripts are not removed automatically. If you need to remove them, then restart or clean up the pod/VM.</li><li>You cannot use Harness secrets in scripts since there is no connectivity to Harness at the time when the script is run (before the Delegate registers with Harness).</li></ul><h3>Review: What Can I Run In a Script?</h3><p>You can add any commands supported on the host/container/pod running the Delegate. Linux shell commands are most common. If kubectl, Helm, or Docker is running on the host/container/pod where you install the Delegate, then you can use their commands. The Kubernetes and Docker Delegates include Helm.</p><p>The base image for the Delegate is Ubuntu 18.04 or later, and so any default Ubuntu packages may be used in the Delegate script.</p><p>All Delegates include cURL and unzip as part of their installation package, and so you may use cURL and unzip in your Delegate scripts without installing them. The following script will work without having to install any packages:</p><pre class="hljs python">apt-get install -y python<br/>curl &#34;https://s3.amazonaws.com/aws-cli/awscli-bundle.zip&#34; -o &#34;awscli-bundle.zip&#34;<br/>unzip awscli-bundle.zip<br/>./awscli-bundle/install -b ~/bin/aws</pre><h4>When is the Script Executed?</h4><p>Delegate scripts are applied under the following conditions:</p><ul><li><strong>New Delegate</strong> - If you add a Delegate script when you create the Delegate, the commands are executed before the Delegate is started.</li><li><strong>Running Delegate</strong> - If you apply a Delegate script to a running Delegate, either by applying it as a new script or by switching the Delegate’s current script, the script commands are executed when the Delegate is restarted, but before the Delegate comes up.</li></ul><h3>Step 1: Download the Delegate Config File</h3><p>When you install a Delegate, you are prompted to download its config file. For Kubernetes and Docker Delegates, this is a YAML file.</p><p>Download the file and open it in a text editor.</p><h3>Step 2: Add a Script to the Delegate INIT_SCRIPT Environment Variable</h3><p>In the Delegate config file, locate the <code>INIT_SCRIPT</code> environment variable.</p><p>For example, here it is in the Kubernetes Delegate harness-delegate.yaml file:</p><pre>...<br/>apiVersion: apps/v1<br/>kind: StatefulSet<br/>...<br/>spec:<br/>...<br/>    spec:<br/>    ...<br/>        env:<br/>        ...<br/>        - name: INIT_SCRIPT<br/>          value: |-<br/>            echo install wget<br/>            apt-get install wget<br/>            echo wget installed<br/>...</pre><p></p><p>In <code>value</code>, enter your script. For a list of common scripts, see <a href="/article/nxhlbmbgkj-common-delegate-profile-scripts">Common Delegate Scripts</a>.</p><div class="tip-callout">A multiline script must follow the YAML spec for <a href="https://yaml.org/spec/1.2-old/spec.html#id2795688" target="_blank">literal scalar style</a>.</div><div class="note-callout">The script should <u>not</u> be in quotes.</div><p>For the Docker Delegate, Harness uses a Docker compose file, so you add your script like this:</p><pre>...<br/>      - |<br/>        INIT_SCRIPT=<br/>        echo Init Script Example<br/>        echo Done!!<br/>...</pre><p></p><p>A Docker compose file doesn&#39;t use the exact same YAML formatting as Kubernetes manifests and so the script formatting is slightly different.</p><h3>Step 3: Install the Delegate</h3><p>Follow the remaining Delegate installation steps.</p><p>See:</p><ul><li><a href="/article/0hn6vdpeqz-install-kubernetes-delegate">Install the Harness Kubernetes Delegate</a></li><li><a href="/article/hnvvwbhbdu-install-docker-delegate">Install the Harness Docker Delegate</a></li></ul><h3>Step 4: Verify the Script</h3><p>Check the Delegate pod/host/container to see if the script ran correctly.</p><p>For example, here is a simple hello world script in a Docker Delegate:</p><pre>...<br/>      - |<br/>        INIT_SCRIPT=<br/>        echo hello world!<br/>...</pre><p></p><div class="note-callout">The Docker Delegate file is a Docker compose file so it uses YAML formatting different from Kubernetes manifest YAML.</div><p>Once the Delegate in installed, run <code>docker ps</code> to get the container Id, and then run <code>docker logs &lt;contain Id&gt;</code>.</p><p>In the logs, you will see that your script has run before the Delegate is installed.</p><p>The script is run between <code>Starting initialization script for Delegate</code> and <code>Completed executing initialization script</code>:</p><pre>% docker logs 9d405639948f<br/>Watcher not running<br/>Delegate not running<br/><br/>Starting initialization script for Delegate<br/>hello world!<br/>Completed executing initialization script<br/>Checking Watcher latest version...<br/>The current version 1.0.72500 is not the same as the expected remote version 1.0.72702<br/>Downloading Watcher 1.0.72702 ...<br/>######################################################################## 100.0%<br/>Checking Delegate latest version...<br/>Downloading Delegate  ...<br/>#=#=#                                                                         <br/>Watcher started<br/></pre><h3>See Also</h3><ul><li><a href="/article/up3w9d8zd0-automate-harness-kubernetes-delegate-setup">Automate Harness Kubernetes Delegate Setup</a></li></ul><p></p><p></p><p></p><p></p>