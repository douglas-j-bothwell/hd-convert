<div class="tip-callout">This content is for Harness <a href="https://docs.harness.io/article/1fjmm4by22">FirstGen</a>. Switch to <a href="/article/a73o2cg3pe-add-an-aws-secret-manager">NextGen</a>.</div><p>You can use AWS Secrets Manager for your Harness secrets. AWS Secrets Manager differs from AWS KMS in that AWS Secrets Manager stores both secrets and encryption keys whereas with AWS KMS, Harness stores the secret in its Harness store and retrieves the encryption keys from KMS.</p><p>In this topic:</p><ul><li><a href="https://docs.harness.io/article/otkxijqoa6-add-an-aws-secrets-manager#before_you_begin">Before You Begin</a></li><li><a href="https://docs.harness.io/article/otkxijqoa6-add-an-aws-secrets-manager#permissions_test_aws_permissions">Permissions: Test AWS Permissions</a></li><li><a href="https://docs.harness.io/article/otkxijqoa6-add-an-aws-secrets-manager#step_1_configure_secrets_manager">Step 1: Configure Secrets Manager</a></li><li><a href="https://docs.harness.io/article/otkxijqoa6-add-an-aws-secrets-manager#step_2_display_name">Step 2: Display Name</a></li><li><a href="https://docs.harness.io/article/otkxijqoa6-add-an-aws-secrets-manager#option_credentials_type">Option: Credentials Type</a></li><li><a href="https://docs.harness.io/article/otkxijqoa6-add-an-aws-secrets-manager#option_assume_iam_role_on_delegate">Option: Assume IAM Role on Delegate</a><ul><li><a href="https://docs.harness.io/article/otkxijqoa6-add-an-aws-secrets-manager#delegate_selector">Delegate Selector</a></li></ul></li><li><a href="https://docs.harness.io/article/otkxijqoa6-add-an-aws-secrets-manager#option_aws_access_keys_manually">Option: AWS Access Keys Manually</a><ul><li><a href="https://docs.harness.io/article/otkxijqoa6-add-an-aws-secrets-manager#access_key">Access Key</a></li><li><a href="https://docs.harness.io/article/otkxijqoa6-add-an-aws-secrets-manager#secret_key">Secret Key</a></li></ul></li><li><a href="https://docs.harness.io/article/otkxijqoa6-add-an-aws-secrets-manager#option_assume_role_using_sts_on_delegate">Option: Assume Role Using STS on Delegate</a><ul><li><a href="https://docs.harness.io/article/otkxijqoa6-add-an-aws-secrets-manager#role_arn">Role ARN</a></li><li><a href="https://docs.harness.io/article/otkxijqoa6-add-an-aws-secrets-manager#external_id">External ID</a></li><li><a href="https://docs.harness.io/article/otkxijqoa6-add-an-aws-secrets-manager#assume_role_duration">Assume Role Duration</a></li></ul></li><li><a href="https://docs.harness.io/article/otkxijqoa6-add-an-aws-secrets-manager#step_3_secret_name_prefix">Step 3: Secret Name Prefix</a></li><li><a href="https://docs.harness.io/article/otkxijqoa6-add-an-aws-secrets-manager#step_4_region">Step 4: Region</a></li><li><a href="https://docs.harness.io/article/otkxijqoa6-add-an-aws-secrets-manager#step_5_usage_scope">Step 5: Usage Scope</a></li><li><a href="https://docs.harness.io/article/otkxijqoa6-add-an-aws-secrets-manager#limitations">Limitations</a></li></ul><p></p><h3>Before You Begin</h3><ul><li>See <a href="/article/4o7oqwih6h-harness-key-concepts">Harness Key Concepts</a>.</li><li>See <a href="/article/au38zpufhr-secret-management">Secrets Management Overview</a>.</li></ul><p></p><h3>Permissions: Test AWS Permissions</h3><p>Harness uses the same minimum IAM policies for AWS secret manager access as the AWS CLI.</p><p>The AWS account you use for the AWS Secret Manager must have the following policies at a minimum:</p><pre>{<br/>    &#34;Version&#34;: &#34;2012-10-17&#34;,<br/>    &#34;Statement&#34;: {<br/>        &#34;Effect&#34;: &#34;Allow&#34;,<br/>        &#34;Action&#34;: [<br/>            &#34;secretsmanager:Describe*&#34;,<br/>            &#34;secretsmanager:Get*&#34;,<br/>            &#34;secretsmanager:List*&#34; <br/>        ],<br/>        &#34;Resource&#34;: &#34;*&#34;<br/>    }<br/>}</pre><p></p><p>These policies let you list secrets which will allow you to add the Secrets Manager and refer to secrets, but it will not let you read secrets values.</p><p>The following policy list lets Harness perform all the secrets operations you might need:</p><pre>{<br/>    &#34;Version&#34;: &#34;2012-10-17&#34;,<br/>    &#34;Statement&#34;: {<br/>        &#34;Effect&#34;: &#34;Allow&#34;,<br/>        &#34;Action&#34;: [<br/>          &#34;secretsmanager:CreateSecret&#34;,<br/>          &#34;secretsmanager:DescribeSecret&#34;,<br/>          &#34;secretsmanager:DeleteSecret&#34;,<br/>          &#34;secretsmanager:GetRandomPassword&#34;,<br/>          &#34;secretsmanager:GetSecretValue&#34;,<br/>          &#34;secretsmanager:ListSecretVersionIds&#34;,<br/>          &#34;secretsmanager:ListSecrets&#34;,<br/>          &#34;secretsmanager:PutSecretValue&#34;,<br/>          &#34;secretsmanager:UpdateSecret&#34; <br/>        ],<br/>        &#34;Resource&#34;: &#34;*&#34;<br/>    }<br/>}</pre><p></p><p>See <a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/auth-and-access_identity-based-policies.html">Using Identity-based Policies (IAM Policies) for Secrets Manager</a> from AWS.</p><p>To test use the AWS account when running <a href="https://docs.aws.amazon.com/cli/latest/reference/secretsmanager/list-secrets.html#examples" target="_blank">aws secretsmanager list-secrets</a> on either the Harness Delegate host or another host.</p><h3>Step 1: Configure Secrets Manager</h3><ol><li>In <strong>Security</strong>, select <strong>Secrets Management</strong>, and then click <strong>Configure Secrets Managers.</strong> In the resulting <strong>Secrets Managers</strong> page, the <strong>Status</strong> column indicates the <strong>Default</strong> provider.</li><li>Click <strong>Add Secrets Manager</strong>. The <strong>Configure Secrets Manager</strong> settings appear.</li><li>Select <strong>AWS Secrets Manager</strong> from the drop-down list.<div class="note-callout">For information on restrictions on names and maximum quotas, see <a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/reference_limits.html" target="_blank">Quotas for AWS Secrets Manager</a>.</div><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/otkxijqoa6/1600960592209/screenshot-2020-09-24-at-8-45-19-pm.png" style="max-height:60%;max-width:60%" data-hd-height="60%" data-hd-width="60%"/></figure></li></ol><h3>Step 2: Display Name</h3><p>Enter a name for this secrets manager.</p><h3>Option: Credentials Type</h3><p>You can select the following options for authenticating with AWS:</p><ul><li><strong>Assume IAM Role on Delegate.</strong></li><li><strong>Enter AWS Access Keys Manually</strong>.</li><li><strong>Assume Role Using STS on Delegate.</strong></li></ul><h3>Option: Assume IAM Role on Delegate</h3><p></p><p>If you select <strong>Assume the IAM Role on Delegate</strong>, Harness will authenticate using the IAM role assigned to the AWS host running the Delegate you select using a Delegate Selector.</p><h4>Delegate Selector</h4><p>In <strong>Delegate Selector</strong>, enter the Selector of the Delegate that this Secrets Manager will use for all connections. For information about Selectors, see <a href="https://docs.harness.io/article/c3fvixpgsl-select-delegates-for-specific-tasks-with-selectors">Select Delegates for Specific Tasks with Selectors</a>.</p><h3>Option: AWS Access Keys Manually</h3><p>Use your AWS IAM user login credentials.</p><p>Either from the JSON for the <strong>Key Policy</strong>, or in the AWS <strong>IAM</strong> console, under <strong>Encryption keys,</strong> gather the following required details — <strong>Display Name</strong>, <strong>AWS Access Key ID</strong>, <strong>AWS Secret Key</strong>, and <strong>AWS Resource Name (ARN)</strong>.</p><p>For more information, see <a href="https://docs.aws.amazon.com/kms/latest/developerguide/viewing-keys.html#find-cmk-id-arn" target="_blank">Finding the Key ID and ARN</a> from Amazon.</p><h4>Access Key</h4><p>The AWS Access Key ID for the IAM user you want to use to connect to Secrets Manager.</p><h4>Secret Key</h4><p>Paste in the contents of the Secret Key corresponding to the Access Key ID.</p><h3>Option: Assume Role Using STS on Delegate</h3><p></p><p>This option uses the <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp.html" target="_blank">AWS Security Token Service</a> (STS) feature. Typically, you use <code>AssumeRole</code> within your account or for AWS cross-account access.</p><h4>Role ARN</h4><p>Enter the Amazon Resource Name (ARN) of the role that you want to assume. This is an IAM role in the target deployment AWS account.</p><h4>External ID</h4><p>If the administrator of the account to which the role belongs provided you with an external ID, then enter that value.</p><p>For more information, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-user_externalid.html">How to Use an External ID When Granting Access to Your AWS Resources to a Third Party</a> from AWS.</p><h4>Assume Role Duration</h4><p>This is the AssumeRole Session Duration. See Session Duration in the <a href="https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html" target="_blank">AssumeRole AWS docs</a>.</p><h3>Step 3: Secret Name Prefix</h3><p>Enter a prefix to be added to all secrets. For example, <code>devops</code> will result in secrets like <code>devops/mysecret</code>. The prefix is not a folder name, but a prefix. Secrets Manager uses is a flat naming method.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/au38zpufhr/1558646489700/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><h3>Step 4: Region</h3><p>Select the AWS Region for the Secrets Manager.</p><h3>Step 5: Usage Scope</h3><p>See <a href="/article/e4ikpd00f6-scope-secret-managers-to-applications-and-environments">Scope Secret Managers to Applications and Environments</a>.</p><h3>Limitations</h3><ul><li>For limitations of AWS secrets, see <a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/reference_limits.html" target="_blank">Quotas for AWS Secrets Manager</a>.</li><li>Secret names must be alphanumeric (Vault and KMS do not have this limitation). When migrating secrets created using Vault or KMS into AWS Secrets Manager, failures might occur due to the secret name limitation. You will have to rename those secrets into an alphanumeric format before they can be transitioned into AWS Secrets Manager.</li></ul><p></p>