<p>Harness supports WinRM authentication using Kerberos, enabling you to connect to a target host via the Kerberos protocol. For a quick Kerberos summary, see <a href="https://www.roguelynn.com/words/explain-like-im-5-kerberos/">Explain like I’m 5: Kerberos by Lynn Root</a>.</p><p>In this topic:</p><ul><li><a href="#before_you_begin">Before You Begin</a></li><li><a href="#limitations">Limitations</a></li><li><a href="#step_1_add_spn_to_the_active_directory_server">Step 1: Add SPN to the Active Directory Server</a></li><li><a href="#step_2_access_win_rm_configuration">Step 2: Access WinRM Configuration</a></li><li><a href="#step_3_display_name">Step 3: Display Name</a></li><li><a href="#step_4_auth_scheme">Step 4: Auth Scheme</a></li><li><a href="#step_5_username">Step 5: Username</a></li><li><a href="#step_6_domain">Step 6: Domain</a></li><li><a href="#step_7_tgt_generation">Step 7: TGT Generation</a></li><li><a href="#step_8_keytab_file_path">Step 8: Keytab File Path</a></li><li><a href="#step_9_advanced_options">Step 9: Advanced Options</a></li><li><a href="#step_9_test_the_connection">Step 10: Test the Connection</a></li></ul><p></p><h3>Before You Begin</h3><ul><li>See <a href="https://docs.harness.io/article/4o7oqwih6h-harness-key-concepts">Harness Key Concepts</a>.</li><li>See <a href="https://docs.harness.io/article/au38zpufhr-secret-management">Secrets Management Overview</a>.</li><li>Make sure you can generate TGT using <code>kinit</code> command on the machine where the Delegate is running. For more information about <code>kinit</code> command, see <a href="https://web.mit.edu/kerberos/krb5-1.12/doc/user/user_commands/kinit.html">kinit documentation</a>.</li></ul><p></p><h3>Limitations</h3><p>There are some corner use cases which Harness does not support because of how Java and Python interact, and as a result of limitations in Windows:</p><ul><li>The equals character (=) is not supported in the name of a Harness Service Config Variable or Environment Service Variable Override. See <a href="/article/q78p7rpx9u-add-service-level-config-variables">Add Service Config Variables</a> and <a href="/article/4m2kst307m-override-service-files-and-variables-in-environments">Override a Service Configuration in an Environment</a>.</li><li>The underscore character (_) is not supported in the working directory for Service Commands and their shell scripts. See <a href="/article/lgg12f0yry-set-default-application-directories-as-variables">Create Default Application Directories and Variables</a> and <a href="/article/1329n00z5e-use-script-based-service">Use Script Based Services</a>.</li><li>Harness has the same limitations as Windows environment variables. Harness treats all Service Config Variables and Environment Service Variable Overrides as Windows environment variables.</li><li>Non-UTF8 characters are not supported in Service Config Variables and Environment Service Variable Overrides. For example, <code>äöü!ÖÜÄéÊêÈèç</code>.</li><li>Harness has limited support for quotes in Service Config Variables and Environment Service Variable Overrides. A simple use such as <code>foo&#39;bar</code> will work, but a complex combination of single quotes and other characters such as backslash (\) might not work.</li><li>Harness does support variable values ending in three or more slashes.</li><li>Secrets cannot contain special characters without escaping. For example, if the secret contains a <code>$</code> like <code>ab$c</code> it will fail.<br/>Escape any special characters in your secrets: <code>ab\$c</code>.</li></ul><h3>Step 1: Add SPN to the Active Directory Server</h3><p>Make sure you add the Service Principal Name to the Active Directory as follows using the <strong>setspn</strong> command:</p><pre>WSMAN/&lt;Fully Qualified Domain Name&gt;@&lt;REALM&gt;<br/>HTTP/&lt;Fully Qualified Domain Name&gt;@&lt;REALM&gt;<br/>HTTP/&lt;Fully Qualified Domain Name&gt;<br/>WSMAN/&lt;Fully Qualified Domain Name&gt; </pre><p>For more information about setting the SPN using the setspn command, see <a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/cc731241(v=ws.11)">Microsoft’s Setspn documentation</a>.</p><p>For example, if the fully qualified domain name is <code>221.213.188.35.bc.googleusercontent.com</code> and the Realm name is <code>KERBEROS.LOCAL</code> then add the following:</p><pre>WSMAN/251.200.188.35.bc.googleusercontent.com@KERBEROS.LOCAL<br/>HTTP/251.200.188.35.bc.googleusercontent.com@KERBEROS.LOCAL    HTTP/251.200.188.35.bc.googleusercontent.com<br/>WSMAN/251.200.188.35.bc.googleusercontent.com</pre><p></p><h3>Step 2: Access WinRM Configuration</h3><p>In Secrets Management, under Execution Credentials, click <strong>WinRM Connection</strong>.</p><p>Click <strong>Add WinRM Connection</strong>.</p><p>The WinRM Connection Attributes dialog appears.</p><h3>Step 3: Display Name</h3><p>Name to identify the connection. You will use this name to identify this connection when setting up the Connection Attributes in the environment Service Infrastructure.</p><h3>Step 4: Auth Scheme</h3><p>Select <strong>Kerberos</strong>.</p><h3>Step 5: Username</h3><p>Username is a string that names a specific entity to which a set of credentials may be assigned. Enter the account name associated with the Kerberos account, such as <strong>johndoe</strong>.</p><h3>Step 6: Domain</h3><p>Domain is the logical network served by a single Kerberos database and a set of Key Distribution Centers (KDCs). This is where the service (that the user is trying to authenticate with) is located.</p><p>For example: <strong>US-EAST-2.COMPUTE.INTERNAL</strong>.</p><p>The target hosts that your WinRM connection is intending to authenticate with via Kerberos are located in a domain name with the same name you enter in <strong>Domain</strong>.</p><p>For example, <strong>ip-172-31-44-168.us-east-2.compute.internal</strong>. The domain naming convention is all uppercase letters to differentiate the domain from the internet domain, but the <strong>Domain</strong> field does not enforce the convention.</p><h3>Step 7: TGT Generation</h3><p>You can choose this option to generate a new TGT from the KDC every time you authenticate with the service. This ensures that the TGT is always valid and not expired when you try to authenticate.</p><p>Select one of the following options:</p><ul><li><strong>Key Tab File Path (on Delegate)</strong> - Enter the path to the KeyTab present in the Delegate for TGT generation.</li><li><strong>Password</strong> - Enter a password for TGT generation. </li></ul><h3>Step 8: Keytab File Path</h3><p>This field is displayed if you select <strong>Key Tab File Path</strong> for <strong>TGT Generation</strong>. Enter the file path to the keytab file on the server running the Harness Delegate. For example, <strong>/home/johndoe/a.keytab</strong>. The file is not uploaded to Harness.</p><p>To use the Kerberos WinRM connection to connect to a target host, you select it in <strong>WinRM Connection Attributes</strong> while specifying the target host in the Service Infrastructure/ Infrastructure Definition settings of an environment.</p><p>In this example, the target host that you want to use Kerberos authentication with is entered in Host Name(s).</p><p>Note that the domain name used to identify the hosts in the <strong>Host Name(s)</strong> field is likely to be the same as the domain name you entered in <strong>Domain</strong> when configuring the WinRM connection.</p><div class="warning-callout">The Host Name cannot be an IP address and it should be a domain name. The connection will not succeed if it is an IP address.</div><h3>Step 9: Advanced Options</h3><p>See the Advanced Options settings in <a href="/article/9fqa1vgar7-add-win-rm-connection-credentials">Add WinRM Connection Credentials</a>.</p><h3>Step 10: Test the Connection</h3><p>Click <strong>Test</strong> to ensure that the connection is successful. Once the connection is successful, click <strong>Submit</strong>.</p>