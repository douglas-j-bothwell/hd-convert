<p>You can encrypt any text and reference it in Harness Application entities or connections.</p><h3>Before You Begin</h3><ul><li>See <a href="/article/4o7oqwih6h-harness-key-concepts">Harness Key Concepts</a>.</li><li>Make sure you add the required Secrets Manager. See <a href="/article/uuer539u3l-add-a-secrets-manager">Add a Secrets Manager</a>.</li></ul><p></p><h3>Step 1: Add Encrypted Text</h3><ol><li>In <strong>Secrets Management</strong>, click <strong>Encrypted Text</strong>.</li><li>Click <strong>Add Encrypted Text</strong>. The <strong>Add Encrypted Text</strong> dialog appears.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/4vqipye0vz/1580802409035/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li><li>Select the <strong>Secrets Manager</strong> you will use to encrypt this secret.</li><li>Enter a name for the encrypted text. This is the name you will use to reference the text elsewhere in your applications.</li><li>Enter a value for the encrypted text.</li><li><strong>Scope to Account</strong> - If your Harness User account is part of a User Group with the <strong>Administer Other Account Functions</strong> permission enabled, you will see the <strong>Scope to Account</strong> option. Select <strong>Scope to Account</strong> to make this encrypted text secret available to Delegate Profile scripts only. Only secrets scoped to the account are available to use in Delegate Profiles.</li><li>For <strong>Usage Scope</strong>, see <a href="/article/e5q9qcho4y-restrict-secrets-usage">Restrict Secrets Usage</a>.</li><li>Click <strong>Submit</strong>.</li></ol><h3>Step 2: Use the Encrypted Text in Services</h3><p>When you are in an Application entity such as a Service, you can use the encrypted text. For example:</p><ol><li>In a Service&#39;s <strong>Configuration</strong> section, click <strong>Add Variable</strong>. The <strong>Config Variable</strong> dialog appears.</li><li>Enter a name for the variable, and then, in <strong>Type</strong>, select <strong>Encrypted Text</strong>.</li><li>In <strong>Value</strong>, select the secret you created in <strong>Secrets Management</strong>.</li><li>Click <strong>Submit</strong> and the secret will be used at runtime.</li></ol><p></p><h3>Step 3: Using the Encrypted Text in Connectors</h3><p>All of the passwords and keys used in Harness Connectors (Cloud Providers, Artifact Servers, Verification Providers, Source Repo Providers, and Collaboration Providers) are stored as Encrypted Text secrets in Harness.</p><p>You create the Encrypted Text secret first and then select it in the Connector. Or you can create it from the Connector by clicking <strong>Create Encrypted Text</strong>:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/ygyvp998mu/1587749743104/image.png"/></figure><p></p><p>You can also edit it in the Connector.</p><h3>Step 4: Reference the Encrypted Text</h3><p>For an Encrypted Text secret that has been scoped to an Application (using its <strong>Usage Scope</strong> settings), you reference the secret in an Application component using the expression: <code>${secrets.getValue(&#34;secret_name&#34;)}</code>.</p><p>For example, if you have text secret named doc-secret you can reference it in a Workflow <a href="/article/1fjrjbau7x-capture-shell-script-step-output">Shell Script</a> step like this:</p><pre>echo &#34;text secret is: &#34; ${secrets.getValue(&#34;doc-secret&#34;)}</pre><p>For Encrypted Text used in a Service&#39;s <strong>Config Variables</strong>, you reference them in the Workflow using the Service with the variable <code>${serviceVariable.var_name}</code> .</p><p>Avoid using $ in your secret value. If your secret value includes $, you must use single quotes when you use the expression in a script.</p><h3>Step 5: Add a Secret to a File at Runtime</h3><p>When a text secret has been scoped to Account-level using the <strong>Scope to Account</strong> setting, it can be referenced in a Delegate Profile as part of a script and written to a file as well. For example, here is a secret decoded from <a href="https://linux.die.net/man/1/base64" target="_blank">base64</a> and written to a file:</p><p><code>echo ${secrets.getValue(&#34;my_secret&#34;)} | base64 -d &gt; /path/to/file.txt</code></p><p>This example uses base64, but you can also write a secret to a file without it:</p><p><code>echo &#39;${secrets.getValue(&#34;long_secret&#34;)}&#39; &gt; /tmp/secretvalue.txt</code></p><p>If you do not use base64 and the secret value contains any character that is interpreted by the shell, it might cause issues.</p><p>In this case, you can use a here document special-purpose code block:</p><pre>cat &gt;/harness/secret_exporter/values.txt &lt;&lt; &#39;EOF&#39;<br/>MySecret:${secrets.getValue(&#34;test&#34;)}<br/>EOF</pre><h3>Review: Valid Characters in Secret Names</h3><p>Secret names may only contain alphanumeric characters, <code>-</code>, <code>_</code> and <code>\</code>.</p><h3>Review: Quotes and Secrets in a Script</h3><p>By default, secret expressions use quotes for the secret name: <code>${secrets.getValue(&#34;secret_name&#34;)}</code>.</p><p>If the secret value <u>itself</u> includes quotes, either single or double, and anywhere in the secret value, you <u>must</u> use the opposite quote when you use the expression in a script (echo, etc).</p><p>While uncommon, you might need quotes in the secret value for interpreting environment variables, etc.</p><div class="warning-callout">If you do not use the opposite quote you will expose the secret value.</div><p>Single quote example:</p><p>Here, the secret value is <code>&#39;mysecret&#39;</code> and the name is <code>secret_name</code>. To echo, use double quotes:</p><p><code>echo &#34;${secrets.getValue(&#39;secret_name&#39;)}&#34;</code></p><p><code>echo &#34;${secrets.getValue(&#34;secret_name&#34;)}&#34;</code></p><p>Double quote example:</p><p>Here, the secret value is <code>&#34;mysecret&#34;</code> and the name is <code>secret_name</code> .</p><p><code>echo &#39;${secrets.getValue(&#39;secret_name&#39;)}&#39;</code></p><div class="warning-callout">Avoid using $ in your secret value. If your secret value includes $, you must use single quotes when you use the expression in a script.<br/>For example, if your secret value is <code>&#39;my$secret&#39;</code> , and the name is <code>secret_name</code>, to echo, use single quotes:<br/>  <code>echo &#39;${secrets.getValue(&#34;secret_name&#34;)}&#39;</code></div><h3>Secrets in YAML Code</h3><div class="note-callout">The example below applies to the values.yaml used by the secret manifest for either Kubernetes and Native Helm deployments. See <a href="/article/i3n6qr8p5i-deployments-overview#kubernetes_or_native_helm">Kubernetes or Native Helm?</a>.</div><p>When you plan to use your secrets in YAML content, make sure you follow the quoting mechanism needed by YAML syntax.</p><p>For example, if the secret value is &#34;foo: bar&#34; and the secret has:</p><blockquote><p> <code>stringData: {{.Values.secret}}</code></p></blockquote><p>It will resolve as follows:</p><blockquote><p> <code>stringData: foo: bar</code></p></blockquote><p>This is not recognized as the lack of quotes and presence of extra space will lead to errors while executing the workflow.</p><h4>Solution</h4><p>To avoid this, follow the quoting mechanism suggested by YAML syntax, as follows:</p><blockquote><p><code>stringData: {{.Values.secret | quote}}</code></p></blockquote><p>It will resolve as follows:</p><blockquote><p> <code>stringData: &#34;foo: bar&#34;</code></p></blockquote><h3>Review: Secrets in Outputs</h3><p>When a secret is displayed in an output, Harness substitutes the secret value with asterisks so that the secret value is never displayed. Harness replaces each character in the name with an asterisk (*).</p><p>For example, here the secret values for repo username and password are replaced with <code>*****</code>:</p><pre>helm repo add --username **** --password **** nginx https://charts.bitnami.com/bitnami</pre><p>If you accidentally use a very common value in your secret, like whitespace, the <code>*</code> substitution might appear in multiple places in the output.</p><p>If you see output similar to this, review your secret and fix the error.</p><div class="warning-callout">If an operation within a script changes the value of the secret and Harness cannot match it to the expression, the newly modified string is displayed in the output exposing the secret value. If the modification is minor, the secret value can be easily deciphered which is a security concern.</div><p>See <a href="/article/o5ec7vvtju-secrets-and-log-sanitization">Secrets and Log Sanitization</a>.</p><h3>Review: Secret Scope</h3><p>When creating secrets, it&#39;s important to understand their scope in your Harness account.</p><p>A user can only create a secret according to the scope set by its Harness User permissions.</p><p>For example, if you have access to Application A only, you can create a secret scoped to Application A.</p><p>If you have access to Application A and B, you may still narrow the secret&#39;s scope to Application A only.</p><p>If the scope of a secret is only Application A, then only users with Read permission for Application A may see that secret. Users with Write permission to Application A may edit it also.</p><p>For steps, see <a href="/article/e5q9qcho4y-restrict-secrets-usage">Restrict Secrets Usage</a>.</p><h3>Review: Secrets and Caching</h3><p>When a secret is used it is fetched from the source and put in cache.</p><p>By default, secrets are cached for 1 hour. When a secret is used, the cache is refreshed and the 1 hour limit starts again. When the 1 hour limit is reached, the secret is removed from the cache and is added back to the cache the next time itâ€™s accessed.</p><p>If the secret is not in the cache when Harness fetches the secret, then the secret is fetched from the source and put in cache.</p><div class="note-callout"><a href="mailto:support@harness.io">Harness Support</a> can increase the default cache expiry limit for your account. Harness can also disable secret caching entirely if you want.</div><p></p>