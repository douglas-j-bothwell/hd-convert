type: article
article_id: 85rycqfiqg
user_id: mfr0nxh4be
category_id: 49yov609ez
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Single Sign-On (SSO) with LDAP
slug: sso-ldap
description: Harness supports Single Sign-On (SSO) with LDAP implementations, including
  Active Directory and OpenLDAP. This topic covers how to integrate Harness with LDAP,
  and how to sync and delink User Groups.
short_version: Harness supports Single Sign-On (SSO) with LDAP, such as Active Directory
  and OpenLDAP.
tags:
- security
- SSO
- 'single sign-on '
- LDAP
- Active Directory
- OpenLDAP
- access control
- User Group
- permission
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: Article updated
  source: API
  triggered_at: 2022-09-05T11:16:43.292909Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Single Sign-On (SSO) with LDAP
  description: Harness supports Single Sign-On (SSO) with LDAP implementations, including
    Active Directory and OpenLDAP. This topic covers how to integrate Harness with
    LDAP, and how to sync and delink User Groups.
  short_version: Harness supports Single Sign-On (SSO) with LDAP, such as Active Directory
    and OpenLDAP.
  body: |-
    <p>Harness supports Single Sign-On (SSO) with LDAP implementations, including Active Directory and OpenLDAP. Integrating Harness with your LDAP directory enables you to log your LDAP users into Harness as part of Harness&#39; SSO infrastructure.</p><p>Once you integrate your Harness account with LDAP, you can create a Harness User Group and sync it with your LDAP directory users and groups. Then the users in your LDAP directory can log into Harness using their LDAP emails and passwords.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/85rycqfiqg/1537566178712/image.png" style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure><p>In this topic:</p><p></p><ul><li><a href="https://docs.harness.io/article/85rycqfiqg-sso-ldap#video_demonstration">Video Demonstration</a></li><li><a href="https://docs.harness.io/article/85rycqfiqg-sso-ldap#limitations">Limitations</a></li><li><a href="https://docs.harness.io/article/85rycqfiqg-sso-ldap#before_you_begin">Before You Begin</a></li><li><a href="https://docs.harness.io/article/85rycqfiqg-sso-ldap#setup_overview">Setup Overview</a></li><li><a href="https://docs.harness.io/article/85rycqfiqg-sso-ldap#ports_and_permissions">Ports and Permissions</a></li><li><a href="https://docs.harness.io/article/85rycqfiqg-sso-ldap#add_ldap_sso_provider">Add LDAP SSO Provider</a></li><li><a href="#schedule_ldap_group_sync">Schedule LDAP Group Sync</a></li><li><a href="https://docs.harness.io/article/85rycqfiqg-sso-ldap#add_a_harness_admin_for_ldap_users">Add a Harness Admin for LDAP Users</a></li><li><a href="https://docs.harness.io/article/85rycqfiqg-sso-ldap#add_a_harness_user_group_using_ldap_users">Add a Harness User Group using LDAP Users</a></li><li><a href="https://docs.harness.io/article/85rycqfiqg-sso-ldap#enable_ldap_for_sso">Enable LDAP for SSO</a></li><li><a href="https://docs.harness.io/article/85rycqfiqg-sso-ldap#log_in_using_synched_user">Log In Using Synched User</a></li><li><a href="https://docs.harness.io/article/85rycqfiqg-sso-ldap#delink_a_user_group_from_ldap">Delink a User Group from LDAP</a></li><li><a href="https://docs.harness.io/article/85rycqfiqg-sso-ldap#ldap_linked_users_locked_out_of_harness">LDAP-linked Users Locked Out of Harness</a></li><li><a href="https://docs.harness.io/article/85rycqfiqg-sso-ldap#troubleshooting">Troubleshooting</a></li><li><a href="https://docs.harness.io/article/85rycqfiqg-sso-ldap#using_power_shell_to_find_users">Using PowerShell to Find Users</a></li></ul><h3>Video Demonstration</h3><ul><li><a href="https://docs.harness.io/article/85rycqfiqg-sso-ldap#log_in_using_synched_user">Sync</a></li></ul><p>For a quick run through the Harness LDAP SSO functionality, watch the following video.</p><div class="hd--embed" data-provider="Wistia" data-thumbnail=""><iframe src="//fast.wistia.net/embed/iframe/3uhtxudd4q" allowtransparency="true" frameborder="0" scrolling="no" class="wistia_embed" name="wistia_embed" allowfullscreen="" mozallowfullscreen="" webkitallowfullscreen="" oallowfullscreen="" msallowfullscreen="" width="620" height="349"></iframe><script src="//fast.wistia.net/assets/external/E-v1.js" async=""></script></div><p></p><h3>Limitations</h3><ul><li>Nested LDAP groups are not supported.</li></ul><h3>Before You Begin</h3><ul><li><a href="/article/zlymcu6bf1-authentication-settings">Authentication Settings</a> provides an overview of Harness&#39; broader login-management options.</li></ul><h3>Setup Overview</h3><p>Here are the steps for setting up Harness SSO with LDAP:</p><ol><li>Add LDAP as a SSO Provider in Harness. This step involves authenticating with your LDAP server and defining how Harness will query it for users and groups.</li><li>Add a Harness administrator using a user from your LDAP directory. This administrator will manage your LDAP-linked Harness user groups.</li><li>Add a Harness User Group and link it to your LDAP directory. Harness syncs all the users in that LDAP user group automatically and manages user authorization.</li><li>​Enable the LDAP Provider you set up in Harness as the Harness SSO provider. Simply click the <strong>Enable</strong> button next to your new LDAP SSO provider in Harness.</li><li>To verify the LDAP SSO, log into Harness using one of the synchronized LDAP users.</li></ol><div class="note-callout">Users provisioned with LDAP are sent an email invitation to log into Harness. They must use the invitation to log in. If SAML is also set up with Harness, then can log in via SAML. See <a href="/article/zy8yjcrqzg-single-sign-on-sso-with-saml">Single Sign-On (SSO) with SAML</a>.</div><p></p><h4>Harness Local Login</h4><p>To prevent lockouts or in the event of OAuth downtime, a User in the Harness Administrators Group or with <strong>Administer Other Account Functions</strong> permissions can use the <a href="http://app.harness.io/auth/#/local-login"><strong>Local Login</strong></a> URL (http://app.harness.io/auth/#/local-login) to log in and update the OAuth settings.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/rb33l4x893/1638374284838/screenshot-2021-12-01-at-9-27-06-pm.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><ol><li>Log in using <strong>Harness Local Login</strong>.</li><li>Change the settings to enable users to log in.</li></ol><h3>Ports and Permissions</h3><p>The following ports and permissions are required to add LDAP as a Harness SSO provider.</p><h4>Ports</h4><p>The Harness LDAP connection is between the Harness delegate and your LDAP server. The delegate uses the following ports:</p><ul><li>HTTPS: 443.</li><li>LDAP without SSL: 389.</li><li>Secure LDAP (LDAPS): 636. By default, LDAP traffic is transmitted unsecured. For Windows Active Directory, you can make LDAP traffic confidential and secure by using SSL/TLS. You can enable LDAP over SSL by installing a certificate from a Microsoft certification authority (CA) or a non-Microsoft CA.</li></ul><h4>Permissions</h4><p>Authentication with an LDAP server is called the Bind operation. The Bind operation exchanges authentication information between the LDAP client (Harness delegate) and your LDAP server. The security-related semantics of this operation are in RFC4513.</p><p>When you configure Harness with LDAP, you will enter a Bind DN (distinguished name) for the LDAP directory user account used to authenticate.</p><p>The specific permissions needed by Harness depend on the LDAP directory service you are using.</p><ul><li><strong>Windows Active Directory:</strong> By default, all Active Directory users in the <strong>Authenticated Users</strong> group have Read permissions to the entire Active Directory infrastructure. If you have limited this, ensure that the account used to connect Harness may enumerate the Active Directory LDAP users and groups by assigning it <strong>Read MemberOf</strong> rights to <strong>User</strong> objects. Changing the default is not a trivial task and requires you to change the basic authorization settings of your Active Directory. For more information, see <a href="https://docs.microsoft.com/en-us/windows-server/manage/windows-admin-center/configure/user-access-control" target="_blank">Configure User Access Control and Permissions</a> from Microsoft.</li><li><strong>OpenLDAP:</strong> The default access control policy is allow read by all clients. If you change this default, ensure that the account used to connect Harness to OpenLDAP is granted the <strong>Authenticated users</strong> entity. For more information, see <a href="https://www.openldap.org/doc/admin24/access-control.html" target="_blank">Access Control</a> from OpenLDAP.</li></ul><h3>Add LDAP SSO Provider</h3><p>Adding your LDAP Provider to Harness initially involves establishing a connection from Harness (specifically, the Harness delegate) and querying your LDAP directory for the users and groups you want to sync with Harness for SSO.</p><h4>Querying Your LDAP Directory</h4><p>If you need to query your LDAP server before or during the Harness LDAP SSO setup, use the <strong>ldapsearch</strong> CLI tool (Linux/Mac), <a href="http://www.ldapadmin.org/" target="_blank">LDAP Admin</a> (Windows), the <strong>dsquery</strong> CLI tool (Windows), <strong>Active Directory Users and Computers</strong> (Windows), or <a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/ee617195(v=technet.10)" target="_blank">Windows PowerShell</a>.</p><p>For example, the following ldapsearch will query an Active Directory LDAP directory running on a AWS EC2 instance and return LDAP Data Interchange Format (LDIF) output, which you can pipe to a file if needed:</p><pre>ldapsearch -h example.com -p 389 -x -b &#34;DC=example,DC=com&#34;</pre><p>The output will include the distinguished names, objectClass, and canonical names for the objects in the LDAP directory.</p><p>The same query using dsquery to query Active Directory is:</p><pre>dsquery * -limit 0 &gt;&gt;all-objects.txt</pre><p>To query for all users using dsquery:</p><pre>dsquery * -limit 0 -filter &#34;&amp;(objectClass=User)(objectCategory=Person)&#34; -attr * &gt;&gt;all-users.txt</pre><h4>Enabling LDAP for Harness SSO</h4><p>To add your LDAP directory as a Harness SSO provider, use the following procedure.</p><div class="note-callout">Once LDAP is set up and enabled in Harness, you cannot add a second LDAP SSO entry in Harness. The UI for adding LDAP will be disabled.</div><ol><li>Log into <strong>Harness</strong>, mouseover <strong>Continuous Security</strong>, and then click <strong>Access Management</strong>.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/85rycqfiqg/1549589249045/image.png" style="max-height:25%;max-width:25%" data-hd-height="25%" data-hd-width="25%"/></figure></li><li>From the resulting <strong>Access Management</strong> page, click <strong>Authentication Settings</strong>.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/85rycqfiqg/1578095229893/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li><li>From the <strong>Authentication Settings</strong> page, click <strong>Add SSO Providers</strong>, then click <strong>LDAP</strong>.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/85rycqfiqg/1578095255803/image.png"/></figure></li><li>If prompted, disable the <strong>Allow login via public OAuth providers</strong> slider.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/15xfy3639u/1561144837769/image.png" style="max-height:75%;max-width:75%" data-hd-height="75%" data-hd-width="75%"/></figure>Then again select <strong>Add SSO Providers &gt; LDAP</strong>. The <strong>Add</strong> <strong>LDAP Provider</strong> dialog appears.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/15xfy3639u/1561147194161/image.png" style="max-height:60%;max-width:60%" data-hd-height="60%" data-hd-width="60%"/></figure></li></ol><p>In this <strong>Add</strong> <strong>LDAP Provider</strong> dialog, you will authenticate with your LDAP server, and then perform user and group LDAP queries to ensure that Harness can sync your LDAP users and groups when you enable LDAP SSO.</p><ol><li style="counter-increment:li 4" start="5">Configure the <strong>Connection Query</strong>.<br/>The <strong>Connection Query</strong> section has the following fields and settings.<table><tbody><tr><td><p><strong>Field</strong></p></td><td><p><strong>Description</strong></p></td></tr><tr><td><p><strong>Display Name</strong></p></td><td><p>Enter a name for the LDAP SSO provider in Harness.</p></td></tr><tr><td><p><strong>Host</strong></p></td><td><p>Enter the hostname for the LDAP server. Harness uses DNS to resolve the hostname. You can also use the public IP address of the host.</p></td></tr><tr><td><p><strong>Port</strong></p></td><td><p>Enter 389 for standard LDAP. If you want to connect over Secure LDAP (LDAPS), use port 636, and enable the <strong>Use SSL</strong> setting.</p></td></tr><tr><td><p><strong>Use SSL</strong></p></td><td><p>Enable this setting if you entered port 636 in <strong>Port</strong> and are connecting over Secure LDAP (LDAPS).</p></td></tr><tr><td><p><strong>Max Referral Hops</strong></p></td><td><p>If you have referrals configured for your LDAP authentication, select the adjacent <strong>Enable Referrals</strong> check box and enter the number of referrals here. For information on LDAP referrals, see <a href="https://tools.ietf.org/html/rfc4511#section-4.1.10" target="_blank">Referral</a> in RFC 4511 or <a href="https://docs.microsoft.com/en-us/windows/desktop/ad/referrals" target="_blank">Referrals</a> from Microsoft.</p></td></tr><tr><td><p><strong>Connection Timeout</strong></p></td><td><p>Enter the number of milliseconds to wait for an LDAP connection before timing out. For example, <code>5000</code> is equal to 5 seconds.</p></td></tr><tr><td><p><strong>Recursive Membership Search</strong></p></td><td><p>Enable/disable nested LDAP queries to optimize LDAP Group Sync performance. If you uncheck the <strong>Recursive Membership Search</strong> setting Harness will not run nested LDAP query and only do a flat group search.</p></td></tr><tr><td><p><strong>Response Timeout</strong></p></td><td><p>Enter the number of milliseconds to wait for an LDAP response before timing out. For example, <code>5000</code> is equal to 5 seconds.</p></td></tr><tr><td><p><strong>Bind DN</strong></p></td><td><p>The distinguished name of the directory object used for the Bind operation. The Bind operation is the authentication exchange between Harness and the LDAP server. Typically, this is the user object for the administrator. For example:</p><p><strong>cn=Administrator,CN=Users,DC=example,DC=com</strong></p><p>This user will be used for all LDAP queries performed by Harness.</p></td></tr><tr><td><p><strong>Password</strong></p></td><td><p>The password to log into the LDAP host. This is the password associated with the user identified in <strong>Bind DN</strong>.</p></td></tr></tbody></table><ol><li>When you have filled in the <strong>Connection Query</strong>, click <strong>TEST CONNECTION</strong>. You are notified when the connection is successful.<br/>If the test is unsuccessful, please see <a href="#troubleshooting">Troubleshooting</a>.</li><li>Click <strong>Next</strong>.</li></ol></li><li>Configure the <strong>User Queries</strong>. The <strong>User Queries</strong> section is used to search the LDAP directory for users that Harness will add as Harness users. When you set the <strong>User Queries</strong> here, you are setting the scope within which any searches for LDAP users will be performed by Harness. Later, when LDAP SSO is enabled, the settings is the <strong>User Queries</strong> section will be used to search for any user logging into Harness.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/15xfy3639u/1561148295000/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure>The <strong>User Queries</strong> section has the following fields and settings.<table><tbody><tr><td><p><strong>Field</strong></p></td><td><p><strong>Description</strong></p></td></tr><tr><td><p><strong>Base DN</strong></p></td><td><p>Enter the relative distinguished name (RDN) for the Users object in the directory.</p><p>If you are logged into the Active Directory server, you can enter <strong>dsquery user</strong> at the command line and you will see a distinguished name for a user object, such as:</p><p><strong>CN=John Doe,CN=Users,DC=mycompany,DC=com</strong></p><p>The <strong>Base DN</strong> is the relative distinguished name (RDN) following the user common name (CN). Typically, this is the Base DN you should enter:</p><p><strong>CN=Users,DC=mycompany,DC=com</strong></p><p>Once you have the Base DN, you can ensure that it provides all of the attributes for your LDAP users with the <strong>dsquery</strong> command piped to <strong>dsget user</strong>:</p><p><strong>dsquery user dc=mycompany,dc=com | dsget user -samid -fn -ln -dn</strong></p><p>The result will include all of the users and help you with setting up your query.</p></td></tr><tr><td><p><strong>Search Filter</strong></p></td><td><p>The filter defines the conditions that must be fulfilled for the LDAP search using the entry in <strong>Base DN</strong>. Enter the search filter for the attribute to use when looking for users belonging to the <strong>Base DN</strong>. Typically, <strong>Search Filter</strong> is either:</p><p><strong>(objectClass=user)</strong> or <strong>(objectClass=person)</strong></p><p>In dsquery, if the command <strong>dsquery * -filter &#34;(objectClass=user)&#34;</strong> returns the LDAP users then <strong>(objectClass=user)</strong> is the correct filter.</p></td></tr><tr><td><p><strong>Name Attribute</strong></p></td><td><p>Enter the common name attribute for the users in your LDAP directory. Typically, this is <strong>cn</strong>. To list all attributes for a user, enter the following dsquery:</p><p><strong>dsquery * &#34;CN=users,DC=mycompany,DC=com&#34; -filter &#34;(samaccountname=</strong><em><strong>user_name</strong></em><strong>)&#34; -attr *</strong></p></td></tr><tr><td><p><strong>Email Attribute</strong></p></td><td><p>Enter the LDAP user attribute that contains the users&#39; email address. Harness uses email addresses to identify users. Typically, the attribute name is <strong>userPrincipalName</strong> (most common), <strong>email</strong> or <strong>mail</strong>.</p></td></tr><tr><td><p><strong>Group Membership Attribute</strong></p></td><td><p>Enter <strong>memberOf</strong> to return a list of all of the groups of which each user is a member. The dsquery for all groups the user John Doe (john.doe) is a member of would be:</p><p><strong>dsquery user -samid john.doe | dsget user -memberof | dsget group -samid</strong></p></td></tr></tbody></table><ol><li>When you have filled in the <strong>User Queries</strong>, click <strong>TEST USER</strong>. You are notified when the search is successful.</li><li>Click <strong>Next</strong>.</li></ol></li><li>Configure the <strong>Group Query</strong>. The <strong>Group Query</strong> section is used to search the LDAP directory for user groups that Harness will sync with to create Harness user groups. When you set the <strong>Group Query</strong> here, you are setting the scope wherein any searches for LDAP groups will be performed.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/85rycqfiqg/1537479685895/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure>The <strong>Group Query</strong> section has the following fields.<br/><table><tbody><tr><td><p><strong>Field</strong></p></td><td><p><strong>Description</strong></p></td></tr><tr><td><p><strong>Base DN</strong></p></td><td><p>Enter the distinguished name of the LDAP group you want to add. This should be the LDAP group containing the users you searched for in <strong>User Queries</strong>. To see a list of all the groups in your LDAP directory, use this dsquery command:</p><p><strong>dsquery group -o dn DC=mycompany,DC=com</strong></p><p>To ensure that the group contains the members you want, use the dsget command:</p><p><strong>dsget group &#34;CN=</strong><em><strong>Group_Name</strong></em><strong>,CN=Users,DC=mycompnay,DC=com&#34; -members | dsget user -samid -upn -desc</strong></p><p>Typically, you will want to pick the Users group that gives future searches for groups a wide scope. For example:</p><p><strong>CN=Users,DC=mycompany,DC=com</strong></p><p>Later, when you search for LDAP groups as part of adding group members to Harness, your search will be performed within the scope of the group you set in <strong>Base DN</strong>.</p></td></tr><tr><td><p><strong>Search Filter</strong></p></td><td><p>Enter <strong>(objectClass=group)</strong> because you are searching for an LDAP group.</p></td></tr><tr><td><p><strong>Name Attribute</strong></p></td><td><p>Enter <strong>cn</strong> for the name attribute.</p></td></tr><tr><td><p><strong>Description Attribute</strong></p></td><td><p>Enter <strong>description</strong> to sync the LDAP group description. To see the description in your LDAP directory, use dsquery:</p><p><strong>dsquery * -Filter &#34;(objectCategory=group)&#34; -attr sAMAccountName description</strong></p></td></tr></tbody></table><ol><li>When you have filled in the <strong>Group Query</strong>, click <strong>TEST GROUP</strong>. You are notified when the search is successful.</li></ol></li><li>Click <strong>SUBMIT</strong>. The new <strong>LDAP Provider</strong> is listed in the SSO Providers.<br/>Before you enable LDAP SSO for Harness, you will create a Harness Administrator using a user from your LDAP directory, and add the users from an LDAP group to a Harness user group.</li></ol><h3>Schedule LDAP Group Sync</h3><div class="note-callout">Currently, this feature is behind the Feature Flag <code>LDAP_GROUP_SYNC_JOB_ITERATOR</code>. Contact <a href="mailto:support@harness.io" target="_blank">Harness Support</a> to enable the feature.</div><p>By default, Harness syncs with your server every 15 minutes. If your LDAP server is slow in responding to queries it can cause a ripple effect on other systems.</p><p>The <strong>Schedule LDAP Group Sync</strong> setting provides scheduling using a Cron expression. This allows you to run the sync outside of business hours when your LDAP server is less likely to be under heavy load.</p><p>In <strong>Cron Expression</strong>, enter the schedule for the sync as a Cron expression.</p><p>For example, <code>0 0 5 ? * * *</code> will result in <code>At 05:00:00am every day</code>.</p><p>You can find <a href="https://www.freeformatter.com/cron-expression-generator-quartz.html" target="_blank">Cron expression editors online</a>.</p><p>Click <strong>Execution Time</strong>.</p><p>The first 5 iterations appear as a sample.</p><pre>Iteration 1 : 2021-09-24T02:00:00-07:00<br/><br/>Iteration 2 : 2021-09-25T02:00:00-07:00<br/><br/>Iteration 3 : 2021-09-26T02:00:00-07:00<br/><br/>Iteration 4 : 2021-09-27T02:00:00-07:00<br/><br/>Iteration 5 : 2021-09-28T02:00:00-07:00</pre><p></p><p></p><h3>Add a Harness Admin for LDAP Users</h3><p>Before LDAP SSO is enabled for Harness, create a Harness administrator for the LDAP users you will be adding. The new administrator is defined using a specific LDAP user&#39;s email address. For example, a <strong>User logon name</strong> and <strong>Active Directory domain name</strong>: john.doe@mycompany.com.</p><div class="note-callout">At least one LDAP user account should be a member of the Harness Administrators group, or have full <strong>Account Permissions</strong>. This will ensure that you can fully manage Harness once you enable LDAP SSO in Harness.</div><p>To create a Harness administrator for your LDAP users, do the following:</p><ol><li>In <strong>Harness</strong>, mouseover <strong>Continuous Security</strong>, and click <strong>Access Management</strong>.</li><li>Click <strong>Users</strong>.</li><li>Click <strong>Add User</strong>. The <strong>Add User</strong> dialog appears.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/85rycqfiqg/1537485458159/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li><li>In <strong>Email Address(es)</strong>, enter the email address of a user from the LDAP user group you plan to sync with Harness. For Active Directory, this is the email address in the <strong>Account</strong> tab for the user, under <strong>User logon name</strong>.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/85rycqfiqg/1537485640755/image.png" style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure></li><li>In the <strong>Add User</strong> dialog, click <strong>User Groups</strong>, and select <strong>Account Administrator</strong>.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/85rycqfiqg/1537485743318/image.png" style="max-height:20%;max-width:20%" data-hd-height="20%" data-hd-width="20%"/></figure></li><li>Click <strong>SUBMIT</strong>. An email will be sent to the email address you entered, inviting you to log into Harness and create a password. You do not need to use the email because later, once you have enabled LDAP SSO in Harness, you can use the email and password from Active Directory.</li><li><strong>Do not log out of Harness</strong>. Later, after you have added LDAP users to Harness, you can log out and back in with the LDAP email address and the password you use for your LDAP directory.<br/>Now you can add a new Harness user group for your LDAP users and sync it with your LDAP provider.</li></ol><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;add_a_harness_user_group_using_ldap_users&#34;&gt;&lt;/span&gt;"><p><span id="add_a_harness_user_group_using_ldap_users"></span></p>
    </div><h3>Add a Harness User Group with LDAP Users</h3><p>Once you have configured an LDAP SSO Provider for Harness, you can create a Harness User Group and sync it to your LDAP directory. Later, when LDAP SSO is enabled in Harness, and users in this group log into Harness, Harness will verify their email addresses and passwords using its connection to the LDAP provider.</p><p>Harness treats LDAP group names as case-sensitive. QA, Qa, qA, will all create new groups.</p><p>If there are duplicate names synced with Harness, Harness adds an <code>_1</code> suffix.</p><p>Users added to the LDAP-linked Harness User Group are also added as Harness Users. If the Harness User Group is removed, the User account remains, and when the User logs into Harness, its email address and password are verified by the LDAP provider. The User can also be added to any other Harness User Group.</p><div class="note-callout">Harness syncs with the LDAP server every 15 minutes. Consequently, if a user is removed from the LDAP server, it will take up to 15 minutes before the user is removed from Harness User Group automatically. You must remove the corresponding Harness User account separately. Look for users with <strong>user not registered</strong> in their <strong>Name</strong> column or <strong>None</strong> in their <strong>User Groups</strong> column.</div><p>To sync your LDAP users with a Harness user group, do the following:</p><ol><li>In <strong>Harness</strong>, mouseover <strong>Continuous Security</strong>, and click <strong>Access Management</strong>.</li><li>Click <strong>User Groups</strong>.</li><li>Click <strong>Add User Group</strong>. The <strong>Add User Group</strong> dialog appears.</li></ol><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/85rycqfiqg/1537483713202/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><ol><li>In <strong>Name</strong>, enter a name for your LDAP users, such as <strong>Active Directory</strong>.</li><li>Click <strong>SUBMIT</strong>. The new group page appears.</li><li>In <strong>Member Users</strong>, click <strong>Link to External Directory</strong>. The <strong>Link External LDAP Group</strong> dialog appears. You will use this dialog to query the LDAP Provider you added to Harness for the LDAP users to add to this Harness user group.</li><li>In <strong>LDAP Group Search Query</strong>, enter the common name of the LDAP user group, such as <strong>Harness</strong>, and click <strong>SEARCH</strong>. The search results display matching groups.<br/>Remember, the scope of the LDAP group search in the <strong>Link External LDAP Group</strong> dialog is limited by the <strong>Connection</strong>, <strong>User</strong>, and <strong>Group Query</strong> search you defined in your <strong>LDAP Provide</strong>r in Harness:<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/15xfy3639u/1561148590620/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure>The search results in the <strong>Link External LDAP Group</strong> dialog display the groups that fall within the scope of the queries you defined in your LDAP Provider <strong>and</strong> match the name you enter. For example, here are the search results for the LDAP user group named <strong>Harness</strong>. You can see that the group in Active Directory and in the <strong>Link External LDAP Group</strong> dialog search results has two members.<table class="borderless"><tbody><tr><td><p><strong>Group in Active Directory</strong></p></td></tr><tr><td><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/85rycqfiqg/1537488007715/image.png" style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure></td></tr><tr><td><p><strong>Search Results in Harness</strong></p></td></tr><tr><td><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/85rycqfiqg/1537488202738/image.png" style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure></td></tr></tbody></table></li><li>For the group you want to sync, click <strong>Link Group</strong>. The group is linked and the dialog closes. The <strong>Member Users</strong> section of the Harness group page displays the new link.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/85rycqfiqg/1537555972707/image.png" style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure>It will take a few minutes to sync the LDAP group users with the Harness group. Harness syncs with the LDAP server every 10 minutes. If you add users in your LDAP directory you will not see it immediately in Harness. Once Harness syncs with your LDAP directory, the users are added to the Harness group.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/85rycqfiqg/1537556177759/image.png" style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure></li><li>Set any <strong>Account Permissions</strong> and <strong>Application Permissions</strong> for the user group. Without <strong>Account Permissions</strong> configured, the users will not be able to perform operations in Harness. For more information, see <a href="/article/ven0bvulsj-users-and-permissions#permissions">Users and Permissions</a>.</li></ol><div class="note-callout">LDAP users that do not have the user attribute for email are not displayed because Harness uses email addresses as the user login.</div><p>Now that you have a Harness user group containing your LDAP users, you can safely enable LDAP SSO in Harness.</p><h3>Enable LDAP for SSO</h3><p>You can enable the LDAP SSO Provider you configured in Harness and begin using LDAP as the login method for Harness users.</p><div class="warning-callout">Before you enable LDAP for SSO and log out of Harness to test it, ensure that your LDAP users have the passwords associated with their email addresses. If they do not have the passwords, they will be locked out of Harness. Remember, Active Directory passwords are stored using non-reversible encryption.You can also add a new user to your LDAP group, record its password, wait 15 minutes for the corresponding Harness group to refresh, and then log into Harness using the new user. If any lockout problem occurs, contact Harness Support at <a href="mailto:support@harness.io">support@harness.io</a>.</div><p>To enable the LDAP Provider, do the following:</p><ol><li>In Harness, mouseover <strong>Continuous Security</strong>, and then click <strong>Access Management</strong>.</li><li>Click <strong>SSO Provider Setup</strong> to view the LDAP Provider.</li><li>Click the checkbox under <strong>Enabled</strong>. A confirmation dialog appears.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/85rycqfiqg/1537482951029/image.png" style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure><div class="note-callout">The confirmation dialog reminds you to ensure the Harness Delegate can connect to the LDAP server, and both are up and running. Any interruption in the connection will impact users&#39; ability to log in to Harness.</div>If you want to confirm the Harness delegate can connect and query the LDAP Provider, then close this dialog, open the LDAP Provider you configured in <strong>Access Management</strong>, and use the <strong>TEST QUERY</strong>, <strong>TEST USER</strong>, and <strong>TEST GROUP</strong> buttons in the <strong>LDAP Provider</strong> settings to verify connectivity and queries.</li><li>Click <strong>CONFIRM</strong>. The LDAP SSO Provider is enabled.</li></ol><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;login_using_synched_user&#34;&gt;&lt;/span&gt;"><p><span id="login_using_synched_user"></span></p>
    </div><h3>Log In Using Synched User</h3><div class="note-callout">Users provisioned with LDAP are sent an email invitation to log into Harness. They must use the invitation to log in. If SAML is also set up with Harness, then can log in via SAML. See <a href="/article/zy8yjcrqzg-single-sign-on-sso-with-saml">Single Sign-On (SSO) with SAML</a>.</div><p>With a Harness user group synced with a LDAP group and LDAP SSO enabled, you can now log into Harness using LDAP users from the LDAP group.</p><p>To log into Harness using an LDAP user, do the following:</p><ol><li>Select which user you want to test from the Harness user group you synched with your LDAP provider. If necessary, create a new user in your LDAP group, and, in Harness, refresh your user group with the LDAP provider to add that user to Harness.</li><li>If you are logged into Harness, log out.</li><li>Log into Harness using the email address and password for a user in your LDAP group. If you encounter errors, see <a href="#troubleshooting">Troubleshooting</a>.</li></ol><h3>Delink a User Group from LDAP</h3><p>In you want to remove the external link between a Harness user group and your LDAP provider, you can delink the Harness user group.</p><div class="note-callout">Delinking a User does not remove the User from Harness. It removes them from the LDAP-linked User Group. To removes the User, go to the <strong>Users</strong> page, find the individual User account, and delete the User.</div><p>To delink a Harness user group from its linked LDAP provider, do the following:</p><ol><li>In Harness, mouseover <strong>Continuous Security</strong>, and click <strong>Access Management</strong>.</li><li>Click <strong>User Groups</strong>.</li><li>Click the user group that is linked to the LDAP provider. The linked user groups are identified using a link icon, the LDAP Provider you set up in Harness, and the synched LDAP user group.</li></ol><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/85rycqfiqg/1537558560236/image.png" style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure><p></p><ol><li>Click the name of the user group to open its settings.</li><li>Click <strong>Delink Group</strong> to remove the link to the LDAP provider.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/85rycqfiqg/1537558665382/image.png" style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure>You are prompted to confirm.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/85rycqfiqg/1537558692558/image.png" style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure></li><li>Click <strong>Retain all members in the user group</strong> to keep the users in this Harness user group. If LDAP SSO is enabled in Harness, the users can still log into Harness. If LDAP SSO is disabled, then the user cannot log into Harness.</li><li>Click <strong>CONFIRM</strong>.</li></ol><p></p><h3>LDAP-linked Users Locked Out of Harness</h3><div class="warning-callout">If any lockout problem occurs, contact Harness Support at <a href="mailto:support@harness.io">support@harness.io</a>. Harness SaaS and On-Prem admins can use <strong>Local Login</strong>, described below.</div><p>If you have LDAP SSO enabled, the users and groups that the LDAP Provider in Harness can locate should be able to log into Harness. If login is not working, then it is likely due to one of the following causes:</p><ul><li>Harness cannot locate the user in the LDAP directory configured as its LDAP Provider.</li><li>LDAP server cannot be reached by the Harness Delegate. See <a href="https://docs.harness.io/article/85rycqfiqg-sso-ldap#connection_query_error">Connection Query Error</a> below.</li><li>LDAP SSO is disabled.</li><li>LDAP SSO has been changed (for example, a password in LDAP) and Harness cannot locate or authenticate the user in the LDAP provider.</li><li>LDAP directory (attributes, users, groups, membership, etc) has changed and Harness cannot locate the user in the LDAP provider according to the settings in its <strong>LDAP Provider</strong>.</li></ul><h4>Solutions</h4><ul><li>If LDAP SSO is disabled, enable it.</li><li>Locate the user(s) in your LDAP directory and then change the configuration of the LDAP Provider to find the user. Obtain the user(s)&#39; base distinguished name and use that in the <strong>User Queries</strong> of the <strong>LDAP Provider</strong> configuration.</li><li>Determine which LDAP setting has changed in your corporate LDAP directory configuration and update the LDAP settings in Harness. For example, if the Base DN password changed in your corporate LDAP configuration, update the Password in the Harness LDAP settings:</li></ul><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/85rycqfiqg/1563893952864/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>If you need to update a password in both Harness and your LDAP directory, update the password in Harness first, and then update it in your LDAP directory. For example:</p><pre>dsquery user &#34;OU=users,DC=example,DC=local&#34; -limit 0 | dsmod user -pwd &lt;new_password&gt; -mustchpwd yes</pre><p>This ensures that you can log into Harness once your LDAP directory password is updated. Harness syncs with your LDAP server every 15 minutes.</p><h4>Harness Local Login</h4><p>To prevent lockouts or in the event of OAuth downtime, a User in the Harness Administrators Group can use the <a href="http://app.harness.io/auth/#/local-login"><strong>Local Login</strong></a> URL (http://app.harness.io/auth/#/local-login) to log in and update the OAuth settings.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/rb33l4x893/1638374284838/screenshot-2021-12-01-at-9-27-06-pm.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><ol><li>Log in using <strong>Harness Local Login</strong>.</li><li>Change the settings to enable users to log in.</li></ol><p></p><h3>Troubleshooting</h3><p>The following errors might occur during the set up or use of LDAP SSO.</p><h4>Connection Query Error</h4><p>When setting up the LDAP Provider and attempting the <strong>Connection Query</strong>, the following message appears.</p><pre class="hljs bash">Invalid request: No delegates could reach the resource.</pre><p>Here is how the error appears in the LDAP Provider dialog.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/85rycqfiqg/1537387263304/image.png" style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure><h5>Cause</h5><p>This can occur if the Harness delegate is unable to connect to the LDAP server.</p><h5>Solution</h5><ul><li>Ensure the delegate is running. In <strong>Harness</strong>, click <strong>Setup</strong>, click <strong>Harness Delegates</strong>, and then verify that the delegate is running. For more information, see <a href="/article/h9tkwmkrm7-delegate-installation">Delegate Installation</a>.</li><li>Ensure that the delegate can connect to the LDAP server from its network location. If the delegate is running in a VPC, ensure that it a has outbound HTTPS and LDAP connections over ports 443 and 389.</li><li>Ensure the password in the <strong>Connection Query</strong> is correct.</li><li>Try to connect with SSL disabled. You might not have SSL configured on your LDAP server.</li><li>The delegate attempts to resolve the hostname of the LDAP server using DNS. Ensure that the LDAP server host name can be resolved in DNS using <strong>nslookup</strong> and ping its IP address.</li></ul><h4>User Query Error</h4><p>When attempting the <strong>User Queries</strong> in the <strong>LDAP Provider</strong> dialog, the following message appears.</p><pre>Please check configuration. Server returned zero record for the configuration.</pre><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/85rycqfiqg/1537388336254/image.png" style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure><h5>Cause</h5><p>The User Query is unable to return users from the LDAP provider because its search settings do not match users in the LDAP directory.</p><h5>Solution</h5><ul><li>If the Connection Query is working, the failure of the User Query is likely because the Base DN does not have users in it. Try <strong>CN=Users,DC=mycompany,DC=com</strong> or <strong>DC=mycompany,DC=com</strong>.</li><li>It is possible that the <strong>Search Filter</strong> does not return users. Try <strong>(objectClass=person)</strong> and <strong>(objectClass=user)</strong>.</li></ul><h4>No Members Returned from Link External LDAP Group Search</h4><p>When you attempt to link a user group to an LDAP Provider, Harness uses the settings of the LDAP Provider you configured to locate the groups and group members in your LDAP directory.</p><p></p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/15xfy3639u/1561149223435/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><p>In some cases, you might be unable to locate a group, or members of a group.</p><h5>Cause</h5><ul><li>LDAP Provider settings are incorrect, and cannot locate the group and users you want according to its <strong>Connection</strong>, <strong>User</strong>, and <strong>Group Query</strong> settings.</li></ul><h5>Solution</h5><ul><li>Locate the group using your LDAP directory tools, such as <strong>Active Directory Users and Groups</strong>. Confirm the LDAP Base DN for the group and the members of the group. Use that Base DN in the User Query section of the LDAP Provider in Harness.</li></ul><h3>Using PowerShell to Find Users</h3><p>You can use Windows PowerShell to export a list of Active Directory users. When setting up your LDAP Provider, a list of the users you want to sync with Harness can be useful.</p><p>To get a list of attributes for a user:</p><pre>Get-ADUser username -Properties *</pre><p>Export all users by name to a csv file:</p><pre>Get-ADUser -Filter * -Properties * | Select-Object name | export-csv -path c:\export\allusers.csv</pre><p>Export all users by name and email:</p><pre>Get-ADUser –filter * -property * | Select-object Name, mail</pre><p>Export all from a specific OU:</p><pre>Get-ADUser -Filter * -SearchBase &#34;OU=Devops,OU=UserAccounts,DC=EXAMPLE,DC=COM&#34;</pre><h4>Using Active Directory Users and Computers</h4><p>You can also obtain a list of group members using the <strong>Saved Queries</strong> feature of <strong>Active Directory Users and Computers</strong>.</p><ol><li>On the Active Directory domain controller, open Active Directory Users and Computers</li><li>Right-click <strong>Saved Queries</strong>, click <strong>New</strong>, and select <strong>Query</strong>.</li><li>Enter a name for your query, such as <strong>Harness</strong>.</li><li>Click the <strong>Define Query</strong> button.</li><li>From <strong>Find</strong>, select <strong>Users, Contacts, and Groups</strong>.</li><li>Click the <strong>Advanced</strong> tab.</li><li>Click <strong>Field</strong>, then <strong>User</strong>, and then <strong>Member of</strong>.</li><li>Using the condition <strong>is (exactly)</strong>, and paste the group&#39;s DN (such as <strong>CN=Harness,CN=Users,DC=mycompany,DC=com</strong>) into the <strong>Value</strong> field.</li><li>Click <strong>Add</strong>.</li><li>Click <strong>OK</strong> twice to complete the query.</li><li>Click the query and then click the <strong>Refresh</strong> button. Here is what the query and results look like:<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/85rycqfiqg/1537819263595/image.png" style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure></li><li>Click the <strong>Export list</strong> button to export the list to a file.</li></ol><h3>Notes</h3><ul><li>Once LDAP is set up and enabled in Harness, you cannot add a second LDAP SSO entry in Harness. The UI for adding LDAP will be disabled.</li></ul><p></p><p></p>
  slug: sso-ldap
  tags:
  - security
  - SSO
  - 'single sign-on '
  - LDAP
  - Active Directory
  - OpenLDAP
  - access control
  - User Group
  - permission
  is_live: true
