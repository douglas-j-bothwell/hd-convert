<h3>Minor Release 76025</h3><p>Release Date: July 31, 2022</p><div class="warning-callout"><strong>Important information about upgrading Timescale DB<br/><br/></strong>Before you upgrade, you must install the following <code>timescaledb_upgrade.sh</code> script.<br/><br/></div><p></p><details><summary>timescaledb_upgrade.sh</summary><div><pre class="hljs bash">#!/bin/bash<br/><br/>[[ -z $1 ]] &amp;&amp; echo &#34;No Namespace specified, please run $0 &lt;namespace&gt;, or $0 &lt;namespace&gt; restore_dump -- to restore the dump.out generated by the script from current directory.&#34; &amp;&amp; exit 1 || ns=&#34;$1&#34;<br/><br/>###<br/><br/>MONGO_URI=$(echo `kubectl -n $ns get secret harness-manager-config -o yaml |grep MONGO_URI |cut -d : -f2 | head -1 |base64 -d -i`)<br/>log=&#34;update_tsdb.log&#34;<br/>schema_ver=`kubectl exec -it mongodb-replicaset-chart-0 -n $ns -- mongo &#34;$MONGO_URI&#34; --quiet --eval &#34;db.schema.find({})&#34; |cut -d : -f5 |cut -d , -f1 |cut -c2-`<br/><br/>###<br/><br/>function checkret() {<br/>        if [ $? -ne 0 ]; then<br/>          echo &#34;[FAIL]&#34; ; exit 1<br/>        else<br/>          echo &#34;[OK]&#34;<br/>        fi<br/>}<br/><br/>        if [ &#34;$2&#34; = &#34;restore_dump&#34; ] ; then<br/>                echo -n &#34;restore_dump detected, copying dump.out from current directory to tsdb...&#34;<br/>                if [ -f ./dump.out ] ; then<br/>                        kubectl cp dump.out $ns/timescaledb-single-chart-0:/home/postgres/dump.out &amp;&gt;&gt;$log<br/>                                checkret<br/>                echo -n &#34;Restoring dump.out to tsdb(postgres)...&#34;<br/>                        kubectl exec -it timescaledb-single-chart-0 -n $ns -- bash -c &#34;psql &lt; dump.out&#34; &amp;&gt;&gt;$log<br/>                                checkret<br/>                        echo &#34;Restoration complete, exiting...&#34; ; exit 0<br/>                else<br/>                echo &#34;[FAIL - dump.out not detected in `pwd`, exiting]&#34; ; exit 1<br/>                fi<br/>        else<br/>                echo &#34;timescaledb upgrade preparations, if you encounter any issues please provide $log to support@harness.io, proceeding...&#34;<br/>        fi<br/><br/><br/><br/>##########<br/><br/>echo &#34;Schema version = $schema_ver&#34;<br/>echo -n &#34;Updating schema version $schema_ver to 0 for tsdb...&#34;<br/><br/>kubectl exec -it mongodb-replicaset-chart-0 -n $ns -- mongo &#34;$MONGO_URI&#34; --quiet --eval &#34;db.schema.update({&#34;version&#34;: $schema_ver}, { \$set : {&#34;timescaleDbVersion&#34; : 0, &#34;timescaleDBDataVersion&#34; :0}})&#34; &amp;&gt;&gt;$log<br/>        checkret<br/><br/>echo -n &#34;Taking dump of postgres...&#34;<br/>        kubectl exec -it timescaledb-single-chart-0 -n $ns -- bash -c &#34;pg_dumpall &gt; dump.out&#34; &amp;&gt;&gt;$log<br/>        checkret<br/><br/>echo -n &#34;Copying postgres db dump to local direcotry: `pwd`/dump.out...&#34;<br/>        kubectl cp $ns/timescaledb-single-chart-0:/home/postgres/dump.out dump.out &amp;&gt;&gt;$log<br/>        checkret<br/><br/>echo &#34;Backup complete, confirm dump.out is valid, and press ENTER to continue, CTRL+C to abort...&#34;<br/>        read wait;<br/><br/>echo -e &#34;<br/><br/>Removing statefulsets and pvcs:&#34;<br/><br/>echo -n &#34;Removing statefulset for TSDB...&#34;<br/>kubectl delete sts timescaledb-single-chart -n $ns &amp;&gt;&gt;$log<br/>        checkret<br/><br/>echo -n &#34;Removing TSDB service...&#34;<br/>kubectl delete svc timescaledb-single-chart timescaledb-single-chart-config timescaledb-single-chart-replica -n $ns &amp;&gt;&gt;$log<br/>        checkret<br/><br/>echo -n &#34;Removing TSDB PVCs(storage-volume-timescaledb-single-chart-0)...&#34;<br/>kubectl delete pvc storage-volume-timescaledb-single-chart-0 -n $ns &amp;&gt;&gt;$log<br/>                checkret<br/><br/>echo -n &#34;Removing TSDB PVCs(storage-volume-timescaledb-single-chart-1)...&#34;<br/>        kubectl get pvc storage-volume-timescaledb-single-chart-1 -n $ns &amp;&gt;&gt;$log<br/>        if [ $? -ne 0 ] ; then<br/>        echo &#34;not found, skipping.&#34;<br/>        else<br/>        kubectl delete pvc storage-volume-timescaledb-single-chart-1 -n $ns &amp;&gt;&gt;$log<br/>        echo &#34;[OK]&#34;<br/>        fi<br/><br/>        for ep in `kubectl get ep |grep timescale | cut -d &#39; &#39; -f1` ; do<br/><br/>echo -n &#34;Removing TSDB endpoint($ep)...&#34;<br/>        kubectl delete ep $ep -n $ns &amp;&gt;&gt;$log<br/>                checkret<br/>        done<br/><br/><br/>echo -e &#34;TSDB backup/dump completed, please proceed with upgrade to 756xx release.<br/>*****************************************************************************<br/>NOTE: All data should be rebuilt within TSDB, optionally however, if you are<br/>seeing inconsistent data, run the following to restore your dump to tsdb:<br/><br/>$0 &lt;namespace&gt; restore_dump<br/><br/>this will restore the dump taken to postgres within tsdb.<br/><br/>Any issues, please contact support@harness.io&#34; ; exit 0<br/></pre></div></details><p>We&#39;re pleased to present Harness SaaS Release 76025.</p><h4>New Features and Enhancements</h4><h5>Platform and Delegate</h5><ul><li>Added a time-to-live (TTL) value to Delegate task assignment data. This ensures the expiration and discard of old records (DEL-4409)</li><li>Implement Immutable Delegate Operations Suite (formerly Stackdriver) logging. Immutable Delegates now transmit logs to Harness Manager (DEL-4285)</li><li>Updated immutable Delegates to use JRE version 11.0.14 (DEL-4281)</li><li>Fixed a problem with the current performance log in the Delegate (DEL-4233)</li><li>Introduced the <code>validTillNextRelease</code> boolean value to indicate that the current Delegate version is the latest version and considered valid (DEL-4198)</li><li>Changed the <code>LdapSettingsDTO</code> class to support the use of the new manager with older Delegates (DEL-4099)</li><li>Added API support to list the required Delegates during automated installation and use (DEL-3520).</li><li>Separated the endpoints used for monitoring from those used by agents for instance sync. This improves monitoring and problem identification (CDS-38387)</li><li>Changed custom deployments to eliminate polling and permit an empty artifact source script. If no script is specified, the deployment uses the provided artifact version and version information is available in the artifact variable<code>${artifact.*}</code> (CDS-34235)</li><li>Added support for Jira User assignment fields. You can now create or update Jira issues with fields of type &#34;user&#34; (CDS-28853)</li></ul><h4>Continuous Deployment</h4><ul><li>Changed the end point for agents to call for instance sync. This ensures separations for end points to monitor which helps us identifying issues faster. (CDS-38387, ZD-339265)</li><li>Custom artifact source script can be made empty now. If the script is empty, the deployment proceeds with the version customer provides and the same details will be available in the artifact variable which can be accessed using ${artifact.*} (CDS-34235, ZD-319303, ZD-28100)</li><li>You can now update/create Jira issues with fields of type <code>user</code>. (CDS-28853, ZD-237529)</li></ul><h4>Issues Fixed in This Release</h4><ul><li>Resolved a schema problem that caused GraphQL API to fail with &#34;TypeError: Type SecretManagerConfig must define one or more fields.&#34; The failure occurred when schema validation was enabled (PL-26534, ZD-32450, ZD-32477, ZD-32501)</li><li>Resolved a problem that resulted in failed calls made with an API key to GraphQL API. The user experienced a &#34;not authorized&#34; error (PL-26261) - <span style="color:#f44e3b" data-hd-color="#f44e3b">For Public RelNotes Summary, the entry was NO -- should this item have relnotes?</span></li><li>Application Permissions under User Groups does not load (PL-26111, ZD-32018)</li><li>Missing Kryo register for class io.harness.exception.InterruptedRuntimeException.class (PL-26018)<br/>Registered the class in kryo.</li><li>Kryo exception in Delegate logs with <code>ScmGitFileTaskParams</code> (PL-25981) - <span style="color:#d33115" data-hd-color="#d33115">THIS IS MARKED NA BUT INCLUDED FOR MINOR RELEASE 75805</span></li><li>Resolved a problem that made API keys visible an available for GraphQL mutation (PL-25976) <span style="color:#d33115" data-hd-color="#d33115">- THIS IS MARKED BUG - SHOULD IT BE DOCUMENTED?</span></li><li>Resolved a side effect of a logic change that triggered &#34;Files Unavailable&#34; messages to appear in the UI under &#34;Git Sync Activity&#34; when Delegates were not available (PL-25873, ZD-30962)</li><li>Improved the user experience in Secrets Manager for function and usability (PL-25859)</li><li>Improved the user experience in Cloud Secrets loader for function and style (PL-25756)</li><li>Fixed a problem that prevented editing the usage scope of Secret Managers appearing on pages 2 and higher in a paginated list of Secret Managers that belong to an account (PL-25702, ZD-31154, ZD-31424)</li><li>Improved the error messaging that is generated when a secret that is not scoped to an application is used in a regular expression. The original error message said that the secret did not exist (PL-25601, ZD-31263)</li><li>Removed the Slack channel name UI element and updated snapshots (PL-25559)</li><li>Fixed a problem that intermittently prevented the deletion of old entity names in git. The issue occured when an entity was renamed in Harness application and affected customers who used rename operation with git sync in CG (PL-25117, ZD-30527)</li><li>Improved the specificity of a generic error message to aid in understanding the problem (PL_24963, ZD-30093)</li><li>Eliminated the option to delete userGroup references in a pipeline using GraphQL unless the pipelines are deleted (PL-24821, ZD-30056, DZ-30935)</li><li>With the new Secrets component which loads secret with typeahead and renders them in paginated fashion in a dropdown.Feature flag USE_PAGINATED_ENCRYPT_SERVICE should be enabled for the new component to load (PL-24586, ZD-20770, ZD-29889, ZD-30552, ZD-30978, ZD-31525)</li><li>Enhanced the current component and added search-ability &amp; paginated responses using infinite scroll (PL-25448, ZD-31159)</li><li>Changed the confi-as-code <code>upsert-entity</code> API to return HTTP 400 on failure (PL-23938)</li><li>Improved the behavior of the UI when a user group is created with a long name (PL-11098)</li><li>Rolled back Java SDK to version 1.0.5.1 (FFM-3643)</li><li>Fix backward incompatible enum change with latest versions of manager (DEL-4479, ZD-32463)</li><li>Resolved a problem that caused immutable delegates to download client tools even when download was explicitly disabled (DEL-4478)</li><li>Fixed an issue that caused no-tools images to download tools on-the-fly (DEL-4475)</li><li>Fixed a problem that caused Slack messages sent by Delegates to fail (DEL-4431, ZD-32250)</li><li>Changed behavior to disallow Harness support users from downloading Delegates on customer accounts (DEL-4425)</li><li>Corrected a regression issue that prevented Delegates from sending email to customers over SMTP (DEL-4403, ZD-<br/>31746, ZD-31898, ZD-31917, ZD-31986, ZD-31990)</li><li>Increased time out for network calls from delegate as task acquire call is timing out before completion when there are more than 100 secrets to decrypt (DEL-4399, ZD-32084)</li><li>Fixed API to accept ringName in cases where Delegate ring is enabled (DEL-4295)</li><li>Resolved an issue where, under high load conditions, Harness Manager sometimes sent a Delegate the incorrect version of Java. The issue resulted in termination without recovery for Delegate processes (DEL-4291, ZD-31673)</li><li>Logging dependency was removed during cleanup of delegate dependencies, most likely because they were not showing up in dependency graph as they are not directly referenced from code, causing delegate to stop logging to stack driver (DEL-4278)</li><li>Resolved an issue that prevented some older ECS executions from loading in the UI (DEL-4277, ZD-31501, ZD-31622)</li><li>Changed an issue in the Delegate websockets connection to Harness Manager to allow for quicker reconnects when network problems occur (DEL-4269, ZD-31018, ZD-31589, ZD-31849)</li><li>Adding more details in delegate logs in case the calls from delegate to manager are failing (DEL-4236, ZD-31346)</li><li>Added filtering by delegate status (DEL-4231, ZD-31001)</li><li>There was an issue in copying the config files in case the manager and delegates are on different version. This fixes the backward incompatibility (DEL-4209, ZD-31145)</li><li>New warning in delegate logs to show if heartbeat is delayed more than 3 minutes (DEL-4167, ZD-30491)</li><li>In the Delegate input selectors, it can backspace all the characters, not only up to the first character of text only. Also, by pressing the backspace button twice it can remove the previous tags (DEL-3331)</li><li>Added null check for environment so that if no environments present it should not crash the deployment filters (CDS-39936)</li><li>While adding infradefinition as template in a pipeline stage and choosing the option to &#39;always skip&#39; the stage, the deployment was throwing an error message saying infra is invalid.We were still validating infra even when stage is marked as &#39;always skipped&#39; in which case infra can be empty. Skipped validation of infra in that case to fix the bug.Now we will successfully be able to select &#39;skip always&#39; option for infra templatized stages too (CDS-39825)</li><li>For customers who had feature flag PIPELINE_PER_ENV_DEPLOYMENT_PERMISSION enabled can now work with trigger creation with templatized pipeline (CDS-39740, ZD-32239)</li><li>Improved the Error Message for Rancher Cloud Provider Test connection Failure (CDS-39235)</li><li>Fixed &#34;workflow execution not found&#34; exception on service dashboard page (CDS-39230, ZD-32027, ZD-32029)</li><li>The issue was because Currently, we limit to 500 artifacts and then apply pattern filter.<br/>Fix: We now first apply the pattern filter to all artifacts and then limit it to 500.</li><li>There were some missing attributes like processes, metadata etc. in PCF manifest due to which it wasn&#39;t being parsed. Have added the supported CF attributes</li><li>Fixed shell script step authentication on GKE 1.19+. While the response from, for instance, kubectl command invoked in a shell script step was previously &#34;Unauthorized&#34;, now the platform will authenticate correctly if the cloud provider credentials are valid (CDS-38837, ZD-31452)</li><li>Fix: Service dashboard fails to load if the pods for any deployment is manually scaled up from 0 (CDS-38830, ZD-31642)</li><li>Text will be truncated if its length is more than the length of box (CDS-38828)</li><li>Fixed a bug where big artifacts list was not being trimmed down at slack messages- Fixed a bug where large messages were being restricted by Slack API (CDS-38677, ZD-31302, ZD-32268)</li><li>If PCF Setup task fails after creation of the app, the app name revert was failing as the newly created app conflicted with the renames, now it will delete the newly created app if the setup is not successful and then it will start renaming the old apps. Also have added the error message to the UI (CDS-38672, ZD-31471)</li><li>Added more details when Helm deploy task fails because of connectivity issues with K8s cluster (CDS-38663)</li><li>Customer will be able to use Terragrunt Destroy Step even with underlying terraform version &gt; 15.0.0 (CDS-38662, ZD-31506)</li><li>Fixed an issue when application defaults are configured using code (CDS-38624 ZD-31467)</li><li>Manifest collection directory is changed from /manifest-collection-{app-manifest-id}/ to /manifest-collection/{app-manifest-id} to reduce clutter in home folder (CDS-38543, ZD-30994)</li><li>While picking previous approvals to reject with auto reject previous approvals feature, only workflows waiting on same approval step is considered (CDS-38525)</li><li>With this FF on, a static timeout of 3min is added in git fetch operation in K8s and Native helm swimlanes in CG (CDS-38492, ZD-31294)</li><li>User group could have been deleted if they were part of deployment freeze which led to dangling references in freeze windows. Going forward user group can&#39;t be deleted if they are part of deployment freeze (CDS-038177)</li><li>Fixed retry logic to start chart museum server in case the port is already in use (CDS-38135, ZD-31129)</li><li>No notes req since it was for one cuxtomer (CDS-37918, ZD-30951)</li><li>The deployment status was showing wrong artifact in custom deployment type when a rollback happened. Have fixed this to show the correct artifact (CDS-37806, ZD-30352)</li><li>Added the execution capability of SM to verify the eligibility of delegate to access the SM (CDS-37797, ZD-30884)</li><li>made timeout as required field (CDS-37524, ZD 30412)</li><li>YAMI won&#39;t have service name and environment name in case it is templatized (CDS-37480, ZD-28531)</li><li>new change will make call in group of 15 items every time you scroll, and also if you type it will search for those 15 items with the written text . The changes are behind a ff , so that testing scope is not increased and we can quickly move the changes (CDS-37471, ZD-30667)</li><li>Displayed the service artifact version and enhanced the design on hovering over the details (CDS-37635)</li><li>We added a monitor to detect when a workflow has an active status, is stuck in a not execution step, and for more than 45 minutes. The REPEAT, FORK, PHASE_STEP, PHASE, and SUB_WORKFLOW are considered not execution steps.This feature is behind FF named WORKFLOW_EXECUTION_ZOMBIE_MONITOR.Two info level log messages are added to help in future troubleshooting.# Evaluating if workflow execution {} is a zombie execution [workflowId={}] – Printed when monitor found a stuck/zombie candidate.# Trigger force abort of workflow execution {} due remains in a zombie state [currentStateType={}] – Printed when is detected the zombie conditions, running for more than 10 minutes in a not execution step (CDS-36559, ZD-18501, ZD-29096)</li></ul><p></p>