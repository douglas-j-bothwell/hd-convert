<p>You can configure Workflows to skip one or more steps based on different conditions.</p><p>Harness users often have Workflows that are very similar, but differ in settings such as Service, Environment, or artifact. Instead if managing multiple Workflows, you can merge these Workflows and add conditions that skip specific steps based on these different conditions.</p><div class="note-callout">You can add Workflow step skip conditions to any Harness Workflow types.</div><p>In this topic:</p><ul><li><a href="#before_you_begin">Before You Begin</a></li><li><a href="#option_1_skip_all_steps_in_a_section">Option 1: Skip All Steps in a Section</a></li><li><a href="#option_2_skip_specific_steps_in_a_section">Option 2: Skip Specific Steps in a Section</a></li><li><a href="#option_3_skip_rollback_steps">Option 3: Skip Rollback Steps</a></li><li><a href="#review_what_conditions_can_i_use">Review: What Conditions Can I Use?</a><ul><li><a href="#regex">Regex</a></li><li><a href="#operators">Operators</a></li></ul></li><li><a href="#limitations">Limitations</a></li><li><a href="#next_steps">Next Steps</a></li></ul><h3>Before You Begin</h3><ul><li><a href="/article/m220i1tnia-workflow-configuration">Workflows</a></li><li><a href="/article/9dvxcegm90-variables">Variables and Expressions in Harness</a></li></ul><h3>Option 1: Skip All Steps in a Section</h3><div class="note-callout">This example uses Harness Workflow templates and Harness built-in variable expressions. See <a href="/article/m220i1tnia-workflow-configuration#template_a_workflow">Template a Workflow</a> and <a href="/article/9dvxcegm90-variables">Variables and Expressions in Harness</a>.</div><p>Open a Workflow that contains multiple steps that you want skipped under a specific condition.</p><p>For example, here is a Workflow that deploys a WAR file to physical servers.</p><p>It contains two <strong>Prepare Infra</strong> steps to select nodes:</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583190149024/image.png" style="max-height:25%;max-width:25%" data-hd-height="25%" data-hd-width="25%"/></figure><p>For this example, you want to skip all of these steps if the name of the Environment used by the Workflow is <strong>testing</strong>.</p><p>Click the more options button (<strong>︙</strong>) next to <strong>Prepare Infra</strong> to see its options.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583190190909/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>In <strong>Execution</strong>, click <strong>Conditional</strong>. The <strong>Conditional Execution</strong> settings appear.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583188619504/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Click <strong>All Steps</strong>.</p><p>In <strong>Skip condition</strong>, enter the condition to evaluate. Enter <code>$</code> to see the available Harness built-in variables. See <a href="/article/9dvxcegm90-variables">Variables and Expressions in Harness</a>.</p><p>Skip conditions are boolean. If the condition you enter in <strong>Skip condition</strong> evaluates to <strong>true</strong>, all of the steps in <strong>Prepare Infra</strong> are skipped.</p><p>Skip conditions use <a href="https://commons.apache.org/proper/commons-jexl/reference/syntax.html" target="_blank">Java Expression Language (JEXL)</a>. You could use simply use a condition like <code>myvalue == true</code>.</p><p>Skip conditions support advanced expressions. For example:</p><p><code>!${workflow.variables.A} == 1 || ${workflow.variables.B} == 2)</code></p><p>Review the operators in the <a href="https://commons.apache.org/proper/commons-jexl/reference/syntax.html#Operators" target="_blank">JEXL reference</a>.</p><p>In our example, we want the steps skipped if the name if the Environment used by the Workflow is <strong>testing</strong>. The <strong>Conditional Execution</strong> settings are: <code>${env.name} == &#39;testing&#39;</code></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583189625111/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>The variable expression <code>${env.name}</code> is one of the many built-in Harness expressions.</p><p>Click <strong>Submit</strong>. The Workflow indicates that the section is using skip conditions, and displays the skip condition you set up:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583190291231/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>In this example we deploy the Workflow and select <strong>testing</strong> for the Environment. This means that the skip condition evaluates to true, and the steps are skipped.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583190886230/image.png"/></figure><p>As you can see, the deployment results indicates the skip condition.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583191120943/image.png"/></figure><p></p><p>If you wish to remove the defined conditional expressions, click on the <strong>Default</strong> button and confirm.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1586343168214/screenshot-2020-04-08-at-4-17-51-pm.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><h3>Option 2: Skip Specific Steps in a Section</h3><p>You can skip specific steps based on a condition.</p><p>Open a Workflow, and click the more options button (<strong>︙</strong>) next to a section heading, such as <strong>Prepare Infra</strong>.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583190190909/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>In <strong>Execution</strong>, click <strong>Conditional</strong>. The <strong>Conditional Execution</strong> settings appear.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583188619504/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Click <strong>Selected steps</strong>. In <strong>Skip Conditions</strong> click <strong>Add</strong>. The settings for adding multiple conditions appear.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583191890608/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Click in <strong>Skip</strong> and select the step(s) you want to set a skip condition on.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583191969640/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>In <strong>Skip condition</strong>, enter the condition to evaluate. Enter <code>$</code> to see the available Harness built-in variables.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583192852815/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Click <strong>Add</strong> to add conditions for other steps. Here&#39;s an example with conditions for two steps using the variable expression <code>${infra.name}</code>.</p><p></p><p>The <code>${infra.name}</code> evaluates to the name of the Infrastructure Definition used by this Workflow at deployment runtime. See <a href="/article/9dvxcegm90-variables">Variables and Expressions in Harness</a> for other built-in expressions.</p><p>In this example, two conditions are added:</p><ul><li>The Infrastructure Definition named <strong>QA</strong> is selected as the condition value, and the step <strong>Select_Nodes_Dev</strong> is selected as the skip step.</li><li>The Infrastructure Definition named <strong>DEV</strong> is selected as the condition value, and the step <strong>Select_Nodes_QA</strong> is skipped.</li></ul><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583192898928/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><p>Click <strong>Submit</strong>. The Workflow indicates that each step is using skip conditions, and displays the skip condition you set up for each step:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583192948957/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>In this example we deploy the Workflow and select <strong>DEV</strong> for the Infrastructure Infrastructure. This means that the skip condition evaluates to true, and the <strong>Select Nodes_QA</strong> step is skipped.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583193281029/image.png"/></figure><p>As you can see, the deployment results indicates the skip condition.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583193378131/image.png"/></figure><p></p><h3>Option 3: Skip Rollback Steps</h3><p>You can add skip conditions to steps in a Workflow <strong>Rollback Steps</strong> section.</p><p>For example, in a Harness Kubernetes Canary Workflow there is a default rollback step, <strong>Rollback Deployment</strong>.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583193933047/image.png" style="max-height:25%;max-width:25%" data-hd-height="25%" data-hd-width="25%"/></figure><p>Perhaps you are testing and do not want to rollback the deployment if it fails. You can click the more option button next to <strong>Deploy</strong> and then in <strong>Execution</strong> click <strong>Conditional</strong>.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583194005809/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>In <strong>Conditional Execution</strong>, you can set a condition to skip the <strong>Rollback Deployment</strong> step if the name of the Environment used by the Workflow is <strong>testing</strong>:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583194179880/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><h3>Review: What Conditions Can I Use?</h3><div class="note-callout">You cannot use Harness secrets in conditions.</div><p>The conditions you set in <strong>Conditional Execution</strong> are boolean. If the condition evaluates to <strong>true</strong>, the selected step is skipped.</p><p>The conditions follow the syntax <code>val1 == val2</code>.</p><p>You can use boolean values <code>true</code> and <code>false</code>, or any other value that can be evaluated.</p><p>Skip conditions use <a href="https://commons.apache.org/proper/commons-jexl/reference/syntax.html" target="_blank">Java Expression Language (JEXL)</a>. You could use simply use a condition like <code>myvalue == true</code>.</p><p>Skip conditions support advanced expressions. For example:</p><p><code>!${workflow.variables.A} == 1 || ${workflow.variables.B} == 2)</code></p><p>Review the operators in the <a href="https://commons.apache.org/proper/commons-jexl/reference/syntax.html#Operators" target="_blank">JEXL reference</a>.</p><p>For variable expressions, you can use:</p><ul><li>Harness built-in variable expressions.</li><li>Expressions that reference Service or Workflow variables you created.</li><li>Expressions that reference variables published as part of an Approval Stage in a Pipeline.</li></ul><p>Ensure the variable referenced by the expression is available in the Workflow section where you have applied the skip condition.</p><p>For example, Service variables are not available in Canary or Multi-Service Workflow <strong>Pre-deployment Steps</strong>. This is because in these Workflow types, the Service is selected in the Phases that follow the <strong>Pre-deployment Steps</strong>.</p><p>If the variable expression you select cannot be evaluated, the Workflow will fail.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583194897033/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><h4>Regex</h4><p>Harness supports the <a href="https://commons.apache.org/proper/commons-jexl/reference/syntax.html" target="_blank">Java Expression Language (JEXL)</a>. You can use JEXL regex in your skip conditions.</p><p>For example, if the artifact the Workflow is deploying is named <strong>todolist.war</strong> you could use the following regex in your skip condition: <code>${artifact.fileName} =~ &#39;^todo.*&#39;</code>.</p><h4>Operators</h4><p>Harness supports <a href="https://commons.apache.org/proper/commons-jexl/reference/syntax.html#Operators" target="_blank">JEXL operators</a>. Since skip conditions are boolean, you may only use operators that evaluate to true or false. An expression that evaluates to a numeric value like <code>${artifact.buildNo}*10</code> will not work.</p><p>As an example of other operators, you can use the Starts With <code>=^</code> operator like this <code>${infra.name} =^ &#39;Q&#39;</code> :</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583196157149/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>If you select the <strong>QA</strong> Infrastructure Definition at deployment, the condition is matched because <strong>QA</strong> starts with <strong>Q</strong> and the <strong>Select Nodes_Dev</strong> is skipped:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583196274207/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><p>Here is another example using the Inequality <code>!=</code> operator:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/02i1k7nvsj/1583194832404/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><h3>Limitations</h3><ul><li>Skip conditions do not support the Ternary conditional <code>?:</code> operator.</li></ul><h3>Next Steps</h3><ul><li><a href="/article/9dvxcegm90-variables">Variables and Expressions in Harness</a></li></ul><p></p>