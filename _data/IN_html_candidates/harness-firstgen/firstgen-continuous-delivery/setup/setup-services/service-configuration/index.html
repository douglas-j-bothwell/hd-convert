<p>Services represent your microservices/apps. You define where the artifacts for those services come from, and you define the container specs, configuration variables, and files for those services.</p><div class="note-callout">This is a general overview of a Harness Service. For detailed deployment information for each type of Service, see <a href="/article/i3n6qr8p5i-deployments-overview">Deployments Overview</a> and select your deployment type.</div><h3>In this topic:</h3><ul><li> <a href="#before_you_begin">Before You Begin</a></li><li> <a href="#add_a_service">Step 1: Add a Service</a></li><li> <a href="#service_types">Step 2: Select Deployment Type</a></li><li> <a href="#artifact_sources">Step 3: Select an Artifact Source</a></li><li><a href="#option_configure_artifact_collection">Option: Configure Artifact Collection</a></li><li><a href="#option_manually_select_an_artifact">Option: Manually Select an Artifact</a></li><li><a href="#container_specs">Container Specs and Manifests</a></li></ul><p></p><h3>Before You Begin</h3><ul><li>Read the <a href="/article/bucothemly-application-configuration">Create an Application</a> topic to get an overview of how Harness organizes Services.</li><li>Read the <a href="/article/eb3kfl8uls-service-configuration">Add a Service</a> topic to understand the process to add a Service to an Application.</li><li>Read <a href="/article/htvzryeqjw-configuration-as-code">Configuration as Code</a> to see how you can quickly configure your Harness Service using your existing YAML in Git.</li></ul><h3>Step 1: Add a Service to a Harness Application</h3><p>To add a service, do the following:</p><ol><li>Click <strong>Setup</strong>, and then click the name of your application. The application entities appear.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/ot0kiyfgqj/1587015087282/app-overview.png"/></figure></li><li>Click <strong>Services</strong>, and then click <strong>Add Service</strong>. The <strong>Service</strong> dialog appears.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/ot0kiyfgqj/1587015197221/add-service.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li><li>Select a <strong>Deployment Type</strong>. Each deployment type will set up a Service for its deployment platform. For example, selecting <strong>Kubernetes</strong> creates a Service with default Kubernetes manifest files.</li><li>Click <strong>SUBMIT</strong>. The <strong>Service Overview</strong> appears.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/ot0kiyfgqj/1587016220544/service-overview.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure> In this new Service you will set up artifacts, container specs, and configuration files and variables.</li></ol><h3>Step 2: Select Deployment Type</h3><p>There are multiple Service types used in Harness, listed in the <strong>Deployment Type</strong> field, such as Kubernetes and Helm.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/ot0kiyfgqj/1587015992242/deploytypes.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><p>These Service types are discussed in detail in the deployment guides for those platforms. For more information, see <a href="/article/i3n6qr8p5i-deployments-overview">Deployments Overview</a>.</p><h3>Step 3: Add an Artifact Source</h3><p>Different Service types support different artifact sources, such as Docker or Amazon AMI. For details on different service types and artifact sources, see <a href="/article/qluiky79j8-service-types-and-artifact-sources">Service Types and Artifact Sources</a>.</p><p>For most deployment types, you add an artifact source and then reference it in the Service or Workflow.</p><div class="note-callout">If you do not reference the artifact source somewhere in your Harness entities, via a Service spec or Shell Script Workflow step, for example, Harness does not use it.</div><p>For example, in a Kubernetes Service, you add an Artifact Source for the Docker image you want to deploy. Here&#39;s an example using an nginx image on Docker Hub:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/eb3kfl8uls/1605568763283/image.png"/></figure><p>Next, you reference the artifact <strong>image</strong> and <strong>dockercfg</strong> secret in the Kubernetes manifest <strong>values.yaml</strong> file. Here&#39;s the default that is created automatically when you add a new Kubernetes Service:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/eb3kfl8uls/1605568998242/image.png"/></figure><p>And here are the values referenced using the Go templating expressions <code>{{.Values.image}}</code> and <code>{{.Values.dockercfg}}</code> in the Secret and Deployment manifests in the same Service:</p><pre>{{- if .Values.createImagePullSecret}}<br/>apiVersion: v1<br/>kind: Secret<br/>metadata:<br/>  name: {{.Values.name}}-dockercfg<br/>  annotations:<br/>    harness.io/skip-versioning: true<br/>data:<br/>  .dockercfg: {{.Values.dockercfg}}<br/>type: kubernetes.io/dockercfg<br/>---<br/>{{- end}}<br/>...<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: {{.Values.name}}-deployment<br/>spec:<br/>  replicas: {{int .Values.replicas}}<br/>  selector:<br/>    matchLabels:<br/>      app: {{.Values.name}}<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: {{.Values.name}}<br/>    spec:<br/>      {{- if .Values.createImagePullSecret}}<br/>      imagePullSecrets:<br/>      - name: {{.Values.name}}-dockercfg<br/>      {{- end}}<br/>      containers:<br/>      - name: {{.Values.name}}<br/>        image: {{.Values.image}}<br/>        {{- if or .Values.env.config .Values.env.secrets}}<br/>        envFrom:<br/>        {{- if .Values.env.config}}<br/>        - configMapRef:<br/>            name: {{.Values.name}}<br/>        {{- end}}<br/>        {{- if .Values.env.secrets}}<br/>        - secretRef:<br/>            name: {{.Values.name}}<br/>        {{- end}}<br/>        {{- end}}</pre><p>The above referencing of the artifact source is done automatically when you create a new Kubernetes Service, but it is important to remember that you must reference the artifact when you create your own manifests in Harness.</p><h3>Option: Configure Artifact Collection</h3><p></p><div class="note-callout">Currently, this feature is behind the Feature Flag <code>ARTIFACT_COLLECTION_CONFIGURABLE</code>. Contact <a href="mailto:support@harness.io" target="_blank">Harness Support</a> to enable the feature.</div><p></p><p>You can control how Harness collects artifacts using the <strong>Auto Collect Artifact</strong> option in <strong>Artifact Source</strong>.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/eb3kfl8uls/1632861025356/clean-shot-2021-09-28-at-13-30-02.png"/></figure><p>By default, artifact collection runs every 3 minutes. If you have shared resources such as artifact servers and secret managers you might notice a lot of API calls. This number of calls can lead to an increase in load and theoretically impact system stability. Also, some services have rate limiting that can be impacted.</p><p>The <strong>Auto Collect Artifact</strong> option in <strong>Artifact Source</strong> allows you to enable and disable artifact collection to prevent any issues. Also, Harness provides the following artifact collection information:</p><ul><li><strong>Failed Attempts:</strong> the number of times artifact collection failed.</li></ul><div class="note-callout"><strong>Auto Collect Artifact</strong> is automatically disabled if the number of failed collections exceeds 3500. You can reset artifact collection using the <strong>Reset Artifact Collection</strong> button in the status message.</div><ul><li><strong>Last Polled At:</strong> the last time Harness attempted to collect the artifact.</li><li><strong>Last Collected At:</strong> the last time Harness successfully collected the artifact.</li><li><strong>Artifact Collection Status:</strong> shows if the collection is successful, retrying, or failed.</li></ul><p>Let&#39;s look at some examples. </p><h4>Disabled</h4><p>When the <strong>Auto Collect Artifact</strong> option in <strong>Artifact Source</strong> is not selected, artifact collection is disabled.</p><p>Hover over the Artifact Source to see the status.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/eb3kfl8uls/1635444282035/clean-shot-2021-10-28-at-11-04-30.png"/></figure><div class="note-callout"><strong>Auto Collect Artifact</strong> is automatically disabled if the number of failed collections exceeds 3500. You can reset artifact collection using the <strong>Reset Artifact Collection</strong> button in the status message.</div><h4>Enabled</h4><p>When the <strong>Auto Collect Artifact</strong> option in <strong>Artifact Source</strong> is selected, artifact collection is enabled.</p><p>Hover over the Artifact Source to see the status.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/eb3kfl8uls/1635444321420/clean-shot-2021-10-28-at-11-05-13.png"/></figure><p></p><p></p><h4>Enabled and Retrying</h4><p>When the <strong>Auto Collect Artifact</strong> option in <strong>Artifact Source</strong> is selected but collection failed, Harness will retry collection.</p><p>Hover over the Artifact Source to see the status.</p><p></p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/eb3kfl8uls/1635444361694/clean-shot-2021-10-28-at-11-05-54.png"/></figure><h4>Reset Artifact Collection when Maximum Failed Attempts Reached</h4><p>If artifact collection failures have reached the maximum of 3500 attempts, you can reset artifact collection using the <strong>Reset Artifact Collection</strong> button in the status message.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/eb3kfl8uls/1635444411195/clean-shot-2021-10-28-at-11-06-41.png"/></figure><h4>Artifact Collection with Harness GraphQL</h4><p>You can enable/disable artifact collection for an Artifact Source using Harness GraphQL API.</p><p>First, you&#39;ll need the Artifact Source Id. Obtain the Artifact Source Id by querying the Service:</p><pre class="hljs graphql">query{<br/>  service(serviceId: &#34;60HIgOKdTayQUh3F2dndVw&#34;){<br/>    artifactSources{<br/>      id<br/>      name<br/>      artifacts(limit:10, offset:0){<br/>        nodes {<br/>          id<br/>          buildNo<br/>        }<br/>      }<br/>    }<br/>  }<br/>}</pre><p></p><p>This will give you a response with all Artifact Sources for the Service. Save the Id of the Artifact Source you want to enable/disable collections for.</p><p>Next, use <code>setArtifactCollectionEnabled</code> to enable or disable the Artifact Source collection.</p><p>You set the <code>artifactCollectionEnabled</code> to <code>true</code> to enable collection or <code>false</code> to disable collection.</p><pre class="hljs graphql">mutation {<br/>  setArtifactCollectionEnabled (input:{<br/>    clientMutationId:&#34;abc&#34;,<br/>    appId:&#34;d2GfddtSRHSmW2TpFhIreA&#34;,<br/>    artifactStreamId:&#34;pXESnvkXSA210zrAlbCxPw&#34;,<br/>    artifactCollectionEnabled:true<br/>  })<br/>  {<br/>    clientMutationId<br/>    message<br/>  }<br/>}</pre><p></p><p>The Artifact Source Id you collected earlier is used by <code>artifactStreamId</code>. The Application Id is entered in <code>appId</code>.</p><p>The response of the mutations will be something like this:</p><pre>{<br/>  &#34;data&#34;: {<br/>    &#34;setArtifactCollectionEnabled&#34;: {<br/>      &#34;clientMutationId&#34;: &#34;abc&#34;,<br/>      &#34;message&#34;: &#34;Successfully set artifact collection enabled&#34;<br/>    }<br/>  }<br/>}</pre><h3>Option: Manually Select an Artifact</h3><p>You can have Harness pull a list of builds and versions from an Artifact Source. Click <strong>Artifact History</strong>, and then <strong>Manually pull artifact</strong>. The <strong>Manually Select An Artifact</strong> dialog appears.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/eb3kfl8uls/1558370833210/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Select the artifact source in <strong>Artifact Stream</strong>, and then the artifact build in <strong>Artifact</strong>.</p><h4>Deleted Artifacts Refreshed in Harness</h4><p>Currently, Harness will update the list of artifacts from the following repo types and remove deleted items:</p><ul><li>Docker</li><li>AMI</li><li>Artifactory</li><li>ECR</li><li>GCR</li><li>ACR</li><li>Nexus</li><li>Azure Machine Image</li></ul><p>If you delete artifacts in another repo, such as S3, the list of artifacts in Harness is not updated.</p><h3>Container Specs and Manifests</h3><p>You can use container specifications and manifests to configure a Service. For information on the specs and manifests available for the different Service types, see <a href="/article/i3n6qr8p5i-deployments-overview">Deployments Overview</a>.</p><p></p><p></p>