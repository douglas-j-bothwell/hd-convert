<div class="tip-callout">Harness supports Cloud Foundry CLI version 6 and 7. Support for version 7 is behind the Feature Flag <code>CF_CLI7</code>. You can read about it in <a href="/article/jxsna1a0mi-add-container-images-for-pcf-deployments">Add Container Images for Tanzu Deployments</a>.</div><p>Harness supports all Cloud Foundry plugins from the <a href="https://plugins.cloudfoundry.org/" target="_blank">CF plugin marketplace</a>, <a href="https://network.pivotal.io/" target="_blank">Tanzu Network</a>, and in-house, and enables you to run and use them in Harness TAS Workflow steps.</p><p>Harness also includes first-class support for the <a href="https://docs.pivotal.io/application-service/2-7/appsman-services/autoscaler/using-autoscaler-cli.html" target="_blank">App Autoscaler plugin</a>, enabling you to create it as part of your Harness Workflow, bind it to your app, and enable or disable it as needed. Here is the App Autoscaler option as part of the <strong>App Setup</strong> command.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/6kt564f64q/1580332748516/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><p>In this topic:</p><ul><li><a href="#before_you_begin">Before You Begin</a></li><li><a href="#visual_summary">Visual Summary</a></li><li><a href="#review_requirements_for_running_plugins">Review: Requirements for Running Plugins</a></li><li><a href="#step_1_running_cf_plugins_using_the_cf_command">Step 1: Running CF Plugins Using the CF Command</a></li><li><a href="#step_2_script">Step 2: Script</a></li><li><a href="#step_3_delegate_selectors">Step 3: Delegate Selectors</a></li><li><a href="#review_plugin_directory">Review: Plugin Directory</a></li></ul><p></p><h3>Before You Begin</h3><ul><li>See <a href="/article/nh4afrhvkl">Connect to Your Target Tanzu Account</a>.</li><li>See <a href="/article/r1crlrpjk4-define-your-pcf-target-infrastructure">Define Your Tanzu Target Infrastructure</a>.</li></ul><p></p><h3>Visual Summary</h3><p>Harness runs CF plugins using the Workflow command <strong>CF Command</strong>. CF Command automatically sets the <code>CF_PLUGIN_HOME</code> directory, logs in (using the Harness TAS Cloud Provider), and runs the plugin using the script in CF Command.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/ttu8ty2glb/1623880343848/image.png"/></figure><h3>Review: Requirements for Running Plugins</h3><p>To run plugins using CF Command, you must have the following:</p><ul><li>CF CLI Installed on Harness Delegates​</li><li>Plugins Installed on Harness Delegates​</li><li>Create-Service-Push Installed on Delegate</li></ul><h4>CF CLI Installed on Harness Delegates</h4><div class="note-callout">Ensure that the Harness Delegate(s) used for your deployment have the correct version of the CF CLI installed. See <a href="/article/8tsb75aldu-install-cloud-foundry-cli-6-and-7-on-harness-delegates">Install Cloud Foundry CLI Versions on the Harness Delegate</a>.</div><p>The CF CLI must be installed on the Harness Delegates used in deployment. This is a requirement for any TAS deployment with Harness.</p><p>The CF CLI can be installed on the Delegate(s) using a Delegate Profile script.</p><p>For more information, see <a href="/article/8tsb75aldu-install-cloud-foundry-cli-6-and-7-on-harness-delegates">Install Cloud Foundry CLI Versions on the Harness Delegate</a>.</p><p>In Harness, click <strong>View Logs</strong> to see the successful installation:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/6kt564f64q/1575334792407/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>A single Delegate Profile can be used on all Delegates to ensure that any Delegates used have the CF CLI installed.</p><h4>Plugins Installed on Harness Delegates</h4><p>The plugin you want to run must be installed on the Harness Delegates that CF Command will use. You can tag a Harness Delegate and then select the Tag in the CF Command, ensuring that the CF Command runs your plugin on a Harness Delegate with the plugin installed.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/6kt564f64q/1580332998447/image.png"/></figure><p>You can install the plugin on the Harness Delegate using the same Delegate Profile you use to install the CF CLI on the Delegate(s).</p><p>Here is an example installing the CF CLI and <a href="https://plugins.cloudfoundry.org/#Create-Service-Push" target="_blank">Create-Service-Push</a> plugin:</p><pre>sudo wget -O /etc/yum.repos.d/cloudfoundry-cli.repo https://packages.cloudfoundry.org/fedora/cloudfoundry-cli.repo<br/>sudo yum -y install cf-cli<br/><br/>echo y | cf install-plugin -r CF-Community &#34;Create-Service-Push&#34;</pre><p>If you are using the Kubernetes, ECS, or Helm Delegates, you can select the Profile when you download a new Delegate script. Typically, you will be using a Shell Script Delegate for TAS deployments. In that case, simply apply the Profile to each new Delegate:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/6kt564f64q/1574724912851/image.png"/></figure><p></p><h4>Create-Service-Push Installed on Delegate</h4><div class="note-callout">The Create-Service-Push plugin must be installed on the Delegate(s) to use the App AutoScaler plugin. See <a href="/article/8tsb75aldu-install-cloud-foundry-cli-6-and-7-on-harness-delegates">Install Cloud Foundry CLI Versions on the Harness Delegate</a>.</div><p>The <a href="https://plugins.cloudfoundry.org/#Create-Service-Push" target="_blank">Create-Service-Push</a> plugin reads in a services&#39; manifest.yml file, creates the services listed in it, and pushes an application. Create-Service-Push extends <code>cf push</code>.</p><p>If you want to create TAS services from the inline or remote manifest files set up in your Harness Service <strong>Manifests</strong> section, you need to have Create-Service-Push installed on the Delegate.</p><p>For example, you can see the <code>cf create-service-push</code> command used to run a plugin defined in the manifest here:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/6kt564f64q/1580333121300/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>You can install the Create-Service-Push plugin in a Delegate Profile by itself:</p><pre>echo y | cf install-plugin -r CF-Community &#34;Create-Service-Push&#34;</pre><p>or in the Delegate Profile that installs the CF CLI:</p><pre>sudo wget -O /etc/yum.repos.d/cloudfoundry-cli.repo https://packages.cloudfoundry.org/fedora/cloudfoundry-cli.repo<br/>sudo yum -y install cf-cli<br/><br/>echo y | cf install-plugin -r CF-Community &#34;Create-Service-Push&#34;</pre><p>Click <strong>View Logs</strong> to see the successful installation:</p><pre>Searching CF-Community for plugin Create-Service-Push...<br/>Plugin Create-Service-Push 1.3.1 found in: CF-Community<br/>Attention: Plugins are binaries written by potentially untrusted authors.<br/>Install and use plugins at your own risk.<br/>Do you want to install the plugin Create-Service-Push? [yN]: y<br/>Starting download of plugin binary from repository CF-Community...<br/><br/> 0 B / 9.82 MiB [------------------------------------------------------]   0.00% 9.82 MiB / 9.82 MiB [==============================================] 100.00% 0sInstalling plugin Create-Service-Push...<br/>OK<br/><br/>Plugin Create-Service-Push 1.3.1 successfully installed.</pre><h3>Step 1: Running CF Plugins Using the CF Command</h3><p>Once the CF plugin has been installed on a Harness Delegate, you can simply add the CF Command to your Workflow to run the plugin.</p><ol><li>In your TAS Workflow, decide where you want to execute a CF CLI command. If you want to run a plugin, you will likely want to add the CF Command to the <strong>Setup</strong> section.</li><li>click <strong>Add Command</strong>. <strong>Add Command</strong> appears.</li><li>Click <strong>CF Command</strong>. <strong>CF Command</strong> appears.</li></ol><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/6kt564f64q/1580333154645/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>As the commented-out text states, the CF Command will perform the login steps of using the CF CLI. So you do not need to include login credentials in CF Command. CF Command will use the credentials set up in your Harness TAS Cloud Provider.</p><h3>Step 2: Script</h3><p>Enter your CF CLI commands.</p><p>There are two built-in Harness TAS variables you can use to reference the manifest and vars files used by the plugin you want to run:</p><ul><li>If you are using inline Manifest files, the variable <code>${service.manifest}</code> refers to the folder containing your manifest files.</li></ul><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/6kt564f64q/1574895511399/image.png"/></figure><ul><li>If you are using remote Manifest files via a Git repo, <code>${service.manifest}</code> refers to the folder containing your manifest files and <code>${service.manifest.repoRoot}</code> refers to the root folder of the repo.</li></ul><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/6kt564f64q/1574890615262/image.png"/></figure><p>You can use the variables together to point to different locations. For example, here the manifest.yml file is one folder and the vars.yml is located using a path from the repo root folder:</p><pre>cf create-service-push --service-manifest ${service.manifest}/manifest.yml --no-push --vars-file ${service.manifest.repoRoot}/QA/vars.yml<br/>cf plugins | grep autoscaling-apps</pre><p>These variables appear when you type <code>${service</code> in <strong>Script</strong>:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/6kt564f64q/1580333199973/image.png"/></figure><div class="note-callout">Environment Service Overrides, such as <a href="/article/r0vp331jnq">Tanzu Manifest Overrides</a>, do not apply to or override the <code>${service.manifest}</code> variable. The <code>${service.manifest}</code> variable only looks in the Harness Service.</div><p>You can also use variables in your script to templatize paths to manifest files. For example, if your Workflow Environment were templatized (see <a href="/article/m220i1tnia-workflow-configuration#template_a_workflow">Template a Workflow</a>), you can use the Environment variable <code>${env.name}</code> in your path, like this:</p><p><code>${service.manifest.repoRoot}/${env.name}/vars.yml</code></p><p>When the Workflow is deployed, the user will have to provide a name for the Environment to use. The same name will be substituted for <code>${env.name}</code> in the path in your script.</p><p>This substitution can be useful if you have folder names in your remote Git repo that match Harness Environment names, such as QA and PROD. The same Workflow and CF Command can be used for both Environments and use manifest files in separate repo folders.</p><h3>Step 3: Delegate Selectors</h3><div class="note-callout">Ensure that the Harness Delegate(s) used for your deployment have the correct version of the CF CLI installed. See <a href="/article/8tsb75aldu-install-cloud-foundry-cli-6-and-7-on-harness-delegates">Install Cloud Foundry CLI Versions on the Harness Delegate</a>.</div><p>In order for the plugin in your script to execute, the Harness Delegate(s) running the script must have the plugin installed.</p><p>Unless all of your Harness Delegates have the plugin installed, you can refer to the specific Delegates with the plugin installed using <a href="/article/h9tkwmkrm7-delegate-installation#delegate_selectors">Delegate Selectors</a>. Add the Delegate Selectors for the Delegates with the plugins installed.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/6kt564f64q/1580333212513/image.png"/></figure><p>If you do not add any Delegates Selectors to the CF Command, when the CF Command runs, Harness will only use Delegates that have the CF CLI installed.</p><p>However, if you are running plugins in CF Command, Harness cannot know which Delegates have the plugins installed.</p><p>This is why the Delegate Selectors setting ensures that CF Command only executes on Delegates that can run the plugins mentioned in the CF Command script.</p><h3>Review: Plugin Directory</h3><div class="note-callout">Ensure that the Harness Delegate(s) used for your deployment have the correct version of the CF CLI installed. See <a href="/article/8tsb75aldu-install-cloud-foundry-cli-6-and-7-on-harness-delegates">Install Cloud Foundry CLI Versions on the Harness Delegate</a>.</div><p>By default, the CF CLI stores plugins in <code>$CF_HOME/.cf/plugins</code>, which defaults to <code>$HOME/.cf/plugins</code>. For most cases, this location does not need to change.</p><p>To change the root directory of this path from <code>$CF_HOME</code>, set the <code>CF_PLUGIN_HOME</code> environment variable.</p><p>For example:</p><p><code>export CF_PLUGIN_HOME=&#39;&lt;path to plugin home&gt;&#39;</code></p><p>You can set the <code>CF_PLUGIN_HOME</code> environment variable before you install the Delegate. This will ensure that the Delegate Profile that you use to install the CF CLI uses the new <code>CF_PLUGIN_HOME</code>.</p><p>For more information, see <a href="https://docs.cloudfoundry.org/cf-cli/use-cli-plugins.html#plugin-directory" target="_blank">Changing the Plugin Directory</a> from Pivotal.</p><p></p>