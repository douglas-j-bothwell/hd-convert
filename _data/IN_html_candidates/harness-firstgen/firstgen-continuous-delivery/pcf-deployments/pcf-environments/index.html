<p>In this step of the tutorial, you will add a description of the target PCF infrastructure where Harness will deploy the PCF apps you defined in your Harness PCF Service.</p><p>In this topic:</p><ul><li><a href="https://docs.harness.io/article/ur8gjgayds-pcf-environments#pcf_environments_overview">PCF Environments Overview</a></li><li><a href="https://docs.harness.io/article/ur8gjgayds-pcf-environments#pcf_infrastructure_definitions">PCF Infrastructure Definitions</a><ul><li><a href="https://docs.harness.io/article/ur8gjgayds-pcf-environments#using_variables_in_the_infrastructure_definition">Using Variables in the Infrastructure Definition</a></li></ul></li><li><a href="https://docs.harness.io/article/ur8gjgayds-pcf-environments#service_configuration_overrides">Service Configuration Overrides</a><ul><li><a href="https://docs.harness.io/article/ur8gjgayds-pcf-environments#variable_override">Variable Override</a></li><li><a href="https://docs.harness.io/article/ur8gjgayds-pcf-environments#file_override">File Override</a></li><li><a href="https://docs.harness.io/article/ur8gjgayds-pcf-environments#pcf_manifests_override">PCF Manifests Override</a><ul><li><a href="https://docs.harness.io/article/ur8gjgayds-pcf-environments#overwrite_using_local_values">Overwrite using Local Values</a></li><li><a href="https://docs.harness.io/article/ur8gjgayds-pcf-environments#overwrite_using_remote_values">Overwrite using Remote Values</a></li></ul></li><li><a href="https://docs.harness.io/article/ur8gjgayds-pcf-environments#variable_precedence">Variable Precedence</a></li></ul></li><li><a href="https://docs.harness.io/article/ur8gjgayds-pcf-environments#next_step">Next Step</a></li></ul><h3>PCF Environments Overview</h3><p><a href="/article/n39w05njjv-environment-configuration">Environments</a> represent one or more of your PCF deployment infrastructures, such as Dev, QA, Stage, Production, etc.</p><p>In the PCF Environments you create, you will add a description for each of the different PCF infrastructures where you want to deploy your apps. In Harness, these descriptions are called Infrastructure Definitions. Infrastructure Definitions are described later in this topic.</p><p>To set up your PCF deployment Environment, do the following:</p><ol><li>In your Harness Application, click <strong>Environments</strong>.</li><li>Click <strong>Add Environment</strong>. The <strong>Environment</strong> dialog appears.</li></ol><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1572306660285/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><ol><li style="counter-increment:li 2" start="3">In <strong>Name</strong>, enter a name for the PCF Environment, such as <strong>Staging</strong>. You will use this name later when you create your Workflow and select this Environment.</li><li>In <strong>Environment Type</strong>, select <strong>Production</strong> or <strong>Non-Production</strong>.</li><li>Click <strong>SUBMIT</strong>. The Environment is created.</li></ol><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1572307062964/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Next, you will add Infrastructure Definitions to describe the deployment environments where you want to deploy your PCF apps.</p><h3>PCF Infrastructure Definitions</h3><div class="note-callout"><a href="https://docs.harness.io/article/n39w05njjv-environment-configuration#add_an_infrastructure_definition">Infrastructure Definitions</a> are a feature-flagged replacement for Service Infrastructure.</div><p>In the Environment, you create Infrastructure Definitions that describe your target deployment environments. PCF Infrastructure Definitions specify the following:</p><ul><li>The PCF deployment type.</li><li>The PCF Cloud Provider that you added, as described in <a href="/article/whwnovprrb-infrastructure-providers#pivotal_cloud_foundry_pcf">Add Cloud Providers</a>.</li><li>The PCF organization to use.</li><li>The target PCF space that the app you are deploying is scoped to.</li><li>Any specific Harness Services that you want to scope the Infrastructure Definition to. If you choose not to scope to specific Services, the Infrastructure Definition may be used with any PCF Service. </li></ul><p>To add an Infrastructure Definition, do the following:</p><ol><li>In your Environment, click <strong>Add Infrastructure Definition</strong>. The <strong>Infrastructure Definition</strong> dialog appears.</li></ol><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1568673787971/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>The <strong>Infrastructure Definition</strong> dialog has the following fields.</p><table><tbody><tr><td><p><strong>Fields</strong></p></td><td><p><strong>Description</strong></p></td></tr><tr><td><p><strong>Name</strong></p></td><td><p>Enter a name for your Infrastructure Definition. You will use this name to select this Infrastructure Definition when you create Harness Workflows.</p></td></tr><tr><td><p><strong>Cloud Provider Type</strong></p></td><td><p>Select <strong>Pivotal Cloud Foundry</strong>.</p></td></tr><tr><td><p><strong>Deployment Type</strong></p></td><td><p>Select <strong>Pivotal Cloud Foundry</strong>.</p></td></tr><tr><td><p><strong>Cloud Provider</strong></p></td><td><p>Select the Cloud Provider to use to connect to the foundation. This will be one of the PCF Cloud Providers you set up in <a href="/article/whwnovprrb-infrastructure-providers#pivotal_cloud_foundry_pcf">Add Cloud Providers</a>.</p><p>The roles associated with the PCF user account used in the Cloud Provider determine what orgs will appear in the <strong>Organization</strong> setting.</p></td></tr><tr><td><p><strong>Organization</strong></p></td><td><p>The active PCF orgs available to the PCF user account used in the Cloud Provider are listed. Select the PCF org for the development account.</p></td></tr><tr><td><p><strong>Space</strong></p></td><td><p>Select the space where the application you are deploying is scoped.</p></td></tr><tr><td><p><strong>Scope to Specific Services</strong></p></td><td><p>Select this option to scope this Infrastructure Definition to the Harness PCF Service you want to deploy.</p><p>If you do not select this setting, you can select this Infrastructure Definition when you create a Workflow for <strong>any</strong> PCF Service.</p></td></tr></tbody></table><p>When you are finished configuring your Infrastructure Definition, it will look something like this:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1572368278952/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><p>Click <strong>Submit</strong>. The Infrastructure Definition is displayed in the Environment page:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1572375668839/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><h4>Using Variables in the Infrastructure Definition</h4><p>You can use Service variables in the PCF Infrastructure Definition <strong>Organization</strong> and <strong>Space</strong> settings:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1572374732589/image.png"/></figure><p>This allows you to set the orgs and spaces in a Service, and have the Infrastructure Definition act as a template that multiple Services can use.</p><div class="note-callout">The orgs specified must be available to the PCF user account used to set up the PCF Cloud Provider used in the Infrastructure Definition.</div><h3>Service Configuration Overrides</h3><p>A PCF Service and Environment are used together when you set up a Harness Workflow to deploy your PCF app. You can configure your Environment to override settings of the Harness PCF Services that use the Environment, thereby making the Environment dictate PCF manifest values.</p><p>For example, a PCF Service uses a manifest.yml file that specifies specific routes, but an Environment might need to change the routes because it is deploying the app in the manifest to a QA space.</p><h4>Variable Override</h4><p>You can overwrite Service variables when one or more Services are paired with this Environment in a Workflow.</p><p>To overwrite a Service variable, do the following:</p><ol><li>In the Harness Service, note the name of the Service variable in <strong>Config Variables</strong>.<br/><br/><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1572379253111/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li><li>In the Harness Environment, click <strong>Service Configuration Override</strong>. The <strong>Service Configuration Override</strong> dialog appears.<br/><br/><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1572379343787/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li><li>In <strong>Service</strong>, select the Harness Service that contains the variable you want to overwrite. If you select <strong>All Services</strong>, you will have to manually enter the name of the variable you want to overwrite. The following steps use a single Service.<br/><br/>When you have selected a Service, the <strong>Override Type</strong> options appear.<br/> <br/><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1572379524688/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li><li>Click <strong>Variable Override</strong>.</li><li>In <strong>Configuration Variable</strong>, select the variable you want to overwrite.</li><li>In <strong>Override Scope</strong>, the only option is <strong>Entire Environment</strong>, currently.</li><li>In <strong>Type</strong>, select <strong>Text</strong> or <strong>Encrypted Text</strong>.</li><li>In <strong>Override Value</strong>, if you selected <strong>Text</strong> in <strong>Type</strong>, enter a new value. If you selected <strong>Encrypted Text</strong>, select an existing Encrypted Text secret. Encrypted Text secrets are set up in Harness <a href="/article/au38zpufhr-secret-management">Secrets Management</a>.<br/><br/>When you are done, the dialog will look something like this:<br/><br/> <figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1572379758528/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li><li>Click <strong>Submit</strong>. The override is added to the Environment:</li></ol><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1572379817081/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><h4>File Override</h4><p>File override is not currently used in PCF deployments.</p><h4>PCF Manifests Override</h4><p>The most commonly-used override is for PCF manifests. You can override the entire manifest.yml of a Service or any of its values.</p><div class="note-callout">To overwrite any property in an inline or remote manifest, the manifest.yml must use vars.yml for the property value. </div><p>For example, if you hardcode <code>route: example.com</code> in your inline or remote manifest.yml, you cannot overwrite it in <strong>Service Configuration Overrides</strong>. You must use a variable like <code>route: ((ROUTE1))</code> in manifest.yml and then provide a value for the variable like  <code>ROUTE1: example.com</code> in vars.yml.</p><p>For example, here are inline manifest.yml and vars.yml files using variables for routes. These variables are then overwritten in <strong>Service Configuration Overrides</strong>:</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1572382200912/image.png"/></figure><p>You can only perform one overwrite of a single Service. If you attempt to add a second overwrite of the same Service, you will receive this error: <code>Can’t add, this override already exists. Please use the edit button to update.</code></p><p>To overwrite a PCF manifest, do the following:</p><ol><li>In the Harness Service, note the name(s) of the Service vars.yml property in <strong>Manifests</strong> that you want to overwrite. If you are using remote manifest files, go to your remote repro and note the name(s).</li><li>In the Harness Environment, click <strong>Service Configuration Override</strong>. The <strong>Service Configuration Override</strong> dialog appears.<br/><br/><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1572379343787/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li><li>In <strong>Service</strong>, select the Harness Service that contains the variable you want to overwrite. If you select <strong>All Services</strong>, you will have to manually enter the name of the variable you want to overwrite. The following steps use a single Service.<br/><br/>The <strong>Override Type</strong> options appear.<br/><br/><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1572379524688/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li><li>Click <strong>PCF Manifests</strong>.</li><li>Click <strong>Local</strong> or <strong>Remote</strong>. The steps for each option are below.</li></ol><h5>Overwrite using Local Values</h5><p>You can overwrite values in the vars.yml configured in your Service. It does not matter if the vars.yml in your Service is inline and remote.</p><p>To overwrite the variable values configured in your Harness Service, you can simply enter the vars.yml variables you want to overwrite, and enter new values. Here is an example overwriting routes in an inline vars.yml:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1572384638429/image.png"/></figure><h5>Overwrite using Remote Values</h5><p>Typically, a single manifest.yml is used in a Service and then remote vars.yml files are used to supply different variable values.</p><p>To overwrite manifest property values using remote files, you simply point to a remote Git folder that contains the manifest.yml or vars.yml files containing the new values.</p><p>For example, here is a Service with an inline manifest.yml and vars.yml, and it uses the remote Git repo folder <strong>pcf-dev</strong> to overwrite the vars.yml values:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1572384562165/image.png"/></figure><p>The remote vars.yml file does not need to supply all of the variables for the vars.yml file it is overwriting. You can simply overwrite the variables you want.</p><p>As you can see in the above example, the remote vars.yml file only overwrites the <strong>routes</strong> in the inline vars.yml file.</p><h4>Variable Precedence</h4><p>If multiple variables of the same name are defined in different places, such as a Service&#39;s <strong>Manifests</strong> or <strong>Config Variables</strong> sections or an Environment&#39;s <strong>Service Configuration Overrides</strong> section, the variables get overwritten according to the following precedence, from greatest to least:</p><ol><li><strong>Service Configuration Overrides</strong> variables for a specific Service are of the greatest precedence, and override all others.</li><li><strong>Service Configuration Overrides</strong> variables for all Services.</li><li>Variables in a Service <strong>Config Variables</strong> section.</li><li>Variables defined in inline or remote files in Service <strong>Manifests</strong> section.</li></ol><p>For more information, see <a href="/article/n39w05njjv-environment-configuration#override_a_service_configuration" target="_blank">Override a Service Configuration</a>.</p><h3>Next Step</h3><ul><li><a href="/article/9ao4gsr93j-pcf-workflows-and-deploy">4 - PCF Workflows and Deployments</a></li></ul><p></p>