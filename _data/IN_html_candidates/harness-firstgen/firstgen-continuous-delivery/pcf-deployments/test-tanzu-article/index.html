<p></p><div class="note-callout">Currently, this feature is behind the Feature Flag <code>CUSTOM_MANIFEST</code>. Contact <a href="mailto:support@harness.io" target="_blank">Harness Support</a> to enable the feature. </div><p></p><p>You can use manifests in a packaged archive with the <strong>Custom Remote Manifests</strong> setting in a Harness Tanzu Service. You add a script to the Service that pulls the package and extracts its contents. Next, you supply the path to the manifest, template, etc.</p><p>A Harness TAS Service and Environment are used together when you set up a Harness Workflow to deploy your TAS app. You can configure your Environment to override the manifest path of the Harness TAS Services that deploy to the Environment.</p><p>This topic describes how to pull packaged archives, reference their manifest, and override the references at the Environment level.</p><p>In this topic:</p><ul><li><a href="https://docs.harness.io/article/a5eyx0cecd-test-tanzu-article#before_you_begin">Before You Begin</a></li><li><a href="https://docs.harness.io/article/a5eyx0cecd-test-tanzu-article#supported_platforms_and_technologies">Supported Platforms and Technologies</a></li><li><a href="https://docs.harness.io/article/a5eyx0cecd-test-tanzu-article#option_application_manifest_api_developed_in_custom_manifest">Option: Application Manifest API Developed in Custom Manifest</a></li><li><a href="https://docs.harness.io/article/a5eyx0cecd-test-tanzu-article#step_1_create_a_harness_tanzu_service">Step 1: Create a Harness Tanzu Service</a></li><li><a href="https://docs.harness.io/article/a5eyx0cecd-test-tanzu-article#step_2_use_custom_remote_manifests">Step 2: Use Custom Remote Manifests</a></li><li><a href="https://docs.harness.io/article/a5eyx0cecd-test-tanzu-article#step_3_add_script_for_remote_package">Step 3: Add Script for Remote Package</a></li><li><a href="https://docs.harness.io/article/a5eyx0cecd-test-tanzu-article#step_4_add_path_to_manifests">Step 4: Add Path to Manifests</a></li><li><a href="https://docs.harness.io/article/a5eyx0cecd-test-tanzu-article#step_5_add_delegate_selector">Step 5: Add Delegate Selector</a></li><li><a href="https://docs.harness.io/article/a5eyx0cecd-test-tanzu-article#option_override_manifests_in_environment">Option: Override Manifests in Environment</a></li><li><a href="https://docs.harness.io/article/a5eyx0cecd-test-tanzu-article#option_use_a_harness_artifact_source">Option: Use a Harness Artifact Source</a></li><li><a href="https://docs.harness.io/article/a5eyx0cecd-test-tanzu-article#undefined">Option: Use Local Script</a></li><li><a href="https://docs.harness.io/article/a5eyx0cecd-test-tanzu-article#undefined">Notes</a></li><li><a href="https://docs.harness.io/article/a5eyx0cecd-test-tanzu-article#see_also">See Also</a></li></ul><h3>Before You Begin</h3><ul><li><a href="/article/hy819vmsux-pivotal-cloud-foundry-quickstart">Tanzu Application Service (TAS) Quickstart</a></li><li><a href="/article/c92izkztka-create-a-basic-pcf-deployment">Create a Basic Tanzu Deployment</a> </li><li><a href="/article/nh4afrhvkl">Connect to Your Target Tanzu Account</a>.</li><li><a href="/article/r0vp331jnq-override-pcf-manifests-and-config-variables-and-files">Override Tanzu Manifests and Config Variables and Files</a>.</li></ul><h3>Supported Platforms and Technologies</h3><p>See <a href="/article/220d0ojx5y-supported-platforms">Supported Platforms and Technologies</a>.</p><h3>Option: Application Manifest API Developed in Custom Manifest</h3><p>Use Application Manifest API developed in Custom Manifest to use store type: <code>CUSTOM</code>. Define a fetching script for packaged manifest and the path to the manifest directory or template along with Delegate Selectors.</p><h3>Step 1: Create a Harness Tanzu Service</h3><p>In your Harness Application, create your TAS Service, as described in <a href="https://docs.harness.io/article/jxsna1a0mi-add-container-images-for-pcf-deployments">Add Container Images for Tanzu Deployments</a>.</p><h3>Step 2: Use Custom Remote Manifests</h3><p>In your Harness Tanzu Service, in <strong>Manifests</strong>, click more options (︙) and select <strong>Custom Remote Manifests</strong>.</p><p>In <strong>Manifest Format</strong>, select <strong>TAS Manifests</strong>.</p><p>Now you can add your script to pull the package containing your manifest.</p><h3>Step 3: Add Script for Remote Package</h3><p>In <strong>Script</strong>, enter the script that pulls the package containing your manifest and extracts the manifest from the package. For example:</p><pre class="hljs perl">curl -sSf -u &#34;${secrets.getValue(&#34;username&#34;)}:${secrets.getValue(&#34;password&#34;)}&#34; -O &#39;https://mycompany.jfrog.io/module/example/manifest.zip&#39;<br/><br/>unzip manifest.zip</pre><p>You can use Harness Service, Workflow, secrets, and built-in variables in the script.</p><p>The script is run on the Harness Delegate selected for deployment.</p><p>Harness creates a temporary working directory on the Delegate host for the downloaded package. You can reference the working directory in your script with <code>WORKING_DIRECTORY=$(pwd)</code> or <code>cd $(pwd)/some/other/directory</code>.</p><p>Once you have deployed the Workflow, you can check which Delegate was selected in the <strong>Delegates Evaluated</strong> setting for the Workflow step that used the manifest.</p><h3>Step 4: Add Path to Manifests</h3><p>Once you have a script that extracts your package, you provide Harness with the path to the manifest in the expanded folders and files.</p><p>You can use Harness Service, Workflow, and built-in variables in the path.</p><h3>Step 5: Add Delegate Selector</h3><p>In <strong>Delegate Selector</strong>, select the Selector for the Delegate(s) you want to use. You add Selectors to Delegates to make sure that they&#39;re used to execute the command. For more information, see <a href="/article/c3fvixpgsl-select-delegates-for-specific-tasks-with-selectors">Select Delegates with Selectors</a>.</p><p>Harness will use Delegates matching the Selectors you add.</p><p>If you use one Selector, Harness will use any Delegate that has that Selector.</p><p>If you select two Selectors, a Delegate must have both Selectors to be selected. That Delegate might also have other Selectors, but it must have the two you selected.</p><div class="note-callout">You can use expressions for Harness built-in variables or Account Default variables in <strong>Delegate Selectors</strong>. When the variable expression is resolved at deployment runtime, it must match an existing Delegate Selector.For example, if you have a Delegate Selector <strong>prod</strong> and the Workflow is using an Environment also named <strong>prod</strong>, the Delegate Selector can be <code>${env.name}</code>. This is very useful when you match Delegate Selectors to Application component names such as Environments, Services, etc. It&#39;s also a way to template the Delegate Selector setting.</div><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/a5eyx0cecd/1630396168803/custom-remote-manifests.png" style="max-height:50%;max-width:50%;display:block;margin-left:0;margin-right:auto" data-hd-height="50%" data-hd-width="50%" data-hd-align="left"/></figure><h3>Option: Override Manifests in Environment</h3><p>You can override Harness Service settings at the Harness Environment level using Service Configuration Overrides. See <a href="https://docs.harness.io/article/r0vp331jnq-override-pcf-manifests-and-config-variables-and-files#option_2_pcf_manifests_override">PCF Manifest Override.</a></p><p>Here&#39;s an example overriding Service file locations with new file locations:</p><p>From the <strong>Environment</strong>, go to the <strong>Service Configuration Overrides</strong> section, and click <strong>Add Configuration Overrides</strong>. The <strong>Service Configuration Override</strong> settings appear.</p><p>In <strong>Service</strong>, select the Tanzu Application Services.</p><p>In  <strong>Override Type</strong> options, select TAS manifests.</p><p>In <strong>Store Type options,</strong> select Custom.</p><p>Custom Manifest Override Configuration gives two options: Inherited script from Service or Define a new script.</p><p>Once you have a script that extracts your package, you provide Harness with the path to the manifest in the expanded folders and files.</p><p>Once you have a script that extracts your package, you provide Harness with the path to the manifest in the expanded folders and files. Here&#39;s an example:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/a5eyx0cecd/1630493220347/screenshot-2021-09-01-at-3-34-07-pm.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Click <strong>Submit</strong>.</p><h3>Option: Use a Harness Artifact Source</h3><p>Although the <strong>Custom Remote Manifests</strong> option is designed for when the manifest and deployment artifact are in the same package, you can use them separately with <strong>Custom Remote Manifests.</strong></p><p>You must reference the Harness Artifact Source using the <a href="/article/ojd73hseby-pcf-built-in-variables">Harness built-in variables</a>.</p><h3>Option: Use Local Script</h3><p>You can also use a local script to create your manifest in <strong>Custom Remote Manifests</strong>.</p><p>You can use Harness Service, Workflow, secrets, and built-in variables in the script using the <a href="/article/ojd73hseby-pcf-built-in-variables">Harness built-in variables</a>.</p><p>Here&#39;s the script used:</p><details><summary>Example Script</summary><div>cat &lt;&lt;EOT &gt;&gt; vars.yml<br/>APP_NAME: my_app<br/>APP_MEMORY: 750M<br/>INSTANCES: 1<br/>EOT<br/><br/><br/>cat &lt;&lt;EOT &gt;&gt; manifest.yml<br/>applications:<br/>- name: ((APP_NAME))<br/> memory: ((APP_MEMORY))<br/> instances : ((INSTANCES))<br/> random-route: true<br/>EOT</div></details><p></p><h3>Notes</h3><ul><li>If the artifact you are deploying with your manifest is public (DockerHub) and does not require credentials, you can use the standard public image reference, such as <code>image: harness/todolist-sample:11</code>.</li></ul><h3>See Also</h3><ul><li><a href="https://docs.harness.io/article/xpeb2raihj-preprocess-artifacts-to-match-supported-types">Preprocess Tanzu Artifacts to Match Supported Types</a></li><li><a href="https://docs.harness.io/article/ojd73hseby-pcf-built-in-variables">Tanzu Built-in Variables</a></li></ul><p></p>