type: article
article_id: 4xtxj2f88b
user_id: mfr0nxh4be
category_id: hupik7gwhc
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Map CloudFormation Infrastructure
slug: map-cloud-formation-infrastructure
description: Simply map CloudFormation template outputs to the required Harness settings.
short_version: Simply map CloudFormation template outputs to the required Harness
  settings.
tags: []
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: Article updated
  source: API
  triggered_at: 2022-07-18T22:16:51.900122Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Map CloudFormation Infrastructure
  description: Simply map CloudFormation template outputs to the required Harness
    settings.
  short_version: Simply map CloudFormation template outputs to the required Harness
    settings.
  body: '<div class="tip-callout">This content is for Harness <a href="/article/1fjmm4by22">FirstGen</a>.
    Switch to <a href="/article/vynj4hxt98">NextGen</a>.</div><p>To enable Harness
    to deploy to the provisioned infrastructure you defined in <a href="/article/wtper654tn-add-cloud-formation-templates">Add
    CloudFormation Templates</a>, you map outputs from your CloudFormation template
    to the Harness Infrastructure Definition settings Harness requires for provisioning.</p><p>Mappings
    provide Harness with the minimum settings needed to provision using your template.</p><div
    class="note-callout">Harness supports first class mapping for AWS-based infrastructures
    (SSH, ASG, ECS, Lambda).</div><p>In this topic:</p><ul><li> <a href="#before_you_begin">Before
    You Begin</a></li><li> <a href="#limitations">Limitations</a></li><li> <a href="#visual_summary">Visual
    Summary</a></li><li> <a href="#step_create_an_infrastructure_definition">Step:
    Create an Infrastructure Definition</a></li><li> <a href="#option_1_map_an_aws_ami_asg_infrastructure">Option
    1: Map an AWS AMI/ASG Infrastructure</a></li><li> <a href="#option_2_map_an_aws_ecs_infrastructure">Option
    2: Map an AWS ECS Infrastructure</a></li><li> <a href="#option_3_map_an_aws_lambda_infrastructure">Option
    3: Map an AWS Lambda Infrastructure</a></li><li> <a href="#option_4_map_a_secure_shell_ssh_infrastructure_on_aws">Option
    4: Map a Secure Shell (SSH) Infrastructure on AWS</a></li><li> <a href="#next_steps">Next
    Steps</a></li></ul><p></p><h3>Before You Begin</h3><p>Ensure you have read the
    following topics before you map the CloudFormation Provisioner in an Infrastructure
    Definition:</p><ul><li> <a href="/article/qj0ems5hmg-cloud-formation-provisioning-with-harness">CloudFormation
    Provisioning with Harness</a></li><li> <a href="/article/308nblm0vc-cloud-formation-account-setup">Set
    Up Your Harness Account for CloudFormation</a></li><li> <a href="/article/wtper654tn-add-cloud-formation-templates">Add
    CloudFormation Templates</a></li></ul><h3>Limitations</h3><p><strong>AWS Services
    Supported</strong> — Harness supports first class CloudFormation provisioning
    for AWS-based infrastructures:</p><ul><li>SSH</li><li>AMI/Auto Scaling Group</li><li>ECS</li><li>Lambda</li></ul><p><strong>Deployment
    Strategies Supported</strong> — Harness Infrastructure Provisioners are only supported
    in Canary and Multi-Service types. For AMI and ECS, Infrastructure Provisioners
    are also supported in Blue/Green deployments.</p><p><strong>CloudFormation Template
    Outputs</strong> — If you have been running your deployments manually, you might
    not have outputs configured in your template files. To provision using your CloudFormation
    template, you will need to add these output variables to your template.</p><p><strong>Template
    Formats</strong> — CloudFormation templates may be in JSON or YAML.</p><h3>Visual
    Summary</h3><p>This topic describes step 2 in the Harness CloudFormation Provisioning
    implementation process:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/wtper654tn/1589837133398/image.png"/></figure><p>Once
    you have completed this topic, you can move onto the next step: <a href="/article/5wdb3r765g-provision-cloudformation-create-stack">Provision
    using CloudFormation Create Stack</a>.</p><p></p><h3>Step: Create an Infrastructure
    Definition</h3><p>As noted above, ensure you have done <a href="/article/308nblm0vc-cloud-formation-account-setup">Set
    Up Your Harness Account for CloudFormation</a> and <a href="/article/wtper654tn-add-cloud-formation-templates">Add
    CloudFormation Templates</a> before using the CloudFormation Infrastructure Provisioner
    to create the Infrastructure Definition.</p><p>To use a CloudFormation Infrastructure
    Provisioner to create an ​Infrastructure Definition, do the following:</p><ol><li>In
    the same Harness Application where you created the CloudFormation Infrastructure
    Provisioner, in an existing Environment, click <strong>Add ​Infrastructure Definition</strong>.
    The ​Infrastructure Definition settings appear.</li><li>In <strong>Name</strong>,
    enter the name for the ​Infrastructure Definition. This is the name you will select
    when you add this ​Infrastructure Definition to a Workflow or Workflow Phase.</li><li>In <strong>Cloud
    Provider Type</strong>, select the type of Harness Cloud Provider you will use
    to connect to the target platform.<div class="note-callout">Harness supports first
    class mapping for AWS-based infrastructures (SSH, ASG, ECS, Lambda).</div></li><li>In <strong>Deployment
    Type</strong>, select the platform for the deployment, such as ECS, AMI, etc.</li><li>Select <strong>Map
    Dynamically Provisioned Infrastructure</strong>. This option reveals the Infrastructure
    Provisioner settings for the ​Infrastructure Definition.</li><li>In <strong>Provisioner</strong>,
    select the name of the CloudFormation Provisioner you want to use.</li><li>In <strong>Cloud
    Provider</strong>, select the Cloud Provider to use to connect to the target cloud
    platform.<br/>The remainder of the settings are specific to the Provisioner and
    Cloud Provider you selected.</li><li>Map the required fields to your CloudFormation
    template outputs. The platform-specific sections below provide examples for the
    common deployment types.</li></ol><p>You map the CloudFormation template outputs
    using this syntax, where <code>exact_name</code> is the name of the output:</p><pre>${cloudformation.<em>exact_name</em>}</pre><p></p><div
    class="note-callout">When you map a CloudFormation template output to a Harness
    Infrastructure Definition setting, the expression for the output, <code>${cloudformation.exact_name​}</code>,
    can be used anywhere in the Workflow that uses that CloudFormation Provisioner.
    This can be useful if you want to echo the outputs in a <a href="/article/1fjrjbau7x-capture-shell-script-step-output">Shell
    Script step</a> for example.</div><p></p><h3>Option 1: Map an AWS AMI/ASG Infrastructure</h3><div
    class="note-callout">AMI/ASG and ECS deployments are the only type that supports
    Terraform and CloudFormation Infrastructure Provisioners in Blue/Green deployments.</div><p>The
    AMI deployment type uses an AWS Auto Scaling Group and only requires that you
    provide a region and Auto Scaling Group.</p><p>The Auto Scaling Group output is
    the Auto Scaling Group you want Harness to mirror (use as a template) when it
    provisions a new Auto Scaling Group as part of the AMI deployment.</p><p>For more
    information, see <a href="/article/aedsdsw9cm-aws-ami-deployments-overview">AWS
    AMI Deployments Overview</a>.</p><p>In the following example, we show:</p><ul><li>Required
    outputs.</li><li>The outputs used for the optional Target Group and Application
    Load Balancer.</li><li>The stage Target Group and Application Load Balancer used
    for Blue/Green deployments.</li></ul><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1569732829902/image.png"/></figure><p></p><h3>Option
    2: Map an AWS ECS Infrastructure</h3><p>The ECS mapping supports both ECS launch
    types, EC2 and Fargate.</p><p>The ECS deployment type has two <strong>Launch Type</strong>
    options:</p><ul><li><strong>EC2 Instances</strong> - Region and Cluster are required.
    Here is an example mapping Region and Cluster and the remaining fields:</li></ul><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/other/1569732099822/image.png"/></figure><p></p><ul><li><strong>Fargate
    Launch Type</strong> - Region, Cluster, Task Execution Role, VPC, Subnets, Security
    Group are required. Here is an example mapping all of these:</li></ul><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/other/1569732386758/image.png"/></figure><p>See
    <a href="/article/5z2kw34d7x-aws-ecs-deployments-overview">AWS ECS Deployments
    Overview</a> and <a href="/article/j39azkrevm-aws-ecs-deployments">AWS ECS Quickstart</a>.</p><h3>Option
    3: Map an AWS Lambda Infrastructure</h3><p>The Lambda deployment type supports
    AWS Instance and AWS Auto Scaling Groups. Both require IAM role and region outputs.</p><p>Here
    is an Infrastructure Definition example for Lambda.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1569733299114/image.png"/></figure><p>See
    <a href="/article/z24n8ut61d-lambda-deployment-overview">Lambda Deployment Overview</a>
    and <a href="/article/wy1rjh19ej-aws-lambda-deployments">AWS Lambda Quickstart</a>.</p><h3>Option
    4: Map a Secure Shell (SSH) Infrastructure on AWS</h3><div class="note-callout">The
    Secure Shell (SSH) deployment type is supported with CloudFormation on AWS only.
    To use SSH with a datacenter, see <a href="/article/1m3p7phdqo-shell-script-provisioner">Shell
    Script Provisioner</a>.</div><p>The Secure Shell (SSH) deployment type has two
    <strong>AWS Node Type</strong> options: <strong>AWS Instance</strong> and <strong>AWS
    Autoscaling Group</strong>.</p><p>For the <strong>AWS Instance</strong>, only
    AWS tags are required. Here is an example mapping both VPCs and AWS tags:</p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/other/1569389534182/image.png"/></figure><p>The
    remaining settings can also use output variables or be hardcoded.</p><p>For AWS
    <strong>Auto Scaling Group</strong>, only an Auto Scaling Group is required:</p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/other/1569389625617/image.png"/></figure><p>See
    <a href="/article/6pwni5f9el-traditional-deployments-overview">Traditional Deployments
    Overview</a>.</p><h3>Next Steps</h3><p>Now that the Infrastructure Definition
    is mapped to the CloudFormation outputs in your script, the provisioned infrastructure
    can be used as a deployment target by a Harness Workflow. But the CloudFormation
    template must still be run to provision this infrastructure.</p><p>To run the
    CloudFormation template in your Harness Infrastructure Provisioner and create
    the infra you defined in Infrastructure Definition, you add a <strong>CloudFormation
    Create Stack</strong> step to a Workflow that uses the Infrastructure Definition
    you just set up.</p><p>For steps on adding the CloudFormation Create Stack step,
    see  <a href="/article/5wdb3r765g-provision-cloudformation-create-stack">Provision
    using CloudFormation Create Stack</a>.</p><p></p>'
  slug: map-cloud-formation-infrastructure
  tags: []
  is_live: true
