type: article
article_id: wtper654tn
user_id: mfr0nxh4be
category_id: hupik7gwhc
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Add CloudFormation Templates
slug: add-cloud-formation-templates
description: Set up a CloudFormation Infrastructure Provisioner.
short_version: Set up a CloudFormation Infrastructure Provisioner.
tags: []
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: Article updated
  source: API
  triggered_at: 2022-07-18T22:16:36.098118Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Add CloudFormation Templates
  description: Set up a CloudFormation Infrastructure Provisioner.
  short_version: Set up a CloudFormation Infrastructure Provisioner.
  body: '<div class="tip-callout">This content is for Harness <a href="/article/1fjmm4by22">FirstGen</a>.
    Switch to <a href="/article/vynj4hxt98">NextGen</a>.</div><p>This topic describes
    how to set up a Harness Infrastructure Provisioner for CloudFormation.</p><p>Once
    the Harness Infrastructure Provisioner is set up, you can use it to define a deployment
    target in a Harness Infrastructure Definition.</p><p>Once you add the Infrastructure
    Definition to a Workflow, you add a CloudFormation Create Stack step to the Workflow.
    The CloudFormation Create Stack step uses the same Harness Infrastructure Provisioner
    to run your templates and build the target infrastructure, and then deploy to
    it.</p><p>This topic walks you through a detailed setup of a Harness CloudFormation
    Provisioner.</p><p>In this topic:</p><ul><li><a href="https://docs.harness.io/article/wtper654tn-add-cloud-formation-templates#before_you_begin">Before
    You Begin</a></li><li><a href="https://docs.harness.io/article/wtper654tn-add-cloud-formation-templates#limitations">Limitations</a></li><li><a
    href="https://docs.harness.io/article/wtper654tn-add-cloud-formation-templates#visual_summary">Visual
    Summary</a></li><li><a href="https://docs.harness.io/article/wtper654tn-add-cloud-formation-templates#step_1_add_a_cloud_formation_provisioner">Step
    1: Add a CloudFormation Provisioner</a></li><li><a href="https://docs.harness.io/article/wtper654tn-add-cloud-formation-templates#step_2_add_your_cloud_formation_template">Step
    2: Add Your CloudFormation Template</a><ul><li><a href="https://docs.harness.io/article/wtper654tn-add-cloud-formation-templates#template_body">Template
    Body</a></li><li><a href="https://docs.harness.io/article/wtper654tn-add-cloud-formation-templates#git_repository">Git
    Repository</a></li><li><a href="https://docs.harness.io/article/wtper654tn-add-cloud-formation-templates#amazon_s3">Amazon
    S3</a></li></ul></li><li><a href="https://docs.harness.io/article/wtper654tn-add-cloud-formation-templates#step_3_add_input_variables">Step
    3: Add Input Variables</a></li><li><a href="https://docs.harness.io/article/wtper654tn-add-cloud-formation-templates#step_4_complete_the_cloud_formation_provisioner">Step
    4: Complete the CloudFormation Provisioner</a></li><li><a href="https://docs.harness.io/article/wtper654tn-add-cloud-formation-templates#next_steps">Next
    Steps</a></li></ul><h3>Before You Begin</h3><ul><li><a href="/article/qj0ems5hmg-cloud-formation-provisioning-with-harness">CloudFormation
    Provisioning with Harness</a></li><li><a href="/article/308nblm0vc-cloud-formation-account-setup">Set
    Up Your Harness Account for CloudFormation</a></li></ul><p></p><h3>Limitations</h3><ul><li>Harness
    supports first class CloudFormation provisioning for AWS-based infrastructures:<ul><li>SSH</li><li>AMI/Auto Scaling
    Group</li><li>ECS</li><li>Lambda</li></ul></li><li>AWS CloudFormation has its
    own template limits. See <a href="https://aws.amazon.com/cloudformation/faqs/#Limits_and_Restrictions"
    target="_blank">Limits and Restrictions</a> from AWS.</li><li>If you have plus
    signs (<code>+</code>) in the AWS S3 bucket URL, Harness changes these to spaces.
    Harness changes the plus signs because plus signs in AWS S3 URLs are interpreted
    as spaces by AWS. It is a limitation of AWS. If you want to use a <code>+</code>
    in your URL, replace it with URL encoding <code>%2B</code> in any file path in
    Harness.</li></ul><h3>Visual Summary</h3><p>This topic describes step 1 in the
    Harness CloudFormation Provisioning implementation process:</p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/wtper654tn/1589837133398/image.png"/></figure><p>Once
    you have completed this topic, you can move onto the next step: <a href="/article/4xtxj2f88b-map-cloud-formation-infrastructure">Map
    CloudFormation Infrastructure</a>.</p><h3>Step 1: Add a CloudFormation Provisioner</h3><p>Setting
    up the CloudFormation Provisioner involves the following steps:</p><ol><li>Add
    your CloudFormation template via its S3 bucket, Git repo, or simply paste it into
    Harness.</li><li>Import any input variables.</li></ol><p>Let&#39;s get started.</p><p>To
    set up a CloudFormation Infrastructure Provisioner, do the following:</p><ol><li>In
    your Harness Application, click <strong>Infrastructure Provisioners</strong>.</li><li>Click
    <strong>Add Infrastructure Provisioner</strong>, and then click <strong>CloudFormation</strong>.
    The <strong>Add CloudFormation Provisioner</strong> dialog appears.<figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/wtper654tn/1589841895308/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li><li>In
    <strong>Display Name</strong>, enter the name for this provisioner. You will use
    this name to select this provisioner in Harness Infrastructure Definition and
    the CloudFormation Create Stack Workflow step.</li></ol><h3>Step 2: Add Your CloudFormation
    Template</h3><p>Your CloudFormation template can be added in one of three ways:</p><ul><li>AWS
    S3 bucket.</li><li>Git repo.</li><li>Paste in the template.</li></ul><p>For S3
    and the Git repo, you must have an AWS Cloud Provider or Source Repro Provider
    set up in Harness. See <a href="/article/308nblm0vc-cloud-formation-account-setup">Set
    Up Your Harness Account for CloudFormation</a>.</p><p>Let&#39;s walk through these
    options.</p><div class="note-callout">CloudFormation templates may be in JSON
    or YAML and Harness accepts both formats. Nested stacks are supported for <strong>Amazon
    S3</strong> source types only. This is an <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-stack.html"
    target="_blank">AWS limitation</a>.</div><h4>Template Body</h4><ol><li>If you
    select <strong>Template Body</strong>, then paste in the CloudFormation template
    JSON or YAML.</li></ol><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/wtper654tn/1589845130908/image.png"/></figure><div
    class="tip-callout">You can also use <a href="/article/9dvxcegm90-variables">Harness
    variable expressions</a>, such as <a href="/article/766iheu1bk-add-workflow-variables-new-template">Workflow
    variables</a>, in <strong>Template Body</strong>.</div><h4>Git Repository</h4><p>For
    Git Repository, ensure that you have added a SourceRepo Provider in Harness that
    connects to your Git repo. For more information, see <a href="https://docs.harness.io/article/ay9hlwbgwa-add-source-repo-providers">Add
    SourceRepo Providers</a>.</p><p>If you select <strong>Git Repository</strong>,
    do the following:</p><ol><li style="counter-increment:li 0" start="1">In <strong>Source
    Repository</strong>, select a SourceRepo Provider for the Git repo you added to
    your Harness account.</li><li>In <strong>Commit ID</strong>, select <strong>Latest
    from Branch</strong> or <strong>Specific Commit ID</strong>.</li><li>In <strong>Branch/Commit
    ID</strong>, enter the branch or commit ID for the remote repo.</li><li>In <strong>File
    Path</strong>, enter the repo file and folder path.<br/><br/>For example, if the
    full path to your script is <strong>http://github.com/johnsmith/harness/branch1/scripts/foo.yaml</strong>,
    and you selected <strong>Branch</strong> and entered <strong>branch1</strong>,
    in <strong>File Path</strong> you can enter <strong>scripts/foo.yaml</strong>
    or even <strong>./scripts/foo.yaml</strong>.<br/><br/>Using the same example,
    if you selected <strong>Specific Commit ID</strong> and enter a commit ID, in
    <strong>File Path</strong> you can enter <strong>scripts/foo.yaml</strong> or
    even <strong>./scripts/foo.yaml</strong>.</li></ol><div class="tip-callout">You
    cannot also use <a href="/article/9dvxcegm90-variables">Harness variable expressions</a>,
    such as <a href="/article/766iheu1bk-add-workflow-variables-new-template">Workflow
    variables</a>, in <strong>File Path</strong> at this time.</div><h4>Amazon S3</h4><p>For
    Amazon S3, ensure you have added an AWS Cloud Provider to connect Harness to your
    AWS account, as described in <a href="/article/308nblm0vc-cloud-formation-account-setup">Set
    Up Your Harness Account for CloudFormation</a>.</p><p>If you select <strong>Amazon
    S3</strong>, in <strong>Template File Path</strong>, enter the URL for the template
    in its S3 bucket.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/wtper654tn/1589845742924/image.png"/></figure><p></p><div
    class="warning-callout">Only enter the <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingBucket.html"
    target="_blank">globally-unique S3 bucket name URL</a>. Not the region-specific
    URL.</div><div class="tip-callout">You can also use <a href="/article/9dvxcegm90-variables">Harness
    variable expressions</a>, such as <a href="/article/766iheu1bk-add-workflow-variables-new-template">Workflow
    variables</a>, in <strong>Template File Path</strong>.</div><p>Ensure that the
    AWS Cloud Provider has permissions to read the bucket contents. The required policies
    is <code>AmazonS3ReadOnlyAccess</code> and you need another policy with the action
    <code>cloudformation:GetTemplateSummary</code>. See <a href="/article/308nblm0vc-cloud-formation-account-setup">Set
    Up Your Harness Account for CloudFormation</a>.</p><p></p><div class="tip-callout">You
    can find many template samples from CloudFormation <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-sample-templates.html"
    target="_blank">Sample Templates</a>.</div><p></p><h3>Step 3: Add Input Variables</h3><p>Likely,
    your template contains <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/gettingstarted.templatebasics.html#gettingstarted.templatebasics.parameters">input
    parameters</a> that require specific values be passed in when Harness creates
    a stack from the template. For example, here is an input parameter for a key pair
    named <strong>KeyName</strong>:</p><pre>Parameters:<br/>  KeyName:<br/>    Description:
    Name of an existing EC2 KeyPair to enable SSH access to the instance<br/>    Type:
    &#39;AWS::EC2::KeyPair::KeyName&#39;<br/>    ConstraintDescription: must be the
    name of an existing EC2 KeyPair.</pre><p></p><p>You can add these input parameters
    to your Harness CloudFormation Provisioner and specify the values for the inputs
    when you use this provisioner in a Workflow.</p><p>In <strong>Variables</strong>,
    click <strong>Add</strong> to add your inputs manually.</p><p>You can use <strong>Populate
    Variables</strong> if you added a URL to your template in an S3 bucket or Git
    repo.</p><div class="note-callout">You can also use <strong>Populate Variables</strong>
    if you added your template manually, but you will need to also select an AWS Cloud
    Provider and region. Harness uses those to access the AWS CloudFormation API,
    parse the template you entered manually, and extract the variables.</div><p>We
    will cover the <strong>Populate Variables</strong> scenario.</p><ol><li style="counter-increment:li
    0" start="1">Click <strong>Populate Variables</strong>. The <strong>Populate from
    Example</strong> assistant appears.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/wtper654tn/1590007669775/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li><li>If
    you are using an AWS S3 source:<ol><li>In <strong>AWS Cloud Provider</strong>,
    select the AWS Cloud Provider you added that has permission to access the template
    in the S3 bucket.</li><li>In <strong>Region</strong>, select the AWS region where
    the AWS Cloud Provider should connect. AWS S3 is global, but AWS connections require
    a region.</li></ol></li><li>If you are using a Git Repository source, you do not
    need to enter anything.</li><li>Click <strong>Submit</strong>. The input parameters
    from your template are added automatically:<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/wtper654tn/1590008843341/image.png"/></figure></li><li>For
    each input, select the type of value required: <strong>Text</strong> or <strong>Encrypted
    Text</strong>. When this provisioner is added to a Workflow, the user will have
    to provide a value for the input that matches the type. Encrypted Text values
    use secrets you set up in Harness <a href="/article/au38zpufhr-secret-management">Secrets
    Management</a>.</li></ol><p>Here is what the input variables look like in a Workflow
    CloudFormation Create Stack step:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/wtper654tn/1589841218642/image.png"/></figure><p></p><h3>Step
    4: Complete the CloudFormation Provisioner</h3><p>Once you have completed your
    setup, click <strong>Submit</strong>. The CloudFormation Provisioner is created.</p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/wtper654tn/1590009659349/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Next
    you will map template outputs to the Harness Infrastructure Definition settings
    Harness requires for provisioning.</p><h3>Next Steps</h3><ul><li><a href="/article/4xtxj2f88b-map-cloud-formation-infrastructure">Map
    CloudFormation Infrastructure</a></li></ul><p></p>'
  slug: add-cloud-formation-templates
  tags: []
  is_live: true
