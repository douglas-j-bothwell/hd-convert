<p>This guide explains how to use Amazon Elastic Container Service (ECS) with Harness.</p><div class="note-callout">New to using ECS with Harness? See <a href="/article/j39azkrevm-aws-ecs-deployments">AWS ECS Quickstart</a>.</div><p>In this guide, we will set up Harness for ECS, create a Harness Application, and deploy a public Docker image from Docker Hub to an existing ECS cluster using Harness. This deployment scenario is very popular and a walkthrough of all the steps involved will help you set up this scenario in Harness for your own microservices and apps.</p><p>Walk through this guide in the following order:</p><ul><li><a href="https://docs.harness.io/article/08whoizbps-ecs-deployments-overview#component_overview">Component Overview</a></li><li><a href="https://docs.harness.io/article/08whoizbps-ecs-deployments-overview#prerequisites">Prerequisites</a></li><li><a href="https://docs.harness.io/article/08whoizbps-ecs-deployments-overview#deployment_overview">Deployment Overview</a></li><li><a href="/article/wrm6hpyrjl-harness-ecs-delegate">1 - Harness ECS Delegate</a></li><li><a href="/article/gpu36fl1y0-ecs-connectors-and-providers-setup">2 - ECS Connectors and Providers Setup</a></li><li><a href="/article/riu73ehy2m-ecs-services">3 - ECS Services</a></li><li><a href="/article/yasp1dt3h5-ecs-environments">4 - ECS Environments</a></li><li><a href="/article/oinivtywnl-ecs-workflows">5 - ECS Basic and Canary Workflows</a></li><li><a href="/article/7qtpb12dv1-ecs-blue-green-workflows">6 - ECS Blue/Green Workflows</a></li><li><a href="/article/5229btw1mq-ecs-setup-in-yaml">7 - ECS Setup in YAML</a></li><li><a href="/article/rdk1j5s32z-ecs-troubleshooting">8 - ECS Troubleshooting</a></li></ul><h3>Component Overview</h3><p>The following table lists the ECS components and where they are set up in Harness, as well as the related Harness components that perform ECS deployment operations. For detailed explanations of ECS, see the <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/Welcome.html">ECS Developer Guide</a> from Amazon.</p><table><tbody><tr><td><p><strong>Component</strong></p></td><td><p><strong>Description</strong></p></td><td><p><strong>Harness Location</strong></p></td></tr><tr><td><p>Harness Delegate</p></td><td><p>A software service you run in the same VPC as the ECS cluster to enable Harness to perform deployment operations. The Delegate does not need root privileges, and it only makes an outbound HTTPS connection to the Harness platform.</p></td><td><p>This guide will describe how to set up the Harness Delegate for ECS deployment.</p><p>See <a href="/article/wrm6hpyrjl-harness-ecs-delegate">Harness ECS Delegate</a>.</p></td></tr><tr><td><p>Harness Cloud Provider</p></td><td><p>A Cloud Provider is a logical representation of your AWS infrastructure. Typically, a Cloud Provider is mapped to a AWS account, Kubernetes cluster, Google service account, Azure subscription, or a data center.</p></td><td><p>This guide will describe how to set up the AWS Cloud Provider for ECS deployment.</p><p>For general information, see <a href="/article/gpu36fl1y0-ecs-connectors-and-providers-setup">ECS Connectors and Providers Setup</a>.</p></td></tr><tr><td><p>ECS Task Definition</p></td><td><p>Describes the Docker containers to run (CPU, memory, environment variables, ports, etc) and represents your application.</p></td><td><p>Specified in the Harness Service, in Container Specification.</p></td></tr><tr><td><p>ECS Task</p></td><td><p>Instance of a Task Definition. Multiple Tasks can be created by one Task Definition, as demand requires.</p></td><td><p></p></td></tr><tr><td><p>ECS Service</p></td><td><p>Defines the minimum and maximum Tasks from one Task Definition to run at any given time, autoscaling, and load balancing.</p></td><td><p>This is specified in the Harness Service, in Service Specification.</p></td></tr><tr><td><p>ECS Cluster</p></td><td><p>A Cluster is a group of ECS Container Instances where you run your service tasks in order for them to be accessible. The container management service handles the cluster across one or more ECS Container Instance(s), including the scheduling, maintaining, and scaling requests to these instances.</p></td><td><p>ECS Clusters are selected in two Harness components:</p><ul><li>The AWS Cloud Provider, via the IAM role for Delegate option.</li><li>Harness application Environment, where you select the AWS Cloud provider, and your ECS cluster name.</li></ul></td></tr><tr><td><p>Launch Types</p></td><td><p>There are two types:</p><ul><li>Fargate - Run containers without having to manage servers or clusters of Amazon EC2 instances.</li><li>EC2 - Run containers on a cluster of Amazon EC2 instances that you manage.</li></ul></td><td><p>You specify the launch type to use when adding a Service Infrastructure to a Harness Environment.</p></td></tr><tr><td><p>Replica Scheduling Strategy</p></td><td><p>Places and maintains the desired number of tasks across your cluster.</p></td><td><p>This is specified in the Harness Service, in Service Specification.</p></td></tr><tr><td><p>Daemon Scheduling Strategy</p></td><td><p>As of July 2018, ECS has a daemon scheduling strategy that deploys exactly one task on each active container instance that meets all of the task placement constraints that you specify in your cluster.</p><p>With a daemon strategy, a task is deployed onto each instance in a cluster to provide common supporting functionality.</p></td><td><p>This is specified in the Harness Service, in Service Specification.</p></td></tr><tr><td><p>awsvpc Network Mode</p></td><td><p>Provides each task with its own elastic network interface. Fargate task definitions require the awsvpc network mode.</p></td><td><p></p></td></tr><tr><td><p>Service Discovery</p></td><td><p>An ECS service can use the ECS Service Discovery to manage HTTP and DNS namespaces for ECS services via the AWS Cloud Map API actions.</p></td><td><p>This is specified in the Harness Service, in Service Specification.</p></td></tr><tr><td><p>Auto Scaling</p></td><td><p>Auto Scaling adjusts the ECS desired count up or down in response to CloudWatch alarms.</p></td><td><p>This is specified in the Harness Workflow ECS Service Setup command.</p></td></tr></tbody></table><h3>Prerequisites</h3><ul><li>One or more existing ECS clusters:<ul><li>You will need an ECS cluster to deploy your ECS services using Harness.</li><li>If you use a Harness ECS Delegate (recommended), you will need an ECS cluster for the Delegate. The steps for setting up an ECS Delegate are in <a href="/article/wrm6hpyrjl-harness-ecs-delegate">Harness ECS Delegate</a>.</li></ul></li><li>If you want to run a Harness Shell Script Delegate on an EC2 instance in the same VPC as the ECS cluster, ensure it meets the Harness <a href="https://docs.harness.io/article/h9tkwmkrm7-delegate-installation#delegate_requirements" target="_blank">Delegate Requirements</a>.</li><li>IAM Role for the Harness Cloud Provider connection to AWS. The policies are listed in <a href="https://docs.harness.io/article/whwnovprrb-infrastructure-providers#ecs_existing_cluster" target="_blank">ECS (Existing Cluster)</a> and also described in this document.</li></ul><h3>Deployment Overview</h3><p>This guide takes you through setting up ECS Deployment using the following steps:</p><ol><li>Install and run the Harness ECS Delegate in an ECS cluster in your VPC.</li><li>Add an AWS Cloud Provider that uses the IAM role of the Harness ECS Delegate. You can also create a Cloud Provider that uses another AWS account with the required ECS permissions, but using the Delegate is the easiest method.</li><li>Create a Harness Application for ECS.</li><li>Add a Harness Service. We will cover the following ECS features when we add a service:<ol><li>Replica Strategy.</li><li>Daemon Strategy.</li><li>awsvpc Network Mode.</li><li>Service Discovery.</li></ol></li><li>Add an Environment and ECS Service Infrastructure.</li><li>Add a Workflow:</li></ol><ul><li>Canary Deployment with Replica Scheduling.</li><li>Basic Deployment with Daemon Scheduling.</li><li>Blue/Green Workflow.</li></ul><ol><li style="counter-increment:li 6" start="7">Deploy an ECS Workflow.</li></ol><h3>Rollbacks</h3><p>See <a href="/article/d7rnemtfuz-ecs-rollback">ECS Rollbacks</a>.</p><h3>Next Step</h3><p><a href="/article/wrm6hpyrjl-harness-ecs-delegate">1 - Harness ECS Delegate</a></p>