type: article
article_id: 45dm9z3m2h
user_id: mfr0nxh4be
category_id: 3pyb3kmkbs
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Define Your Lambda Target Infrastructure
slug: 3-lambda-environments
description: Add a Harness Environment that describes your AWS Lambda computing service.
short_version: Add a Harness Environment that describes your AWS Lambda computing
  service.
tags:
- Lambda
- Environment
- Infrastructure Definition
- Service Infrastructure
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: Article updated
  source: API
  triggered_at: 2022-07-18T22:23:33.222439Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Define Your Lambda Target Infrastructure
  description: Add a Harness Environment that describes your AWS Lambda computing
    service.
  short_version: Add a Harness Environment that describes your AWS Lambda computing
    service.
  body: '<div class="tip-callout">This content is for Harness <a href="/article/1fjmm4by22">FirstGen</a>.
    Switch to <a href="/article/5fnx4hgwsa">NextGen</a>.</div><p></p><p>Once you&#39;ve
    added a Lambda Service to your Application, you can define Environments where
    your Service can be deployed. Within an Environment, you specify the following
    in an Infrastructure Definition:</p><ul><li>The Lambda Service that contains your
    functions zip file and functions specs. (Set up in <a href="/article/qp8hk4nzbo-2-service-for-lambda">Add
    Lambda Functions</a>.)</li><li>A deployment type. In this case, <strong>Lambda</strong>.</li><li>The
    AWS Cloud Provider you set up in <a href="/article/lo9taq0pze-1-delegate-and-connectors-for-lambda">Connect
    to AWS for Lambda Deployments</a>.</li></ul><p>An Environment can be a Dev, QA,
    Production, or other Environment. You can deploy one or many Services to each
    Environment by creating an Infrastructure Definition in the Environment for each
    Service.</p><p>In this topic:</p><ul><li><a href="#before_you_begin">Before You
    Begin</a></li><li><a href="#step_1_create_an_environment">Step 1: Create an Environment</a></li><li><a
    href="#step_2_define_the_lambda_infrastructure">Step 2: Define the Lambda Infrastructure</a></li><li><a
    href="#option_provision_the_lambda_infrastructure">Option: Provision the Lambda
    Infrastructure</a></li><li><a href="#option_override_service_settings">Option:
    Override Service Settings</a></li><li><a href="#next_steps">Next Steps</a></li></ul><p></p><h3>Before
    You Begin</h3><ul><li><a href="/article/lo9taq0pze-1-delegate-and-connectors-for-lambda">Connect
    to AWS for Lambda Deployments</a></li><li><a href="/article/qp8hk4nzbo-2-service-for-lambda">Add
    Lambda Functions</a></li></ul><p></p><h3>Step 1: Create an Environment</h3><p>The
    following procedure creates an Environment for the Lambda Service type, as set
    up in <a href="/article/qp8hk4nzbo-2-service-for-lambda">Add Lambda Functions</a>.</p><ol><li>In
    your Harness Application, click <strong>Environments</strong>. The <strong>Environments</strong>
    page appears.</li><li>Click <strong>Add Environment</strong>. The <strong>Environment</strong>
    dialog appears.</li><li>In <strong>Name</strong>, enter a name that describes
    the deployment environment, for example, <strong>Lambda</strong>.</li><li>In <strong>Environment
    Type</strong>, select <strong>Non-Production</strong>.</li><li>Click <strong>SUBMIT</strong>.
    The new <strong>Environment</strong> page appears.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1568774865230/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li></ol><p></p><h3>Step
    2: Define the Lambda Infrastructure</h3><p>You must define one or more Infrastructure
    Definitions for the Environment.</p><p>A Harness Infrastructure Definition defines
    the AWS VPC, subnets, and security groups to use for the Lambda deployment.</p><p>To
    add the Infrastructure Definition:</p><ol><li>In the Harness Environment, click
    <strong>Add Infrastructure Definition</strong>. The <strong>Infrastructure Definition</strong>
    dialog appears.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1568700465102/image.png"
    style="max-height:25%;max-width:25%" data-hd-height="25%" data-hd-width="25%"/></figure>The
    <strong>Infrastructure Definition</strong> dialog appears.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1568700582279/image.png"
    style="max-height:75%;max-width:75%" data-hd-height="75%" data-hd-width="75%"/></figure></li><li>Enter
    a <strong>Name</strong> that will identify this Infrastructure Definition when
    you <a href="/article/491a6etr7a-4-lambda-workflows-and-deployments">add it to
    a Workflow</a>.</li><li>In <strong>Cloud Provider Type</strong>, select <strong>Amazon
    Web Services</strong>.</li><li>In <strong>Deployment Type</strong>, select <strong>AWS Lambda</strong>.
    This expands the <strong>Infrastructure Definition</strong> dialog to look something
    like this:<figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1568758647596/image.png"
    style="max-height:75%;max-width:75%" data-hd-height="75%" data-hd-width="75%"/></figure></li><li>Select
    <strong>Use</strong> <strong>Already Provisioned Infrastructure</strong>, and
    follow the <a href="#define_provisioned_infrastructure">Define a Provisioned Infrastructure</a>
    steps below.</li></ol><div class="tip-callout">If you are using a configured Harness
    <a href="/article/o22jx8amxb-add-an-infra-provisioner">Infrastructure Provisioner</a>,
    instead select <strong>Map Dynamically Provisioned Infrastructure</strong>, and
    then select the provisioner. The settings below are for <strong>Use Already Provisioned
    Infrastructure</strong>.</div><h4 style="margin-top:1.5em">Define a Provisioned
    Infrastructure</h4><p>The <strong>Infrastructure Definition</strong> dialog&#39;s
    lower section defines settings similar to the <code>‑‑role</code> and <code>‑‑vpc-config</code>
    options in the <code>aws lambda create-function</code> command. For example:</p><pre
    class="hljs bash">$ aws lambda create-function --function-name ExampleApp-aws-lambda-Lambda-my-function
    \<br/>--runtime nodejs8.10 --handler index.handler --zip-file lambda/function.zip
    \<br/><strong>--role</strong> execution-role-arn \<br/><strong>--vpc-config</strong>
    SubnetIds=comma-separated-vpc-subnet-ids,SecurityGroupIds=comma-separated-security-group-ids</pre><p>To
    fill out the <strong>Infrastructure Definition</strong> dialog&#39;s lower section:</p><ol><li>In
    <strong>Cloud Provider</strong>, select the AWS Cloud Provider you added in <a
    href="/article/lo9taq0pze-1-delegate-and-connectors-for-lambda">Connect to AWS
    for Lambda Deployments</a>.</li></ol><div class="tip-callout">After your <strong>Cloud
    Provider</strong> selection, the remaining drop-down lists take a few seconds
    to populate. Later, some fields will again take a few seconds to repopulate based
    on your selections in other fields.</div><ol><li style="counter-increment:li 1"
    start="2">In <strong>IAM Role</strong>, select <a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-intro-execution-role.html">IAM
    role</a> that AWS Lambda assumes when it executes your function.</li><li>In <strong>Region</strong>,
    select the AWS region where your function will be used.</li><li>In <strong>VPC</strong>,
    to connect your function to a VPC to access private resources during execution,
    select the VPC. If you do not select a VPC, then the function executes in &#34;<em>non-VPC</em>&#34;
    mode.</li></ol><div class="tip-callout">Lambda runs your function code securely
    within a VPC by default. However, to enable your Lambda function to access resources
    inside your private VPC, you must provide additional, VPC-specific configuration
    information that includes private subnet IDs and security group IDs. AWS Lambda
    uses this information to set up elastic network interfaces (ENIs) that enable
    your function to connect securely to other resources within your private VPC.
    For more information and guidelines, see <a href="https://docs.aws.amazon.com/lambda/latest/dg/vpc.html"
    target="_blank">Configuring a Lambda Function to Access Resources in an Amazon
    VPC</a> or <a href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-vpc.html"
    target="_blank">Configuring a Lambda function to access resources in a VPC</a>
    from AWS.</div><ol><li style="counter-increment:li 4" start="5">In <strong>Subnets</strong>,
    select the subnet IDs for the subnets (within the VPC) where the Lambda function
    will access resources. AWS recommends that you choose at least two subnets for
    Lambda to run your functions in high availability mode.</li><li>In <strong>Security
    Groups</strong>, select the security group ID(s) for the Lambda function. When
    you set a VPC for your function to access, your Lambda function loses default
    Internet access. If you require external Internet access for your function, make
    sure that your security group allows outbound connections, and that your VPC has
    a NAT gateway.</li><li>Enable <strong>Scope to Specific Services</strong>, and
    use the adjacent drop-down to select the Harness Lambda Service you created in
    <a href="/article/qp8hk4nzbo-2-service-for-lambda">Add Lambda Functions</a>.</li></ol><div
    class="tip-callout">Scoping is a recommended step, to make this Infrastructure
    Definition available to any Workflow or Phase that uses your Lambda Service.</div><p
    style="margin-left:2.5em">When you are done, the dialog will look something like
    this:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1568774468395/image.png"
    style="max-height:75%;max-width:75%" data-hd-height="75%" data-hd-width="75%"/></figure><ol><li
    style="counter-increment:li 7" start="8">Click <strong>Submit</strong>. The new
    Infrastructure Definition is added to the Harness environment.</li></ol><h3>Option:
    Provision the Lambda Infrastructure</h3><p>With Harness, you can use a CloudFormation
    template to provision the Lambda infrastructure. For more information, see <a
    href="/article/4xtxj2f88b-map-cloud-formation-infrastructure#option_3_map_an_aws_lambda_infrastructure">Map
    an AWS Lambda Infrastructure</a>.</p><h3>Option: Override Service Settings</h3><p>Your
    Environment can overwrite Service Config Variables, Config Files, and other settings.
    This enables you to maintain a Service&#39;s native settings, but change them
    when the Service is used with this Environment.</p><p>For more information, see
    <a href="https://docs.harness.io/article/n39w05njjv-environment-configuration#override_a_service_configuration">Override
    a Service Configuration</a>.</p><p></p><h3>Next Steps</h3><ul><li><a href="/article/491a6etr7a-4-lambda-workflows-and-deployments">Create
    a Basic Lambda Deployment</a></li><li><a href="/article/g9o2g5jbye-troubleshooting-harness#aws_lambda">Troubleshoot
    AWS Lambda Deployments</a></li></ul><p></p>'
  slug: 3-lambda-environments
  tags:
  - Lambda
  - Environment
  - Infrastructure Definition
  - Service Infrastructure
  is_live: true
