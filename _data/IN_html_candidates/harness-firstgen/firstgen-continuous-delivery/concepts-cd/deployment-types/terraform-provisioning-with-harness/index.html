<p></p><div class="tip-callout">This content is for Harness <a href="/article/1fjmm4by22">FirstGen</a>. Switch to <a href="/article/w6i5f7cpc9">NextGen</a>.</div><p>Harness lets you use Terraform to provision infrastructure as part of your deployment process. Harness can provision any resource that is supported by a Terraform  <a href="https://www.terraform.io/docs/configuration/providers.html" target="_blank">provider or plugin</a>.</p><div class="note-callout">Looking for How-tos? See <a href="/article/9pvvgcdbjh-terrform-provisioner">Terraform How-tos</a>.</div><p>In this topic:</p><ul><li> <a href="#terraform_implementation_summary">Terraform Implementation Summary</a></li><li> <a href="#use_terraform_for_non_deployment_provisioning">Use Terraform for Non-deployment Provisioning</a></li><li> <a href="#limitations">Limitations</a></li><li> <a href="#permissions">Permissions</a></li><li> <a href="#no_artifact_required">No Artifact Required</a></li><li> <a href="#service_instances_s_is_consumption">Service Instances (SIs) Consumption</a></li></ul><h3>Terraform Implementation Summary</h3><p>Here is a visual summary of how you use your Terraform scripts in Harness to provision infra and then deploy to it:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/hh52ews03d/1586283628749/image.png"/></figure><p>You set up a Terraform Infrastructure Provisioner in the following order:</p><ol><li><strong>Terraform Infrastructure Provisioner</strong> — Add your Terraform scripts as a Harness Terraform Provisioner. You add the provisioner script by connecting to a Git repo where the scripts are kept and setting up any inputs.</li><li><strong>​Infrastructure Definition</strong> — Select the Terraform Provisioner you set up. Now it can be used in any Workflow where you want to target the provisioned infrastructure. You simply map your script outputs to the required Harness settings:</li></ol><p></p><figure><a href="https://files.helpdocs.io/kw8ldg1itf/other/1568837600923/image.png"><img src="https://files.helpdocs.io/kw8ldg1itf/other/1568837600923/image.png"/></a></figure><p></p><ol><li style="counter-increment:li 2" start="3"><strong>Workflow Setup</strong> — When you create your Workflow, you select the Infrastructure Definition that maps to your script outputs.</li><li><strong>Workflow Provisioner Step</strong> — In the Workflow, you add a <strong>Terraform Provisioner</strong> step. The Workflow will build the infrastructure according to your Terraform script.</li><li><strong>Pre-deployment</strong> — The pre-deployment steps are executed and provision the infrastructure using the <strong>Terraform Provisioner</strong> step.</li><li><strong>Deployment</strong> — The Workflow deploys to the provisioned infrastructure defined in its Infrastructure Definition.</li></ol><h3>Use Terraform for Non-deployment Provisioning</h3><p>You can use Terraform in Harness to provision any infrastructure, not just the target infrastructure for the deployment.</p><p>See <a href="/article/jaxppd8w9j-using-the-terraform-apply-command">Using the Terraform Apply Command</a>.</p><h3>Limitations</h3><ul><li>Terraform Infrastructure Provisioners are only supported in Canary and Multi-Service deployment types. For AMI/ASG and ECS deployments, Terraform Infrastructure Provisioners are also supported in Blue/Green deployments.</li><li>The <strong>Terraform Provision</strong> and <strong>Terraform Rollback</strong> commands are available in the <strong>Pre-deployment</strong> section and the <strong>Terraform Destroy</strong> command is available in the <strong>Post-deployment</strong> section.</li></ul><h3 id="permissions">Permissions</h3><p>You need to give Harness permissions in your target environment so Harness can provision using Terraform. These are the same permissions you would need to grant Harness for existing, static infrastructures.</p><p>The permissions required for Harness to use your provisioner and successfully deploy to the provisioned instances depends on the deployment platform you use.</p><p>As a summary, you will need to manage the following permissions:</p><ul><li><strong>Delegate</strong> - The Harness Delegate will require permissions according to the deployment platform. It will use the access, secret, and SSH keys you configure in Harness  <a href="https://docs.harness.io/article/au38zpufhr-secret-management">Secrets Management</a> to perform deployment operations. For ECS Delegates, you can add an IAM role to the ECS Delegate task definition. For more information, see  <a href="/article/wrm6hpyrjl-harness-ecs-delegate#trust_relationships_and_roles">Trust Relationships and Roles</a>.</li><li><strong>Cloud Provider</strong> - The Harness Cloud Provider must have access permissions for the resources you are planning to create in the Terraform script. For some Harness Cloud Providers, you can use the installed Delegate and have the Cloud Provider assume the permissions used by the Delegate. For others, you can enter cloud platform account information.</li></ul><div class="note-callout">The account used for the Cloud Provider will require platform-specific permissions for creating infrastructure. For example, to create EC2 AMIs the account requires the <strong>AmazonEC2FullAccess</strong> policy.</div><ul><li><strong>Git Repo</strong> - You will add the Git repo where the provisioner script is located to Harness as a Source Repo Provider. For more information, see  <a href="https://docs.harness.io/article/ay9hlwbgwa-add-source-repo-providers">Add Source Repo Providers</a>.</li><li><strong>Access and Secret Keys</strong> - These are set up in Harness  <a href="https://docs.harness.io/article/au38zpufhr-secret-management">Secrets Management</a> and then used as variable values when you add a Provisioner step to a Workflow.</li><li><strong>SSH Key</strong> - In order for the Delegate to copy artifacts to the provisioned instances, it will need an SSH key. You set this up in Harness Secrets Management and then reference it in the Harness Environment Infrastructure Definition. See <a href="/article/au38zpufhr-secret-management">Secrets Management</a>.</li><li><strong>Platform Security Groups</strong> - Security groups are associated with EC2 and other cloud platform instances and provide security at the protocol and port access level. You will need to define security groups in your provisioner scripts and ensure that they allow the Delegate to connect to the provisioned instances.</li></ul><h3>No Artifact Required</h3><p>You do not need to deploy artifacts via Harness Services to use Terraform provisioning in a Workflow. You can simply set up a Terraform Provisioner and use it in a Workflow to provision infrastructure without deploying any artifact. In Harness documentation, we include artifact deployment as it is the ultimate goal of Continuous Delivery.</p><h3>Service Instances (SIs) Consumption</h3><p>Harness Service Instances (SIs) are not consumed when a Harness Workflow uses Terraform to provision resources. When Harness deploys artifacts via Harness Services to the provisioned infrastructure in the same Workflow or Pipeline, SIs licensing is consumed.</p><h3>Next Steps</h3><p>Get started with <a href="https://docs.harness.io/article/9pvvgcdbjh-terrform-provisioner">Terraform How-tos</a>.</p><p></p>