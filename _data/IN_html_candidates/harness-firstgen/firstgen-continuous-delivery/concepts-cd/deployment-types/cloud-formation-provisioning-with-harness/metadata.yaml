type: article
article_id: qj0ems5hmg
user_id: mfr0nxh4be
category_id: vbcmo6ltg7
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: CloudFormation Provisioning with Harness (FirstGen)
slug: cloud-formation-provisioning-with-harness
description: Use AWS CloudFormation to provision infrastructure as part of your deployment
  process.
short_version: Use AWS CloudFormation to provision infrastructure as part of your
  deployment process.
tags: []
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: ""
  source: API
  triggered_at: 2022-07-18T22:07:37.685993Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: CloudFormation Provisioning with Harness (FirstGen)
  description: Use AWS CloudFormation to provision infrastructure as part of your
    deployment process.
  short_version: Use AWS CloudFormation to provision infrastructure as part of your
    deployment process.
  body: <p></p><div class="tip-callout">This content is for Harness <a href="/article/1fjmm4by22">FirstGen</a>.
    Switch to <a href="/article/vynj4hxt98">NextGen</a>.</div><p>Harness lets you
    use AWS CloudFormation to provision infrastructure as part of your deployment
    process. Harness can provision any resource that is supported by <a href="https://aws.amazon.com/cloudformation/"
    target="_blank">CloudFormation</a>.</p><p>In this topic:</p><ul><li><a href="#limitations">Limitations</a></li><li><a
    href="#cloud_formation_implementation_summary">CloudFormation Implementation Summary</a></li><li><a
    href="#permissions">Permissions</a></li><li><a href="#no_artifact_required">No
    Artifact Required</a></li><li><a href="#service_instances_s_is_consumption">Service
    Instances (SIs) Consumption</a></li></ul><p></p><h3>Limitations</h3><ul><li>Harness
    CloudFormation integration does not support AWS Serverless Application Model (SAM)
    templates. Only standard <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-whatis-concepts.html#w2ab1b5c15b7">AWS
    CloudFormation templates</a>.</li><li>Harness Infrastructure Provisioners are
    only supported in Canary and Multi-Service deployment types. For AMI/ASG and ECS
    deployments, Infrastructure Provisioners are also supported in Blue/Green deployments.</li></ul><h3>CloudFormation
    Implementation Summary</h3><p>You use a CloudFormation Infrastructure Provisioner
    in the following ways:</p><ol><li><strong>CloudFormation Infrastructure Provisioner</strong>
    — Add a Harness Infrastructure Provisioner as a blueprint for the infrastructure
    where you will deploy your application.<br/>You add the CloudFormation template
    by pasting it into the Infrastructure Provisioner, or by connecting to an AWS
    S3 bucket or Git repo where the CloudFormation templates are kept.<br/>You simply
    need to map some of the output variables in the template to the required fields
    in Harness. When Harness deploys your microservice, it will build your infrastructure
    according to this blueprint.</li><li><strong>Infrastructure Definition</strong>
    — In a Harness Infrastructure Definition, the outputs are mapped as part of the
    Infrastructure Definition:<figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1569042536517/image.png"/></figure>The
    provisioned environment is now a deployment target environment for a Workflow
    to use. You can use this Infrastructure Definition in any Workflow where you want
    to deploy to that provisioned deployment infrastructure.</li><li><strong>Workflow
    Step</strong> — Add a CloudFormation Provisioner step to a Workflow to build the
    infrastructure according to your CloudFormation Provisioner and its template.</li></ol><h3>Permissions</h3><p>The
    permissions required for Harness to use your provisioner and successfully deploy
    to the provisioned instances depends on the deployment platform you provision.
    The permissions are discussed in this topic in the configuration steps where they
    are applied, but, as a summary, you will need to manage the following permissions:</p><ul><li><strong>Delegate</strong>
    - The Delegate will require permissions according to the deployment platform.
    It will use the access, secret, and SSH keys you configure in Harness <a href="/article/au38zpufhr-secret-management">Secrets
    Management</a> to perform deployment operations. For ECS Delegates, you can add
    an IAM role to the ECS Delegate task definition. For more information, see <a
    href="https://docs.harness.io/article/h9tkwmkrm7-delegate-installation#trust_relationships_and_roles">Trust
    Relationships and Roles</a>.</li><li><strong>Cloud Provider</strong> - The AWS
    Cloud Provider must have <strong>create</strong> permissions for the resources
    you are planning to create in the CloudFormation template. For Harness AWS Cloud
    Providers, you can install the Delegate in your AWS VPC and have the Cloud Provider
    assume the permissions used by the Delegate.</li></ul><div class="note-callout">The
    account used for the Cloud Provider will require platform-specific permissions
    for creating infrastructure. For example, to create EC2 AMI instances the account
    requires the <strong>AmazonEC2FullAccess</strong> policy.</div><ul><li><strong>S3
    Bucket</strong> - You can use an AWS S3 bucket to point to the provisioner template.
    The AWS Cloud Provider can be used to access S3 also. The IAM role used by the
    Cloud Provider simply needs the S3 Bucket policy, described in <a href="/article/whwnovprrb-cloud-providers#amazon_s3">Add
    Cloud Providers</a>.</li><li><strong>Access and Secret Keys</strong> - These are
    set up in Harness <a href="/article/au38zpufhr-secret-management">Secrets Management</a>
    and then used as inout values when you add a CloudFormation Provisioner step to
    a Workflow.</li></ul><h3>No Artifact Required</h3><p></p><p>You do not need to
    deploy artifacts via Harness Services to use CloudFormation provisioning in a
    Workflow. You can simply set up a CloudFormation Provisioner and use it in a Workflow
    to provision infrastructure without deploying any artifact. In Harness documentation,
    we include artifact deployment as it is the ultimate goal of Continuous Delivery.</p><h3>Service
    Instances (SIs) Consumption</h3><p></p><p>Harness Service Instances (SIs) are
    not consumed and no additional licensing is required when a Harness Workflow uses
    CloudFormation to provision resources. When Harness deploys artifacts via Harness
    Services to the provisioned infrastructure in the same Workflow or Pipeline, SIs
    licensing is consumed.</p>
  slug: cloud-formation-provisioning-with-harness
  tags: []
  is_live: true
