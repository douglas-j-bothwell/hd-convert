type: article
article_id: u3rp89v80h
user_id: mfr0nxh4be
category_id: n03qfofd5w
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Define Your Kubernetes Target Infrastructure
slug: define-your-kubernetes-target-infrastructure
description: Specify the Kubernetes cluster you want to target for deployment.
short_version: Specify the Kubernetes cluster you want to target for deployment.
tags:
- release name
- target cluster
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: Article updated
  source: API
  triggered_at: 2021-08-19T20:11:27.675891Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Define Your Kubernetes Target Infrastructure
  description: Specify the Kubernetes cluster you want to target for deployment.
  short_version: Specify the Kubernetes cluster you want to target for deployment.
  body: '<p>Harness Infrastructure Definitions specify the target deployment infrastructure
    for your Harness Services, and the specific infrastructure details for the deployment,
    like cluster settings.</p><p>Specify the Kubernetes cluster you want to target
    for deployment as a Harness Infrastructure Definition.</p><div class="note-callout">For
    Amazon Elastic Kubernetes Service (Amazon EKS) and OpenShift, use <a href="#option_1_specify_a_vendor_agnostic_kubernetes_cluster">Option
    1: Specify a Vendor Agnostic Kubernetes Cluster</a>.</div><p>In this topic:</p><ul><li><a
    href="#before_you_begin">Before You Begin</a></li><li><a href="#step_1_create_an_environment">Step
    1: Create an Environment</a></li><li><a href="#option_1_specify_a_vendor_agnostic_kubernetes_cluster">Option
    1: Specify a Vendor Agnostic Kubernetes Cluster</a></li><li><a href="#option_2_specify_a_gcp_or_azure_kubernetes_cluster">Option
    2: Specify a GCP or Azure Kubernetes Cluster</a></li></ul><h3>Before You Begin</h3><ul><li><a
    href="/article/6ib8n1n1k6-add-container-images-for-kubernetes-deployments">Add
    Container Images for Kubernetes Deployments</a></li><li><a href="/article/2j2vi5oxrq-define-kubernetes-manifests">Define
    Kubernetes Manifests</a></li></ul><h3>Step 1: Create an Environment</h3><p>Environments
    represent one or more of your deployment infrastructures, such as Dev, QA, Stage,
    Production, etc. Use Environments to organize your target cluster Infrastructure
    Definitions.</p><ol><li>In your Harness Application, click <strong>Environments</strong>.
    The <strong>Environments</strong> page appears.</li><li>Click Add Environment.
    The <strong>Environment</strong> settings appear.</li><li>In <strong>Name</strong>,
    enter a name that describes this group of target clusters, such as QA, Stage,
    Prod, etc.</li><li>In <strong>Environment Type</strong>, select <strong>Non-Production</strong>
    or <strong>Production</strong>.</li><li>Click <strong>SUBMIT</strong>. The new <strong>Environment</strong> page
    appears.</li><li>Click  <strong>Add Infrastructure Definition</strong>. The following
    section provide information on setting up different Add Infrastructure Definitions
    for different target clusters.</li></ol><h3>Option 1: Specify a Vendor Agnostic
    Kubernetes Cluster</h3><div class="note-callout">Currently, Harness connects to
    Amazon Elastic Kubernetes Service (Amazon EKS) and OpenShift using the Kubernetes
    Cluster Cloud Provider.</div><p>If you are using a Harness Kubernetes Cluster
    Cloud Provider to connect to your target cluster, enter the following settings:</p><h4>Name</h4><p>Enter
    a name that describes the target cluster, such as <strong>checkout</strong>, <strong>orders</strong>,
    etc.</p><h4>Cloud Provider Type</h4><p>Select <strong>Kubernetes Cluster</strong>.</p><h4>Deployment
    Type</h4><p>Select <strong>Kubernetes</strong>.</p><p>The <strong>Helm</strong>
    option is only if you are deploying to a Harness native Helm Service. See <a href="/article/ii558ppikj-helm-deployments-overview">Helm
    Deployments Overview</a>.</p><h4>Cloud Provider</h4><p>Select the <strong>Kubernetes
    Cluster Cloud Provider</strong> that connects to your target cluster. All Kubernetes
    Cluster Cloud Providers are prefaced with <strong>Kubernetes Cluster:</strong>.</p><p></p><figure><img
    src="https://files.helpdocs.io/i5nl071jo5/articles/0ud2ut4vt2/1580771174702/image.png"
    style="max-height:50%;max-width:50%;display:block;margin-left:auto;margin-right:auto"
    data-hd-height="50%" data-hd-width="50%" data-hd-align="center"/></figure><h4>Namespace</h4><p>Select
    the namespace of the target Kubernetes cluster. Typically, this is <code>default</code>.</p><p>The
    namespace must already exist during deployment. Harness will not create a new
    namespace if you enter one here.</p><p>You can use Harness variables to reference
    the name here in the Service Manifests files. See <a href="/article/5xm4z4q3d8-create-kubernetes-namespaces-based-on-infra-mapping">Create
    Kubernetes Namespaces based on InfraMapping</a>.</p><div class="note-callout">If
    you omit the <code>namespace</code> key and value from a manifest in your Service,
    Harness automatically uses the namespace you entered in the Harness Environment  <strong>Infrastructure
    Definition</strong> settings <strong>Namespace</strong> field.</div><h4>Release
    Name</h4><p>Harness requires a Kubernetes release name for tracking.</p><p>The
    release name must be unique across the cluster.</p><p>The Harness-generated unique
    identifier <code>release-${infra.kubernetes.infraId}</code> can be used to ensure
    a unique release name.</p><p>The <code>${infra.kubernetes.infraId}</code> expression
    is a unique identifier that identifies the combination of Service and Infrastructure
    Definition.</p><p>In the Infrastructure Definition <strong>Service Infrastructure
    Mapping</strong> below each listing has a unique identifier that can be referenced
    using <code>${infra.kubernetes.infraId}</code>:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/u3rp89v80h/1624554401882/clean-shot-2021-06-24-at-10-06-02.png"/></figure><div
    class="note-callout">Use <code>release-${infra.kubernetes.infraId}</code> for
    the <strong>Release Name</strong> instead of just <code>${infra.kubernetes.infraId}</code>.
    Kubernetes service and pod names follow RFC-1035 and must consist of lowercase
    alphanumeric characters or &#39;-&#39;, start with an alphabetic character, and
    end with an alphanumeric character. Using <code>release-</code> as a prefix will
    prevent any issues.</div><p>Here is an example of how <code>${infra.kubernetes.infraId}</code>
    is used and how the ID is output as the <strong>Release Name</strong>:</p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/u3rp89v80h/1623869897319/clean-shot-2021-06-16-at-11-55-07.png"/></figure><p>See
    <a href="/article/aza65y4af6-built-in-variables-list">Built-in Variables List</a>
    for more expressions.</p><p>The release name is not incremented with each release.
    It identifies releases so that Harness knows which release is being replaced with
    a new version.</p><p>See <a href="/article/ttn8acijrz-versioning-and-annotations">Kubernetes
    Versioning and Annotations</a>.</p><h5>Release Name is Reserved for Internal Harness
    ConfigMap</h5><p>The release name you enter in <strong>Release Name</strong> is
    reserved for the internal Harness ConfigMap used for tracking the deployment.</p><p>Do
    not create a ConfigMap that uses the same name as the release name. Your ConfigMap
    will override the Harness internal ConfigMap and cause a NullPointerException.</p><h4>Scope
    to specific Services</h4><p>To limit this Infrastructure Definition to specific
    Harness Services, select the Services in <strong>Scope to specific Services</strong>.</p><p>If
    you leave this setting empty, the Infrastructure Definition is available to all
    Workflows deploying Services with the Deployment Type of this Infrastructure Definition.</p><h4>Example</h4><p></p><figure><img
    src="https://files.helpdocs.io/i5nl071jo5/articles/0ud2ut4vt2/1580771833106/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><h3>Option
    2: Specify a GCP or Azure Kubernetes Cluster</h3><p>If you are using a Harness
    Google Cloud Platform or Azure Cloud Provider to connect to your target cluster,
    enter the following settings:</p><h4>Name</h4><p>Enter a name that describes the
    target cluster, such as <strong>checkout</strong>, <strong>orders</strong>, etc.</p><h4>Cloud
    Provider Type</h4><p>Select <strong>Google Cloud Platform</strong> or <strong>Microsoft
    Azure</strong>.</p><p>The only differences in settings are the <strong>Azure Subscription</strong>
    and <strong>Resource Group</strong> settings, described below.</p><h4>Deployment
    Type</h4><p>Select <strong>Kubernetes</strong>.</p><p>The <strong>Helm</strong>
    option is only if you are deploying to a Harness native Helm Service. See <a href="/article/ii558ppikj-helm-deployments-overview">Helm
    Deployments Overview</a>.</p><h4>Use Already Provisioned Infrastructure</h4><p>To
    manually define the target cluster, select <strong>Use Already Provisioned Infrastructure</strong>.</p><h4>Map
    Dynamically Provisioned Infrastructure</h4><p>To use a Harness Infrastructure
    Provisioner, select <strong>Map Dynamically Provisioned Infrastructure</strong>.
    For details on provisioning your cluster, See <a href="/article/huajnezo0r-provision-kubernetes-infrastructures">Provision
    Kubernetes Infrastructures</a>.</p><h4>Cloud Provider</h4><p>Select the <strong>Google
    Cloud Platform</strong> or <strong>Azure Cloud Provider</strong> that connects
    to your target cluster.</p><p>All Google Cloud Platform Cloud Providers are prefaced
    with <strong>Google Cloud Platform:</strong>.</p><p>All Azure Cloud Providers
    are prefaced with <strong>Azure:</strong>.</p><h4>Azure: Subscription</h4><p>Select
    the Azure subscription to use.</p><p>When you set up the <a href="/article/whwnovprrb-cloud-providers">Azure
    Cloud Provider</a> in Harness, you entered the <strong>Client/Application ID</strong> for
    the Azure App registration. To access resources in your Azure subscription, you
    must assign the Azure app using this Client ID to a role in that subscription.</p><p>In
    this Azure Infrastructure Definition, you select the subscription. If the Azure
    App registration using this Client ID is not assigned a role in a subscription,
    no subscriptions will be available.</p><h4>Azure: Resource Group</h4><p>Select
    the resource group where your VM is located.</p><h4>Cluster Name</h4><p>Select
    the cluster you created for this deployment.</p><p></p><figure><img src="https://files.helpdocs.io/i5nl071jo5/articles/0ud2ut4vt2/1580772255572/image.png"
    style="max-height:50%;max-width:50%;display:block;margin-left:auto;margin-right:auto"
    data-hd-height="50%" data-hd-width="50%" data-hd-align="center"/></figure><p>If
    the cluster name is taking a long time to load, check the connectivity of the
    host running the Harness Delegate.</p><h4>Namespace</h4><p>Enter the namespace
    of the target Kubernetes cluster. Typically, this is <code>default</code>.</p><p>The
    namespace must already exist during deployment. Harness will not create a new
    namespace if you enter one here.</p><p>You can use Harness variables to reference
    the name here in the Service Manifests files. See <a href="/article/5xm4z4q3d8-create-kubernetes-namespaces-based-on-infra-mapping">Create
    Kubernetes Namespaces based on InfraMapping</a>.</p><div class="note-callout">If
    you omit the <code>namespace</code> key and value from a manifest in your Service,
    Harness automatically uses the namespace you entered in the Harness Environment  <strong>Infrastructure
    Definition</strong> settings <strong>Namespace</strong> field.</div><h4>Release
    Name</h4><p>Harness requires a Kubernetes release name for tracking.</p><p>The
    release name must be unique across the cluster.</p><p>The Harness-generated unique
    identifier <code>release-${infra.kubernetes.infraId}</code> can be used to ensure
    a unique release name.</p><div class="note-callout">Use <code>release-${infra.kubernetes.infraId}</code> for
    the <strong>Release Name</strong> instead of just <code>${infra.kubernetes.infraId}</code>.
    Kubernetes service and pod names follow DNS-1035 and must consist of lowercase
    alphanumeric characters or &#39;-&#39;, start with an alphabetic character, and
    end with an alphanumeric character. Using <code>release-</code> as a prefix will
    prevent any issues.</div><h4>Scope to specific Services</h4><p>To limit this Infrastructure
    Definition to specific Harness Services, select the Services in <strong>Scope
    to specific Services</strong>.</p><p>If you leave this setting empty, the Infrastructure
    Definition is available to all Workflows deploying Services with the Deployment
    Type of this Infrastructure Definition.</p><h4>Example</h4><p>Here is an example
    of a cluster targeted using a Google Cloud Platform Cloud Provider:</p><figure><img
    src="https://files.helpdocs.io/i5nl071jo5/articles/0ud2ut4vt2/1580772383510/image.png"
    style="max-height:50%;max-width:50%;display:block;margin-left:auto;margin-right:auto"
    data-hd-height="50%" data-hd-width="50%" data-hd-align="center"/></figure><p>Here
    is an example of a cluster targeted using a Azure Cloud Provider:</p><p></p><figure><img
    src="https://files.helpdocs.io/i5nl071jo5/articles/0ud2ut4vt2/1580772704694/image.png"
    style="max-height:50%;max-width:50%;display:block;margin-left:auto;margin-right:auto"
    data-hd-height="50%" data-hd-width="50%" data-hd-align="center"/></figure><h3>Next
    Steps</h3><ul><li><a href="/article/huajnezo0r-provision-kubernetes-infrastructures">Provision
    Kubernetes Infrastructures</a></li></ul><p></p>'
  slug: define-your-kubernetes-target-infrastructure
  tags:
  - release name
  - target cluster
  is_live: true
