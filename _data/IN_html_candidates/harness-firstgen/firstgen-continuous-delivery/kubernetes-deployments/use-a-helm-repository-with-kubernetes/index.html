<div class="tip-callout">This content is for Harness <a href="/article/1fjmm4by22">FirstGen</a>. Switch to <a href="/article/cifa2yb19a">NextGen</a>.</div><p></p><p>You can link remote Helm charts in a Helm Repository to your Harness Kubernetes Service, such as AWS S3, Google Cloud Storage (GCS), or a chart repo such as Bitnami.</p><div class="note-callout">You can also use Helm charts in a Git repo. For more information, see <a href="/article/yjkkwi56hl-link-resource-files-or-helm-charts-in-git-repos">Link Resource Files or Helm Charts in Git Repos</a>.</div><p>In this topic:</p><ul><li> <a href="#before_you_begin">Before You Begin</a></li><li> <a href="#migrating_from_a_harness_helm_deployment_type">Migrating from a Harness Helm Deployment Type?</a></li><li> <a href="#step_1_helm_repository_artifact_server">Step 1: Helm Repository Artifact Server</a></li><li> <a href="#step_2_link_the_service_with_a_helm_repository">Step 2: Link the Service with a Helm Repository</a></li><li> <a href="#option_skip_versioning_for_service">Option: Skip Versioning for Service</a></li><li> <a href="#option_helm_command_flags">Option: Helm Command Flags</a></li><li><a href="https://docs.harness.io/article/hddm3rgf1y-use-a-helm-repository-with-kubernetes#option_override_helm_chart_values_yaml">Option: Override Helm Chart Values YAML</a></li><li> <a href="#example_1_google_gcs_and_aws_s3">Example 1: Google GCS and AWS S3</a></li><li> <a href="#example_2_workflow_variable_expression">Example 2: Workflow Variable Expression</a></li><li> <a href="#example_3_deploying_kubernetes_service_linked_to_a_helm_repository">Example 3: Deploying Kubernetes Service Linked to a Helm Repository</a></li><li> <a href="#notes">Notes</a></li><li> <a href="#next_steps">Next Steps</a></li></ul><h3>Before You Begin</h3><ul><li><a href="/article/ycacqs7tlx-override-harness-kubernetes-service-settings">Override Harness Kubernetes Service Settings</a></li><li><a href="/article/2j2vi5oxrq-define-kubernetes-manifests">Define Kubernetes Manifests</a></li></ul><h3>Migrating from a Harness Helm Deployment Type?</h3><p>If you are migrating from a Harness Helm deployment type to the Kubernetes deployment type, be aware that Helm charts in Kubernetes V2 require that you set up a Harness <a href="/article/7dghbx1dbl-configuring-artifact-server">Helm Artifact Server</a> to connect to your remote Helm chart repo.</p><h3>Step 1: Helm Repository Artifact Server</h3><p>Before you can link a Helm Repository to your Harness Kubernetes Service, you create a Harness Artifact Server to connect Harness with a Helm Repository.</p><p>See <a href="/article/0hrzb1zkog-add-helm-repository-servers">Add Helm Repository Artifact Servers</a>.</p><h3>Step 2: Link the Service with a Helm Repository</h3><ol><li>In your Harness Kubernetes Service, in <strong>Manifests</strong>, click <strong>Link Remote Manifests</strong>. The <strong>Remote Manifests</strong> settings appear.</li><li>In <strong>Manifest Format</strong>, select <strong>Helm Chart from Helm Repository</strong>.</li><li>In <strong>Helm Repository</strong>, select the Helm Chart Repository you added as a Harness Artifact Server. For more information, see <a href="/article/0hrzb1zkog-add-helm-repository-servers">Add Helm Repository Artifact Servers</a>.<div class="note-callout">If you are using GCS or a storage service for your Helm Repository, you will see a <strong>Base Path</strong> setting.</div></li><li>In <strong>Base Path</strong> (GCS or a storage service only), enter the path to the charts&#39; bucket folder or a Workflow variable expression.<ol><li style="counter-increment:li 0" start="1">If you use a charts&#39; bucket folder, simply enter the name of the folder. Whether you need to specify a single folder (e.g. <code>charts</code>) a folder path (e.g. <code>helm/charts</code>) depends on the Helm Chart Repository you added as a Harness Artifact Server.</li><li>If you use a Workflow variable expression, you can enter in the expression as part of the path. For example, <code>/Myservice/Chart/${workflow.variables.branchName}/</code> or simply <code>${workflow.variables.chartFolder}</code>.</li></ol><div class="note-callout">For more information, see <a href="/article/7bpdtvhq92-workflow-variables-expressions">Kubernetes Workflow Variable Expressions</a> and <a href="/article/9dvxcegm90-variables">Variables and Expressions in Harness</a>.</div><ol><li style="counter-increment:li 2" start="3">If the chart is in the <strong>root</strong> folder of the repository location set in the Helm Chart Repository you added as a Harness Artifact Server, leave <strong>Base Path</strong> empty.</li></ol></li><li>In <strong>Chart Name</strong>, enter the name of the chart in that repo. For example, we use <strong>nginx</strong>.<br/>In some cases, you might have different charts in different repos, and you do not want to create a new Harness Service for each chart. To address this, you have the following options:</li></ol><ul><li>You can use a Service variable for the <strong>Chart Name</strong> setting. You can then supply the value at deployment runtime. See <a href="/article/q78p7rpx9u-add-service-level-config-variables">Add Service Config Variables</a>. You can also override this setting using an Environment Service Override Variable. <a href="/article/4m2kst307m-override-service-files-and-variables-in-environments">Override a Service Configuration in an Environment</a>.</li><li>You can also override the Helm chart in the Service using a Helm chart override in an Environment. See <a href="/article/ycacqs7tlx-override-harness-kubernetes-service-settings">Override Harness Kubernetes Service Settings</a>.</li></ul><ol><li style="counter-increment:li 5" start="6">In <strong>Chart Version</strong>, enter the chart version to use. This is found in the <strong>Chart.yaml</strong> <strong>version</strong> label. For this guide, we will use <strong>1.0.1</strong>. If you leave this field empty Harness gets the latest chart.</li><li>In <strong>Helm Version</strong>, select the Helm version of your chart, such as <strong>v3</strong>.</li></ol><p>When you are finished, the dialog will look like this:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/hddm3rgf1y/1591392858301/image.png"/></figure><h3>Option: Skip Versioning for Service</h3><p>By default, Harness versions ConfigMaps and Secrets deployed into Kubernetes clusters. In some cases, you might want to skip versioning.</p><p>Typically, to skip versioning in your deployments, you add the annotation <code>harness.io/skip-file-for-deploy</code> to your manifests. See <a href="/article/4vjgmjcj6z-deploy-manifests-separately-using-apply-step">Deploy Manifests Separately using Apply Step</a>.</p><p>In some cases, such as when using public manifests or Helm charts, you cannot add the annotation. Or you might have 100 manifests and you only want to skip versioning for 50 of them. Adding the annotation to 50 manifests is time-consuming.</p><p>Instead, enable the <strong>Skip Versioning for Service</strong> option in <strong>Remote Manifests</strong>.</p><p>When you enable <strong>Skip Versioning for Service</strong>, Harness will not perform versioning of ConfigMaps and Secrets for the Service.</p><p>If you have enabled <strong>Skip Versioning for Service</strong> for a few deployments and then disable it, Harness will start versioning ConfigMaps and Secrets.</p><h3>Option: Helm Command Flags</h3><p>You can extend the Helm commands that Harness runs when deploying your Helm chart.</p><p>Use <strong>Enable Command Flags</strong> to have Harness run Helm-specific Helm commands and their options <u>as part of preprocessing</u>. All the commands you select are run before <code>helm install/upgrade</code>.</p><p>Click <strong>Enable Command Flags</strong>, and then select commands from the <strong>Command Flag Type</strong> dropdown.</p><p>Next, in <strong>Input</strong>, add any options for the command.</p><div class="note-callout">The <code>--debug</code> option is not supported.</div><p>For Kubernetes deployments using Helm charts from a Helm Repository, the following commands are supported (more might be added):</p><ul><li>TEMPLATE: <code>helm template</code> to render the helm template files.</li><li>VERSION: <code>helm version</code> to validate Helm on the Delegate.</li><li>FETCH: <code>helm fetch</code> (v1) <code>helm pull</code> (v2) to get the Helm chart.</li></ul><p>You will see the outputs for the commands you select in the Harness deployment logs. The output will be part of pre-processing and appear before <code>helm install/upgrade</code>.</p><div class="note-callout">If you use Helm commands in the Harness Service and in a Workflow deploying that Service, the Helm commands in the Harness Service override the commands in the Workflow.</div><h4>Harness Variable Expressions are Supported</h4><p>You can use <a href="/article/9dvxcegm90-variables">Harness variable expressions</a> in any of the command options settings. For example, <a href="/article/q78p7rpx9u-add-service-level-config-variables">Service Config variables</a> and <a href="/article/766iheu1bk-add-workflow-variables-new-template">Workflow variables</a>.</p><h3>Option: Override Helm Chart Values YAML</h3><div class="note-callout">For the <strong>Inline</strong> and <strong>Remote</strong> options, see <a href="/article/p453sikbqt-override-values-yaml-files">Override Values YAML Files</a>.</div><p>If you are using the Helm Chart from Helm Repository option in <strong>Manifests</strong>, you can override the chart in <strong>Manifests</strong> using one or more values YAML files inside the Helm chart.</p><p>In <strong>Configuration</strong>, in <strong>Values YAML Override</strong>, click the edit icon.</p><p>In <strong>Store Type</strong>, select <strong>From Helm Repository</strong>.</p><p>In <strong>File Path(s)</strong>, enter the file path to the override values YAML file.</p><p>Multiple files can be used. When you enter the file paths, separate the paths using commas.</p><p>The latter paths are given higher priority.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/p453sikbqt/1627588950131/clean-shot-2021-07-29-at-13-02-21.png"/></figure><p>See <a href="/article/p453sikbqt-override-values-yaml-files">Override Values YAML Files</a>.</p><h3>Example 1: Google GCS and AWS S3</h3><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/hddm3rgf1y/1586419974586/screenshot-2020-04-09-at-1-41-56-pm.png" style="max-height:70%;max-width:70%" data-hd-height="70%" data-hd-width="70%"/></figure><p></p><h3>Example 2: Workflow Variable Expression</h3><p>Here is an example using a Workflow variable expression. You can see the variable created in the Workflow&#39;s <strong>Workflow Variables</strong> section, referenced using an expression in <strong>Remote Manifests</strong>, and then a value provided for the variable in the deployment dialog that matches the chart folder&#39;s name.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/hddm3rgf1y/1586420577509/screenshot-2020-04-09-at-1-52-16-pm.png" style="max-height:80%;max-width:80%" data-hd-height="80%" data-hd-width="80%"/></figure><p></p><p>Click <strong>Submit</strong>. The Helm repo is added to <strong>Manifests</strong>.</p><h3>Example 3: Deploying Kubernetes Service Linked to a Helm Repository</h3><p>When you deploy a Workflow using a Harness Kubernetes Service set up with a Helm Repository, you will see Harness fetch the chart:</p><figure><a href="https://files.helpdocs.io/kw8ldg1itf/articles/zmca0zai3s/1556315475242/image.png"><img src="https://files.helpdocs.io/kw8ldg1itf/articles/zmca0zai3s/1556315475242/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></a></figure><p>Next, you will see Harness initialize using the chart:</p><figure><a href="https://files.helpdocs.io/kw8ldg1itf/articles/zmca0zai3s/1556315542170/image.png"><img src="https://files.helpdocs.io/kw8ldg1itf/articles/zmca0zai3s/1556315542170/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></a></figure><div class="note-callout">Harness does not support the following objects when using Helm charts in Harness Kubernetes deployments: ClusterRoleBindingList, RoleBindingList, RoleList.<br/>If you use these objects in your chart, Harness will consider the chart invalid and fail the deployment.<br/>See the Kubernetes API docs for information on these deployments.</div><p>The Helm version info is displayed in the Service dashboard:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/hddm3rgf1y/1592954791545/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><h3>Notes</h3><p>Helm Dependencies are supported with charts in Helm Repositories, not with Helm charts in Git repos.</p><h3>Next Steps</h3><p>You can override the Helm Repository in a Harness Environment <strong>Service Configuration Overrides</strong> section. See <a href="/article/ycacqs7tlx-override-harness-kubernetes-service-settings">Override Harness Kubernetes Service Settings</a>.</p><p></p>