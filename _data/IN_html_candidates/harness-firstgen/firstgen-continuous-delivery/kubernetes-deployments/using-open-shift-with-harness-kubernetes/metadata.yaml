type: article
article_id: p756zrn9vc
user_id: mfr0nxh4be
category_id: n03qfofd5w
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Using OpenShift with Harness Kubernetes
slug: using-open-shift-with-harness-kubernetes
description: This topic reviews OpenShift support in the Harness Delegate and Workflows.
short_version: This topic reviews OpenShift support in the Harness Delegate and Workflows.
tags: []
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: Article updated
  source: API
  triggered_at: 2021-05-12T17:21:48.917547Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Using OpenShift with Harness Kubernetes
  description: This topic reviews OpenShift support in the Harness Delegate and Workflows.
  short_version: This topic reviews OpenShift support in the Harness Delegate and
    Workflows.
  body: '<p>Harness supports OpenShift for Kubernetes deployments. This topic reviews
    OpenShift support in the Harness Delegate and Workflows.</p><p>In this topic:</p><ul><li><a
    href="https://docs.harness.io/article/p756zrn9vc-using-open-shift-with-harness-kubernetes#before_you_begin">Before
    You Begin</a></li><li><a href="https://docs.harness.io/article/p756zrn9vc-using-open-shift-with-harness-kubernetes#review_kubernetes_delegate_and_open_shift">Review:
    Kubernetes Delegate and OpenShift</a></li><li><a href="https://docs.harness.io/article/p756zrn9vc-using-open-shift-with-harness-kubernetes#review_deployment_strategy_support">Review:
    Deployment Strategy Support</a></li><li><a href="https://docs.harness.io/article/p756zrn9vc-using-open-shift-with-harness-kubernetes#step_add_manifests_and_open_shift_template">Step:
    Add Manifests and OpenShift Template</a></li><li><a href="https://docs.harness.io/article/p756zrn9vc-using-open-shift-with-harness-kubernetes#option_define_service_variables">Option:
    Define Service Variables</a></li><li><a href="#option_skip_versioning_for_service">Option:
    Skip Versioning for Service</a></li><li><a href="https://docs.harness.io/article/p756zrn9vc-using-open-shift-with-harness-kubernetes#notes">Notes</a></li><li><a
    href="https://docs.harness.io/article/p756zrn9vc-using-open-shift-with-harness-kubernetes#next_steps">Next
    Steps</a></li></ul><h3>Before You Begin</h3><ul><li><a href="/article/m383u53mp1-connect-to-your-target-kubernetes-platform">Connect
    to Your Target Kubernetes Platform</a></li><li><a href="/article/h9tkwmkrm7-delegate-installation">Delegate
    Installation and Management</a></li><li><a href="/article/whwnovprrb-cloud-providers">Add
    Cloud Providers</a></li></ul><h3>Review: Kubernetes Delegate and OpenShift</h3><p>Harness
    supports OpenShift using a Delegate running externally to the Kubernetes cluster.</p><div
    class="note-callout">For steps on connecting, see Kubernetes Cluster in <a href="/article/whwnovprrb-cloud-providers">Add
    Cloud Providers</a>.</div><p>Harness does support running Delegates internally
    for OpenShift 3.11 or greater, but the cluster must be configured to allow images
    to run as root inside the container in order to write to the filesystem.</p><p>Typically,
    OpenShift is supported through an external Delegate installation (shell script
    installation of the Delegate outside of the Kubernetes cluster) and a service
    account token, entered in the <strong>Kubernetes Service Account Token</strong>
    field. You only need to use the <strong>Master URL</strong> and <strong>Kubernetes
    Service Account Token</strong> fields in the <strong>Kubernetes Cloud Provider</strong>
    dialog.</p><p>The following shell script is a quick method for obtaining the service
    account token. Run this script wherever you run kubectl to access the cluster.</p><p>Set
    the <code>SERVICE_ACCOUNT_NAME</code> and <code>NAMESPACE</code> values to the
    values in your infrastructure.</p><pre>SERVICE_ACCOUNT_NAME=default<br/>NAMESPACE=mynamepace<br/>SECRET_NAME=$(kubectl
    get sa &#34;${SERVICE_ACCOUNT_NAME}&#34; --namespace &#34;${NAMESPACE}&#34; -o
    json | jq -r &#39;.secrets[].name&#39;)<br/>TOKEN=$(kubectl get secret &#34;${SECRET_NAME}&#34;
    --namespace &#34;${NAMESPACE}&#34; -o json | jq -r &#39;.data[&#34;token&#34;]&#39;
    | base64 -D)<br/>echo $TOKEN</pre><p>Once configured, OpenShift is used by Harness
    as a typical Kubernetes cluster.</p><h3>Review: Deployment Strategy Support</h3><p>In
    order to successfully deploy the workloads in your <strong>Manifests</strong> section
    of the Harness Service, they must meet the <em>minimum</em> requirements of the
    type of deployment you are performing.</p><ul><li><a href="/article/2xp0oyubjj-create-a-kubernetes-canary-deployment">Canary</a>
    and <a href="/article/ukftzrngr1-create-a-kubernetes-blue-green-deployment">Blue/Green</a>
    Workflow Type - Deployment workloads only.</li><li><a href="/article/dl0l34ge8l-create-a-kubernetes-rolling-deployment">Rolling
    Workflow Type</a> - All workload types except Jobs. Jobs will be added soon.</li><li><a
    href="/article/4vjgmjcj6z-deploy-manifests-separately-using-apply-step">​Apply
    Step</a> - All workload types, including Jobs.</li><li><strong>OpenShift:</strong>
    Harness supports <a href="https://docs.openshift.com/container-platform/4.1/applications/deployments/what-deployments-are.html"
    target="_blank">DeploymentConfig</a>, <a href="https://docs.openshift.com/enterprise/3.0/architecture/core_concepts/routes.html"
    target="_blank">Route</a>, and <a href="https://docs.openshift.com/enterprise/3.2/architecture/core_concepts/builds_and_image_streams.html#image-streams"
    target="_blank">ImageStream</a> across Canary, Blue Green, and Rolling deployment
    strategies. Please use <code>apiVersion: apps.openshift.io/v1</code> and not <code>apiVersion:
    v1</code>.</li></ul><h3>Review: Harness Supports List Objects</h3><p>You can leverage
    Kubernetes list objects as needed without modifying your YAML for Harness.</p><p>When
    you deploy, Harness will render the lists and show all the templated and rendered
    values in the log.</p><p>Harness supports:</p><ul><li>List</li><li>NamespaceList</li><li>ServiceList</li><li>For
    Kubernetes deployments, these objects are supported for all deployment strategies
    (Canary, Rolling, Blue/Green).</li><li>For Native Helm, these objects are supported
    for Basic deployments.</li></ul><p>If you run <code>kubectl api-resources</code>
    you should see a list of resources, and <code>kubectl explain</code> will work
    with any of these.</p><h3>Step: Add Manifests and OpenShift Template</h3><ol><li>In
    your Harness Service, in <strong>Manifests</strong>, click <strong>Link Remote
    Manifests</strong>.</li></ol><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/zrz7nstjha/1582584606916/image.png"
    style="max-height:20%;max-width:20%" data-hd-height="20%" data-hd-width="20%"/></figure><ol><li
    style="counter-increment:li 1" start="2">In <strong>Remote Manifests</strong>,
    in <strong>Manifest Format</strong>, click <strong>OpenShift Template</strong>.</li><li>Enter
    the following settings and click <strong>Submit</strong>.</li></ol><table><tbody><tr><td><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/p756zrn9vc/1588680478416/screenshot-2020-05-05-at-5-37-33-pm.png"/></figure></td><td><ul><li><strong>Source
    Repository:</strong> Select the Source Repo Provider connection to your repo.</li><li><strong>Commit
    ID:</strong> Select <strong>Latest from Branch</strong> or <strong>Specific Commit
    ID</strong>. Do one of the following:<ul><li><strong>Branch:</strong> Enter the
    branch name, such as <strong>master</strong>.</li><li><strong>Commit ID:</strong>
    Enter the Git commit ID.</li></ul></li><li><strong>Template File</strong> <strong>Path:</strong>
    Enter the Openshift Template File Path.</li></ul></td></tr></tbody></table><p></p><h3>Option:
    Define Service Variables</h3><p>You can define Service variables in <strong>OpenShift
    Param File</strong>, after adding the OpenShift Template file. <strong>OpenShift
    Param File</strong> is visible only after you have selected an OpenShift Template
    in <strong>Remote Manifests</strong>.</p><ol><li>In the Harness Service, in the <strong>Configuration</strong>
    section, click <strong>Add Param</strong>.</li><li>Select <strong>Inline</strong>
    or <strong>Remote</strong> Store Type.<ol><li>If you select <strong>Inline,</strong>
    then enter the value inline. If you select <strong>Remote</strong>, perform the
    following steps.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/p756zrn9vc/1588835880317/screenshot-2020-05-07-at-12-44-10-pm.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li></ol></li><li>Select
    <strong>Source Repository</strong> from the drop-down menu.</li><li>Select <strong>Latest
    from Branch</strong> or <strong>Specific Commit ID</strong>. Do one of the following:</li></ol><ul><li><strong>Branch:</strong>
    Enter the branch name, such as <strong>master</strong>.</li><li><strong>Commit
    ID:</strong> Enter the Git commit ID.</li></ul><ol><li style="counter-increment:li
    4" start="5">Enter the file path in <strong>Params File Path</strong>.</li></ol><p>Service
    variables can be overwritten at the Harness Environment level. For details on
    overriding Service settings, see <a href="/article/ycacqs7tlx-override-harness-kubernetes-service-settings">Override
    Harness Kubernetes Service Settings</a>.</p><h3>Option: Skip Versioning for Service</h3><p>By
    default, Harness versions ConfigMaps and Secrets deployed into Kubernetes clusters.
    In some cases, you might want to skip versioning.</p><p>Typically, to skip versioning
    in your deployments, you add the annotation <code>harness.io/skip-file-for-deploy</code>
    to your manifests. See <a href="/article/4vjgmjcj6z-deploy-manifests-separately-using-apply-step">Deploy
    Manifests Separately using Apply Step</a>.</p><p>In some cases, such as when using
    public manifests or Helm charts, you cannot add the annotation. Or you might have
    100 manifests and you only want to skip versioning for 50 of them. Adding the
    annotation to 50 manifests is time-consuming.</p><p>Instead, enable the <strong>Skip
    Versioning for Service</strong> option in <strong>Remote Manifests</strong>.</p><p>When
    you enable <strong>Skip Versioning for Service</strong>, Harness will not perform
    versioning of ConfigMaps and Secrets for the Service.</p><p>If you have enabled
    <strong>Skip Versioning for Service</strong> for a few deployments and then disable
    it, Harness will start versioning ConfigMaps and Secrets.</p><h3>Notes</h3><ul><li>Make
    sure that you update your version to <code>apiVersion: apps.openshift.io/v1</code>
    and not <code>apiVersion: v1</code>.</li><li>The token does not need to have global
    read permissions. The token can be scoped to the namespace.</li><li>The Kubernetes
    containers must be OpenShift-compatible containers. If you are already using OpenShift,
    then this is already configured. But be aware that OpenShift cannot simply deploy
    any Kubernetes container. You can get OpenShift images from the following public
    repos: <a href="https://hub.docker.com/u/openshift" target="_blank">https://hub.docker.com/u/openshift</a>
    and <a href="https://access.redhat.com/containers" target="_blank">https://access.redhat.com/containers</a>.</li><li>Useful
    articles for setting up a local OpenShift cluster for testing: <a href="https://computingforgeeks.com/setup-openshift-origin-local-cluster-on-centos/">How
    To Setup Local OpenShift Origin (OKD) Cluster on CentOS 7</a>, <a href="https://chrisphillips-cminion.github.io/kubernetes/2019/07/08/OpenShift-Redirect.html"
    target="_blank">OpenShift Console redirects to 127.0.0.1</a>.</li></ul><h3>Next
    Steps</h3><ul><li><a href="/article/h9tkwmkrm7-delegate-installation">Delegate
    Installation</a></li></ul><p></p><p></p>'
  slug: using-open-shift-with-harness-kubernetes
  tags: []
  is_live: true
