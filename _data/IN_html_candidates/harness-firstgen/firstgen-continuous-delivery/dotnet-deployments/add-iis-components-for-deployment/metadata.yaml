type: article
article_id: f583r8mwcj
user_id: mfr0nxh4be
category_id: 3lkbch7kgn
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Add IIS Components for Deployment
slug: add-iis-components-for-deployment
description: Adding your IIS website, application, and virtual directory artifacts
  to Harness involves adding a connection to your artifact server, and then adding
  each of your IIS artifacts in separate Harness S…
short_version: Adding your IIS website, application, and virtual directory artifacts
  to Harness involves adding a connection to your artifact server, and then adding
  each of your IIS artifacts in separate Harness S…
tags: []
show_toc: true
is_private: true
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: Article updated
  source: API
  triggered_at: 2021-05-12T17:21:06.12054Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Add IIS Components for Deployment
  description: ""
  short_version: ""
  body: '<p>Adding your IIS website, application, and virtual directory artifacts
    to Harness involves adding a connection to your artifact server, and then adding
    each of your IIS artifacts in separate Harness Services.</p><p>This topic describes
    how to perform these steps. </p><p>In this topic:</p><ul><li><a href="#before_you_begin">Before
    You Begin</a></li><li><a href="#visual_summary">Visual Summary</a></li><li><a
    href="#simple_slug">Step 1: Title</a></li><li><a href="#another_slug">Step 2:
    Title</a></li><li><a href="#limitations">Limitations</a></li><li><a href="#next_steps">Next
    Steps</a></li></ul><h3>Before You Begin</h3><ul><li><a href="/article/2oo63r9rwb-iis-net-quickstart">IIS
    (.NET) Quickstart</a></li><li><a href="/article/bq9938fbk8-iis-net-deployments-overview">IIS
    (.NET) Deployments Overview</a></li><li><a href="/article/65lg4hcsnc-connect-to-your-target-iis-platform-account">Connect
    to Your Target IIS (.NET) Platform Account</a></li><li><a href="/article/nmgpqoa1m0-set-up-win-rm-and-iis-on-target-hosts">Set
    Up WinRM and IIS on Target Hosts</a></li></ul><h3 id="undefined">Supported Platforms
    and Technologies</h3><p>See <a href="/article/220d0ojx5y-supported-platforms">Supported
    Platforms and Technologies</a>.</p><h3>Step 1: Add the Artifact Server</h3><p>Connect
    Harness with the artifact sever where your IIS artifacts are located.</p><p>At
    deployment runtime, the Harness Delegate will run a remote command on the target
    host(s) to pull the artifacts from the server and install them on the target host(s).</p><p>Harness
    supports the following artifact servers for IIS deployments:</p><ul><li>Jenkins</li><li>Bamboo</li><li>JFrog
    Artifactory</li><li>Nexus 2 and Nexus 3</li><li>Google Cloud Strorage</li><li>AWS
    S3</li><li>Azure Artifacts</li><li>SMB</li><li>SFTP</li></ul><p>To connect Harness
    with your artifact server, see: <a href="/article/7dghbx1dbl-configuring-artifact-server">Add
    Artifact Servers</a>.</p><p>If you are using AWS or GCP, you use a Harness <a
    href="/article/whwnovprrb-cloud-providers">Cloud Provider</a> for the connection.
    </p><p>Once you add the artifact server, you can create a Harness Service to represent
    your IIS object and add its artifact.</p><h3>Review: Create a Harness Service
    for Each IIS Object</h3><p>IIS requires that an IIS Website already exists on
    the target host(s) before deploying an IIS Application and IIS Virtual Directory.
    </p><p>For this reason, you deploy the IIS Website first, followed by the IIS
    Application and IIS Virtual Directory.</p><p>Similarly, we will create the Harness
    Service for the IIS Website first, followed by the Service&#39;s for the IIS Application
    and IIS Virtual Directory.</p><div class="note-callout">For information about
    IIS sites, applications, and virtual directories, see <a href="https://docs.microsoft.com/en-us/iis/get-started/planning-your-iis-architecture/understanding-sites-applications-and-virtual-directories-on-iis"
    target="_blank">Understanding Sites, Applications, and Virtual Directories on
    IIS 7</a>.</div><h3>Step 2: Add IIS Website Service</h3><p>In this step, you will
    define which artifact to use for your IIS Website. Harness will then create a
    Deployment Specification using PowerShell.</p><div class="note-callout">We are
    using IIS artifact types in this topic, but Harness WinRM Services support IIS
    and Docker artifact types:</div><p>To add a Service for your IIS Website, do the
    following:</p><ol><li>In your Harness Application, click <strong>Services</strong>,
    and then click <strong>Add Service</strong>. The <strong>Service</strong> settings
    appear.</li><li>Give the service a name, such as <strong>IIS-website</strong>.</li><li>In
    <strong>Artifact Type</strong>, select <strong>IIS Website</strong>.</li><li>Click
    <strong>SUBMIT</strong>. The Service is displayed. In <strong>Service Overview</strong>
    you can see the name and type of your service.</li><li>To add the artifact source
    for your IIS website, click <strong>Add Artifact Source</strong>. A list of artifact
    source types appears.</li><li>Click the artifact source type. The artifact sources
    consist of the supported cloud platforms and artifact servers you added earlier.
    <br/>For this example, we will use Artifactory. Harness also supports other popular
    Windows protocols such as SMB and SFTP.<br/>Here is an example of an Artifactory
    Artifact Source using the public Harness repo:</li></ol><table><tbody><tr><td><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/2oo63r9rwb/1583880588052/image.png"/></figure></td><td><ul><li><strong>Display
    Name:</strong> Enter <strong>Todo List</strong>.</li><li><strong>Source Server:</strong>
    Select the Artifact Server you created earlier, <strong>Artifactory Public</strong>.</li><li><strong>Repository:</strong>
    Select <strong>iis-website</strong>.</li><li><strong>Artifact Path/File Filter:</strong>
    Enter <strong>todolist-v3.0.zip</strong>.</li><li><strong>Metadata Only:</strong>
    Select this option.</li></ul></td></tr></tbody></table><p>Click <strong>Submit</strong>.
    The artifact is added to the Service. </p><p></p><div class="note-callout"><strong>Harness</strong>
    <strong>uses Metadata-only:</strong> For WinRM connections, Harness executes PowerShell
    scripts on the target host(s) to download directly onto the Windows Host during
    deployment runtime. For this reason, ensure that the target host has connectivity
    to the Artifact Server before deploying.</div><p></p><h4>Deployment Specification</h4><p>Harness
    builds the service, including the <strong>Deployment Specification</strong>.</p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/tr8ddfm4lz/1546037278903/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>The
    <strong>Deployment Specification</strong> section is automatically filled with
    the Install IIS Website template, which pulls the artifact, expands it, creates
    the Application Pool (AppPool) and creates the website. Later you will create
    the environment where the scripts will be executed.</p><p>To add more scripts,
    mouseover anywhere in the script and click the plus icon:</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/pvjfe077ii/1535411820252/image.png"
    style="max-height:60%;max-width:60%" data-hd-height="60%" data-hd-width="60%"/></figure><p>By
    default the Install IIS Website Template is <em>linked</em> to the template in
    the Template Library and its scripts cannot be edited in the Service (although
    its variables may be edited). </p><p>To modify its scripts, you must <em>copy</em>
    the template instead of linking to it. </p><p>To do this, in the <strong>Deployment
    Specification</strong>, click <strong>Add Command</strong>, select <strong>From
    Template Library</strong>, select the <strong>Install IIS Website Template</strong>,
    and choose <strong>Copy</strong> instead of <strong>Link</strong>.</p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/tr8ddfm4lz/1546038723187/image.png"/></figure><p>The
    template is copied to the Service and you can modify its scripts.</p><h4>Install
    IIS Website Template</h4><p>When you create a Service of type IIS Website, a link
    to the Install IIS Website template is added to the Service. The template contains
    the following script steps:</p><ul><li><strong>Download Artifacts</strong> - As
    noted earlier, for WinRM connections, Harness uses metadata to download the artifact
    directly onto the target Windows host during deployment runtime. Ensure the target
    host has connectivity to your Artifact Server.</li><li><strong>Expand Artifacts</strong>
    - PowerShell script runs to expand the artifact.</li><li><strong>Create App Pool</strong>
    - See <a href="#application_pools">Application Pools</a> below.</li><li><strong>Create
    Website</strong> - PowerShell script to create the IIS Website.</li></ul><p>For
    more information on templates, see <a href="/article/ygi6d8epse-use-templates">Account
    and Application Templates</a>.</p><h4>Template Variables</h4><p>To edit the variables
    used in the Install IIS Website Template in the Service, click <strong>Variables</strong>.
    The <strong>Edit Command</strong> dialog appears.</p><p></p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/mm84gjllge/1580246255030/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Add
    values for the variables as needed. The variables used in the Install IIS Website
    Template in the Service can be modified without influencing the Install IIS Website
    Template in the Template Library.</p><h4>Application Pools</h4><p>Harness manages
    the deployment of the new IIS website, application, or virtual directory artifacts
    to your Windows instances using the default Application pool. If you want to specify
    the Application pool, use the <strong>applicationPool</strong> element, adding
    it to the <strong>New-Item</strong> script during application creation.</p><p>For
    more information, see:</p><ul><li><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/new-item?view=powershell-6"
    target="_blank">New-Item</a></li><li><a href="https://docs.microsoft.com/en-us/dotnet/framework/configure-apps/file-schema/web/applicationpool-element-web-settings"
    target="_blank">&lt;applicationPool&gt; Element (Web Settings)</a></li></ul><p>When
    you create the IIS Services in Harness, you can modify the AppPool name used in
    the <strong>Create AppPool</strong> settings of the <strong>Deployment Specification</strong>.</p><h3>Step
    3: Add IIS Application Service</h3><p>In this procedure you will define which
    artifact(s) to use for your IIS Application. Harness will then create a Deployment
    Specification using PowerShell.</p><p>To add a service for your IIS Application,
    do the following:</p><ol><li>In your application, Click <strong>Services</strong>,
    and then click <strong>Add Service</strong>. The <strong>Service</strong> dialog
    appears.</li><li>Give the service a name, such as <strong>IIS-application</strong>.</li><li>In
    <strong>Artifact Type</strong>, select <strong>IIS Application</strong>.</li><li>Click
    <strong>SUBMIT</strong>. The service is displayed.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/tr8ddfm4lz/1540505167186/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure>In
    <strong>Service Overview</strong> you can see the name and type of your service.</li><li>To
    add the artifact source for your IIS application, click <strong>Add Artifact Source</strong>.
    A list of artifact source types appears.</li><li>Click the artifact source type.
    The artifact sources consist of the cloud providers and build servers you added
    earlier. For this guide, we will use <strong>Amazon S3</strong>.</li><li>For the
    Amazon S3 example, in <strong>Cloud Provider</strong>, select the S3 provider
    you added earlier. Harness connects to the provider automatically</li><li>In <strong>Bucket</strong>,
    select one of the buckets in the S3. The list is automatically populated by Harness.</li><li>In
    <strong>Artifact Path</strong>, select the file(s) for your IIS application. The
    list is automatically populated by Harness. For this guide, we will use a zip
    file.<br/><div class="note-callout">For WinRM connections, Harness does not use
    direct artifact copy when you set up the Service. Metadata is supported and is
    used to download the artifact directly onto the Windows Host during deployment
    runtime. For this reason, ensure that the target host has connectivity to the
    Artifact Server before deploying.</div>When you are finished, the Artifact Source
    will look something like this:<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/mm84gjllge/1580246510583/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li></ol><p></p><p>Click
    <strong>SUBMIT</strong> to add the artifact source. Harness builds the service,
    including the <strong>Deployment Specification</strong>.</p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/tr8ddfm4lz/1546040150567/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><p>The
    <strong>Deployment Specification</strong> section is automatically filled with,
    and linked to, the Install IIS Application template.</p><p>By default, the Install
    IIS Application template is linked to the template in the Template Library and
    its scripts cannot be edited in the Service (although its variables may be edited).
    To modify its scripts, you must copy the template instead of linking to it. To
    do this, in the <strong>Deployment Specification</strong>, click <strong>Add Command</strong>,
    select <strong>From Template Library</strong>, select the <strong>Install IIS
    Application Template</strong>, and choose <strong>Copy</strong> instead of <strong>Link</strong>.</p><h5>Install
    IIS Application Template</h5><p>When you create a Service of type IIS Application,
    a link to the Install IIS Application template is added to the Service. The template
    contains the following script steps:</p><ul><li><strong>Download Artifact</strong>
    - As noted earlier, for WinRM connections, Harness does not use direct artifact
    copy when you set up the Service. Meta-data is supported and is used to download
    the artifact directly onto the Windows Host during deployment runtime. Ensure
    the target host has connectivity to your Artifact Server.</li><li><strong>Expand
    Artifacts</strong> - PowerShell script runs to expand the artifact.</li><li>Create
    Virtual Directory - PowerShell script runs to create the Virtual Directory.</li></ul><p>For
    more information on templates, see <a href="/article/ygi6d8epse-use-templates">Use
    Templates</a>.</p><p>To edit the values for variables used in the template, click
    <strong>Variables</strong>. The variables used in the Install IIS Application
    template in the Service can be modified without influencing the Install IIS Application
    Template in the Template Library.</p><h3>Step 4: Add IIS Virtual Directory Service</h3><p>In
    this procedure you will define which artifact(s) to use for your IIS virtual directory.
    Harness will then create a <strong>Deployment Specification</strong> using PowerShell.</p><p>To
    add a service for your IIS virtual directory, do the following:</p><ol><li>In
    your application, Click <strong>Services</strong>, and then click <strong>Add
    Service</strong>. The <strong>Service</strong> dialog appears.</li><li>Give the
    service a name, such as <strong>IIS-virtual-directory</strong>.</li><li>In <strong>Artifact
    Type</strong>, select <strong>IIS Virtual Directory</strong>.</li><li>Click <strong>SUBMIT</strong>.
    The service is displayed. In <strong>Service Overview</strong> you can see the
    name and type of your service.</li><li>To add the artifact source for your IIS
    virtual directory, click <strong>Add Artifact Source</strong>. A list of artifact
    source types appears.</li><li>Click the artifact source type. The artifact sources
    consist of the cloud providers and build servers you added earlier. For this guide,
    we will use <strong>Amazon S3</strong>.</li><li>For the Amazon S3 example, in
    <strong>Cloud Provider</strong>, select the S3 provider you added earlier. Harness
    connects to the provider automatically</li><li>In <strong>Bucket</strong>, select
    one of the buckets in the S3. The list is automatically populated by Harness.</li><li>In
    <strong>Artifact Path</strong>, select the file(s) for your IIS virtual directory.
    The list is automatically populated by Harness. For this guide, we will use a
    zip file.<br/><div class="note-callout">For WinRM connections, Harness does not
    use direct artifact copy when you set up the Service. Meta-data is supported and
    is used to download the artifact directly onto the Windows Host during deployment
    runtime. For this reason, ensure that the target host has connectivity to the
    Artifact Server before deploying.</div>When you are finished, the Artifact Source
    will look something like this:<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/mm84gjllge/1580246539327/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li></ol><p></p><p>Click
    <strong>SUBMIT</strong> to add the artifact source. Harness builds the service,
    including the <strong>Deployment Specification</strong>.</p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/tr8ddfm4lz/1540508498061/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><p>The
    Install IIS Application template is also used for the IIS Virtual Directory service
    type. By default, as with the IIS Application Service, the Install IIS Application
    template is linked to the template in the Template Library and its scripts cannot
    be edited in the Service (although its variables may be edited). To modify its
    scripts, you must copy the template instead of linking to it. To do this, in the
    <strong>Deployment Specification</strong>, click <strong>Add Command</strong>,
    select <strong>From Template Library</strong>, select the <strong>Install IIS
    Application Template</strong>, and choose <strong>Copy</strong> instead of <strong>Link</strong>.</p><p>You
    can modify the variables of the Install IIS Application template scripts by click
    <strong>Variables</strong>. The variables used in the Install IIS Application
    template in the Service can be modified without influencing the Install IIS Application
    Template in the Template Library.</p><p>Click <strong>Create Virtual Directory</strong>,
    and the <strong>Create Virtual Directory</strong> dialog appears. The dialog contains
    the following default PowerShell script that will be run during shell session
    of your Harness workflow:</p><pre>Import-Module WebAdministration<br/><br/>$siteName=&#34;Default
    Web Site&#34;<br/>$releaseId=&#34;${workflow.ReleaseNo}&#34;<br/>$virtualDirectoryName=&#34;${service.Name}&#34;<br/>$appPhysicalDirectory=$env:SYSTEMDRIVE
    + &#34;\Artifacts\&#34; + $virtualDirectoryName + &#34;\release-&#34; + $releaseId<br/><br/>Write-Host
    &#34;Creating Virtual Directory&#34; $virtualDirectoryName &#34;..&#34;<br/>$VirtualDirPath
    = &#39;IIS:\Sites\&#39; + $siteName + &#39;\&#39; + $virtualDirectoryName<br/>New-Item
    -Path $VirtualDirPath -Type VirtualDirectory -PhysicalPath $appPhysicalDirectory
    -Force<br/><br/>Write-Host &#34;Done.&#34;</pre><p>Note the following:</p><ul><li>The
    <code>$releaseId</code> variable has the value <code>${workflow.ReleaseNo}</code>.
    This is one of the builtin Harness variables. For more information, see <a href="/article/9dvxcegm90-variables">Variables
    and Expressions in Harness</a>.</li><li>The <code>$VirtualDirPath</code> variable
    shows you where your IIS directory will be deployed.</li></ul><p>When you deploy
    this service as part of your workflow, you will see these variables used in the
    Harness deployment dashboard:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/tr8ddfm4lz/1540508807950/image.png"/></figure><p></p><p></p><p></p><h3>Limitations</h3><p>[What
    feature integrations, settings, use cases does Harness not support?]</p><p></p><h3>See
    Also</h3><ul><li>[related topics, reference]</li></ul><h3>Configure As Code</h3><p>To
    see how to configure the settings in this topic using YAML, configure the settings
    in the UI first, and then click the YAML editor button (<span style="color:#fb9e00"
    data-hd-color="#fb9e00"><strong>&lt;/&gt;</strong></span>).</p>'
  slug: add-iis-components-for-deployment
  tags: []
  is_live: true
