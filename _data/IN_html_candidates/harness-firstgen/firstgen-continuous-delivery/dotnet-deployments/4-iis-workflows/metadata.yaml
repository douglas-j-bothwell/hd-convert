type: article
article_id: z6ls3tgkqc
user_id: mfr0nxh4be
category_id: 3lkbch7kgn
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: 4 - IIS Workflows and Pipelines
slug: 4-iis-workflows
description: Combine Workflows for your IIS website, application, and virtual directory
  in a Harness Pipeline.
short_version: Combine Workflows for your IIS website, application, and virtual directory
  in a Harness Pipeline.
tags:
- IIS
- Pipeline
- Basic Workflow
- Virtual Directory
- 'IIS Web Server Role '
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: Article updated
  source: API
  triggered_at: 2021-05-12T17:22:47.984899Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: 4 - IIS Workflows and Pipelines
  description: Combine Workflows for your IIS website, application, and virtual directory
    in a Harness Pipeline.
  short_version: Combine Workflows for your IIS website, application, and virtual
    directory in a Harness Pipeline.
  body: <p>Once you have the Harness Services for IIS website, application, and virtual
    directory, and the Harness Environment for your target infrastructure, you create
    Harness Workflows to deploy the IIS website, application, and virtual directory
    Services.</p><p>In this topic we walk through create a Workflow for the IIS website
    Service, but the Workflows for IIS application and virtual directory Services
    follow the same steps:</p><ul><li><a href="https://docs.harness.io/article/z6ls3tgkqc-4-iis-workflows#create_an_iis_website_workflow">Create
    an IIS Website Workflow</a></li><li><a href="https://docs.harness.io/article/z6ls3tgkqc-4-iis-workflows#deploy_iis_website">Deploy
    IIS Website</a><ul><li><a href="https://docs.harness.io/article/z6ls3tgkqc-4-iis-workflows#confirm_deployment_in_your_windows_instance">Confirm
    Deployment in your Windows Instance</a></li></ul></li><li><a href="https://docs.harness.io/article/z6ls3tgkqc-4-iis-workflows#create_an_iis_application_and_virtual_directory_workflows">Create
    an IIS Application and Virtual Directory Workflows</a></li><li><a href="https://docs.harness.io/article/z6ls3tgkqc-4-iis-workflows#deploy_iis_pipeline">Deploy
    IIS Pipeline</a></li><li><a href="https://docs.harness.io/article/z6ls3tgkqc-4-iis-workflows#next_step">Next
    Step</a></li></ul><div class="note-callout">Before deploying the IIS website,
    application, or virtual directory to your Windows instances, there must be an
    existing <a href="https://docs.microsoft.com/en-us/iis/web-hosting/web-server-for-shared-hosting/installing-the-web-server-role"
    target="_blank">IIS Web Server Role</a> on the instance. This ensures that the
    environment is ready for deployment. Harness IIS Website deployment requires the
    IIS Web Server Role. The Harness IIS Application and IIS Virtual Directory deployments
    require that an IIS Website exists. For more information, see <a href="/article/l639i8uqxs-5-best-practices-and-troubleshooting#installing_iis_from_the_command_line">Installing
    IIS from the Command Line</a> below.</div><h3>Create an IIS Website Workflow</h3><p>Workflows
    are the deployment steps for services and environments, including types such as
    Canary and Blue/Green. Workflows also include verification, rollback, and notification
    steps.</p><ol><li>In your application, click <strong>Workflows</strong>.</li><li>Click
    <strong>Add Workflow</strong>. The <strong>Workflow</strong> dialog appears.</li></ol><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/other/1568414592704/image.png" style="max-height:50%;max-width:50%"
    data-hd-height="50%" data-hd-width="50%"/></figure><p>The dialog has the following
    fields.</p><table><tbody><tr><td><p><strong>Field</strong></p></td><td><p><strong>Description</strong></p></td></tr><tr><td><p><strong>Name</strong></p></td><td><p>Give
    your Workflow a name and description that tells users what it is deploying.</p></td></tr><tr><td><p><strong>Workflow
    Type</strong></p></td><td><p>In this guide, we will do a simple Basic workflow.
    For a summary of workflow types, see <a href="/article/m220i1tnia-workflow-configuration#workflow_types">Add
    a Workflow</a>.</p></td></tr><tr><td><p><strong>Environment</strong></p></td><td><p>Select
    the environment you added.</p></td></tr><tr><td><p><strong>Service</strong></p></td><td><p>Select
    your IIS Website service.</p></td></tr><tr><td><p><strong>Infrastructure Definition</strong></p></td><td><p>Select
    the <strong>Infrastructure Definition</strong> you added.</p></td></tr></tbody></table><p>When
    you are finished, click <strong>SUBMIT</strong>. The workflow is generated:</p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/other/1568414728600/image.png" style="max-height:50%;max-width:50%"
    data-hd-height="50%" data-hd-width="50%"/></figure><ol><li>Under <strong>Prepare
    Infra</strong>, click <strong>Select Nodes</strong>. The <strong>Node Select</strong>
    dialog appears.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/z6ls3tgkqc/1591911102302/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure>If
    you deploy in multiple phases, you can control what hosts to use for each phase.
    If you are simply doing one phase, you do not need to select hosts.<br/>The <strong>Node
    Select</strong> dialog has the following fields.<table><tbody><tr><td><p><strong>Field</strong></p></td><td><p><strong>Description</strong></p></td></tr><tr><td><p><strong>Select
    Specific hosts?</strong></p></td><td><p>Select <strong>Yes</strong> to enter the
    hostname(s) of the nodes where you want the website deployed.</p><p>Select <strong>No</strong>
    to have Harness select the host(s) in the Infrastructure Definition based on the
    setup the in <strong>Environment</strong>. For AWS deployments, Tags are often
    used to help Harness select hosts.</p></td></tr><tr><td><p><strong>Desired</strong>
    <strong>Instances</strong></p></td><td><p>Enter the number of instances you want
    deployed.</p><p>You can also enter a variable expression in this setting, such
    as a Workflow variable:</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/z6ls3tgkqc/1591911289148/image.png"/></figure><p>This
    turns the setting into a deployment parameter. When the Workflow is deployed (manually
    or by <a href="/article/xerirloz9a-add-a-trigger-2">Trigger</a>) you can provide
    a value for the parameter.</p><p>See <a href="/article/766iheu1bk-add-workflow-variables-new-template">Set
    Workflow Variables</a> and <a href="/article/9dvxcegm90-variables">Variables and
    Expressions in Harness</a>.</p></td></tr><tr><td><p><strong>Instance Unit Type</strong></p></td><td><p>Identify
    if the number in <strong>Instances</strong> is a count or percentage.</p><p>For
    example, if you select <strong>10</strong> in <strong>Instances</strong>, you
    can select <strong>Count</strong> and the artifact is deployed to <strong>10</strong>
    instances. Or you can enter 100 in <strong>Instances</strong> and select <strong>Percent</strong>
    and the artifact is deployed to <strong>100%</strong> of the instances in the
    Infrastructure Definition.</p></td></tr></tbody></table>When you finished, click
    <strong>SUBMIT</strong>.</li><li>Under <strong>Deploy Service</strong>, click
    <strong>Install</strong>. The <strong>Install</strong> dialog appears.<figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/z6ls3tgkqc/1580246909447/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure>You
    can set how long the installation may take before it&#39;s timed out. The default
    is 60000ms or 10 minutes. When you are finished, click <strong>SUBMIT</strong>.</li></ol><p>Now
    that your workflow is complete, you are ready to deploy.</p><h3>Deploy IIS Website</h3><div
    class="note-callout">Before deploying the IIS website, application, or virtual
    directory to your Windows instances, there must be an existing <a href="https://docs.microsoft.com/en-us/iis/web-hosting/web-server-for-shared-hosting/installing-the-web-server-role"
    target="_blank">IIS Web Server Role</a> on the instance. This ensures that the
    environment is ready for deployment. Harness IIS Website deployment requires the
    IIS Web Server Role. The Harness IIS Application and IIS Virtual Directory deployments
    require that an IIS Website exists. For more information, see <a href="/article/l639i8uqxs-5-best-practices-and-troubleshooting#installing_iis_from_the_command_line">Installing
    IIS from the Command Line</a> below.</div><p>Now you can deploy your workflow,
    observe the deployment steps in real-time, and confirm in your VPC.</p><ol><li>In
    your workflow, click <strong>Deploy</strong>.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/pvjfe077ii/1535394882270/image.png"/></figure>The
    <strong>Start New Deployment</strong> dialog appears.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/z6ls3tgkqc/1580246961487/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure>Here
    you simply select the artifact build and version to be deployed.</li><li>In <strong>Artifacts</strong>,
    click the dropdown menu and select the artifact build and version to deploy. The
    list is generated automatically by Harness from the artifact source you specified
    when you set up your service.<br/><br/>You can also elect to skip any instances
    that already have the artifact build and version.</li><li>Click <strong>SUBMIT</strong>
    to deploy. Harness shows the deployment in real-time:</li></ol><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/pvjfe077ii/1535409359586/image.png"/></figure><p>Each
    workflow step is displayed. Click through each deployment step to see the logs
    and details.</p><h4>Confirm Deployment in your Windows Instance</h4><p>Now that
    the deployment was successful, confirm the website was added to the Windows instance(s):</p><ol><li>In
    your workflow Deployment page, click the <strong>Install</strong> step.<figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/pvjfe077ii/1535409911262/image.png"/></figure></li><li>Expand
    the <strong>Create Website</strong> section.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/pvjfe077ii/1535409944351/image.png"/></figure></li><li>In
    the log, note the location where the website was created:<br/><br/><div class="hd--html"><pre>INFO
    2018-08-27 15:34:43 IIS-website 2 Started C:\Artifacts\IIS-website\relea http
    :8080:*</pre></div></li><li>Connect to your Windows instance via Microsoft Remote
    Desktop or other console.</li><li>On the Windows instance, navigate to the location
    Harness reported to confirm the website was created:<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/pvjfe077ii/1535410031807/image.png"/></figure></li></ol><h3>Create
    an IIS Application and Virtual Directory Workflows</h3><p>The steps for creating
    Workflows for IIS Applications and Virtual Directories are the same as the steps
    for creating a Workflow for an IIS Website, described above.</p><ol><li>Use the
    Harness Services you created for the IIS Application and Virtual Directory.</li><li>Use
    the same Harness Environment and Infrastructure Definition you used to create
    the IIS Website Workflow.</li><li>Deploy the IIS Virtual Directory Workflow first,
    then the IIS Application Workflow, and lastly the IIS Website Workflow. This sequence
    is best performed using a Harness Pipeline, described below.</li></ol><div class="note-callout">Before
    deploying the IIS website, application, or virtual directory to your Windows instances,
    there must be an existing <a href="https://docs.microsoft.com/en-us/iis/web-hosting/web-server-for-shared-hosting/installing-the-web-server-role"
    target="_blank">IIS Web Server Role</a> on the instance. This ensures that the
    environment is ready for deployment. Harness IIS Website deployment requires the
    IIS Web Server Role. The Harness IIS Application and IIS Virtual Directory deployments
    require that an IIS Website exists. For more information, see <a href="#installing_iis_from_the_command_line">Installing
    IIS from the Command Line</a> below.</div><h3>Deploy IIS Pipeline</h3><p>Once
    you have workflows for your IIS website, application, and virtual directory set
    up, you can create a Harness pipeline that deploys them in the correct order.
    For IIS, you must deploy them in the order website, application, and then virtual
    directory.</p><p>In you Harness application, click <strong>Pipelines</strong>.
    Follow the steps in <a href="/article/zc1u96u6uj-pipeline-configuration">Add a
    Pipeline</a> to add a stage for each of your workflows.</p><p>When you are done,
    the pipeline will look like this:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/tr8ddfm4lz/1540509670588/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Click
    <strong>Deploy</strong>. The <strong>Start New Deployment</strong> dialog opens.
    Select each workflow artifact. When you are done, the dialog will look like this:</p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/z6ls3tgkqc/1580247632423/image.png"/></figure><p>Click
    <strong>SUBMIT</strong>. Here&#39;s what the pipeline looks in the deployment
    dashboard. You can see each Stage was successful:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/z6ls3tgkqc/1578088281389/image.png"/></figure><h3>Next
    Step</h3><ul><li><a href="/article/l639i8uqxs-5-best-practices-and-troubleshooting">5
    - Best Practices and Troubleshooting</a></li></ul><p></p>
  slug: 4-iis-workflows
  tags:
  - IIS
  - Pipeline
  - Basic Workflow
  - Virtual Directory
  - 'IIS Web Server Role '
  is_live: true
