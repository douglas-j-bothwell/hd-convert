type: article
article_id: itseg37bji
user_id: mfr0nxh4be
category_id: 3lkbch7kgn
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: 3 - IIS Environments in AWS and Azure
slug: iis-environments
description: Define AWS and Azure infrastructures for IIS deployments, by creating
  a Harness Environment.
short_version: Define AWS and Azure infrastructures for IIS deployments.
tags:
- IIS
- Environment
- Azure
- AWS
- Infrastructure Definition
- WinRM
- Windows Remote Management
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: Article updated
  source: API
  triggered_at: 2021-05-12T17:22:48.007409Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: 3 - IIS Environments in AWS and Azure
  description: Define AWS and Azure infrastructures for IIS deployments, by creating
    a Harness Environment.
  short_version: Define AWS and Azure infrastructures for IIS deployments.
  body: '<p>This topic describes how to add Harness Infrastructure Definitions for
    target deployment environments in AWS and Azure:</p><ul><li><a href="https://docs.harness.io/article/itseg37bji-iis-environments#create_an_environment">Create
    an Environment</a></li><li><a href="https://docs.harness.io/article/itseg37bji-iis-environments#add_an_infrastructure_definition">Add
    an Infrastructure Definition</a></li><li><a href="https://docs.harness.io/article/itseg37bji-iis-environments#aws_infrastructure_definition">AWS
    Infrastructure Definition</a></li><li><a href="https://docs.harness.io/article/itseg37bji-iis-environments#azure_infrastructure_definition">Azure
    Infrastructure Definition</a></li><li><a href="#option_override_an_iis_service_configuration">Option:
    Override an IIS Service Configuration</a></li><li><a href="https://docs.harness.io/article/itseg37bji-iis-environments#next_step">Next
    Step</a></li></ul><p>For more information, see <a href="/article/n39w05njjv-environment-configuration">Add
    an Environment</a>.</p><h3>Create an Environment</h3><p>To add an environment
    for your IIS Website, do the following:</p><ol><li>In your application, click
    <strong>Environments</strong>. The Environments page for the applications appears.</li><li>Click
    <strong>Add Environment</strong>. The <strong>Environment</strong> dialog appears.</li><li>Enter
    a name for your deployment environment, such as <strong>IIS-EC2</strong>, and
    then, in <strong>Environment Type</strong>, click <strong>Non-Production</strong>
    or <strong>Production</strong>. When you are finished, click <strong>SUBMIT</strong>.
    The Environment page appears.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/pvjfe077ii/1535411999410/image.png"
    style="max-height:60%;max-width:60%" data-hd-height="60%" data-hd-width="60%"/></figure>Next,
    you will add an Infrastructure Definition using the Cloud Provider you added to
    define where your IIS Website will be deployed.</li></ol><h3>Add an Infrastructure
    Definition</h3><p>​Infrastructure Definitions specify the target deployment infrastructure
    for your Harness Services, and the specific infrastructure details for the deployment,
    like VPC settings. </p><p>You define the Kubernetes cluster to use for deployment
    as an ​Infrastructure Definition. For this guide, we will use the GCP Cloud Provider
    you added and the Kubernetes cluster with Helm installed.</p><p>To add the Infrastructure
    Definition, do the following:</p><ol><li>In the Harness Environment, click <strong>Add
    Infrastructure Definition</strong>. The <strong>Infrastructure Definition</strong>
    dialog appears.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1568398274729/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li><li>In
    <strong>Name</strong>, enter the name you will use to select this Infrastructure
    Definition when you create a Workflow.</li><li>In <strong>Cloud Provider Type</strong>,
    select the type of Cloud Provider you added earlier, such as <strong>Amazon Web
    Services</strong>, <strong>Microsoft Azure</strong>, etc. In the following steps
    we use the <strong>Amazon Web Services</strong> type, and so the settings are
    specific to AWS.</li><li>In <strong>Deployment Type</strong>, select <strong>Windows
    Remote Management (WinRM)</strong>.</li><li>In <strong>Cloud Provider</strong>,
    select the Cloud Provider you added earlier.</li><li>In <strong>Region</strong>,
    select the AWS region where you want to deploy. This list is populated using the
    Cloud Provider you selected.</li><li>In <strong>Load Balancer</strong>, select
    the load balancer used by the VPC.</li><li>In <strong>Connection Attribute</strong>,
    select the name of the <a href="https://docs.harness.io/article/1n0t9vo7e4-1-delegate-and-connectors-for-iis#set_up_win_rm_on_instances_and_network">WinRM
    Connection</a> you created. This is the value you entered in <strong>Name</strong>
    when you created the WinRM Connection in <strong>Secrets Management</strong>.</li><li>In
    <strong>Host Name Convention</strong>, in most cases, you can leave the default
    expression in this field.<br/>Host Name Convention is used to derive the instance(s)
    hostname. The hostname that results from the convention should be same as the
    output of the command <strong>hostname</strong> on the host itself.<br/>For information
    on obtaining the AWS instance hostname, see <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html"
    target="_blank">Instance Metadata and User Data</a> from AWS.</li><li>In <strong>Scope
    to specific Services</strong>, select the Harness Service you created earlier.<br/>The
    Infrastructure Definition will look something like this:<figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1568413770282/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li><li>Click
    <strong>Submit</strong>. The new Infrastructure Definition is added to the Harness
    Environment.</li></ol><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1568413816000/image.png"/></figure><p>That
    is all you have to do to set up the deployment Environment in Harness.</p><p>Now
    that you have the Service and Environment set up. Now you can create the deployment
    Workflow in Harness.</p><h3>AWS Infrastructure Definition</h3><p>This following
    table describes the fields for an AWS EC2 Infrastructure Definition.</p><table><tbody><tr><td><p><strong>Field</strong></p></td><td><p><strong>What
    to Enter</strong></p></td></tr><tr><td><p><strong>Cloud Provider Type</strong></p></td><td><p>Select
    the type of Cloud Provider you added earlier, such as Amazon Web Services.</p></td></tr><tr><td><p><strong>Deployment
    Type</strong></p></td><td><p>Select <strong>Windows Remote Management (WinRM)</strong>.</p></td></tr><tr><td><p><strong>Cloud
    Provider</strong></p></td><td><p>Select the Cloud Provider you added.</p></td></tr><tr><td><p><strong>Provision
    Type</strong></p></td><td><p>If you have a Windows instance running in your Cloud
    Provider, click <strong>Already Provisioned</strong>. If you need to set up an
    instance, create the instance in your Cloud Provider, and then return to the Harness
    environment set up.If you have an Infrastructure Provisioner configured, select
    <strong>Dynamically Provisioned</strong>. This guide does not cover Harness Infrastructure
    Provisioners. For more information, see <a href="/article/o22jx8amxb-add-an-infra-provisioner">Add
    an Infra Provisioner</a>.</p></td></tr><tr><td><p><strong>Region</strong></p></td><td><p>Region
    for the VPC.</p></td></tr><tr><td><p><strong>Load Balancer</strong></p></td><td><p>The
    load balancer used by the VPC.</p></td></tr><tr><td><p><strong>WinRM</strong>
    <strong>Connection Attributes</strong></p></td><td><p>Select the name of the WinRM
    Connection you created. This is the value you entered in <strong>Name</strong>
    when you created the WinRM Connection in <strong>Secrets Management</strong>.</p></td></tr><tr><td><p><strong>Host
    Name Convention</strong></p></td><td><p>Host Name Convention is used to derive
    the instance(s) hostname. The hostname that results from the convention should
    be same as the output of the command <strong>hostname</strong> on the host itself.
    Agent-based solutions like AppDynamics, Splunk, New Relic, etc, use the hostname
    to uniquely identify the instance.In most cases, you can leave the default expression
    in this field.For information on obtaining the AWS instance hostname, see <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html"
    target="_blank">Instance Metadata and User Data</a> from AWS.</p></td></tr><tr><td><p><strong>User
    Auto Scaling Group</strong> / <strong>Use AWS Instance Filter</strong></p></td><td><p><strong>User
    Auto Scaling Group:</strong> If you are using an Auto Scaling Group, you can select
    it from the list.<strong>Use AWS Instance Filter:</strong> Specify the VPC, Tags,
    Subnet, and Security Group where your instance(s) will be deployed.</p><p>Using
    <strong>Tags</strong> is the easiest way to reference an instance.</p></td></tr><tr><td><p><strong>Use
    Public DNS for connection</strong></p></td><td><p>If locating the VPC requires
    public DNS name resolution, enable this option.</p></td></tr><tr><td><p><strong>Scope
    to specific Services</strong></p></td><td><p>Select the Harness Service you created
    for your IIS Website.</p></td></tr></tbody></table><p></p><h3>Azure Infrastructure
    Definition</h3><p>You can locate most of the Azure information on the VM overview
    page:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/tr8ddfm4lz/1540422644320/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>This
    following table describes the fields for an Azure Infrastructure Definition.</p><table><tbody><tr><td><p><strong>Field</strong></p></td><td><p><strong>What
    to Enter</strong></p></td></tr><tr><td><p><strong>Cloud Provider Type</strong></p></td><td><p>Select
    the type of Cloud Provider you added earlier, such as Microsoft Azure.</p></td></tr><tr><td><p><strong>Deployment
    Type</strong></p></td><td><p>Select <strong>Windows Remote Management (WinRM)</strong>.</p></td></tr><tr><td><p><strong>Cloud
    Provider</strong></p></td><td><p>Select the Cloud Provider you added.</p></td></tr><tr><td><p><strong>Subscription
    ID</strong></p></td><td><p>Select the Azure subscription to use.When you set up
    the Azure cloud provider in Harness, you entered the Client/Application ID for
    the Azure App registration. To access resources in your Azure subscription, you
    must assign the Azure app using this Client ID to a role in that subscription.
    Now, when you are setting up an Azure Infrastructure Definition in a Harness environment,
    you select the subscription. If the Azure App registration using this Client ID
    is not assigned a role in a subscription, no subscriptions will be available.</p><p>For
    more information, see <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal#assign-the-application-to-a-role"
    target="_blank">Assign the application to a role</a> from Microsoft.</p></td></tr><tr><td><p><strong>Resource
    Group</strong></p></td><td><p>Select the resource group where your VM is located.</p></td></tr><tr><td><p><strong>WinRM</strong>
    <strong>Connection Attributes</strong></p></td><td><p>Select the name of the WinRM
    Connection you created. This is the value you entered in <strong>Name</strong>
    when you created the WinRM Connection in <strong>Secrets Management</strong>.</p></td></tr><tr><td><p><strong>Tags</strong></p></td><td><p>Click
    <strong>Add</strong> to use a tag to quickly select the VM you want to use.</p></td></tr><tr><td><p><strong>Use
    Public DNS for connection</strong></p></td><td><p>If locating the VM(s) requires
    public DNS name resolution, enable this option. Since the Harness delegate can
    only run on Linux, it must either be run on a Linux VM in the same subnet as your
    deployment target VMs or on a Linux server with network access to your Azure VMs.
    In the latter case, you can use public DNS to resolve the hostname of the target
    VMs.</p></td></tr><tr><td><p><strong>Scope to specific Services</strong></p></td><td><p>Select
    the Harness Service you created for your IIS Website.</p></td></tr></tbody></table><p></p><p
    id="undefined"></p><h3>Option: Override an IIS Service Configuration</h3><p></p><div
    class="note-callout">Currently, support for Config Files override is behind a
    Feature Flag. Contact <a href="mailto:support@harness.io" target="_blank">Harness
    Support</a> to enable the feature. Feature Flags can only be removed for Harness
    Professional and Essentials editions. Once the feature is released to a general
    audience, it&#39;s available for Trial and Community Editions.</div><p></p><p>You
    can configure your Environment to override the <strong>Config Variables</strong>
    and <strong>Config Files</strong> in the IIS Services that use the Environment.</p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/itseg37bji/1615827661509/image.png"/></figure><p>For
    more information, see <a href="https://docs.harness.io/article/4m2kst307m-override-service-files-and-variables-in-environments">Override
    a Service Configuration in an Environment</a>.</p><h3>Next Step</h3><ul><li><a
    href="/article/z6ls3tgkqc-4-iis-workflows">4 - IIS Workflows and Pipelines</a></li></ul><p></p>'
  slug: iis-environments
  tags:
  - IIS
  - Environment
  - Azure
  - AWS
  - Infrastructure Definition
  - WinRM
  - Windows Remote Management
  is_live: true
