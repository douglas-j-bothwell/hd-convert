type: article
article_id: vbl1xlad1e
user_id: mfr0nxh4be
category_id: j3m3gbxk88
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Verify Deployments with Logz.io
slug: verify-deployments-with-logz-io
description: Verify, rollback, and improve deployments with Harness and Logz.io.
short_version: Verify, rollback, and improve deployments with Harness and Logz.io.
tags: []
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: Article updated
  source: API
  triggered_at: 2021-05-12T17:21:33.252884Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Verify Deployments with Logz.io
  description: Verify, rollback, and improve deployments with Harness and Logz.io.
  short_version: Verify, rollback, and improve deployments with Harness and Logz.io.
  body: |-
    <p>Harness can analyze Logz.io data and analysis to verify, rollback, and improve deployments. To apply this analysis to your deployments, you set up Logz.io as a verification step in a Harness Workflow.</p><p>This topic covers the process to set up Logz.io in a Harness Workflow, and provides a summary of Harness verification results.</p><div class="tip-callout">In order to obtain the names of the host(s), pod(s), or container(s) where your service is deployed, the verification provider should be added to your Workflow <em>after</em> you have run at least one successful deployment.</div><p>In this topic:</p><ul><li><a href="https://docs.harness.io/article/vbl1xlad1e-verify-deployments-with-logz-io#before_you_begin">Before You Begin</a></li><li><a href="https://docs.harness.io/article/vbl1xlad1e-verify-deployments-with-logz-io#limitations">Limitations</a></li><li><a href="https://docs.harness.io/article/vbl1xlad1e-verify-deployments-with-logz-io#step_1_set_up_deployment_verification">Step 1: Set up Deployment Verification</a></li><li><a href="https://docs.harness.io/article/vbl1xlad1e-verify-deployments-with-logz-io#step_2_select_logz_server">Step 2: Select Logz Server</a></li><li><a href="https://docs.harness.io/article/vbl1xlad1e-verify-deployments-with-logz-io#step_3_query">Step 3: Query</a></li><li><a href="https://docs.harness.io/article/vbl1xlad1e-verify-deployments-with-logz-io#step_4_query_type">Step 4: Query Type</a></li><li><a href="https://docs.harness.io/article/vbl1xlad1e-verify-deployments-with-logz-io#step_5_hostname_field">Step 5: Hostname Field</a></li><li><a href="https://docs.harness.io/article/vbl1xlad1e-verify-deployments-with-logz-io#step_6_message">Step 6: Message</a></li><li><a href="https://docs.harness.io/article/vbl1xlad1e-verify-deployments-with-logz-io#step_7_timestamp_format">Step 7: Timestamp Format</a></li><li><a href="https://docs.harness.io/article/vbl1xlad1e-verify-deployments-with-logz-io#step_8_expression_for_host_container_name">Step 8: Expression for Host/Container name</a></li><li><a href="https://docs.harness.io/article/vbl1xlad1e-verify-deployments-with-logz-io#step_9_analysis_time_duration">Step 9: Analysis Time Duration</a></li><li><a href="https://docs.harness.io/article/vbl1xlad1e-verify-deployments-with-logz-io#step_5_baseline_for_risk_analysis">Step 10: Baseline for Risk Analysis</a></li><li><a href="https://docs.harness.io/article/vbl1xlad1e-verify-deployments-with-logz-io#harness_expression_support_in_cv_settings">Harness Expression Support in CV Settings</a></li></ul><h3>Before You Begin</h3><ul><li><a href="https://docs.harness.io/article/4o7oqwih6h-harness-key-concepts">Harness Key Concepts</a></li><li><a href="/article/1hw6xxh73c-logz-verification-provider">Connect to Logz.io</a></li></ul><h3 id="limitations">Limitations</h3><div class="note-callout">You must have a Logz.io Enterprise account to generate the API tokens required to integrate with Harness. (Logz.io Pro and Community accounts do not support token generation.)</div><h3>Step 1: Set up Deployment Verification</h3><p>To verify your deployment with Logz.io, do the following:</p><ol><li>Ensure that you have added Logz.io as a Harness Verification Provider, as described in <a href="/article/1hw6xxh73c-logz-verification-provider">Connect to Logz.io</a>.</li><li>In your Workflow, under <strong>Verify Service</strong>, click <strong>Add Step</strong>, and select <strong>Logz</strong>.</li><li>Click <strong>Next</strong>. The <strong>Logz</strong> settings appear.</li></ol><h3>Step 2: Select Logz Server</h3><p>In <strong>Logz</strong> <strong>Server</strong>, select the server you added when you set up the Logz verification provider in <a href="/article/1hw6xxh73c-logz-verification-provider">Connect to Logz.io</a>.</p><p>You can also enter variable expressions, such as: <code>${serviceVariable.logz_connector_name}</code>.</p><p></p><h3>Step 3: Query</h3><p>In <strong>Query</strong>, enter search keywords for your query, such as <strong>error or exception</strong>.</p><p>The keywords are searched against the logs identified in the <strong>Message</strong> setting (see below).</p><p>You can also enter variable expressions, such as: <code>error OR ${serviceVariable.error_type}</code></p><h3>Step 4: Query Type</h3><p>Select query type for the value entered in the <strong>Hostname Field</strong>. The queries accept text, numerics, and dates. For MATCH and MATCH_PHRASE types, the input is analyzed and the query is constructed.</p><ol><li><strong>TERM</strong> finds documents that contain the exact term specified in the entered value. See <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html#query-dsl-term-query">ELK documentation on TERM queries</a> for more information.</li><li><strong>MATCH_PHRASE</strong> finds documents that contain the terms specified in the exact order of entries in the analyzed text. See <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html#_phrase">ELK documentation on MATCH_PHRASE queries</a> for more information.</li><li><strong>MATCH</strong> finds documents that contain the entries in the analyzed text in any order. See <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html">ELK documentation on MATCH queries</a> for more information.</li></ol><p>For more information, see <a href="https://logz.io/blog/elasticsearch-queries/" target="_blank">Elasticsearch Queries: A Thorough Guide</a> and <a href="https://docs.logz.io/user-guide/infrastructure-monitoring/configure-grafana-drilldown-links.html" target="_blank">Add dashboards and configure drilldown links</a> from Logz.io.</p><p></p><h3>Step 5: Hostname Field</h3><p>In <strong>Hostname Field</strong>, enter the field name used in the logs that refers to the host/pod/container being monitored.</p><p>This is similar to a <a href="https://docs.logz.io/user-guide/infrastructure-monitoring/configure-grafana-drilldown-links.html" target="_blank">Logz.io dashboard query</a>.</p><h3>Step 6: Message</h3><p>In <strong>Message Field</strong>, enter the field by which the messages are usually indexed. This is typically a <strong>log</strong> field.</p><p>You can also enter variable expressions, such as: <code>${serviceVariable.message_field}</code>.</p><h3>Step 7: Timestamp Format</h3><p>In <strong>Timestamp Format</strong>, enter either a static value (such as <code>@timestamp</code>), or a variable expression such as: <code>${serviceVariable.timestamp_field}</code>.</p><p></p><h3>Step 8: Expression for Host/Container name</h3><p>In <strong>Expression for Host/Container name</strong>, add an expression that evaluates to the host name value for the field you entered in the <strong>Host Name Field</strong> above. The default expression is <strong>${instance.host.hostName}</strong>.</p><div class="note-callout">For AWS EC2 hostnames, use the expression <code>${instance.hostName</code>}.</div><p></p><div class="tip-callout">In order to obtain the names of the host where your service is deployed, the verification provider should be added to your workflow <strong>after</strong> you have run at least one successful deployment.</div><h3>Step 9: Analysis Time Duration</h3><p>Set the duration for the verification step. If a verification step exceeds the value, the workflow <a href="/article/m220i1tnia-workflow-configuration#failure_strategy">Failure Strategy</a> is triggered. For example, if the Failure Strategy is <strong>Ignore</strong>, then the verification state is marked <strong>Failed</strong> but the workflow execution continues.</p><p>See <a href="/article/0avzb5255b-cv-strategies-and-best-practices#analysis_time_duration">CV Strategies, Tuning, and Best Practices</a>.</p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;set_baseline&#34;&gt;&lt;/span&gt;"><p><span id="set_baseline"></span></p>
    </div><h3 id="step_5_baseline_for_risk_analysis">Step 10: Baseline for Risk Analysis</h3><p>See <a href="/article/0avzb5255b-cv-strategies-and-best-practices">CV Strategies, Tuning, and Best Practices</a>.</p><h3>Harness Expression Support in CV Settings</h3><p>You can use expressions (<code>${...}</code>) for <a href="/article/7bpdtvhq92-workflow-variables-expressions">Harness built-in variables</a> and custom <a href="/article/eb3kfl8uls-service-configuration">Service</a> and <a href="/article/766iheu1bk-add-workflow-variables-new-template">Workflow</a> variables in the setting of Harness Verification Providers.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1586812006289/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Expression support lets you template your Workflow verification steps. You can add custom expressions for settings, and then provide values for those settings at deployment runtime. Or you can use Harness built-in variable expressions and Harness will provide values at deployment runtime automatically.</p><p></p>
  slug: verify-deployments-with-logz-io
  tags: []
  is_live: true
