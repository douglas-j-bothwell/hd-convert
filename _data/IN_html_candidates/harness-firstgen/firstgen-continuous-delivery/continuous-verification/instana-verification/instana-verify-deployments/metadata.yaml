type: article
article_id: 3nhtaodeff
user_id: x5amubrz4l
category_id: hb98hpyemv
author:
  name: Michael Katz
  profile_image: https://www.gravatar.com/avatar/17fb3fc86ca54443de0da47ef350d8f0?d=mm&s=150
title: 3 – Verify Deployments with Instana
slug: instana-verify-deployments
description: How to add Instana to a Harness Workflow, where Harness can analyze Instana
  metrics to verify, rollback, and improve deployments.
short_version: Harness can analyze Instana metrics to verify, rollback, and improve
  deployments.
tags: []
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: Article updated
  source: API
  triggered_at: 2021-05-12T17:21:45.838675Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: 3 – Verify Deployments with Instana
  description: How to add Instana to a Harness Workflow, where Harness can analyze
    Instana metrics to verify, rollback, and improve deployments.
  short_version: Harness can analyze Instana metrics to verify, rollback, and improve
    deployments.
  body: |-
    <p>Harness can analyze Instana data to verify, rollback, and improve deployments. To apply this analysis to your deployments, you set up Instana as a verification step in a Harness Workflow, as outined in the following sections:</p><ul><li><a href="https://docs.harness.io/article/vd4jgv41io-3-verify-deployments-with-datadog#deployment_verification_setup">Deployment Verification Setup</a></li><li><a href="#harness_expression_support_in_cv_settings">Harness Expression Support in CV Settings</a></li><li><a href="https://docs.harness.io/article/vd4jgv41io-3-verify-deployments-with-datadog#verification_results">Verification Results</a></li><li><a href="https://docs.harness.io/article/vd4jgv41io-3-verify-deployments-with-datadog#continuous_verification">Continuous Verification</a></li><li><a href="https://docs.harness.io/article/vd4jgv41io-3-verify-deployments-with-datadog#next_steps">Next Steps</a></li></ul><div class="tip-callout">In order to obtain the names of the host(s) or container(s) where your service is deployed, add the Verification Provider to your Workflow <em>after</em> you have run at least one successful Workflow deployment.</div><p></p><h3>Deployment Verification Setup</h3><p>To add an Instana verification step to your Workflow:</p><ol><li>Ensure that you have added Instana as a Harness Verification Provider, as described in <a href="/article/dg4vojlcx1-instana-connection-setup">Instana Connection Setup</a>.</li><li>In your Workflow, under <strong>Verify Service</strong>, click <strong>Add Verification</strong>.</li><li>In the resulting <strong>Add Step</strong> settings, select <strong>Performance Monitoring</strong> &gt; <strong>Instana</strong>.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3nhtaodeff/1584313358784/image.png" style="max-height:75%;max-width:75%" data-hd-height="75%" data-hd-width="75%"/></figure></li><li>Click <strong>Next</strong> to display the <strong>Configure</strong> <strong>Instana</strong> settings.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3nhtaodeff/1584313071951/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure>Next, fill out the settings, which include the following fields.<br/><table><tbody><tr><td><p><strong>Field</strong></p></td><td><p><strong>Description</strong></p></td></tr><tr><td><p><strong>Instana Server</strong></p></td><td><p>Select the Instana <a href="/article/dg4vojlcx1-instana-connection-setup">Verification Provider</a> to use.</p><p>You can also enter variable expressions, such as: <code>${serviceVariable.instana-QA}</code>.</p></td></tr><tr><td><p><strong>Infrastructure Metrics</strong></p></td><td><div class="hd--md" data-hd-markdown="&lt;a name=&#34;docker_metrics_query&#34;&gt;&lt;/a&gt;"><p><a name="docker_metrics_query"></a></p>
    </div><p>In the <strong>Infrastructure Metrics</strong> pane, you can first select one or more <strong>Docker Metrics</strong> to monitor from Instana:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3nhtaodeff/1584318942116/image.png" style="max-height:75%;max-width:75%" data-hd-height="75%" data-hd-width="75%"/></figure><p>Next, in the <strong>Query</strong> field, you must enter a query corresponding to a <a href="http://docs.instana.io/dynamic_focus/" target="_blank">Dynamic Focus</a> query in Instana. For example, you might enter: <code>entity.kubernetes.pod.name:${host}</code></p><p></p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3nhtaodeff/1584331484562/image.png" style="max-height:75%;max-width:75%" data-hd-height="75%" data-hd-width="75%"/></figure><p></p><p>For background information, see Instana&#39;s <a href="https://docs.instana.io/infrastructure_monitoring/containers/" target="_blank">Container Monitoring</a> documentation.</p><p></p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3nhtaodeff/1584318727798/image.png" style="max-height:75%;max-width:75%" data-hd-height="75%" data-hd-width="75%"/></figure><p></p></td></tr><tr><td><p><strong>Application Metrics</strong></p></td><td><div class="hd--md" data-hd-markdown="&lt;a name=&#34;tag_filters&#34;&gt;&lt;/a&gt;"><p><a name="tag_filters"></a></p>
    </div><p>In the <strong>Application Metrics</strong> pane, you specify API endpoint metrics to monitor from Instana.</p><p>First, in the required <strong>Host Tag Filter</strong> field, enter a value in the format: <code>kubernetes.pod.name</code>.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3nhtaodeff/1584320898058/image.png" style="max-height:75%;max-width:75%" data-hd-height="75%" data-hd-width="75%"/></figure><p>Optionally, you can also add <strong>Tag Filters</strong>, corresponding to Filters applied to your metrics on Instana&#39;s <strong>Analytics</strong> tab &gt; <strong>Filters</strong>.</p><p></p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3nhtaodeff/1584324105046/image.png" style="max-height:60%;max-width:60%" data-hd-height="60%" data-hd-width="60%"/></figure><p>To do so:</p><ol><li>Click <strong>Add</strong> to display a <strong>Tag Filters</strong> row, as shown below.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3nhtaodeff/1584321744714/image.png" style="max-height:75%;max-width:75%" data-hd-height="75%" data-hd-width="75%"/></figure></li><li>In the <strong>Name</strong> field, enter the Instana Filter&#39;s name, such as <code>kubernetes.pod.name</code> or <code>kubernetes.cluster.name</code>.</li><li>Select an <strong>Operator</strong> to define the threshold or condition for considering this metric anomalous.</li><li>Enter a <strong>Value</strong> corresponding to the <strong>Operator</strong>.</li><li>To define additional Tag Filters, repeat the above steps.</li></ol><p></p></td></tr><tr><td><p><strong>Expression for Host/Container name</strong></p></td><td><p>The expression entered here should resolve to a host/container name in your deployment environment. By default, the expression is <code>${instance.host.hostName}</code>.</p><div class="tip-callout">For most use cases, you can leave this field empty, to apply the default. However, if you want to add a prefix or suffix, enter an expression as outlined here.</div><p></p><div class="note-callout">For AWS EC2 hostnames, use the expression <code>${instance.hostName</code>}.</div><p>If you begin typing an expression into the field, the field provides expression assistance.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/ps716zaurs/1535566103105/image.png" style="max-height:30%;max-width:30%" data-hd-height="30%" data-hd-width="30%"/></figure><p></p><p>For PCF, you might enter an expression like:</p><pre>${host.pcfElement.displayName}-${host.pcfElement.instanceIndex}</pre><p>...which could yield something like: <code>harness-example-1</code>, where the <code>displayName</code> is <code>harness-example</code> and <code>instanceIndex</code> is <code>1</code>.</p><p></p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/vz9r5mneth/1582875535196/image.png" style="max-height:75%;max-width:75%" data-hd-height="75%" data-hd-width="75%"/></figure><p></p><p>When you are setting up the Workflow for the first time, Harness will not be able to help you create an expression, because there has not been a host/container deployed yet.</p><p>For this reason, you should add the <strong>Verify Step</strong> after you have done one successful deployment.</p></td></tr><tr><td><p><strong>Analysis Time Duration</strong></p></td><td><p>Set the duration for the verification step. If a verification step exceeds the value, the workflow <a href="/article/m220i1tnia-workflow-configuration#failure_strategy">Failure Strategy</a> is triggered. For example, if the Failure Strategy is <strong>Ignore</strong>, then the verification state is marked <strong>Failed</strong> but the workflow execution continues.</p><p>See <a href="https://docs.harness.io/article/0avzb5255b-cv-strategies-and-best-practices">CV Strategies, Tuning, and Best Practices</a>.</p></td></tr><tr><td><p><strong>Baseline for Risk Analysis</strong></p></td><td><p>See <a href="https://docs.harness.io/article/0avzb5255b-cv-strategies-and-best-practices">CV Strategies, Tuning, and Best Practices</a>.</p></td></tr><tr><td><p><strong>Algorithm Sensitivity</strong></p></td><td><p>See <a href="https://docs.harness.io/article/0avzb5255b-cv-strategies-and-best-practices#algorithm_sensitivity_and_failure_criteria">CV Strategies, Tuning, and Best Practices</a>.</p></td></tr><tr><td><p><strong>Include instances from previous phases</strong></p></td><td><p>If you are using this verification step in a multi-phase deployment, select this checkbox to include instances used in previous phases when collecting data. Do not apply this setting to the first phase in a multi-phase deployment.</p></td></tr><tr><td><p><strong>Execute with previous steps</strong></p></td><td><p>Check this checkbox to run this verification step in parallel with the previous steps in <strong>Verify Service</strong>.</p></td></tr></tbody></table></li><li>Click <strong>Test</strong>. Harness verifies the settings you entered.</li><li>When the test is successful, click <strong>Submit</strong>. The Instana verification step is added to your Workflow.</li></ol><p></p><h3>Harness Expression Support in CV Settings</h3><p>You can use expressions (<code>${...}</code>) for <a href="/article/7bpdtvhq92-workflow-variables-expressions">Harness built-in variables</a> and custom <a href="/article/eb3kfl8uls-service-configuration">Service</a> and <a href="/article/766iheu1bk-add-workflow-variables-new-template">Workflow</a> variables in the settings of Harness Verification Providers.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1586812006289/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Expression support lets you template your Workflow verification steps. You can add custom expressions for settings, and then provide values for those settings at deployment runtime. Or you can use Harness built-in variable expressions and Harness will provide values at deployment runtime automatically.</p><h3>Verification Results</h3><p>Once you have deployed your Workflow (or Pipeline) using the Instana verification step, you can automatically verify cloud application and infrastructure performance across your deployment. For more information, see <a href="/article/m220i1tnia-workflow-configuration">Add a Workflow</a> and <a href="/article/zc1u96u6uj-pipeline-configuration">Add a Pipeline</a>.</p><h4>Workflow Verification</h4><p>To see the results of Harness&#39; machine-learning evaluation of your Instana verification: In your Workflow or Pipeline deployment, expand the <strong>Verify Service</strong> step, and then click the <strong>Instana</strong> step to populate the Details panel at right.</p><p></p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3nhtaodeff/1584318109935/image.png" style="max-height:80%;max-width:80%" data-hd-height="80%" data-hd-width="80%"/></figure><p></p><h3>Continuous Verification</h3><p>You can also see the evaluation in the <strong>Continuous Verification</strong> dashboard. While the Workflow verification view is for the DevOps user who developed the Workflow, the <strong>Continuous Verification</strong> dashboard is where <em>all</em> future deployments are displayed for developers and others interested in deployment analysis.</p><p>To explore and interpret verification analysis results, see <a href="/article/2la30ysdz7-deployment-verification-results">Verification Results Overview</a>.</p><h3>Next Steps</h3><ul><li><a href="/article/htvzryeqjw-configuration-as-code">Configuration as Code</a></li><li><a href="/article/ven0bvulsj-users-and-permissions">Users and Permissions</a></li></ul><p></p>
  slug: instana-verify-deployments
  tags: []
  is_live: true
