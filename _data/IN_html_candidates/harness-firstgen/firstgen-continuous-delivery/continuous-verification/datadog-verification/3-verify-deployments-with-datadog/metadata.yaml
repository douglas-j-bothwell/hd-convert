type: article
article_id: vd4jgv41io
user_id: mfr0nxh4be
category_id: x9hs9wviib
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Verify Deployments with Datadog Logging
slug: 3-verify-deployments-with-datadog
description: How to add Datadog to a Harness Workflow, where Harness can analyze Datadog
  metrics to verify, rollback, and improve deployments.
short_version: Harness can analyze Datadog metrics to verify, rollback, and improve
  deployments.
tags:
- Datadog
- Verification Provider
- Deployment Verification
- verification
- risk analysis
- APM
- application performance monitoring
- log
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: Article updated
  source: API
  triggered_at: 2021-05-12T17:22:47.141562Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Verify Deployments with Datadog Logging
  description: How to add Datadog to a Harness Workflow, where Harness can analyze
    Datadog metrics to verify, rollback, and improve deployments.
  short_version: Harness can analyze Datadog metrics to verify, rollback, and improve
    deployments.
  body: '<p>Harness can analyze Datadog logs to verify, rollback, and improve deployments.
    To apply this analysis to your deployments, you set up Datadog as a verification
    step in a Harness Workflow.</p><p>Once you run a deployment, and Datadog preforms
    verification, Harness&#39; machine-learning verification analysis will assess
    the risk level of the deployment.</p><div class="tip-callout">In order to obtain
    the names of the host(s), pod(s), or container(s) where your service is deployed,
    the verification provider should be added to your workflow <em>after</em> you
    have run at least one successful deployment.</div><p>In this topic:</p><ul><li>
    <a href="#before_you_begin">Before You Begin</a></li><li> <a href="#visual_summary">Visual
    Summary</a></li><li> <a href="#step_1_set_up_the_deployment_verification">Step
    1: Set Up the Deployment Verification</a></li><li> <a href="#step_1_datadog_log_server">Step
    2: Datadog Log Server</a></li><li> <a href="#step_3_search_keywords">Step 3: Search
    Keywords</a></li><li> <a href="#step_7_field_name_for_host_containers">Step 4:
    Field Name for Host/Container</a></li><li> <a href="#step_5_expression_for_host_container_name">Step
    5: Expression for Host/Container name</a></li><li> <a href="#step_6_analysis_time_duration">Step
    6: Analysis Time duration</a></li><li> <a href="#step_7_baseline_for_risk_analysis">Step
    7: Baseline for Risk Analysis</a></li><li> <a href="#step_8_algorithm_sensitivity">Step
    8: Algorithm Sensitivity</a></li><li> <a href="#step_9_execute_with_previous_steps">Step
    9: Execute with previous steps</a></li><li> <a href="#review_datadog_and_ecs">Review:
    Datadog and ECS</a></li><li> <a href="#review_harness_expression_support_in_cv_settings">Review:
    Harness Expression Support in CV Settings</a></li><li> <a href="#step_9_view_verification_results">Step
    9: View Verification Results</a></li><li> <a href="#next_steps">Next Steps</a></li></ul><p></p><h3>Before
    You Begin</h3><ul><li>Set up a Harness Application, containing a Service and Environment.
    See  <a href="https://docs.harness.io/article/bucothemly-application-configuration">Create
    an Application</a>.</li><li>See the  <a href="/article/ong5rbbn49-datadog-verification-overview">Datadog
    Verification Overview</a>.</li><li>Make sure you <a href="/article/yqris5svub-1-datadog-connection-setup">Connect
    to Datadog</a>.</li></ul><p></p><h3>Visual Summary</h3><p>Here&#39;s an example
    of a Datadog Logs configuration for verification.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/vd4jgv41io/1580425364540/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><h3>Step
    1: Set Up the Deployment Verification</h3><p>To verify your deployment with Datadog
    Logs, do the following:</p><ol><li>Ensure that you have added Datadog as a verification
    provider, as described in <a href="/article/yqris5svub-1-datadog-connection-setup">Connect
    to Datadog</a>.</li><li>In your workflow, under <strong>Verify Service</strong>,
    click <strong>Add Verification</strong>.</li><li>In the resulting <strong>Add
    Step</strong> settings, select either <strong>Performance Monitoring</strong> &gt;
    <strong>Datadog Logs.</strong></li><li>Click <strong>Next</strong>. The <strong>Datadog
    Logs</strong> settings appear.</li></ol><h3>Step 2: Datadog Log Server</h3><p>Select
    the Datadog verification provider you added earlier in <a href="/article/yqris5svub-1-datadog-connection-setup">Datadog Connection
    Setup</a>.</p><p>You can also enter variable expressions, such as:</p><p> <code>${serviceVariable.datadog_connector_name}</code></p><h3>Step
    3: Search Keywords</h3><p>Enter search keywords, such as <code>*expression*</code>.
    Separate keywords using spaces. (Follow the Datadog <a href="https://docs.datadoghq.com/logs/explorer/search/#search-syntax"
    target="_blank">log search syntax</a>.)</p><p>You can also enter variable expressions,
    such as:</p><p><code>error OR ${serviceVariable.error_type}</code></p><h3 id="step_7_field_name_for_host_containers">Step
    4: Field Name for Host/Container</h3><p>Enter the name of the <strong>tag</strong>
    in Datadog where the service instance is present.</p><p>Harness uses this field
    to group data and perform analysis at the container-level.</p><h3>Step 5: Expression
    for Host/Container name</h3><p>Enter an expression that evaluates to the host/container/pod
    name tagged in the Datadog events.</p><p>This expression relates to the field
    you selected in <strong>Field Name for Host/Container</strong>. You want an expression
    that maps the JSON field returned to Harness with the Datadog field you selected
    in <strong>Field Name for Host/Container</strong>.</p><p>For example, in Datadog,
    a Kubernetes deployment might use the tag <strong>pod_name</strong> to identify
    the pod where the microservice is deployed.</p><p>Find the where the same name
    is identified in the deployment environment, and use that path as the expression.</p><p></p><div
    class="note-callout">For AWS EC2 hostnames, use the expression <code>${instance.hostName</code>}.</div><p>For
    example, locate the pod name in the Datadog <strong>Event Stream</strong> page:</p><ol><li>In
    <strong>Datadog</strong>, click <strong>Events</strong>.</li><li>Locate an event
    using a search query. For more information, see <a href="https://docs.datadoghq.com/graphing/event_stream/"
    target="_blank">Event Stream</a> from Datadog.</li><li>Expand the event by click
    the the ellipsis at the end of the event title.<figure><a href="https://files.helpdocs.io/kw8ldg1itf/articles/rougsx3tir/1536959856299/image.png"><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/rougsx3tir/1536959856299/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></a></figure></li><li>Look
    through the event details and locate the tag that lists the pod name for the instance
    where the service is deployed. In our example, the tag is <strong>pod_name</strong>.<figure><a
    href="https://files.helpdocs.io/kw8ldg1itf/articles/rougsx3tir/1536959897787/image.png"><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/rougsx3tir/1536959897787/image.png"/></a></figure></li><li>Next,
    look in the JSON for the host/container/pod in the deployment environment and
    identify the label containing the same hostname. The path to that label is what
    the expression should be in <strong>Expression for Host/Container name</strong>.
    The default expression is <strong>${host.hostName}</strong>. In most cases, this
    expression will work.</li></ol><h3>Step 6: Analysis Time duration</h3><p>Set the
    duration for the verification step. If a verification step exceeds the value,
    the workflow <a href="/article/m220i1tnia-workflow-configuration#failure_strategy">Failure
    Strategy</a> is triggered. For example, if the Failure Strategy is <strong>Ignore</strong>,
    then the verification state is marked <strong>Failed</strong> but the workflow
    execution continues.</p><p>See  <a href="https://docs.harness.io/article/0avzb5255b-cv-strategies-and-best-practices">CV
    Strategies, Tuning, and Best Practices</a>.</p><h3>Step 7: Baseline for Risk Analysis</h3><p>See 
    <a href="https://docs.harness.io/article/0avzb5255b-cv-strategies-and-best-practices">CV
    Strategies, Tuning, and Best Practices</a>.</p><h3>Step 8: Algorithm Sensitivity</h3><p>See 
    <a href="https://docs.harness.io/article/0avzb5255b-cv-strategies-and-best-practices#algorithm_sensitivity_and_failure_criteria">CV
    Strategies, Tuning, and Best Practices</a>.</p><h3>Step 9: Execute with previous
    steps</h3><p>Check this checkbox to run this verification step in parallel with
    the previous steps in <strong>Verify Service</strong>.</p><h3>Review: Datadog
    and ECS</h3><p>For <a href="/article/08whoizbps-ecs-deployments-overview">ECS-based
    deployments</a>, Datadog uses the container ID to fetch data for both metrics
    and logs. Harness can fetch the container ID if the Harness Delegate is running
    on same ECS cluster as the container or the Delegate must be in same AWS VPC and
    <strong>port 51678</strong> must be open for incoming traffic.</p><h3>Review:
    Harness Expression Support in CV Settings</h3><p>You can use expressions (<code>${...}</code>)
    for <a href="/article/7bpdtvhq92-workflow-variables-expressions">Harness built-in
    variables</a> and custom <a href="/article/eb3kfl8uls-service-configuration">Service</a>
    and <a href="/article/766iheu1bk-add-workflow-variables-new-template">Workflow</a>
    variables in the settings of Harness Verification Providers.</p><p>Expression
    support lets you template your Workflow verification steps. You can add custom
    expressions for settings, and then provide values for those settings at deployment
    runtime. Or you can use Harness built-in variable expressions and Harness will
    provide values at deployment runtime automatically.</p><h3>Step 9: View Verification
    Results</h3><p>Once you have deployed your workflow (or pipeline) using the Datadog
    verification step, you can automatically verify cloud application and infrastructure
    performance across your deployment. For more information, see <a href="/article/m220i1tnia-workflow-configuration">Add
    a Workflow</a> and <a href="/article/zc1u96u6uj-pipeline-configuration">Add a
    Pipeline</a>.</p><h4>Workflow Verification</h4><p>To see the results of Harness
    machine-learning evaluation of your Datadog verification, in your workflow or
    pipeline deployment you can expand the <strong>Verify Service</strong> step and
    then click the <strong>Datadog</strong> step.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/vd4jgv41io/1578090309650/image.png"/></figure><h4>Continuous
    Verification</h4><p>You can also see the evaluation in the <strong>Continuous
    Verification</strong> dashboard. The workflow verification view is for the DevOps
    user who developed the workflow. The <strong>Continuous Verification</strong>
    dashboard is where all future deployments are displayed for developers and others
    interested in deployment analysis.</p><p>To learn about the verification analysis
    features, see the following sections.</p><h5>Deployments</h5><table><tbody><tr><td><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/rougsx3tir/1536957040995/image.png"/></figure></td><td><p><strong>Deployment
    info:</strong> See the verification analysis for each deployment, with information
    on its service, environment, pipeline, and workflows.</p><p><strong>Verification
    phases and providers:</strong> See the vertfication phases for each vertfication
    provider. Click each provider for logs and analysis.</p><p><strong>Verification
    timeline:</strong> See when each deployment and verification was performed.</p></td></tr></tbody></table><h5>Transaction
    Analysis</h5><table><tbody><tr><td><p><strong>Execution details:</strong> See
    the details of verification execution. Total is the total time the verification
    step took, and Analysis duration is how long the analysis took.</p><p><strong>Risk
    level analysis:</strong> Get an overall risk level and view the cluster chart
    to see events.</p><p><strong>Transaction-level summary:</strong> See a summary
    of each transaction with the query string, error values comparison, and a risk
    analysis summary.</p></td><td><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/rougsx3tir/1536957067207/image.png"/></figure></td></tr></tbody></table><h5>Execution
    Analysis</h5><table><tbody><tr><td><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/uw64fijctw/1535497249316/image.png"/></figure></td><td><p><strong>Event
    type:</strong> Filter cluster chart events by Unknown Event, Unexpected Frequency,
    Anticipated Event, Baseline Event, and Ignore Event.</p><p><strong>Cluster chart:</strong>
    View the chart to see how the selected event contrast. Click each event to see
    its log details.</p></td></tr></tbody></table><h5>Event Management</h5><table><tbody><tr><td><p><strong>Event-level
    analysis:</strong> See the threat level for each event captured.</p><p><strong>Tune
    event capture:</strong> Remove events from analysis at the service, workflow,
    execution, or overall level.</p><p><strong>Event distribution:</strong> Click
    the chart icon to see an event distribution including the measured data, baseline
    data, and event frequency.</p></td><td><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/uw64fijctw/1535497306015/image.png"/></figure></td></tr></tbody></table><h3>Next
    Steps</h3><ul><li> <a href="/article/htvzryeqjw-configuration-as-code">Configuration
    as Code</a></li><li> <a href="/article/ven0bvulsj-users-and-permissions">Users
    and Permissions</a></li><li> <a href="https://docs.harness.io/article/0avzb5255b-cv-strategies-and-best-practices#algorithm_sensitivity_and_failure_criteria">CV
    Strategies, Tuning, and Best Practices</a></li></ul><p></p>'
  slug: 3-verify-deployments-with-datadog
  tags:
  - Datadog
  - Verification Provider
  - Deployment Verification
  - verification
  - risk analysis
  - APM
  - application performance monitoring
  - log
  is_live: true
