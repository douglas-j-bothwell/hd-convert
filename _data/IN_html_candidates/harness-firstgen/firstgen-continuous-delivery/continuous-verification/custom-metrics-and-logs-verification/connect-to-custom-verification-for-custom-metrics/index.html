<p></p><p>Connect Harness to a Custom Metrics Data Provider to have Harness verify the success of your deployments. Harness will use your tools to verify deployments and use its machine learning features to identify sources of failures.</p><p>In this topic:</p><ul><li> <a href="#before_you_begin">Before You Begin</a></li><li> <a href="#simple_slug">Step 1: Add Custom Verification Provider</a></li><li> <a href="#step_2_type">Step 2: Type</a></li><li> <a href="#step_3_display_name">Step 3: Display Name</a></li><li> <a href="#step_4_base_url">Step 4: Base URL</a></li><li> <a href="#step_5_headers">Step 5: Headers</a></li><li> <a href="#step_6_parameters">Step 6: Parameters</a></li><li> <a href="#step_7_validation_path">Step 7: Validation Path</a></li><li> <a href="#see_also">See Also</a></li></ul><p></p><h3>Before You Begin</h3><ul><li>See <a href="/article/e87u8c63z4-custom-verification-overview">Custom Verification Overview</a>.</li></ul><p></p><h3>Step 1: Add Custom Verification Provider</h3><p>To connect a custom metrics data provider, do the following:</p><ol><li>Click <strong>Setup</strong>.</li><li>Click <strong>Connectors</strong>.</li><li>Click <strong>Verification Providers</strong>.</li><li>Click <strong>Add Verification Provider</strong>, and click <strong>Custom Verification</strong>.</li></ol><p>The <strong>Metrics Data Provider</strong> dialog appears.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/27w7uso9r4/1561412245998/image.png" style="max-height:505;max-width:50%" data-hd-height="505" data-hd-width="50%"/></figure><p></p><p>In the <strong>Metrics Data Provider</strong> dialog, you can configure how Harness can query event data via API.</p><p>For example, with New Relic Insights, you are configuring the <strong>Metrics Data Provider</strong> dialog to perform a cURL request like the following:</p><pre>curl -H &#34;Accept: application/json&#34; \<br/>-H &#34;X-Query-Key: YOUR_QUERY_KEY&#34; \<br/>&#34;https://insights-api.newrelic.com/v1/accounts/<strong>YOUR_ACCOUNT_ID</strong>/query?nrql=<strong>YOUR_QUERY_STRING</strong>&#34;</pre><div class="note-callout">To query event data via API in New Relic Insights, you will need to set up an API key in New Relic. For more information, see <a href="https://docs.newrelic.com/docs/insights/insights-api/get-data/query-insights-event-data-api" target="_blank">Query Insights event data via API</a> from New Relic.</div><p>The purpose of the <strong>Metrics Data Provider</strong> dialog is to validate the credentials and validation path you enter and return an HTTP 200 from your metrics provider.</p><p>The <strong>Metrics Data Provider</strong> dialog has the following fields.</p><h3>Step 2: Type</h3><p>Select <strong>Metrics Data Provider</strong>.</p><h3>Step 3: Display Name</h3><p>The name for this Verification Provider connector in Harness. This is the name you will use to reference this Verification Provider whenever you use it to add a verification step to a Workflow.</p><h3>Step 4: Base URL</h3><p>Enter the URL for API requests. For example, in New Relic Insights, you can change the default URL to get the Base URL for the API.</p><p><strong>Default URL:</strong> https://insights.newrelic.com/accounts/12121212</p><p><strong>Base URL for API:</strong> https://<strong>insights-api.newrelic.com/v1</strong>/accounts/12121212</p><h3>Step 5: Headers</h3><p>Add the query headers required by your metrics data provider. For New Relic Insights, do the following:</p><ol><li>Click <strong>Add Headers</strong>.</li><li>In <strong>Key</strong>, enter <strong>X-Query-Key</strong>. For New Relic, a X-Query-Key must contain a valid query key.</li><li>In <strong>Value</strong>, enter the key, or click <strong>Use Secret</strong> and select or create a new <a href="/article/ygyvp998mu-use-encrypted-text-secrets">Harness Encrypted Text secret</a> for the API key you got from New Relic.</li><li>Click the checkbox under <strong>Encrypted Value</strong> to encrypt the key.</li><li>Click <strong>Add Headers</strong> again.</li><li>In <strong>Key</strong>, enter <strong>Accept</strong>. This is for the Content-Type of a query.</li><li>In <strong>Value</strong>, enter <strong>application/json</strong>. The Content-Type of a query must be application/json.</li></ol><h3>Step 6: Parameters</h3><p>Add any request parameters that do not change for every request.</p><p>In <strong>Value</strong>, enter the key, or click <strong>Use Secret</strong> and select or create a new <a href="/article/ygyvp998mu-use-encrypted-text-secrets">Harness Encrypted Text secret</a> for the API key you got from New Relic.</p><h3>Step 7: Validation Path</h3><div class="note-callout">Harness expects a JSON response, not simply text.</div><p>In <strong>Path</strong>, you will define a validation path.</p><p> Enter the query string from your metric provider. </p><p>The resulting URL (<strong>{base_URL}/{validation_path}</strong>) is used to validate the connection to the metric provider. </p><p>This query is invoked with the headers and parameters defined here.For example, in New Relic Insights, you can take the query from the <strong>NRQL&gt;</strong> field and add it to the string <strong>query?nrql=</strong>, for example:</p><pre class="hljs apache">query?nrql=SELECT<span class="hljs-number">%20</span>average<span class="hljs-number">%28</span>duration<span class="hljs-number">%29</span><span class="hljs-number">%20</span>FROM<span class="hljs-number">%20</span>PageView</pre><p></p><p>The field accepts URL encoded or unencoded queries.</p><p>If you select <strong>POST</strong>, the <strong>Body</strong> field appears. Enter a sample JSON body to send as the payload when making the call to the APM provider. The requirements of the JSON body will depend on your APM provider.</p><p></p><h3>See Also</h3><ul><li><a href="/article/wya9qgjlrr-connect-to-custom-verification-for-custom-logs">Connect to Custom Verification for Custom Logs</a></li></ul><p></p>