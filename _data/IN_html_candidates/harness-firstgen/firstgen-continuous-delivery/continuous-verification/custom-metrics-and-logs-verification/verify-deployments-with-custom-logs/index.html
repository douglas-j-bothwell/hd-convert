<p></p><p>The following procedure describes how to add a custom Logs verification step in a Harness Workflow. For more information about Workflows, see <a href="/article/m220i1tnia-workflow-configuration">Add a Workflow</a>.</p><p>Once you run a deployment and your custom logs provider obtains its data, Harness machine-learning verification analysis will assess the risk level of the deployment using the data from the provider.</p><div class="tip-callout">In order to obtain the names of the host(s), pod(s), or container(s) where your service is deployed, the verification provider should be added to your Workflow <em>after</em> you have run at least one successful deployment.</div><p>In this topic:</p><ul><li> <a href="#before_you_begin">Before You Begin</a></li><li> <a href="#step_1_set_up_the_deployment_verification">Step 1: Set Up the Deployment Verification</a></li><li> <a href="#step_2_request_method">Step 2: Request Method</a></li><li> <a href="#step_3_search_url">Step 3: Search URL</a></li><li> <a href="#step_4_search_body">Step 4: Search Body</a></li><li> <a href="#step_5_response_type">Step 5: Response Type</a></li><li> <a href="#step_6_log_message_json_path">Step 6: Log Message JSON Path</a></li><li> <a href="#step_7_hostname_json_path">Step 7: Hostname JSON Path</a></li><li> <a href="#step_8_regex_to_transform_host_name">Step 8: Regex to Transform Host Name</a></li><li> <a href="#step_9_timestamp_json_path">Step 9: Timestamp JSON Path</a></li><li> <a href="#step_10_timestamp_format">Step 10: Timestamp Format</a></li><li> <a href="#step_11_expression_for_host_container">Step 11: Expression for Host/Container</a></li><li> <a href="#step_12_analysis_time_duration">Step 12: Analysis Time Duration</a></li><li> <a href="#step_13_data_collection_interval">Step 13: Data Collection Interval</a></li><li> <a href="#step_14_baseline_for_risk_analysis">Step 14: Baseline for Risk Analysis</a></li><li><a href="https://docs.harness.io/article/d4i9pp3uea-verify-deployments-with-custom-logs#step_15_execute_with_previous_steps">Step 15: Execute with previous steps</a></li><li><a href="https://docs.harness.io/article/d4i9pp3uea-verify-deployments-with-custom-logs#step_16_include_instances_from_previous_phases">Step 16: Include instances from previous phases</a></li><li><a href="https://docs.harness.io/article/d4i9pp3uea-verify-deployments-with-custom-logs#step_17_wait_interval_before_execution">Step 17: Wait interval before execution</a></li><li> <a href="#review_additional_notes">Review: Additional Notes</a></li></ul><p></p><h3>Before You Begin</h3><ul><li>See <a href="/article/e87u8c63z4-custom-verification-overview">Custom Verification Overview</a>.</li><li>See <a href="/article/wya9qgjlrr-connect-to-custom-verification-for-custom-logs">Connect to Custom Verification for Custom Logs</a>.</li></ul><p></p><h3>Step 1: Set Up the Deployment Verification</h3><p>To verify your deployment with a custom metric or log provider, do the following:</p><ol><li>Ensure that you have added Custom Logs Provider as a verification provider, as described in <a href="/article/wya9qgjlrr-connect-to-custom-verification-for-custom-logs">Connect to Custom Verification for Custom Logs</a>.</li><li>In your workflow, under <strong>Verify Service</strong>, click <strong>Add Verification</strong>.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/uw64fijctw/1535478536625/image.png"/></figure></li><li>In the resulting <strong>Add Step</strong> settings, select <strong>Log Analysis</strong> &gt; <strong>Custom Log Verification</strong>.</li><li>Click <strong>Next</strong>. The <strong>Configure Custom Log Verification</strong> settings appear.</li><li>In <strong>Log Data Provider</strong>, select the custom logs provider you added, described in <a href="/article/wya9qgjlrr-connect-to-custom-verification-for-custom-logs">Connect to Custom Verification for Custom Logs</a>.</li><li>Click <strong>Add Log Collection</strong> to add a <strong>Log Collection</strong> section.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/1dq1n1k99s/1586217053066/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li></ol><h3>Step 2: Request Method</h3><p>In <strong>Request Method</strong>, select GET or POST.</p><h3>Step 3: Search URL</h3><p>In <strong>Search URL</strong>, enter the API query that will return a JSON response.</p><p>Make sure the following parameters are included in the query. These placeholders will be replaced with the actual values during the execution.</p><ol><li> <code>${start_time}</code> or <code>${start_time_seconds</code>}: This is the placeholder parameter to specify the start time of the query. It is similar to the value specified in custom metrics verification.</li><li> <code>${end_time}</code> or <code>${end_time_seconds}</code>: This is the placeholder parameter to specify the end time of the query. It is similar to the value specified in custom metrics verification.</li><li> <code>${host}</code>: This is the placeholder for querying based on the host during deployment verification. This is NOT a required field if the setup is for a Previous Analysis.</li></ol><p>In the remaining settings, you will map the keys in the JSON response to Harness settings to identify where data—such as log message and timestamp—are located in the JSON response.</p><h3>Step 4: Search Body</h3><p>In <strong>Search Body</strong>, enter any JSON search input for your query. If you need to send a token, but do not want to send it in plaintext, you can use a Harness <a href="/article/au38zpufhr-secret-management#encrypted_text">encrypted text secret</a>.</p><h3>Step 5: Response Type</h3><p>In <strong>Response Type</strong>, select <strong>JSON</strong>.</p><h3>Step 6: Log Message JSON Path</h3><p>In <strong>Log Message JSON Path</strong> – Use <strong>Guide from Example</strong> to query the log provider and return the JSON response.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/1dq1n1k99s/1586219550272/image.png" style="max-height:100%;max-width:100%" data-hd-height="100%" data-hd-width="100%"/></figure><p></p><p>The URL is a combination of the Verification Cloud Provider <strong>Base URL</strong> and the <strong>Log Collection URL</strong> you entered.</p><p>Click <strong>SEND</strong>. In the JSON response, click the key that includes the log message path.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/27w7uso9r4/1562885301673/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>The log message path key is added to <strong>Log Message JSON Path</strong>:</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/27w7uso9r4/1562885323848/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><h3>Step 7: Hostname JSON Path</h3><p>Use <strong>Guide from Example</strong> to query the log provider and return the JSON response. In the JSON response, click the key that includes the hostname path.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/27w7uso9r4/1562885361223/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><h3>Step 8: Regex to Transform Host Name</h3><p>If the JSON value returned requires transformation in order to be used, enter the regex expression here. For example: If the value in the host name JSON path of the response is <code>pod_name:harness-test.pod.name</code> and the actual pod name is simply <code>harness-test.pod.name</code>, you can write a regular expression to remove the <code>pod_name</code> from the response value.</p><h3>Step 9: Timestamp JSON Path</h3><p>Use <strong>Guide from Example</strong> to query the log provider and return the JSON response. In the JSON response, click the key that includes the timestamp.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/27w7uso9r4/1562885442593/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><h3>Step 10: Timestamp Format</h3><p>Enter the format of the timestamp included in the query request (not response). The format follows the <a href="https://docs.oracle.com/javase/8/docs/api/java/text/SimpleDateFormat.html" target="_blank">Java SimpleDateFormat</a>. For example, a timestamp syntax might be <strong>yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSSX</strong>. If you leave this field empty, Harness will use the default range of 1 hour previous (now - 1h) to now.</p><p>Click <strong>Add</strong>. The Log Collection is added.</p><h3>Step 11: Expression for Host/Container</h3><p>The expression entered here should resolve to a host/container name in your deployment environment. By default, the expression is <strong>${instance.host.hostName}</strong>.</p><h3>Step 12: Analysis Time Duration</h3><p>Set the duration for the verification step. If a verification step exceeds the value, the workflow <a href="/article/m220i1tnia-workflow-configuration#failure_strategy">Failure Strategy</a> is triggered. For example, if the Failure Strategy is <strong>Ignore</strong>, then the verification state is marked <strong>Failed</strong> but the workflow execution continues.</p><p>Harness waits 2-3 minutes before beginning the analysis to avoid initial deployment noise. This is a standard with monitoring tools.</p><h3>Step 13: Data Collection Interval</h3><p>Specify the frequency at which Harness will run the query. Harness recommends the value 2.</p><h3>Step 14: Baseline for Risk Analysis</h3><p>See <a href="/article/0avzb5255b-cv-strategies-and-best-practices">CV Strategies, Tuning, and Best Practices</a>.</p><h3>Step 15: Execute with previous steps</h3><p>Check this checkbox to run this verification step in parallel with the previous steps in <strong>Verify Service</strong>.</p><h3>Step 16: Include instances from previous phases</h3><p>If you are using this verification step in a multi-phase deployment, select this checkbox to include instances used in previous phases when collecting data. Do not apply this setting to the first phase in a multi-phase deployment.</p><h3>Step 17: Wait interval before execution</h3><p>Set how long the deployment process should wait before executing the verification step.</p><h3>Review: Additional Notes</h3><p>The <strong>Compare With Previous Run</strong> option is used for Canary deployments where the second phase is compared to the first phase, and the third phase is compared to the second phase, and so on. Do not use this setting in a single phase workflow or in the first phase of a multi-phase workflow.</p><p></p>