<p></p><p>Harness 24/7 Service Guard monitors your live applications, catching problems that surface minutes or hours following deployment. For more information, see  <a href="https://docs.harness.io/article/dajt54pyxd-24-7-service-guard-overview">24/7 Service Guard Overview</a>.</p><p>While Harness supports  <a href="/category/gurgsl2gqt-continuous-verification">all of the common metrics tools</a>, you can add your Custom metrics to Harness 24/7 Service Guard in your Harness Application Environment. For a setup overview, see  <a href="/article/iocufp9eb2-connect-to-custom-verification-for-custom-metrics">Connect to Custom Verification for Custom Metrics</a>.</p><div class="note-callout">This section assumes you have a Harness Application set up, containing a Service and Environment. For steps on setting up a Harness Application, see  <a href="https://docs.harness.io/article/bucothemly-application-configuration">Application Components</a>.</div><p>In this topic:</p><ul><li> <a href="#before_you_begin">Before You Begin</a></li><li> <a href="#step_1_set_up_24_7_service_guard_for_custom_metrics">Step 1: Set up 24/7 Service Guard for Custom Metrics</a></li><li> <a href="#step_2_display_name">Step 2: Display Name</a></li><li> <a href="#step_3_service">Step 3: Service</a></li><li> <a href="#step_4_metrics_data_server">Step 4: Metrics Data Server</a></li><li> <a href="#step_5_metric_type">Step 5: Metric Type</a></li><li> <a href="#step_6_metric_collections">Step 6: Metric Collections</a></li><li> <a href="#step_7_metrics_name">Step 7: Metrics Name</a></li><li> <a href="#step_8_metrics_type">Step 8: Metrics Type</a></li><li> <a href="#step_9_metrics_collection_url">Step 9: Metrics Collection URL</a></li><li> <a href="#step_10_metrics_method">Step 10: Metrics Method</a></li><li> <a href="#step_11_response_mapping">Step 11: Response Mapping</a></li><li> <a href="#step_12_transaction_name">Step 12: Transaction Name</a></li><li> <a href="#step_13_name_(fixed)">Step 13: Name (Fixed)</a></li><li> <a href="#step_14_transaction_name_path_(dynamic)">Step 14: Transaction Name Path (Dynamic)</a></li><li> <a href="#step_15_regex_to_transform_transaction_name_(dynamic)">Step 15: Regex to transform Transaction Name (Dynamic)</a></li><li> <a href="#step_16_metrics_value">Step 16: Metrics Value</a></li><li> <a href="#step_17_timestamp">Step 17: Timestamp</a></li><li> <a href="#step_18_timestamp_format">Step 18: Timestamp Format</a></li><li> <a href="#step_19_test_the_settings">Step 19: Test the Settings</a></li><li> <a href="#review_custom_thresholds">Review: Custom Thresholds</a></li><li> <a href="#step_20_algorithm_sensitivity">Step 20: Algorithm Sensitivity</a></li><li> <a href="#step_21_enable_24_7_service_guard">Step 21: Enable 24/7 Service Guard</a></li><li> <a href="#review_verification_results">Review: Verification Results</a></li><li> <a href="#see_also">See Also</a></li></ul><p></p><h3>Before You Begin</h3><ul><li>See <a href="/article/e87u8c63z4-custom-verification-overview">Custom Verification Overview</a>.</li><li>See <a href="/article/iocufp9eb2-connect-to-custom-verification-for-custom-metrics">Connect to Custom Verification for Custom Metrics</a>.</li></ul><p></p><h3>Step 1: Set up 24/7 Service Guard for Custom Metrics</h3><p>To set up 24/7 Service Guard for custom metrics, do the following:</p><ol><li>Ensure that you have added your Custom Verification provider as a Harness Verification Provider.</li><li>In your Harness Application, ensure that you have added a Service, as described in  <a href="https://docs.harness.io/article/eb3kfl8uls-service-configuration">Services</a>. For 24/7 Service Guard, you do not need to add an Artifact Source to the Service, or configure its settings. You simply need to create a Service and name it. It will represent your application for 24/7 Service Guard.</li><li>In your Harness Application, click <strong>Environments</strong>.</li><li>In <strong>Environments</strong>, ensure that you have added an Environment for the Service you added. For steps on adding an Environment, see  <a href="https://docs.harness.io/article/n39w05njjv-environment-configuration">Environments</a>.</li><li>Click the Environment for your Service. Typically, the <strong>Environment Type</strong> is <strong>Production</strong>.</li><li>In the <strong>Environment</strong> page, locate <strong>24/7 Service Guard</strong>.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3uyehimy3b/1574366458887/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li><li>In <strong>24/7 Service Guard</strong>, click <strong>Add Service Verification</strong>, and then click <strong>Custom APM Verification</strong>.</li></ol><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3uyehimy3b/1574366545215/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><p>The <strong>Custom APM Verification</strong> dialog appears.</p><p></p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/ceo02luigu/1582772595058/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Fill out the dialog. The dialog has the fields described below.</p><div class="note-callout">For 24/7 Service Guard, the queries you define to collect metrics are specific to the Application or Service you want monitored. (Verification is at the Application/Service level.) This is unlike Workflows, where verification is performed at the host/node/pod level.</div><h3>Step 2: Display Name</h3><p>Enter the name that will identify this 24/7 Service Guard monitoring in Harness&#39; <strong>Continuous Verification</strong> page.</p><h3>Step 3: Service</h3><p>Select the Harness Service that represents your live, production application or service.</p><h3>Step 4: Metrics Data Server</h3><p>Select the custom metric provider you added.</p><h3>Step 5: Metric Type</h3><p>Select <strong>Infrastructure</strong> or <strong>Transaction</strong>.</p><p>Consider what you monitoring before selecting. Each type has subtypes in <strong>Metric Collections</strong>:</p><ul><li><strong>Infrastructure</strong><ul><li>Infrastructure</li><li>Value</li></ul></li><li><strong>Transaction</strong><ul><li>Error</li><li>Response Time</li><li>Throughput</li></ul></li></ul><p>For example, if you want to monitor if a value goes below the baseline, select <strong>Infrastructure</strong> and then <strong>Value</strong> in <strong>Metric Collections</strong>.</p><p>If you want to monitor an error, then select <strong>Transaction</strong>.</p><h4>Always Use Throughput with Error and Response Time Metrics</h4><p>Whenever you use the Error metric type, you should also add another metric for Throughput with the same Transaction Name.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/0qvier4m49/1606857927356/image.png"/></figure><p>Harness analyze errors as error percentage and without the throughput the error number does not provide much information.</p><p>The same setup should used with the Response Time metric also. Whenever you set up a Response Time metric, setup a Throughput metric with the same Transaction Name.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/0qvier4m49/1606857610464/image.png"/></figure><h3>Step 6: Metric Collections</h3><p>Click <strong>Add</strong> to add a new metric collection. This displays the dialog shown below.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3uyehimy3b/1594916813754/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3uyehimy3b/1594917096594/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>In the resulting <strong>New Metrics Collection</strong> dialog, use the following controls to define a metrics collection.</p><h3>Step 7: Metrics Name</h3><p>Enter a name for the metrics you want analyzed, such as <strong>ThreadCount</strong>.</p><h3>Step 8: Metrics Type</h3><p>For the <strong>Infrastructure</strong> Metrics Type, select the type of metric you want to collect:</p><ul><li><strong>Infra:</strong> Infrastructure metrics, such as CPU, memory, and HTTP errors.</li><li><strong>Value:</strong> <a href="https://docs.newrelic.com/docs/apm/new-relic-apm/apdex/apdex-measure-user-satisfaction">Apdex</a> (measures user satisfaction with response time).</li><li><strong>Lower Value:</strong> Values below the average.</li></ul><p>For the <strong>Transaction</strong> Metrics Type, select the type of metric you want to collect:</p><ul><li>Error</li><li>Response Time</li><li>Throughput</li></ul><h3>Step 9: Metrics Collection URL</h3><p>Enter a query for your verification. You can simply make the query in your Verification Provider and paste it in the <strong>Metrics Collection URL</strong> field.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3uyehimy3b/1574369561885/image.png"/></figure><p>You will use this query to obtain the JSON paths for the <strong>Response Mapping</strong> settings.</p><p>In most cases, you will want to add the placeholders <code>${start_time}</code> and <code>${end_time}</code> in your query so that you can customize the range when making requests.</p><h3>Step 10: Metrics Method</h3><p>Select <strong>GET</strong> or <strong>POST</strong>. If you select <strong>POST</strong>, the <strong>Metric Collection Body</strong> field appears.</p><figure><a href="https://files.helpdocs.io/kw8ldg1itf/articles/27w7uso9r4/1561413608560/image.png"><img src="https://files.helpdocs.io/kw8ldg1itf/articles/27w7uso9r4/1561413608560/image.png"/></a></figure><p>In <strong>Metric Collection Body</strong>, enter the JSON body to send as a payload when making a REST call to the APM Provider. The requirements of the JSON body will depend on your APM provider.</p><p>You can use variables you created in the Service and Workflow in the JSON, as well as <a href="/article/9dvxcegm90-variables">Harness built-in variables</a>.</p><h3>Step 11: Response Mapping</h3><p>These settings are for specifying which JSON fields in the responses to use for monitoring.</p><h3>Step 12: Transaction Name</h3><p>Select <strong>Fixed</strong> or <strong>Dynamic</strong>.</p><p><strong>Fixed:</strong> Use this option when all metrics are for the same transaction. For example, a single login page.</p><p><strong>Dynamic:</strong> Use this option when the metrics are for multiple transactions</p><h3>Step 13: Name (Fixed)</h3><p>Enter a name to identify the transaction.</p><h3>Step 14: Transaction Name Path (Dynamic)</h3><p>This is the JSON label for identifying a transaction name.</p><p>For example, in a New Relic Insights query, the <strong>FACET</strong> clause is used to group results by the attribute <strong>transactionName</strong>. You can obtain the field name that records the <strong>transactionName</strong> by using the <strong>Guide From Example</strong> feature:</p><ol><li>Click <strong>Guide From Example</strong>. The Guide From Example popover appears.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3uyehimy3b/1574370306015/image.png" style="max-height:75%;max-width:75%" data-hd-height="75%" data-hd-width="75%"/></figure>The Metrics URL Collection is based on the query you entered in the <strong>Metric Collection URL field</strong> earlier.</li><li>Specify a time range using the <code>${startTime}</code> and <code>${endTime}</code>.</li><li>Click <strong>SEND</strong>. The query is executed and the JSON is returned.</li><li>Locate the field name that is used to identify transactions. In our New Relic Insights query, it is the <strong>facets.name</strong> field.<br/>If no metrics are found, you will see a <code>METRIC DATA NOT FOUND</code> error.<br/>Using New Relic Insights as an example, you can find the name in the JSON of your Insights query results.<figure><a href="https://files.helpdocs.io/kw8ldg1itf/articles/27w7uso9r4/1536095120978/image.png"><img src="https://files.helpdocs.io/kw8ldg1itf/articles/27w7uso9r4/1536095120978/image.png" style="max-height:25%;max-width:25%" data-hd-height="25%" data-hd-width="25%"/></a></figure></li><li>Click the field <strong>name</strong> under facets. The field path is added to the <strong>Transaction Name Path</strong> field.<figure><a href="https://files.helpdocs.io/kw8ldg1itf/articles/27w7uso9r4/1536095167499/image.png"><img src="https://files.helpdocs.io/kw8ldg1itf/articles/27w7uso9r4/1536095167499/image.png"/></a></figure></li></ol><h3>Step 15: Regex to transform Transaction Name (Dynamic)</h3><p>Enter a regex expression here to obtain the specific name from the transaction path.</p><p>For example, if your Transaction Name Path JSON evaluated to a value such as <code>name : TxnName</code>, you can write a regex to remove everything other than <code>TxnName</code>.</p><p>For example <code>(name:(.*),)</code> or <code>(?&lt;=:).*(?=,)</code>.</p><h3>Step 16: Metrics Value</h3><p>Specify the value for the event count. This is used to filter and aggregate data returned in a SELECT statement. To find the correct label for the value, do the following:</p><ol><li>Click <strong>Guide From Example</strong>. The example popover appears.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3uyehimy3b/1574379176923/image.png" style="max-height:75%;max-width:75%" data-hd-height="75%" data-hd-width="75%"/></figure>The Metrics URL Collection is based on the query you entered in the <strong>Metric Collection URL field</strong> earlier. The <strong>${host}</strong> field refers to the <code>${host}</code> variable in your query.</li><li>Specify a time range using the <code>${startTime}</code> and <code>${endTime}</code>.</li><li>Click <strong>Send</strong>. The query is executed and the JSON is returned.<br/>If no metrics are found, you will see a <code>METRIC DATA NOT FOUND</code> error.</li><li>Locate the field name that is used to count events.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3uyehimy3b/1574379312462/image.png" style="max-height:75%;max-width:75%" data-hd-height="75%" data-hd-width="75%"/></figure></li><li>Click the name of the field, such as <strong>value</strong>. The JSON path is added to the <strong>Metrics Value</strong> field.</li></ol><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3uyehimy3b/1574379354011/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><h3>Step 17: Timestamp</h3><p>Specify the value for the timestamp in the query. To find the correct label for the value, do the following:</p><ol><li>Click <strong>Guide From Example</strong>. The popover appears.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3uyehimy3b/1574379475168/image.png" style="max-height:75%;max-width:75%" data-hd-height="75%" data-hd-width="75%"/></figure>The Metrics URL Collection is based on the query you entered in the <strong>Metric Collection URL field</strong> earlier.</li><li>Click <strong>Send</strong>. The query is executed and the JSON is returned.</li><li>Click the name of the label for the start time.</li></ol><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3uyehimy3b/1574379495937/image.png" style="max-height:75%;max-width:75%" data-hd-height="75%" data-hd-width="75%"/></figure><p>The JSON path is added to the <strong>Timestamp</strong> path:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3uyehimy3b/1574379544566/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><h3>Step 18: Timestamp Format</h3><p>Enter a timestamp format. The format follows the Java <a href="https://docs.oracle.com/javase/8/docs/api/java/text/SimpleDateFormat.html">SimpleDateFormat</a>. For example, a timestamp syntax might be <strong>yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSSX</strong>. If you leave this field empty, Harness will use the default range of 1 hour previous (now-1h) to now.</p><h3>Step 19: Test the Settings</h3><p>Once you have filled in the <strong>New Metrics Collection</strong> dialog, click <strong>Test</strong> to check your settings. Once they test successfully, click <strong>Add</strong> to add this collection to the <strong>Custom APM Verification</strong> settings.</p><p>This restores the <strong>Custom APM Verification</strong> dialog. Here, you have the option to click <strong>Add</strong> to define additional metrics collections, using the options just outlined.</p><h3>Review: Custom Thresholds</h3><p>In the <strong>Custom APM Verification</strong> dialog, you can access the <strong>Custom Thresholds</strong> section once you have configured at least one Metrics Collection. Within Custom Thresholds, you can define <strong>Ignore Hints</strong> rules that instruct Harness to remove certain metrics/value combinations from 24/7 Service Guard analysis.</p><p>For details about defining Custom Thresholds, see <a href="/article/53t35yit8p-custom-thresholds-24-7">Apply Custom Thresholds to 24/7 Service Guard</a>.</p><h3>Step 20: Algorithm Sensitivity</h3><p>Select the Algorithm Sensitivity. See <a href="/article/0avzb5255b-cv-strategies-and-best-practices#algorithm_sensitivity_and_failure_criteria">CV Strategies, Tuning, and Best Practices</a>.</p><h3>Step 21: Enable 24/7 Service Guard</h3><p>Select this check box to enable 24/7 Service Guard.</p><p>When you are finished, the <strong>Custom APM Verification Settings</strong> dialog will look something like this:</p><p></p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/ceo02luigu/1582785914182/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Click <strong>Submit</strong>. The Custom Metrics 24/7 Service Guard verification is added.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3uyehimy3b/1574379887306/image.png"/></figure><h3>Review: Verification Results</h3><p>To see the running 24/7 Service Guard analysis, click <strong>Continuous Verification</strong>.</p><p>The 24/7 Service Guard dashboard displays the production verification results.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/3uyehimy3b/1574379956772/image.png"/></figure><p></p>