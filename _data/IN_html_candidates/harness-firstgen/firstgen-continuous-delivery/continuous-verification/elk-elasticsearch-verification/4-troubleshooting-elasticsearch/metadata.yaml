type: article
article_id: emorpi9nd4
user_id: mfr0nxh4be
category_id: ytuafly1jg
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Troubleshoot Verification with Elasticsearch
slug: 4-troubleshooting-elasticsearch
description: Resolutions to common problems in configuring the Elastic Stack (ELK
  Stack) as a Harness verification provider.
short_version: Resolutions to common configuration problems with the Elastic Stack
  (ELK Stack).
tags:
- Elasticsearch
- ELK
- Elastic Stack
- Elastic
- ELK_CONFIGURATION_ERROR
- No node with name ${hostName} found reporting to ELK
- SocketTimeoutException
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: Article updated
  source: API
  triggered_at: 2021-05-12T17:22:46.896163Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Troubleshoot Verification with Elasticsearch
  description: Resolutions to common problems in configuring the Elastic Stack (ELK
    Stack) as a Harness verification provider.
  short_version: Resolutions to common configuration problems with the Elastic Stack
    (ELK Stack).
  body: '<p>The following are resolutions to common configuration problems.</p><h3>Workflow
    Step Test Error</h3><p>When you click <strong>TEST</strong> in the <strong>ELK</strong>
    workflow dialog <strong>Expression for Host Name</strong> popover, you should
    get provider information:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/xpftsz2cte/1535665385966/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>The
    following error message can occur when testing the New Relic verification step
    in your workflow:</p><pre>ELK_CONFIGURATION_ERROR: Error while saving ELK configuration.
    No node with name ${hostName} found reporting to ELK</pre><h4>Cause</h4><p>The
    expression in the <strong>Expression for Host/Container name</strong> field is
    incorrect. Typically, this occurs when the wrong hostName label is selected to
    create the expression in the <strong>Expression for Host/Container name</strong>
    field.</p><h4>Solution</h4><p>Following the steps in <a href="#verify_with_elk">Verify
    with ELK</a> again to select the correct expression. Ensure that the <strong>name</strong>
    label selected is under the <strong>host</strong> section of the JSON.</p><p></p><figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/xpftsz2cte/1535665500582/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><h3>SocketTimeoutException</h3><p>When
    you add an ELK verification provider and click SUBMIT, you might see the following
    error.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/xpftsz2cte/1536255539619/image.png"/></figure><h4>Cause</h4><p>The
    Harness delegate does not have a valid connection to the ELK server.</p><h4>Solution</h4><p>On
    the same server or instance where the Harness delegate is running, run one of
    the following cURL commands to verify whether the delegate can connect to the
    ELK server.</p><p>If you do not have a username and password for the ELK server:</p><pre>curl
    -i -X POST url/*/_search?size=1 -H &#39;Content-Type: application/json&#39; -d
    &#39;{&#34;size&#34;:1,&#34;query&#34;:{&#34;match_all&#34;:{}},&#34;sort&#34;:{&#34;@timestamp&#34;:&#34;desc&#34;}}&#39;</pre><p>If
    you have username and password then use this command:</p><pre>curl -i -X POST
    url/*/_search?size=1 -H &#39;Content-Type: application/json&#39; -H &#39;Authorization:
    &lt;Basic: Base64 encoded <em>username:password</em>&gt;&#39;-d &#39;{&#34;size&#34;:1,&#34;query&#34;:{&#34;match_all&#34;:{}},&#34;sort&#34;:{&#34;@timestamp&#34;:&#34;desc&#34;}}&#39;</pre><p>If
    you have token-based authentication, use this command:</p><pre>curl -i -X POST
    url/*/_search?size=1 -H &#39;Content-Type: application/json&#39; -H &#39;tokenKey:
    <em>tokenValue</em>&#39;-d &#39;{&#34;size&#34;:1,&#34;query&#34;:{&#34;match_all&#34;:{}},&#34;sort&#34;:{&#34;@timestamp&#34;:&#34;desc&#34;}}&#39;</pre><p>If
    the cURL command cannot connect, it will fail.</p><p>If the cURL command can connect,
    it will return a HTTP 200, along with the JSON.</p><p>If the cURL command is successful,
    but you still see the SocketTimeoutException error in the ELK dialog, contact
    Harness Support (<a href="mailto:support@harness.io">support@harness.io</a>).</p><div
    class="note-callout">It is possible that the response from the ELK server is just
    taking very long.</div><h3>Log Errors Due To Missing Fields</h3><p>While trying
    to set up a simple query for ELK deployment verification, an error message occurs
    about a missing field and the workflow fails.</p><h4>Cause</h4><p>The fields specified
    in the query can be present only in a subset of the documents. </p><h4>Solution</h4><p>Make
    sure that the field exists in the document that is being examined in ELK and then
    filter the value of the field.</p><p>For example, if you want to fetch only documents
    where the message field contains the term exception and the ELK index contains
    documents that could either contain the message field or not contain it. In such
    a case, a query with conditions as implemented here is recommended.</p><pre class="hljs
    json"><br/>{ <br/>    &#34;bool&#34;:{ <br/>        &#34;must&#34;:[ <br/>            {
    <br/>                &#34;exists&#34;:{ <br/>                    &#34;field&#34;:&#34;message&#34;
    <br/>                      } <br/>            }, <br/>            { <br/>                &#34;regexp&#34;:{<br/>                    &#34;message&#34;:{
    <br/>                        &#34;value&#34;:&#34;exception&#34; <br/>                    }
    <br/>                  } <br/>            } <br/>           ] <br/>      } <br/>}<br/></pre><p></p><h3>Next
    Steps</h3><ul><li><a href="/article/htvzryeqjw-configuration-as-code">Configuration
    as Code</a></li><li><a href="/article/ven0bvulsj-users-and-permissions">Managing
    Users and Groups (RBAC)</a></li></ul><p></p><p></p>'
  slug: 4-troubleshooting-elasticsearch
  tags:
  - Elasticsearch
  - ELK
  - Elastic Stack
  - Elastic
  - ELK_CONFIGURATION_ERROR
  - No node with name ${hostName} found reporting to ELK
  - SocketTimeoutException
  is_live: true
