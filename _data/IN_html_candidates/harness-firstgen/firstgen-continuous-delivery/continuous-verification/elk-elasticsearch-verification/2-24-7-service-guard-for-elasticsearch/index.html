<p></p><p>Harness 24/7 Service Guard monitors your live applications, catching problems that surface minutes or hours following deployment. For more information, see <a href="/article/dajt54pyxd-24-7-service-guard-overview">24/7 Service Guard Overview</a>.</p><p>You can add your Elasticsearch monitoring to Harness 24/7 Service Guard in your Harness Application Environment. For a setup overview, see <a href="/article/dagmgqw5ag-1-elasticsearch-connection-setup">Connect to Elasticsearch</a>.</p><div class="note-callout">This section assumes you have set up a Harness Application, containing a Service and Environment. For steps on setting up a Harness Application, see <a href="/article/bucothemly-application-configuration">Application Components</a>.</div><p>In this topic:</p><ul><li><a href="#before_you_begin">Before You Begin</a></li><li><a href="#visual_summary">Visual Summary</a></li><li><a href="#step_1_set_up_24_7_service_guard_for_elasticsearch">Step 1: Set Up 24/7 Service Guard for Elasticsearch</a></li><li><a href="#step_2_display_name">Step 2: Display Name</a></li><li><a href="#step_3_service">Step 3: Service</a></li><li><a href="#step_4_elk_server">Step 4: ELK Server</a></li><li><a href="#step_5_search_keywords">Step 5: Search Keywords</a></li><li><a href="#step_6_index">Step 6: Index</a></li><li><a href="#step_7_host_name_field">Step 7: Host Name Field</a></li><li><a href="#step_8_message_field">Step 8: Message Field</a></li><li><a href="#step_9_timestamp_field">Step 9: Timestamp Field</a></li><li><a href="#step_10_timestamp_format">Step 10: Timestamp Format</a></li><li><a href="#step_11_enable_24_7_service_guard">Step 11: Enable 24/7 Service Guard</a></li><li><a href="#step_12_baseline">Step 12: Baseline</a></li><li><a href="#step_13_verify_your_settings">Step 13: Verify Your Settings</a></li><li><a href="#next_steps">Next Steps</a></li></ul><p></p><h3>Before You Begin</h3><ul><li>See the <a href="/article/qdajtgsqfj-elasticsearch-verification-overview">Elasticsearch Verification Overview</a>.</li></ul><p></p><h3>Visual Summary</h3><p>Here&#39;s an example 24/7 Service Guard setup for Elasticsearch.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/utqrns129r/1589455698242/elk-s.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><p></p><h3>Step 1: Set Up 24/7 Service Guard for Elasticsearch</h3><p>To set up 24/7 Service Guard for Elasticsearch, do the following:</p><ol><li>Ensure that you have added ELK Elasticsearch as a Harness Verification Provider, as described in <a href="#verification_provider_setup">Verification Provider Setup</a>.</li><li>In your Harness Application, ensure that you have added a Service, as described in <a href="/article/eb3kfl8uls-service-configuration">Services</a>. For 24/7 Service Guard, you do not need to add an Artifact Source to the Service, or configure its settings. You simply need to create a Service and name it. It will represent your application for 24/7 Service Guard.</li><li>In your Harness Application, click <strong>Environments</strong>.</li><li>In <strong>Environments</strong>, ensure that you have added an Environment for the Service you added. For steps on adding an Environment, see <a href="/article/n39w05njjv-environment-configuration">Environments</a>.</li><li>Click the Environment for your running microservice. Typically, the <strong>Environment Type</strong> is <strong>Production</strong>.</li><li>In the <strong>Environment</strong> page, locate <strong>24/7 Service Guard</strong>.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/ps716zaurs/1553127693787/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li><li>In <strong>24/7 Service Guard</strong>, click <strong>Add Service Verification</strong>, and then click <strong>ELK</strong>. The <strong>ELK</strong> dialog appears.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/564doloeuq/1580429709393/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li><li>Fill out the dialog. The dialog has the following fields.</li></ol><div class="note-callout">For 24/7 Service Guard, the queries you define to collect logs are specific to the application or service you want monitored. Verification is application/service level. This is unlike Workflows, where verification is performed at the host/node/pod level.</div><p></p><h3>Step 2: Display Name</h3><p>The name that will identify this service on the <strong>Continuous Verification</strong> dashboard. Use a name that indicates the environment and monitoring tool, such as <strong>ELK</strong>.</p><h3>Step 3: Service</h3><p>The Harness Service to monitor with 24/7 Service Guard.</p><h3>Step 4: ELK Server</h3><p>Select the ELK Verification Provider to use.</p><h3>Step 5: Search Keywords</h3><p>Enter search keywords for your query, such as <strong>error</strong> or <strong>exception</strong>.</p><div class="note-callout">Do not use wildcards in queries with Elasticsearch. ElasticSearch documentation indicates that wildcard queries can become very expensive and take down the cluster.</div><h3>Step 6: Index</h3><p> Enter the the index to search. This field is automatically populated from the index templates, if available.</p><p></p><figure><a href="https://files.helpdocs.io/kw8ldg1itf/articles/xpftsz2cte/1552686253871/image.png"><img src="https://files.helpdocs.io/kw8ldg1itf/articles/xpftsz2cte/1552686253871/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></a></figure><h3>Step 7: Host Name Field</h3><p>Enter the field name used in the ELK logs that refers to the host/pod/container ELK is monitoring.</p><h3>Step 8: Message Field</h3><p>Enter the field by which the messages are usually indexed. Typically, a log field.</p><p>To find the field in <strong>Kibana</strong> and enter it in <strong>Harness</strong>, do the following:</p><ol><li>In Kibana, click <strong>Discover</strong>.</li><li>In the search field, search for <strong>error or exception</strong>.</li><li>In the results, locate a log for the host/container/pod ELK is monitoring. For example, in the following Kubernetes results in Kibana, the messages are indexed under the <strong>log</strong> field.</li><li>In <strong>Harness</strong>, in the <strong>ELK</strong> dialog, next to <strong>Message Field</strong>, click <strong>Guide From Example</strong>. The <strong>Message Field</strong> popover appears.</li><li>In the JSON response, click on the name of the label that maps to the log in your Kibana results. Using our Kubernetes example, you would click the <strong>log</strong> label.<br/><br/>The label is added to the <strong>Message Field</strong>.</li></ol><h3>Step 9: Timestamp Field</h3><p>Enter the timestamp field in the Elasticsearch record, such as <strong>@timestamp</strong>.</p><h3>Step 10: Timestamp Format</h3><p>Enter the format for the timestamp field in the Elasticsearch record. Use Kibana to determine the format.</p><p>In <strong>Kibana</strong>, use the <strong>Filter</strong> feature in <strong>Discover</strong> to construct your timestamp range:</p><p></p><figure><a href="https://files.helpdocs.io/kw8ldg1itf/articles/xpftsz2cte/1552686474922/image.png"><img src="https://files.helpdocs.io/kw8ldg1itf/articles/xpftsz2cte/1552686474922/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></a></figure><p>Format Examples:</p><p><strong>Timestamp:</strong> 2018-08-24T21:40:20.123Z. <strong>Format:</strong> yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSSX</p><p><strong>Timestamp:</strong> 2018-08-30T21:57:23+00:00. <strong>Format:</strong> yyyy-MM-dd&#39;T&#39;HH:mm:ss.SSSXXX</p><p>For more information, see  <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.x/common-options.html#date-math" target="_blank">Data Math</a> from Elastic.</p><h3>Step 11: Enable 24/7 Service Guard</h3><p>Click the checkbox to enable 24/7 Service Guard.</p><h3>Step 12: Baseline</h3><p>Select the baseline time unit for monitoring. For example, if you select <strong>For 4 hours</strong>, Harness will collect the logs for the last 4 hours as the baseline for comparisons with future logs. If you select <strong>Custom Range</strong> you can enter a <strong>Start Time</strong> and <strong>End Time</strong>.</p><h3>Step 13: Verify Your Settings</h3><ol><li style="counter-increment:li 0" start="1">Click <strong>Test</strong>. Harness verifies the settings you entered.</li><li>Click <strong>Submit</strong>. The ELK 24/7 Service Guard is configured.</li></ol><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/xpftsz2cte/1552687135390/image.png"/></figure><p>To see the running 24/7 Service Guard analysis, click <strong>Continuous Verification</strong>.</p><p>The 24/7 Service Guard dashboard displays the production verification results.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/xpftsz2cte/1552692695915/image.png"/></figure><p> For more information, see <a href="/article/dajt54pyxd-24-7-service-guard-overview">24/7 Service Guard Overview</a>.</p><p></p><h3>Next Steps</h3><ul><li><a href="/article/e2eghvcyas-3-verify-deployments-with-elasticsearch">Verify Deployments with Elasticsearch</a></li></ul><p></p>