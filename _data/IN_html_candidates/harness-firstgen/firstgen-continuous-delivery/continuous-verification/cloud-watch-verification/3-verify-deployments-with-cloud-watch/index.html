<p>The following procedure describes how to add CloudWatch as a verification step in a Harness workflow. For more information about workflows, see <a href="/article/m220i1tnia-workflow-configuration">Add a Workflow</a>.</p><p>Once you run a deployment and CloudWatch preforms verification, Harness&#39; machine-learning verification analysis will assess the risk level of the deployment.</p><div class="tip-callout">In order to obtain the names of the host(s), pod(s), or container(s) where your service is deployed, the verification provider should be added to your workflow <strong>after</strong> you have run at least one successful deployment.</div><div class="note-callout">You cannot configure CloudWatch Deployment Verification for AWS ALB and AWS EKS.</div><div class="hd--md" data-hd-markdown="&lt;span id=&#34;visual_summary&#34;&gt;&lt;/span&gt;"><p><span id="visual_summary"></span></p>
</div><h3>In this topic:</h3><ul><li> <a href="#before_you_begin">Before You Begin</a></li><li> <a href="#visual_summary">Visual Summary</a></li><li> <a href="#setup_verification">Step 1: Set up the Deployment Verification</a></li><li> <a href="#cloudwatch_server">Step 2: CloudWatch Server</a></li><li> <a href="#region">Step 3: Region</a></li><li> <a href="#lambda">Step 4: Lambda</a></li><li> <a href="#ec2_metrics">Step 5: EC2 Metrics</a></li><li> <a href="#ecs_metrics">Step 6: ECS Metrics</a></li><li> <a href="#elb_metrics">Step 7: ELB Metrics</a></li><li> <a href="#load_balancers">Step 8: Load Balancers</a></li><li> <a href="#metrics_name">Step 9: Metrics Name</a></li><li> <a href="#expression_for_host/container_name">Step 10: Expression for Host/Container name</a></li><li> <a href="#analysis_time_duration">Step 11: Analysis Time Duration</a></li><li> <a href="#baseline_for_risk_analysis">Step 12: Baseline for Risk Analysis</a></li><li> <a href="#execute_with_previous_steps">Step 13: Execute with previous steps</a></li><li> <a href="#verify_configuration">Step 14: Verify Your Configuration</a></li><li> <a href="#view_results">Step 15: View Verification Results</a></li><li> <a href="#harness_expression_support_in_cv_settings">Harness Expression Support in CV Settings</a></li><li> <a href="#next_steps">Next Steps</a></li></ul><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;before_you_begin&#34;&gt;&lt;/span&gt;"><p><span id="before_you_begin"></span></p>
</div><p></p><h3>Before You Begin</h3><ul><li>Set up a Harness Application, containing a Service and Environment. See <a href="/article/bucothemly-application-configuration">Create an Application</a>.</li><li>See the <a href="/article/q6ti811nck-cloud-watch-verification-overview">CloudWatch Verification Overview</a>.</li></ul><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;visual_summary&#34;&gt;&lt;/span&gt;"><p><span id="visual_summary"></span></p>
</div><p></p><h3>Visual Summary</h3><p>Here&#39;s an example of a CloudWatch setup for verification.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/awerepjwlc/1580248428792/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;setup_verification&#34;&gt;&lt;/span&gt;"><p><span id="setup_verification"></span></p>
</div><p></p><h3>Step 1: Set up the Deployment Verification</h3><ol><li>Ensure that you have added AWS as a Cloud Provider, as described in <a href="/article/huoann4npq-cloud-watch-connection-setup">Connect to CloudWatch</a>.</li><li>In your Workflow, under <strong>Verify Service</strong>, click <strong>Add Step</strong>.</li><li>In the resulting <strong>Add Step</strong> settings, select <strong>Performance Monitoring</strong> &gt; <strong>CloudWatch</strong>.</li><li>Click <strong>Next</strong>. The <strong>Configure </strong><strong>CloudWatch</strong> settings appear.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/awerepjwlc/1580248428792/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li></ol><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;cloudwatch_server&#34;&gt;&lt;/span&gt;"><p><span id="cloudwatch_server"></span></p>
</div><p></p><h3>Step 2: CloudWatch Server</h3><p>Select the AWS Cloud Provider you set up in <a href="/article/huoann4npq-cloud-watch-connection-setup">Connect to CloudWatch</a>. You can also enter variable expressions, such as: <code>${serviceVariable.cloudwatch_connector_name}</code>.</p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;region&#34;&gt;&lt;/span&gt;"><p><span id="region"></span></p>
</div><p></p><h3>Step 3: Region</h3><p>Select the AWS region where the EC2 and/or ELB are located. You can also enter variable expressions, such as: <code>${env.name}</code>.</p><div class="note-callout">If the <strong>Cloudwatch Server</strong> field contains an expression, the <strong>Region</strong> field must also use an expression.</div><div class="hd--md" data-hd-markdown="&lt;span id=&#34;lambda&#34;&gt;&lt;/span&gt;"><p><span id="lambda"></span></p>
</div><p></p><h3>Step 4: Lambda</h3><p>Select this option for Harness to use the CloudWatch monitoring for the Lambda function(s) the Workflow is deploying.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/fnl9wjmd4c/1563408793664/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>You can select <strong>ELB Metrics</strong> (Load Balancers, Metric Names) but they are not required. For information on Lambda metrics, see <a href="https://docs.aws.amazon.com/lambda/latest/dg/monitoring-functions-metrics.html" target="_blank">AWS Lambda Metrics</a>.</p><p>The metrics are Invocations, Errors, Throttles, and Duration.</p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;ec2_metrics&#34;&gt;&lt;/span&gt;"><p><span id="ec2_metrics"></span></p>
</div><p></p><h3>Step 5: EC2 Metrics</h3><p>This drop-down menu contains the available EC2 metrics. Select the metrics to monitor. For more information, see <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/working_with_metrics.html" target="_blank">Using Amazon CloudWatch Metrics</a> from AWS.</p><p>You can see the available metrics in <strong>CloudWatch</strong>. Click <strong>Metrics</strong>, and then click <strong>All metrics</strong>.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/fnl9wjmd4c/1537307677378/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><div class="hd--md" data-hd-markdown="&lt;span id=&#34;ecs_metrics&#34;&gt;&lt;/span&gt;"><p><span id="ecs_metrics"></span></p>
</div><p></p><h3>Step 6: ECS Metrics</h3><p>Expand the <strong>ECS Metrics</strong> option and specify the <strong>Cluster</strong> and <strong>Metric Names</strong> for monitoring.</p><p>In your are performing a Canary analysis, ECS metrics measure historical data because there is no host.</p><p>See <a href="/article/0avzb5255b-cv-strategies-and-best-practices#canary_analysis">Canary Analysis</a>.</p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;elb_metrics&#34;&gt;&lt;/span&gt;"><p><span id="elb_metrics"></span></p>
</div><p></p><h3>Step 7: ELB Metrics</h3><p><strong>ELB Metrics</strong> are available for all of the CloudWatch types. Add each load balancer you want to monitor. For more information, see <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/elb-metricscollected.html" target="_blank">Elastic Load Balancing Metrics and Dimensions</a> from AWS.</p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;load_balancers&#34;&gt;&lt;/span&gt;"><p><span id="load_balancers"></span></p>
</div><p></p><h3>Step 8: Load Balancers</h3><p>Select the load balancer to monitor. The list of load balancers is populated according to the AWS cloud provider and region you selected. (Note: For CloudWatch analysis to appear, you must select a load balancer that provides at least 7 days of historical data for comparison.)</p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;metrics_name&#34;&gt;&lt;/span&gt;"><p><span id="metrics_name"></span></p>
</div><p></p><h3>Step 9: Metrics Name</h3><p>This drop-down menu contains the available ELB metrics. Select the metrics you want to monitor.</p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;expression_for_host/container_name&#34;&gt;&lt;/span&gt;"><p><span id="expression_for_host/container_name"></span></p>
</div><p></p><h3>Step 10: Expression for Host/Container name</h3><p>The expression entered here should resolve to a host/container name in your deployment environment. By default, the expression is <code>${instance.host.hostName}</code>. If you begin typing the expression into the field, the field provides expression assistance.</p><p></p><div class="note-callout">For AWS EC2 hostnames, use the expression <code>${instance.hostName</code>}.</div><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/ps716zaurs/1535566103105/image.png" style="max-height:40%;max-width:40%" data-hd-height="40%" data-hd-width="40%"/></figure><p>You can also click <strong>Guide from Example</strong> to select available hosts from a drop-down list and test them.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/awerepjwlc/1580249058050/image.png" style="max-height:75%;max-width:75%" data-hd-height="75%" data-hd-width="75%"/></figure><div class="hd--md" data-hd-markdown="&lt;span id=&#34;analysis_time_duration&#34;&gt;&lt;/span&gt;"><p><span id="analysis_time_duration"></span></p>
</div><p></p><h3>Step 11: Analysis Time Duration</h3><p>Set the duration for the verification step. If a verification step exceeds the value, the workflow <a href="/article/m220i1tnia-workflow-configuration#failure_strategy">Failure Strategy</a> is triggered. For example, if the Failure Strategy is <strong>Ignore</strong>, then the verification state is marked <strong>Failed</strong> but the workflow execution continues.</p><p>See  <a href="https://docs.harness.io/article/0avzb5255b-cv-strategies-and-best-practices#algorithm_sensitivity_and_failure_criteria">CV Strategies, Tuning, and Best Practices</a>.</p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;baseline_for_risk_analysis&#34;&gt;&lt;/span&gt;"><p><span id="baseline_for_risk_analysis"></span></p>
</div><p></p><h3>Step 12: Baseline for Risk Analysis</h3><p>See  <a href="https://docs.harness.io/article/0avzb5255b-cv-strategies-and-best-practices">CV Strategies, Tuning, and Best Practices</a>.</p><p>In your are performing a Canary analysis, ECS metrics measure historical data because there is no host.</p><p>See <a href="/article/0avzb5255b-cv-strategies-and-best-practices#canary_analysis">Canary Analysis</a>.</p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;execute_with_previous_steps&#34;&gt;&lt;/span&gt;"><p><span id="execute_with_previous_steps"></span></p>
</div><p></p><h3>Step 13: Execute with previous steps</h3><p>Check this checkbox to run this verification step in parallel with the previous steps in <strong>Verify Service</strong>.</p><p>Here is an example of a completed CloudWatch verification step.</p><p></p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/awerepjwlc/1580264530537/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;verify_configuration&#34;&gt;&lt;/span&gt;"><p><span id="verify_configuration"></span></p>
</div><p></p><h3>Step 14: Verify Your Configuration</h3><p>When you are finished, click <strong>Test</strong> to verify your configuration. Once the test succeeds, click <strong>Submit</strong>. This adds the CloudWatch verification step to your Workflow.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/fnl9wjmd4c/1537308084703/image.png" style="max-height:20%;max-width:20%" data-hd-height="20%" data-hd-width="20%"/></figure><p></p><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;view_results&#34;&gt;&lt;/span&gt;"><p><span id="view_results"></span></p>
</div><p></p><h3>Step 15: View Verification Results</h3><p>Once you have deployed your workflow (or pipeline) using the CloudWatch verification step, you can automatically verify cloud application and infrastructure performance across your deployment. For more information, see <a href="/article/m220i1tnia-workflow-configuration">Add a Workflow</a> and <a href="/article/zc1u96u6uj-pipeline-configuration">Add a Pipeline</a>.</p><h5>Workflow Verification</h5><p>To see the results of Harness machine-learning evaluation of your CloudWatch verification, in your Workflow or Pipeline deployment you can expand the <strong>Verify Service</strong> step and then click the <strong>CloudWatch</strong> step.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/awerepjwlc/1574709136929/image.png"/></figure><h5>Continuous Verification</h5><p>You can also see the evaluation in the <strong>Continuous Verification</strong> dashboard. The workflow verification view is for the DevOps user who developed the workflow. The <strong>Continuous Verification</strong> dashboard is where all future deployments are displayed for developers and others interested in deployment analysis.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/awerepjwlc/1574709454699/image.png"/></figure><p>Clicking a deployment instance open the deployment details in the <strong>Deployments</strong> page.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/awerepjwlc/1574709526619/image.png"/></figure><p>To learn about the verification analysis features, see the following sections.</p><h5>Deployments</h5><p>Harness supports Metrics from CloudWatch for Lambda, EC2, ECS, and ELB.</p><table><tbody><tr><td><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/awerepjwlc/1574709611172/image.png"/></figure></td><td><p><strong>Deployment info -</strong> See the verification analysis for each deployment, with information on its service, environment, pipeline, and workflows.</p><p><strong>Verification phases and providers -</strong> See the verification phases for each verification provider. Click each provider for logs and analysis.</p><p><strong>Verification timeline -</strong> See when each deployment and verification was performed.</p></td></tr></tbody></table><h5>Web Transaction Analysis</h5><table><tbody><tr><td><p><strong>Execution details -</strong> See the details of verification execution. Total is the total time the verification step took, and Analysis duration is how long the analysis took.</p><p><strong>Risk level analysis -</strong> Get an overall risk level and view the cluster chart to see events.</p><p><strong>Web</strong> <strong>Transaction-level summary -</strong> See a summary of each transaction with the query string, error values comparison, and a risk analysis summary.</p></td><td><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/awerepjwlc/1574709560205/image.png"/></figure></td></tr></tbody></table><div class="hd--md" data-hd-markdown="&lt;span id=&#34;next_steps&#34;&gt;&lt;/span&gt;"><p><span id="next_steps"></span></p>
</div><p></p><p></p><h3>Harness Expression Support in CV Settings</h3><p>You can use expressions (<code>${...}</code>) for <a href="/article/7bpdtvhq92-workflow-variables-expressions">Harness built-in variables</a> and custom <a href="/article/eb3kfl8uls-service-configuration">Service</a> and <a href="/article/766iheu1bk-add-workflow-variables-new-template">Workflow</a> variables in the settings of Harness Verification Providers.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1586812006289/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Expression support lets you template your Workflow verification steps. You can add custom expressions for settings, and then provide values for those settings at deployment runtime. Or you can use Harness built-in variable expressions and Harness will provide values at deployment runtime automatically.</p><h3>Next Steps</h3><ul><li><a href="https://docs.harness.io/article/0avzb5255b-cv-strategies-and-best-practices">CV Strategies, Tuning, and Best Practices</a>.</li></ul><p></p>