type: article
article_id: ehezyvz163
user_id: mfr0nxh4be
category_id: bpoqe48x7r
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Verify Deployments with AppDynamics
slug: 3-verify-deployments-with-app-dynamics
description: Covers how to set up AppDynamics in a Harness Workflow, how to "templatize"
  settings to enable runtime or Trigger input, and how to interpret verification results.
short_version: Harness can analyze AppDynamics data to verify, rollback, and improve
  deployments.
tags:
- AppDynamics
- Verification Provider
- Workflow
- APM
- application performance monitoring
- risk analysis
- template
- templatize
- environment variable
- Workflow variable
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: Article updated
  source: API
  triggered_at: 2021-05-12T17:22:47.006354Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Verify Deployments with AppDynamics
  description: Covers how to set up AppDynamics in a Harness Workflow, how to "templatize"
    settings to enable runtime or Trigger input, and how to interpret verification
    results.
  short_version: Harness can analyze AppDynamics data to verify, rollback, and improve
    deployments.
  body: |-
    <p>Harness can analyze AppDynamics data to verify, rollback, and improve your deployments. To enable this analysis, you must configure AppDynamics as a verification step in a Harness Workflow. This topic covers:</p><ul><li><a href="#before_you_begin">Before You Begin</a></li><li><a href="#limitations">Limitations</a></li><li><a href="#add_step">Step 1: Add Verification Step</a></li><li><a href="#appdynamics_server">Step 2: AppDynamics Server</a></li><li><a href="#application_name">Step 3: Application Name</a></li><li><a href="#tier_name">Step 4: Tier Name</a></li><li><a href="#host_name">Step 5: Expression for Host/Container Name</a></li><li><a href="#time_duration">Step 6: Analysis Time Duration</a></li><li><a href="#baseline">Step 7: Baseline for Risk Analysis</a></li><li><a href="#sensitivity">Step 8: Algorithm Sensitivity</a></li><li><a href="#previous_phases">Step 9: Include Instances from Previous Phases</a></li><li><a href="#execute_previous">Step 10: Execute with Previous Steps</a></li><li><a href="#test_save">Step 11: Test and Save</a></li><li><a href="#view_results">Step 12: View Verification Results</a></li><li><a href="#harness_expression_support_in_cv_settings">Harness Expression Support in CV Settings</a></li><li><a href="https://docs.harness.io/article/ehezyvz163-3-verify-deployments-with-app-dynamics#next_steps">Next Steps</a></li></ul><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;before_you_begin&#34;&gt;&lt;/span&gt;"><p><span id="before_you_begin"></span></p>
    </div><h3>Before You Begin</h3><ul><li>Add AppDynamics as a Harness <a href="/article/cqy0jmm71h-1-app-dynamics-connection-setup">Verification Provider</a>.</li></ul><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;limitations&#34;&gt;&lt;/span&gt;"><p><span id="limitations"></span></p>
    </div><h3>Limitations</h3><p>Add the AppDynamics Verification Provider to your Workflow only <em>after</em> you have run at least one successful Workflow deployment. This enables the AppDynamics integration to obtain the names of the host(s) or container(s) where your service is deployed.</p><p>See <a href="/article/9dvxcegm90-variables#limitations">general limitations</a> on the Harness variable expressions that are presented as options below.</p><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;add_step&#34;&gt;&lt;/span&gt;"><p><span id="add_step"></span></p>
    </div><h3>Step 1: Add Verification Step</h3><p>To add an AppDynamics verification step to your Workflow:</p><ol><li>In your Workflow, under <strong>Verify Service</strong>, click <strong>Add Verification</strong>.</li><li>In the resulting <strong>Add Step</strong> settings, select <strong>Performance Monitoring</strong> &gt; <strong>AppDynamics</strong>.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/ehezyvz163/1580242032434/image.png" style="max-height:75%;max-width:75%" data-hd-height="75%" data-hd-width="75%"/></figure></li><li>Click <strong>Next</strong>. The <strong>Configure</strong> <strong>AppDynamics</strong> settings appear, ready for you to configure in the steps below.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/vz9r5mneth/1582790601174/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure></li></ol><div class="hd--md" data-hd-markdown="&lt;span id=&#34;appdynamics_server&#34;&gt;&lt;/span&gt;"><p><span id="appdynamics_server"></span></p>
    </div><h3>Step 2: AppDynamics Server</h3><p>In the <strong>AppDynamics Server</strong> drop-down, select the server you added when you set up your <a href="/article/cqy0jmm71h-1-app-dynamics-connection-setup">AppDynamics Verification Provider</a>.</p><p>You can also enter variable expressions, such as: <code>${serviceVariable.appd_QA}</code>. Do not use hyphens (dashes) in variable expressions; also, see other <a href="https://docs.harness.io/article/9dvxcegm90-variables#limitations">limitations on Harness variables</a>.</p><div class="note-callout">If the <strong>AppDynamics Server</strong> field contains an expression, the <strong>Application Name</strong> and <strong>Tier Name</strong> fields must also use an expression. <a href="#templatize">Templatized</a> fields cannot take variable expressions, and cannot be edited. Using expressions or templatization will disable the <strong>Test</strong> button.</div><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;application_name&#34;&gt;&lt;/span&gt;"><p><span id="application_name"></span></p>
    </div><h3>Step 3: Application Name</h3><p>This field&#39;s drop-down list is populated with the applications available on the AppDynamcis server you selected. Select an application from the list. In <strong>AppDynamics</strong>, the applications are listed in the <strong>Applications</strong> tab.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/vz9r5mneth/1582699435004/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>You can also enter variable expressions, such as: <code>${app.name}</code>.</p><div class="note-callout">Do not use hyphens (dashes) in variable expressions. See other <a href="https://docs.harness.io/article/9dvxcegm90-variables#limitations">limitations on Harness variables</a>. If the <strong>AppDynamics Server</strong> field contains an expression, the <strong>Application Name</strong> and <strong>Tier Name</strong> fields must also use an expression. <a href="#templatize">Templatized</a> fields cannot take variable expressions, and cannot be edited. Using expressions or templatization will disable the <strong>Test</strong> button.</div><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;tier_name&#34;&gt;&lt;/span&gt;"><p><span id="tier_name"></span></p>
    </div><h3>Step 4: Tier Name</h3><p>The field&#39;s drop-down list is populated with tiers from the AppDynamics application you selected. Pick the tier from which you want usage metrics, code exceptions, error conditions, and exit calls. In <strong>AppDynamics</strong>, the tiers are displayed in the <strong>Tiers &amp; Nodes</strong> page.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/vz9r5mneth/1582700045337/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>You can also enter variable expressions, such as: <code>${service.name}</code>.</p><div class="note-callout">Do not use hyphens (dashes) in variable expressions. See other <a href="https://docs.harness.io/article/9dvxcegm90-variables#limitations">limitations on Harness variables</a>. If the <strong>Application Name</strong> field contains an expression, the <strong>Tier Name</strong> field must also use an expression. <a href="#templatize">Templatized</a> fields cannot take variable expressions, and cannot be edited. Using expressions or templatization will disable the <strong>Test</strong> button.</div><p>For PCF deployments, application tiers will match tier information from the <a href="/article/3ekpbmpr4e-adding-and-editing-inline-pcf-manifest-files">application manifest file</a>.</p><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;host_name&#34;&gt;&lt;/span&gt;"><p><span id="host_name"></span></p>
    </div><h3>Step 5: Expression for Host/Container Name</h3><p>Any expression that you enter in this field should resolve to a host/container name in your deployment environment. By default, the expression is <code>${instance.host.hostName}</code>.</p><div class="tip-callout">For most use cases, you can leave this field empty, to apply the default. However, if you want to add a prefix or suffix, enter an expression as outlined here.</div><p>If you begin typing an expression into the field, the field provides expression assistance.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/ps716zaurs/1535566103105/image.png" style="max-height:30%;max-width:30%" data-hd-height="30%" data-hd-width="30%"/></figure><p></p><div class="note-callout">For AWS EC2 hostnames, use the expression <code>${instance.hostName</code>}.</div><h4>Do Not Use Reuse Node Name</h4><p>When the AppDynamics <a href="https://docs.appdynamics.com/display/PRO45/Java+Agent+Configuration+Properties#JavaAgentConfigurationProperties-reusenodenameReuseNodeName" target="_blank">Reuse Node Name property</a> is set to true, it reuses node names in AppDynamics. As a result, you don&#39;t need to supply a node name, but you do need to provide a node name prefix using -Dappdynamics.agent.reuse.nodeName.prefix.</p><p>For verifying Harness deployments, we suggest you refrain the Reuse Node Name property unless it is absolutely needed. This property made sense in the past, but with Kubernetes and Docker deployments Harness always uses a unique identifier for the pod/node and that is sufficient.</p><p>On AppDynamics, the node retention settings of these nodes can be adjusted to delete older instances.</p><h4>Find Node Names in AppDynamics</h4><div class="note-callout">Harness does not support AppDynamics dynamic, or reuse, node names.</div><p>To find the node names in <strong>AppDynamics</strong>, do the following:</p><ol><li>Click <strong>Applications</strong>.</li><li>Click the name of your application.</li><li>Click <strong>Application Dashboard</strong>, and then click <strong>Dashboard</strong>.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/ps716zaurs/1535565741109/image.png" style="max-height:60%;max-width:60%" data-hd-height="60%" data-hd-width="60%"/></figure></li><li>Change your display to <strong>Application Flow Map</strong>.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/ps716zaurs/1535565846973/image.png" style="max-height:30%;max-width:30%" data-hd-height="30%" data-hd-width="30%"/></figure></li><li>Click a node in your Application Flow Map to display its details.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/ps716zaurs/1535565895718/image.png" style="max-height:60%;max-width:60%" data-hd-height="60%" data-hd-width="60%"/></figure></li><li>In the details, click the <strong>Nodes</strong> tab.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/ps716zaurs/1535565958816/image.png" style="max-height:60%;max-width:60%" data-hd-height="60%" data-hd-width="60%"/></figure></li></ol><h4>Expression for AWS EC2 Tags</h4><p>In some cases, hosts are provisioned using a dynamic naming format uses prefixes/suffixes or some other convention that makes it difficult to identify them consistently.</p><p>In these cases, tagging hosts and using EC2 tag names to identify them can be a successful workaround.</p><p>You can the Harness expression <code>${aws.tags.find(host.ec2Instance.tags, &#39;[tag_name]&#39;)}</code> to locate the hosts by EC2 tag name.</p><p>For example, <code>${aws.tags.find(host.ec2Instance.tags, &#39;Project&#39;)}</code>:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/ehezyvz163/1619819442877/image.png"/></figure><p></p><h4>Expressions for Tanzu Application Service (formerly PCF) Hosts</h4><p>You can use expressions for some CF <a href="https://docs.cloudfoundry.org/devguide/deploy-apps/environment-variable.html#view-env" target="_blank">Environment variables</a>. For example, you might enter an expression like:</p><pre class="hljs nohighlight">${host.pcfElement.displayName}_${host.pcfElement.instanceIndex}</pre><p>...which could yield something like: <code>harness_example-1</code>, where the <code>displayName</code> is <code>harness-example</code> and <code>instanceIndex</code> is <code>1</code>.</p><p></p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/vz9r5mneth/1582875535196/image.png" style="max-height:75%;max-width:75%" data-hd-height="75%" data-hd-width="75%"/></figure><p></p><p>See <a href="/article/ojd73hseby-pcf-built-in-variables">PCF Built-in Variables</a>.</p><div class="note-callout">When you are setting up the Workflow for the first time, Harness will <em>not</em> be able to help you create an expression, because there has not been a host/container deployed yet. This is another reason why Harness recommends adding the <strong>Verify Step</strong> <em>after</em> you have done one successful deployment.</div><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;time_duration&#34;&gt;&lt;/span&gt;"><p><span id="time_duration"></span></p>
    </div><h3>Step 6: Analysis Time Duration</h3><p>Use the <strong>Analysis Time Duration</strong> field to set the duration for the verification step. If a verification step exceeds the value, the Workflow&#39;s <a href="/article/m220i1tnia-workflow-configuration#failure_strategy">Failure Strategy</a> is triggered.</p><p>For example, if the Failure Strategy is <strong>Ignore</strong>, then the verification state is marked <strong>Failed</strong>, but the Workflow execution continues. For details, see <a href="/article/0avzb5255b-cv-strategies-and-best-practices">CV Strategies, Tuning, and Best Practices</a>.</p><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;baseline&#34;&gt;&lt;/span&gt;"><p><span id="baseline"></span></p>
    </div><h3>Step 7: Baseline for Risk Analysis</h3><p>To select among the options available on this drop-down list, <a href="/article/0avzb5255b-cv-strategies-and-best-practices">CV Strategies, Tuning, and Best Practices</a>.</p><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;sensitivity&#34;&gt;&lt;/span&gt;"><p><span id="sensitivity"></span></p>
    </div><h3>Step 8: Algorithm Sensitivity</h3><p>Use this drop-down list to specify the sensitivity of the failure criteria. When the criteria are met, the Workflow&#39;s <strong>Failure Strategy</strong> is triggered. For details about the options, see <a href="/article/0avzb5255b-cv-strategies-and-best-practices">CV Strategies, Tuning, and Best Practices</a>.</p><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;previous_phases&#34;&gt;&lt;/span&gt;"><p><span id="previous_phases"></span></p>
    </div><h3>Step 9: Include Instances from Previous Phases</h3><p>If you are using this verification step in a multi-phase deployment, select this checkbox to include instances used in previous phases when collecting data.</p><div class="note-callout">Do not apply this setting to the first phase in a multi-phase deployment.</div><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;execute_previous&#34;&gt;&lt;/span&gt;"><p><span id="execute_previous"></span></p>
    </div><h3>Step 10: Execute with Previous Steps</h3><p>Select this checkbox to run this verification step in parallel with the previous steps in the Workflow&#39;s <strong>Verify Service</strong>.</p><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;test_save&#34;&gt;&lt;/span&gt;"><p><span id="test_save"></span></p>
    </div><h3>Step 11: Test and Save</h3><p>To finish configuring this AppDynamics verification step:</p><ol><li style="counter-increment:li 0" start="1">Click <strong>Test</strong>. Harness verifies the settings you entered.</li><li>When testing is successful, click <strong>Submit</strong>. This AppDynamics verification step is now configured.</li></ol><div class="tip-callout">The <strong>Test</strong> button will be disabled if any of the <strong>AppDynamics Server</strong>, <strong>Application Name</strong>, and/or <strong>Tier Name</strong> fields contain <a href="/article/yyi1c69jeq-templatize-app-dynamics-verification">templatized values</a> or variable expressions. This is because Harness can&#39;t test the abstract values. As a workaround, you can fill these fields with static values from their drop-down lists, then click <strong>Test</strong> to verify all the static values, and then swap in your intended variable expressions before clicking <strong>Submit</strong>.</div><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;view_results&#34;&gt;&lt;/span&gt;"><p><span id="view_results"></span></p>
    </div><h3>Step 12: View Verification Results</h3><p>Once you have executed the Workflow, Harness performs the verification you configured and displays the results in the <strong>Deployments</strong> and <strong>Continuous Verification</strong> pages. Verification is executed in real time, quantifying the business impact of every production deployment.</p><p>For a quick overview of the verification UI elements, see <a href="/article/xldc13iv1y-meet-harness#continuous_verification_tools">Continuous Verification Tools</a>. For details about viewing and interpreting verification results, see <a href="/article/2la30ysdz7-deployment-verification-results">Verification Results Overview</a>.</p><p></p><h3>Harness Expression Support in CV Settings</h3><p>You can use expressions (<code>${...}</code>) for <a href="/article/7bpdtvhq92-workflow-variables-expressions">Harness built-in variables</a> and custom <a href="/article/eb3kfl8uls-service-configuration">Service</a> and <a href="/article/766iheu1bk-add-workflow-variables-new-template">Workflow</a> variables in the settings of Harness Verification Providers.</p><p>Here is an example using Dynatrace, but it applies to all providers.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/other/1586812006289/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Expression support lets you template your Workflow verification steps. You can add custom expressions for settings, and then provide values for those settings at deployment runtime. Or you can use Harness built-in variable expressions and Harness will provide values at deployment runtime automatically.</p><p></p><div class="hd--md" data-hd-markdown="&lt;span id=&#34;next_steps&#34;&gt;&lt;/span&gt;"><p><span id="next_steps"></span></p>
    </div><h3>Next Steps</h3><ul><li><a href="/article/yyi1c69jeq-templatize-app-dynamics-verification">Templatize AppDynamics Verification</a></li><li><a href="/article/e1qar9w373-app-dynamics-environment-variables">Set AppDynamics Environment Variables</a></li><li><a href="/article/w7tcb2frp9-connect-to-app-dynamics-as-a-custom-apm">AppDynamics as a Custom APM</a></li></ul><p></p>
  slug: 3-verify-deployments-with-app-dynamics
  tags:
  - AppDynamics
  - Verification Provider
  - Workflow
  - APM
  - application performance monitoring
  - risk analysis
  - template
  - templatize
  - environment variable
  - Workflow variable
  is_live: true
