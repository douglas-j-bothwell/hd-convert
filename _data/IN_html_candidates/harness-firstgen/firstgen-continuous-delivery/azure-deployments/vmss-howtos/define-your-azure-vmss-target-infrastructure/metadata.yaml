type: article
article_id: 2976rmk4kd
user_id: mfr0nxh4be
category_id: 4o8zim2tfr
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Define Your Azure VMSS Target Infrastructure
slug: define-your-azure-vmss-target-infrastructure
description: Currently, this feature is behind the Feature Flag AZURE_VMSS. Contact
  Harness Support to enable the feature.. The target infrastructure for an Azure virtual
  machine scale set (VMSS) deployment is a…
short_version: Currently, this feature is behind the Feature Flag AZURE_VMSS. Contact
  Harness Support to enable the feature.. The target infrastructure for an Azure virtual
  machine scale set (VMSS) deployment is a…
tags: []
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: Article updated
  source: API
  triggered_at: 2021-11-15T22:35:55.681336Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Define Your Azure VMSS Target Infrastructure
  description: ""
  short_version: ""
  body: '<p></p><div class="note-callout">Currently, this feature is behind the Feature
    Flag <code>AZURE_VMSS</code>. Contact <a href="https://mail.google.com/mail/?view=cm&amp;fs=1&amp;tf=1&amp;to=support@harness.io"
    target="_blank">Harness Support</a> to enable the feature. </div><p></p><p>The
    target infrastructure for an Azure virtual machine scale set (VMSS) deployment
    is a base VMSS template you select in the Harness Infrastructure Definition.</p><p>During
    deployment, this template is used along with the image definition you selected
    in <a href="/article/c43hmoj6ic-add-your-azure-vm-image-for-deployment">Add Your
    Azure VM Image for Deployment</a> to create a new VMSS.</p><p>You select the VMSS
    to use as a template and provide the username and password/key to connect to the
    new VMs.</p><p>Once you have set up the target infrastructure, you select it when
    you set up your Harness Workflow, described in <a href="/article/74htogyjad-create-an-azure-vmss-basic-deployment">Create
    an Azure VMSS Basic Deployment</a>, <a href="/article/ebq6gwgs5r-create-an-azure-vmss-canary-deployment">Create
    an Azure VMSS Canary Deployment</a>, and <a href="/article/9op1u6dgks-create-an-azure-vmss-blue-green-deployment">Create
    an Azure VMSS Blue/Green Deployment</a>.</p><p>.</p><p>In this topic:</p><ul><li>
    <a href="#before_you_begin">Before You Begin</a></li><li> <a href="#undefined">Supported
    Platforms and Technologies</a></li><li> <a href="#undefined">Step 1: Create an
    Environment</a></li><li> <a href="#step_2_create_an_infrastructure_definition">Step
    2: Create an Infrastructure Definition</a></li><li> <a href="#option_1_scope_to_specific_services">Option
    1: Scope to Specific Services</a></li><li> <a href="#next_steps">Next Steps</a></li><li>
    <a href="#configure_as_code">Configure As Code</a></li></ul><h3>Before You Begin</h3><ul><li>
    <a href="/article/1h0723zsvm-azure-virtual-machine-scale-set-deployments">Azure
    Virtual Machine Scale Set Deployments Overview</a></li><li> <a href="/article/c43hmoj6ic-add-your-azure-vm-image-for-deployment">Add
    Your Azure VM Image for Deployment</a></li><li><a href="/article/d5hob1zuip-connect-to-your-azure-vmss">Connect
    to Azure for VMSS Deployments</a></li><li> <a href="/article/h9tkwmkrm7-delegate-installation">Harness
    Delegate Overview</a></li><li> <a href="/article/4o7oqwih6h-harness-key-concepts">Harness
    Key Concepts</a></li></ul><h3 id="undefined">Supported Platforms and Technologies</h3><p>See
    <a href="/article/220d0ojx5y-supported-platforms">Supported Platforms and Technologies</a>.</p><h3
    id="undefined">Step 1: Create an Environment</h3><p>Environments represent one
    or more of your deployment infrastructures, such as Dev, QA, Stage, Production,
    etc. Use Environments to organize your target cluster Infrastructure Definitions.</p><ol><li>In
    your Harness Application, click <strong>Environments</strong>. The <strong>Environments</strong> page
    appears.</li><li>Click Add Environment. The <strong>Environment</strong> settings
    appear.</li><li>In <strong>Name</strong>, enter a name that describes this group
    of target clusters, such as QA, Stage, Prod, etc.</li><li>In <strong>Environment
    Type</strong>, select <strong>Non-Production</strong> or <strong>Production</strong>.</li><li>Click <strong>SUBMIT</strong>.
    The new <strong>Environment</strong> page appears.</li><li>Click  <strong>Add
    Infrastructure Definition</strong>. The following section provide information
    on setting up different Add Infrastructure Definitions for different target clusters.</li></ol><h3>Step
    2: Create an Infrastructure Definition</h3><ol><li>In your Environment, click
    Add Infrastructure Definition.</li><li>Enter the following settings.</li></ol><h4>Name</h4><p>Enter
    a name for the Infrastructure Definition. You will select this name when you set
    up the Infrastructure Definition in your Workflow.</p><h4>Cloud Provider Type</h4><p>Select
    <strong>Microsoft Azure</strong>.</p><h4>Deployment Type</h4><p>Select <strong>Azure
    Virtual Machine Scale Set</strong>.</p><h4>Cloud Provider</h4><p>Select the Azure
    Cloud Provider you set up in <a href="/article/d5hob1zuip-connect-to-your-azure-vmss">Connect
    to Your Azure VMSS</a>. The Cloud Provider is used to pull the Azure information
    you need to define the VMSS Harness will create.</p><h4>Subscription</h4><p>Select
    the subscription to use for the new VMSS.</p><h4>Resource Group</h4><p>Select
    the resource group to use for the new VMSS.</p><h4>Virtual Machine Scale Sets</h4><p>Select
    the base VMSS to use as a template when the Harness Workflow creates a new VMSS
    using the image definition you selected in <a href="/article/c43hmoj6ic-add-your-azure-vm-image-for-deployment">Add
    Your Azure VM Image for Deployment</a>.</p><h4>Username</h4><p>This is the username
    for connecting to the new VMs Harness will create. For example, connections over
    SSH or RDP. The <strong>Username</strong> setting is populated using the username
    taken from the base VMSS you selected. You can use the same username or replace
    it.</p><p>The username may contain letters, numbers, hyphens, and underscores.
    It may not start with a hyphen or number. Usernames must not include <a href="https://docs.microsoft.com/en-us/rest/api/compute/virtualmachines/createorupdate#osprofile"
    target="_blank">reserved words</a>. The value must be between 1 and 64 characters
    long (Linux) or 20 characters (Windows).</p><h4>Authentication Type</h4><p>Select
    <strong>Password</strong> or <strong>SSH Public Key</strong>.</p><p>For <strong>Password</strong>,
    enter the password for the new VMs Harness will create.</p><p>For <strong>SSH
    Public Key</strong>, select an SSH key that you have added to Harness. See <a
    href="/article/gsp4s7abgc-add-ssh-keys">Add SSH Keys</a>.</p><p>Creating the SSH
    key in Azure is covered in <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/linux/mac-create-ssh-keys"
    target="_blank">Quick steps: Create and use an SSH public-private key pair for
    Linux VMs in Azure</a> from Azure.</p><h3>Option 1: Scope to Specific Services</h3><p>The <strong>Scope
    to specific Services</strong> setting in the Infrastructure Definition enables
    you to scope this Infrastructure Definition to specific Harness Services.</p><p>See
    <a href="/article/v3l3wqovbe-infrastructure-definitions">Add an Infrastructure
    Definition</a>.</p><h3>Next Steps</h3><ul><li> <a href="/article/74htogyjad-create-an-azure-vmss-basic-deployment">Create
    an Azure VMSS Basic Deployment</a></li><li> <a href="/article/ebq6gwgs5r-create-an-azure-vmss-canary-deployment">Create
    an Azure VMSS Canary Deployment</a></li><li> <a href="/article/9op1u6dgks-create-an-azure-vmss-blue-green-deployment">Create
    an Azure VMSS Blue/Green Deployment</a></li></ul><h3>Configure As Code</h3><p>To
    see how to configure the settings in this topic using YAML, configure the settings
    in the UI first, and then click the YAML editor button (<span style="color:#fb9e00"
    data-hd-color="#fb9e00"><strong>&lt;/&gt;</strong></span>).</p>'
  slug: define-your-azure-vmss-target-infrastructure
  tags: []
  is_live: true
