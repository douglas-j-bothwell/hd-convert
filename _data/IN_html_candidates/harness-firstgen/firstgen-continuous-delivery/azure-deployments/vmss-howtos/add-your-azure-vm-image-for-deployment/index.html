<p></p><div class="note-callout">Currently, this feature is behind the Feature Flag <code>AZURE_VMSS</code>. Contact <a href="https://mail.google.com/mail/?view=cm&amp;fs=1&amp;tf=1&amp;to=support@harness.io" target="_blank">Harness Support</a> to enable the feature. </div><p></p><p>During an Azure virtual machine scale set (VMSS) deployment, Harness creates a new VMSS using a VM image definition from your Shared Image Gallery.</p><p>In a Harness Service of the <strong>Azure Virtual Machine Scale Set</strong> deployment type, you select the image definition for Harness to use.</p><p>In this topic:</p><ul><li><a href="#before_you_begin">Before You Begin</a></li><li><a href="#visual_summary">Visual Summary</a></li><li><a href="#simple_slug">Step 1: Title</a></li><li><a href="#another_slug">Step 2: Title</a></li><li><a href="#limitations">Limitations</a></li><li><a href="#next_steps">Next Steps</a></li></ul><h3>Before You Begin</h3><ul><li> <a href="/article/1h0723zsvm-azure-virtual-machine-scale-set-deployments">Azure Virtual Machine Scale Set Deployments Overview</a></li><li><a href="/article/d5hob1zuip-connect-to-your-azure-vmss">Connect to Azure for VMSS Deployments</a></li><li> <a href="/article/h9tkwmkrm7-delegate-installation">Harness Delegate Overview</a></li><li> <a href="/article/4o7oqwih6h-harness-key-concepts">Harness Key Concepts</a></li></ul><p>Ensure you have connected Harness to your Azure subscription as described in <a href="/article/d5hob1zuip-connect-to-your-azure-vmss">Connect to Azure for VMSS Deployments</a>.</p><h3 id="undefined">Supported Platforms and Technologies</h3><p>See <a href="/article/220d0ojx5y-supported-platforms">Supported Platforms and Technologies</a>.</p><h3>Step 1: Ensure You Have an Image Definition</h3><p>Azure image definitions are simple to create. For steps on setting one up for the first time, see <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/shared-images-portal" target="_blank">Create an Azure Shared Image Gallery using the portal</a> or <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/linux/tutorial-custom-images" target="_blank">Tutorial: Create a custom image of an Azure VM with the Azure CLI</a> from Azure.</p><p>Open you Shared Image Gallery and note the following information:</p><ul><li>Subscription</li><li>Resource group</li><li>Image gallery name</li><li>Image definition name</li></ul><p>You can see this information in the Shared Image Gallery:</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/c43hmoj6ic/1601070836404/image.png"/></figure><p>You can also see this information in the gallery <strong>Properties</strong>.</p><h3>Step 2: Create the Harness VMSS Service</h3><ol><li>In Harness, create or open an Application. See <a href="/article/bucothemly-application-configuration">Create an Application</a>.</li><li>Select <strong>Services</strong>, and then click <strong>Add Service</strong>.</li><li>In the <strong>Add Service</strong> settings, name your Service.</li><li>In <strong>Deployment Type</strong>, select <strong>Azure Virtual Machine Scale Set</strong>.</li><li>Click <strong>Submit</strong>.</li></ol><p>The new Service is created.</p><p>The Service only requires the image definition you want to use when creating your new VMSS.</p><h3>Step 3: Add the Image Definition Artifact Source</h3><ol><li>In the Harness Service, click <strong>Add Artifact Source</strong>.</li><li>In the Artifact Source settings, in <strong>Cloud Provider</strong>, select the Azure Cloud Provider you added in <a href="/article/d5hob1zuip-connect-to-your-azure-vmss">Connect to Your Azure VMSS</a>.</li><li>In <strong>Subscription</strong>, select the subscription used in your image definition.</li><li>In <strong>Resource Group</strong>, select resource group using in your image definition.</li><li>In <strong>Image Gallery</strong>, select the image gallery containing your image definition.</li><li>In <strong>Image Definition</strong>, select the image definition to use when creating your new MVSS.</li><li>Click <strong>Submit</strong>.</li></ol><p>The image definition information is added.</p><p>At deployment runtime, Harness will use this image definition to create the VMs in the VMSS.</p><p>If Harness cannot obtain this information, verify that the Client ID used in the Azure Cloud Provider has permissions to read the image gallery.</p><div class="note-callout">If you delete an image it might still show up here until Harness cleans up deleted images. Harness cleans up deleted images every 2 hours.</div><h3>Next Steps</h3><ul><li><a href="/article/2976rmk4kd-define-your-azure-vmss-target-infrastructure">Define Your Azure VMSS Target Infrastructure</a></li></ul><h3>See Also</h3><p>See the following docs from Azure:</p><ul><li><a href="https://docs.microsoft.com/en-us/azure/virtual-machines/troubleshooting-shared-images" target="_blank">Troubleshooting shared image galleries in Azure</a></li><li><a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/shared-image-galleries" target="_blank">Shared Image Gallery overview</a></li><li><a href="https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-faq" target="_blank">Azure virtual machine scale sets FAQs</a></li></ul><h3>Configure As Code</h3><p>To see how to configure the settings in this topic using YAML, configure the settings in the UI first, and then click the YAML editor button (<span style="color:#fb9e00" data-hd-color="#fb9e00"><strong>&lt;/&gt;</strong></span>).</p>