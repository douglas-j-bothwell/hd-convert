<p></p><div class="tip-callout">This content is for Harness <a href="/article/1fjmm4by22">FirstGen</a>. Switch to <a href="/article/m7nkbph0ac">NextGen</a>.</div><p>This guide will walk you through deploying a Docker image in an Azure Container Registry (ACR) repo to an Azure Kubernetes Service (AKS) cluster. This scenario is very popular and a walkthrough of all the steps involved will help you set up this scenario in Harness for your own microservices and apps.</p><h3>Deployment Summary</h3><div class="note-callout">For a general overview of how Harness works, seeÂ <a href="/article/4o7oqwih6h-harness-key-concepts">Harness Key Concepts</a>. For a vendor-agnostic, Harness Docker-to-Kubernetes deployment, see our <a href="/article/7in9z2boh6-kubernetes-quickstart">Kubernetes Quickstart</a> doc.</div><p></p><table><tbody><tr><td><p>Azure deployment in Harness Manager</p></td><td><p>The same deployment in Kubernetes Dashboard</p></td></tr><tr><td><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/kiuft72fr5/1578087921012/image.png"/></figure></td><td><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v13edrsui8/1551917982807/image.png"/></figure></td></tr></tbody></table><h4>Deployment Preview</h4><p>The following list describes the major steps we will cover in this guide:</p><ol><li>Install the Harness Kubernetes <strong>Delegate</strong> in an AKS Kubernetes cluster.</li><li>Add <strong>Cloud Providers</strong>. We will create two Harness Cloud Providers:<ol><li><strong>Kubernetes Cloud Provider</strong> - This is a connection to your AKS Kubernetes cluster using the Harness Delegate installed in that cluster.</li><li><strong>Azure Cloud Provider</strong> - This is a connection to your Azure account to access ACR. For other artifact repositories, a Harness Artifact Server connection is used. For Azure, Harness uses a Cloud Provider connection.</li></ol><div class="note-callout"><strong>Why two connections to Azure?</strong> When you create an AKS cluster, Azure also creates a service principal to support cluster operability with other Azure resources. You can use this auto-generated service principal for authentication with an ACR registry. If you can use this method, then only the Kubernetes Cloud Provider is needed.<br/><br/>In this guide, we create separate connections for AKS and ACR because, in some instances, you might not be able to assign the required role to the auto-generated AKS service principal granting it access to ACR. For more information, see <a href="https://docs.microsoft.com/en-us/azure/container-registry/container-registry-auth-aks" target="_blank">Authenticate with Azure Container Registry from Azure Kubernetes Service</a> from Azure.</div></li><li>Create the Harness <strong>Application</strong> for your Azure CD pipeline. The Harness Application represents a group of microservices, their deployment pipelines, and all the building blocks for those pipelines. Harness represents your microservice using a logical group of one or more entities: Services, Environments, Workflows, Pipelines, Triggers, and Infrastructure Provisioners. Applications organize all of the entities and configurations in Harness CI/CD.</li><li>Create the Harness <strong>Service</strong> using the Kubernetes type.<ol><li>Set up your Kubernetes manifests and any config variables and files.</li><li>Set the <strong>ImagePullSecrets</strong> setting to <strong>true</strong>. This will enable Kubernetes in AKS to pull the Docker image from ACR.</li></ol></li><li>Create the Harness <strong>Environment</strong> containing the Infrastructure Definition definition of your AKS cluster, and any overrides.</li><li>Create the Kubernetes deployment Harness <strong>Workflow</strong>.</li><li><strong>Deploy</strong> the Workflow to AKS. The deployment will pull the Docker image from ACR at runtime.</li><li>Advanced options not covered in this guide:<ol><li>Create a Harness <strong>Pipeline</strong> for your deployment, including Workflows and Approval steps. For more information, see <a href="https://docs.harness.io/article/zc1u96u6uj-pipeline-configuration">Pipelines</a>.</li><li>Create a Harness <strong>Trigger</strong> to automatically deploy your Workflows or Pipeline according to your criteria. For more information, see <a href="https://docs.harness.io/article/xerirloz9a-add-a-trigger-2">Triggers</a>.</li><li>Create Harness <strong>Infrastructure Provisioners</strong> for your deployment environments. For more information, see <a href="https://docs.harness.io/article/o22jx8amxb-add-an-infra-provisioner">Infrastructure Provisioners</a>.</li></ol></li></ol><h4>What Are We Going to Do?</h4><p>This guide walks you through deploying a Docker image from Azure ACR to Azure AKS using Harness. Basically, the Harness deployment does the following:</p><ul><li><strong>Docker Image</strong> - Pull Docker image from Azure ACR.</li><li><strong>Kubernetes Cluster</strong> - Deploy the Docker image to a Kubernetes cluster in Azure AKS in a Kubernetes Rolling Deployment.</li></ul><h4>What Are We Not Going to Do?</h4><p>This is a brief guide that covers the basics of deploying ACR artifacts to AKS. It does not cover the following:</p><ul><li>Basics of Docker, Kubernetes, ACR, or AKS. For great documentation on these platforms, see <a href="https://docs.microsoft.com/en-us/azure/container-registry/" target="_blank">Azure Container Registry Documentation</a> and <a href="https://docs.microsoft.com/en-us/azure/aks/" target="_blank">Azure Kubernetes Service (AKS)</a> from Azure.</li><li>Azure basics. This guide assumes you are familiar with Azure Resource Manager, its terminology and components, such as Resource Groups. For more information, see <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-overview" target="_blank">Azure Resource Manager overview</a>, <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-overview#resource-groups">Resource Groups</a>, and <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-template-deploy-portal">Deploy resources with Resource Manager templates and Azure portal</a> from Azure.</li><li>Using all of the artifact types Harness supports. We will focus on Docker images, as they are the most popular type.</li></ul><h3>Before You Begin</h3><p>The following are required:</p><ul><li><strong>ACR repository</strong> - An Azure account with a ACR repository you can connect to Harness.</li><li><strong>AKS Kubernetes cluster</strong> - An AKS Kubernetes cluster running in your Azure environment.</li></ul><p>We will walk you through the process of setting up Harness with connections to ACR and AKS.</p><h3>Next Step</h3><ul><li><a href="/article/z75kx7sur5-1-harness-account-setup">1 - Harness Account Setup for Azure</a></li></ul><p></p>