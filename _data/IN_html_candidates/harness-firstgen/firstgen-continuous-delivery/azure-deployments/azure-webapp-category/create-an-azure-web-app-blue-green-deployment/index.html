<div class="note-callout">Currently, this feature is behind the Feature Flag <code>AZURE_WEBAPP</code>. Contact <a href="https://mail.google.com/mail/?view=cm&amp;fs=1&amp;tf=1&amp;to=support@harness.io" target="_blank">Harness Support</a> to enable the feature.</div><p></p><p>A Harness Azure Web App Blue/Green deployment swaps traffic from one deployment slot to another.</p><p>If you are new to Azure Web App deployment slot swapping, see <a href="https://docs.microsoft.com/en-us/azure/app-service/deploy-staging-slots#what-happens-during-a-swap" target="_blank">What happens during a swap</a> from Azure.</p><div class="note-callout">If you want to shift traffic incrementally as part of the deployment, see <a href="/article/x0etkdg62q-create-an-azure-web-app-canary-deployment">Create an Azure Web App Canary Deployment</a>.</div><h3>Before You Begin</h3><p>Make sure you have read the following:</p><ul><li><a href="/article/lluikqw7q7-azure-web-app-deployments-overview">Azure Web App Deployments Overview</a></li><li>Make sure that you have connected Harness to your Azure subscription as described in <a href="/article/e9k7ngaqiu-connect-to-azure-for-web-app-deployments">Connect to Azure and Artifact Repo for Your Web App Deployments</a>.</li><li><a href="/article/8s766bhiec-add-your-docker-image-for-azure-web-app-deployment">Add Your Docker Image for Azure Web App Deployment</a></li><li><a href="/article/rflkjqxod2-add-a-non-containerized-artifacts-for-azure-web-app-deployment">Add Non-Containerized Artifacts for Azure Web App Deployment</a></li><li><a href="/article/2n35dber6l-define-your-azure-web-app-infrastructure">Define Your Azure Web App Infrastructure</a></li><li><a href="/article/b922byhcn4-azure-web-app-deployment-rollback">Azure Web App Deployment Rollback</a></li></ul><h3>Visual Summary</h3><p>The following short video walks you through a Harness Azure Web App Blue/Green Workflow setup.</p><p></p><div class="hd--embed" data-provider="YouTube" data-thumbnail="https://i.ytimg.com/vi/7B5BhaDkjUo/hqdefault.jpg"><iframe width="200" height="113" src="https://www.youtube.com/embed/7B5BhaDkjUo?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div><h3>Supported Platforms and Technologies</h3><p>See <a href="/article/220d0ojx5y-supported-platforms">Supported Platforms and Technologies</a>.</p><p></p><h3>Step 1: Collect Azure Web App Information</h3><p>The Harness Workflow will use the existing Deployment slots from your Azure Web App.</p><p>In the Azure portal, click your Web App, and then click <strong>Deployment slots</strong>. You can see the Deployment slots for your Web App.</p><p>Click <strong>Swap</strong>. You can see the Source and Target slots.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/x0etkdg62q/1612219242264/image.png"/></figure><p>You&#39;ll use these slot names in your Harness Workflow.</p><p><u>Don&#39;t click the</u> <u><strong>Swap</strong></u> <u>button.</u> Click <strong>Close</strong>.</p><p></p><h3>Step 2: Create the Blue/Green Workflow</h3><p>In your Harness Application, click <strong>Workflows</strong>, and then click <strong>Add Workflow</strong>.</p><p>Enter the following settings and click <strong>Submit</strong>.</p><ul><li><strong>Name:</strong> the name for this Workflow.</li><li><strong>Workflow Type:</strong> select <strong>Blue/Green Deployment</strong>.</li><li><strong>Environment:</strong> select the Harness Environment you added in <a href="/article/2n35dber6l-define-your-azure-web-app-infrastructure">Define Your Azure Web App Infrastructure</a>.</li><li><strong>Service:</strong> select the Service you set up in <a href="/article/8s766bhiec-add-your-docker-image-for-azure-web-app-deployment">Add Your Docker Image for Azure Web App Deployment</a> or <a href="/article/rflkjqxod2-add-a-non-containerized-artifacts-for-azure-web-app-deployment">Add Non-Containerized Artifacts for Azure Web App Deployment</a>.</li><li><strong>Infrastructure Definition:</strong> select the Infrastructure Definition you created in <a href="/article/2n35dber6l-define-your-azure-web-app-infrastructure">Define Your Azure Web App Infrastructure</a>.</li></ul><p>The new Workflow is created.</p><h3>Step 3: Slot Deployment Step</h3><p>The Slot Deployment step is where you select the Web App and source and target deployment slots for the deployment.</p><p>Open the <strong>Slot Deployment</strong> step.</p><p>Enter the following settings and click <strong>Submit</strong>.</p><ul><li><strong>Name:</strong> enter a name for the step.</li><li><strong>App Service:</strong> select the Azure Web App for deployment. Harness pulls the list of Web Apps using the credentials of the Azure Cloud Provider you selected in the Workflow&#39;s Infrastructure Definition.</li><li><strong>Deployment Slot:</strong> select the Source slot for the deployment. This slot is where Harness deploys the new Web App version.<div class="note-callout">Make sure the slot you select is running. Harness shows all slots regardless of their status.</div></li><li><strong>Target Slot:</strong> select the Target slot for the deployment. This slot is where Harness will swap the App content and configurations elements during the <strong>Swap Slot</strong> step.<div class="note-callout">Make sure the slot you select is running. Harness shows all slots regardless of their status.</div></li><li><strong>Slot Steady State Timeout:</strong> enter a minimum of <strong>30m</strong>. The slot deployment relies on Azure and can take time.</li></ul><p>When you&#39;re done, the step will look like this:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/qpfddekbax/1612310677836/image.png"/></figure><h3>Option: Use Variable Expressions in Settings</h3><p>You can use built-in Harness or custom Workflow variable expressions in the <strong>Slot Deployment</strong> step. See <a href="/article/766iheu1bk-add-workflow-variables-new-template">Set Workflow Variables</a>.</p><p>Variables are often used for templating the Workflow. See <a href="/article/60j7391eyy-templatize-pipelines">Create Pipeline Templates</a>.</p><h3>Option: Add a Health Check after Slot Deployment</h3><p>In the Workflow <strong>Verify Service</strong> section, add a health check to ensure that the Docker container or non-containerized app is running correctly.</p><p>The Slot Deployment step is considered successful once the slot is in a running state.</p><p>A running state does not ensure that your new app is accessible. It can take some time for new content to become available on Azure.</p><p>Also, the slot deployment might succeed but the Docker container or non-containerized artifact could be corrupted.</p><p>A health check after Slot Deployment can ensure a successful deployment.</p><h3>Step 4: Swap Slot Step</h3><p>The final step in the Workflow is Swap Slot. This step performs the Web App deployment slot swap. It&#39;s like doing a swap in the Azure portal or via the Azure CLI:</p><pre>az webapp deployment slot swap -n &#34;web app name&#34; -g &#34;resource group name&#34; -s &#34;source slot name&#34; --target-slot &#34;target slot&#34;</pre><p></p><p>Here&#39;s an example of the swap in the deployment logs:</p><pre>Sending request for swapping source slot: [stage] with target slot: [production]<br/>Operation name : [Apply Web App Slot Configuration]<br/>Status : [Succeeded]<br/>Description : [Applied configuration settings from slot &#39;Production&#39; to a site with deployment id &#39;anil-DemoWebApp&#39; in slot &#39;stage&#39;]<br/>Operation name : [Microsoft.Web/sites/slots/StartSlotWarmup/action]<br/>Status : [Succeeded]<br/>Description : [Initial state for slot swap operation is (Source slot: &#39;stage&#39;, DeploymentId:&#39;anil-DemoWebApp&#39;) (TargetSlot: &#39;production&#39;, DeploymentId:&#39;anil-demowebapp__f3c3&#39;)&#39;. Operation:93559f4a-d5c1-4ad5-beb5-a43bbc0578f2]<br/>Operation name : [Microsoft.Web/sites/slots/StartSlotWarmup/action]<br/>Status : [Succeeded]<br/>Description : [Initial state for slot swap operation is (Source slot: &#39;stage&#39;, DeploymentId:&#39;anil-DemoWebApp&#39;) (TargetSlot: &#39;production&#39;, DeploymentId:&#39;anil-demowebapp__f3c3&#39;)&#39;. Operation:93559f4a-d5c1-4ad5-beb5-a43bbc0578f2]<br/>Operation name : [Microsoft.Web/sites/slots/StartSlotWarmup/action]<br/>Status : [Succeeded]<br/>Description : [Initial state for slot swap operation is (Source slot: &#39;stage&#39;, DeploymentId:&#39;anil-DemoWebApp&#39;) (TargetSlot: &#39;production&#39;, DeploymentId:&#39;anil-demowebapp__f3c3&#39;)&#39;. Operation:93559f4a-d5c1-4ad5-beb5-a43bbc0578f2]<br/>Operation name : [Microsoft.Web/sites/slots/StartSlotWarmup/action]<br/>Status : [Succeeded]<br/>Description : [Initial state for slot swap operation is (Source slot: &#39;stage&#39;, DeploymentId:&#39;anil-DemoWebApp&#39;) (TargetSlot: &#39;production&#39;, DeploymentId:&#39;anil-demowebapp__f3c3&#39;)&#39;. Operation:93559f4a-d5c1-4ad5-beb5-a43bbc0578f2]<br/>Operation name : [Microsoft.Web/sites/slots/EndSlotWarmup/action]<br/>Status : [Succeeded]<br/>Description : [Finished warming of site with deploymentId &#39;anil-DemoWebApp&#39;]<br/>Operation name : [Microsoft.Web/sites/slots/EndSlotWarmup/action]<br/>Status : [Succeeded]<br/>Description : [Finished warming of site with deploymentId &#39;anil-DemoWebApp&#39;]<br/>Operation name : [Microsoft.Web/sites/slots/EndSlotWarmup/action]<br/>Status : [Succeeded]<br/>Description : [Finished warming of site with deploymentId &#39;anil-DemoWebApp&#39;]<br/>Operation name : [Microsoft.Web/sites/slots/SlotSwap/action]<br/>Status : [Succeeded]<br/>Description : [Finished swapping site. New state is (Slot: &#39;stage&#39;, DeploymentId:&#39;anil-demowebapp__f3c3&#39;), (Slot: &#39;Production&#39;, DeploymentId:&#39;anil-DemoWebApp&#39;)&#39;. Operation:93559f4a-d5c1-4ad5-beb5-a43bbc0578f2]<br/>Swapping slots done successfully<br/>Operation - [Swap Slots] was success<br/>Swapping request returned successfully</pre><p></p><p>The Workflow is complete. You can now deploy.</p><h3>Step 5: Deploy the Workflow</h3><p>Click <strong>Deploy</strong>, select an artifact, and then click <strong>Submit</strong>.</p><p>The Workflow deploys:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/qpfddekbax/1612311345711/image.png"/></figure><p>You can see the swap succeeded in the logs:</p><pre>...<br/>Description : [Finished swapping site. New state is (Slot: &#39;stage&#39;, DeploymentId:&#39;anil-demowebapp__f3c3&#39;), (Slot: &#39;Production&#39;, DeploymentId:&#39;anil-DemoWebApp&#39;)&#39;. Operation:93559f4a-d5c1-4ad5-beb5-a43bbc0578f2]<br/>...</pre><p></p><p>And the same information is displayed in the Azure portal Activity log:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/qpfddekbax/1612311482653/image.png"/></figure><p></p><h3>Option: Templatize the Workflow</h3><p>See <a href="/article/60j7391eyy-templatize-pipelines">Create Pipeline Templates</a>.</p><h3>Configure As Code</h3><p>To see how to configure the settings in this topic using YAML, configure the settings in the UI first, and then click the YAML editor button (<strong>&lt;/&gt;</strong>).</p><h3>See Also</h3><ul><li><a href="/article/b922byhcn4-azure-web-app-deployment-rollback">Azure Web App Deployment Rollback</a></li></ul><p></p>