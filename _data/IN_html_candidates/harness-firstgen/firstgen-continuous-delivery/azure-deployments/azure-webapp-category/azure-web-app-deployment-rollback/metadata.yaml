type: article
article_id: b922byhcn4
user_id: mfr0nxh4be
category_id: mfdyp6tf0v
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Azure Web App Deployment Rollback
slug: azure-web-app-deployment-rollback
description: Rollback Summary Rollback All Phases at Once Post-Production Rollback
  Rollback Order in Multi-Phase Workflow
short_version: Rollback Summary Rollback All Phases at Once Post-Production Rollback
  Rollback Order in Multi-Phase Workflow
tags: []
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: Article updated
  source: API
  triggered_at: 2022-08-26T19:00:46.311119Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Azure Web App Deployment Rollback
  description: Rollback Summary Rollback All Phases at Once Post-Production Rollback
    Rollback Order in Multi-Phase Workflow
  short_version: Rollback Summary Rollback All Phases at Once Post-Production Rollback
    Rollback Order in Multi-Phase Workflow
  body: '<p></p><div class="note-callout">Currently, this feature is behind the Feature
    Flag <code>AZURE_WEBAPP</code>. Contact <a href="https://mail.google.com/mail/?view=cm&amp;fs=1&amp;tf=1&amp;to=support@harness.io"
    target="_blank">Harness Support</a> to enable the feature.</div><p>Harness performs
    rollback on failed <a href="/article/lluikqw7q7-azure-web-app-deployments-overview">Azure
    Web App deployments</a>.</p><h3>Limitations</h3><h4>Rollback Limitations for both
    Azure Container and Non-Containerized Rollbacks</h4><div class="note-callout">For
    Non-Containerized artifacts deployments, see <a href="/article/rflkjqxod2-add-a-non-containerized-artifacts-for-azure-web-app-deployment">Add
    Non-Containerized Artifacts for Azure Web App Deployment</a>.</div><ul><li><strong>Harness
    Post-Deployment Rollback:</strong> to see if Post-Production Rollback is supported
    for Azure Web App deployments, see <a href="/article/2f36rsbrve-post-deployment-rollback">Rollback
    Production Deployments</a>.</li><li>Rollback only restores the state of the <strong>stage</strong>
    slot. If a step that follows the <strong>Swap Slot</strong> step fails, such as
    a failed Approval or Shell Script step, Harness only rolls back the <strong>stage</strong>
    slot. The target slot is not changed.</li></ul><h4>Rollback Limitations for Non-Containerized
    Rollbacks</h4><p>Rollback for Non-Containerized artifact deployments is not supported
    for the first <u>two</u> deployments because the necessary artifact details are
    not available to perform a rollback.</p><h4>Streaming Logs Limitations for both
    Azure Container and Non-Containerized Deployments</h4><p>You might face timeout
    issues as a result of limitations with streaming Web App slot deployment logs.
    For example, you might see <code>java.net.SocketTimeoutException: timeout</code>
    or some other socket errors as a result of the Azure SDK client.</p><p>Harness
    is working with the Azure team for a resolution (see <a href="https://github.com/Azure/azure-sdk-for-java/issues/27221"
    target="_blank">issue 27221</a>). At this time, you can use a Harness <a href="/article/m8ksas9f71-using-the-http-command">HTTP
    step</a> to verify that the slot is up and ready.</p><h3>Rollback Summary</h3><p>For
    <a href="/article/lluikqw7q7-azure-web-app-deployments-overview">Azure Web App
    deployments</a>, Harness saves the previous Docker or non-containerized app details
    that were running on the slot.</p><p>In case of an Azure Web App deployment failure,
    Harness rollback redeploys the previous instance.</p><h3>Slot Rollback</h3><p>Harness
    initially deploys to the source (staging) slot and then swaps slots with the target
    (production) slot.</p><p>As the source slot is the slot is where Harness deploys
    the new Web App version, Harness rolls back the app version in the source slot
    only.</p><p>Harness does not rollback the app version in the target slot.</p><h3>Traffic
    Rollback</h3><p>Harness returns all traffic to the previous, pre-deployment percentages.</p><p>If
    the pre-deployment traffic was arranged with the source slot at 20% and the target
    slot at 80%, rollback will return network traffic to these percentages.</p><h3>Rollback
    Example for Non-Containerized Rollbacks</h3><p>Here&#39;s an example of a rollback.</p><p><strong>Update
    Slot Configuration Settings</strong>:</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/b922byhcn4/1645818690724/image.png"/></figure><p><strong>Deploy
    to Slot</strong>:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/b922byhcn4/1645818879882/image.png"/></figure><h3>Rollback
    Logs</h3><p>Here&#39;s the log activity from a rollback with the timestamps removed:</p><pre>Sending
    request for stopping deployment slot - [stage]<br/>Operation - [Stop Slot] was
    success<br/>Request sent successfully<br/><br/>Start updating Container settings
    for slot - [stage]<br/>Start cleaning existing container settings<br/><br/>Current
    state for deployment slot is - [Stopped]<br/>Deployment slot stopped successfully<br/><br/>Start
    updating application configurations for slot - [stage]<br/>Deployment slot configuration
    updated successfully<br/><br/>Existing container settings deleted successfully<br/>Start
    cleaning existing image settings<br/><br/>Existing image settings deleted successfully<br/>Start
    updating Container settings: <br/>[[DOCKER_REGISTRY_SERVER_URL]]<br/><br/>Container
    settings updated successfully<br/>Start updating container image and tag: <br/>[library/nginx:1.19-alpine-perl],
    web app hosting OS [LINUX]<br/><br/>Image and tag updated successfully for slot
    [stage]<br/>Deployment slot container settings updated successfully<br/><br/>Sending
    request for starting deployment slot - [stage]<br/>Operation - [Start Slot] was
    success<br/>Request sent successfully<br/><br/>Sending request to shift [0.00]
    traffic to deployment slot: [stage]<br/><br/>Current state for deployment slot
    is - [Running]<br/>Deployment slot started successfully<br/><br/>Traffic percentage
    updated successfully<br/><br/>The following task - [SLOT_ROLLBACK] completed successfully</pre><p></p><h3>See
    Also</h3><ul><li><a href="/article/4dvyslwbun-resume-a-pipeline-deployment">Resume
    Pipeline Deployments</a></li></ul><p></p>'
  slug: azure-web-app-deployment-rollback
  tags: []
  is_live: true
