type: article
article_id: sq1xy00oaa
user_id: mfr0nxh4be
category_id: 4on0a5avqo
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Azure Blueprint How-tos
slug: azure-blueprint-how-tos
description: Harness has first-class support for Azure Blueprints as an infrastructure
  provisioner. Harness takes a Blueprint definition, publishes it using the version
  specified in assign.json file, and creates…
short_version: Harness has first-class support for Azure Blueprints as an infrastructure
  provisioner. Harness takes a Blueprint definition, publishes it using the version
  specified in assign.json file, and creates…
tags: []
show_toc: false
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: Article updated
  source: API
  triggered_at: 2021-08-03T16:09:09.037244Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Azure Blueprint How-tos
  description: ""
  short_version: ""
  body: '<p>Harness has first-class support for Azure Blueprints as an infrastructure
    provisioner.</p><p>Harness takes a Blueprint definition, publishes it using the
    version specified in assign.json file, and creates the assignment.</p><p>See the
    following Blueprint How-tos:</p><ul><li><a href="/article/0qc8f6w5qn-set-up-harness-for-azure-blueprint">Set
    Up Your Harness Account for Azure Blueprint</a></li><li><a href="/article/u4dej7jsix-add-azure-blueprints-to-harness">Add
    Azure Blueprints to Harness</a></li><li><a href="/article/vhit72svmc-provision-using-azure-blueprint-definitions">Provision
    using Azure Blueprint Definitions</a></li></ul><p>For a conceptual overview of
    provisioning with ARM and Blueprints, including videos, see <a href="https://docs.harness.io/article/c7bzn7vjwn-azure-arm-and-blueprint-provision-with-harness">Azure
    ARM and Blueprint Provisioning with Harness</a>.</p><h3>Limitations</h3><ul><li>Rollback
    is not supported for Azure Blueprints.</li><li>All information about the assignment
    must be provided in assign.json file.</li><li>&#34;Unassignment&#34; and updating
    already exiting Blueprints assignments is not supported.</li><li>Azure Blueprint
    outputs cannot be referenced as variables in Harness. This limitation is the result
    of there being no outputs available when the Blueprint assignment is done. It
    is not supported by Azure. Consequently, Azure Blueprint cannot be used for mapping
    dynamically provisioned infrastructure while creating Harness Infrastructure Definitions.</li><li>Before
    reviewing JSON requirements and limitations, let&#39;s review the key parameters:<ul><li><code>identity</code>:
    Blueprint uses a managed identity to deploy the artifacts specified by the Blueprint
    definition. It can use the <code>SystemAssigned</code> or <code>UserAssigned</code>
    value.</li><li><code>location</code>: - Blueprint uses a managed Identity to deploy
    resources, which requires a location.</li><li><code>blueprintId</code>: for example:
    <code>/providers/Microsoft.Management/managementGroups/HarnessARMTest/providers/Microsoft.Blueprint/blueprints/101-boilerplate-mng/versions/v1.</code>
    Here is a description of each part:</li><li><code>/providers/Microsoft.Management/managementGroups/HarnessARMTest</code>:
    Blueprint definition scope including management group name that is <code>HarnessARMTest</code>.</li><li><code>/providers/Microsoft.Blueprint/blueprints/</code>:
    default Blueprint provider information.</li><li><code>101-boilerplate-mng</code>:
    Blueprint definition name.</li><li> <code>v1</code>: new Blueprint version number.</li><li><code>locks</code>:
    determines whether users, groups, and service principals with permissions can
    modify and delete resources deployed by the Blueprint service principal.</li><li><code>parameters</code>:
    list of dynamic parameters that are applied to resources during deployment. See
    <a href="https://docs.microsoft.com/en-us/azure/governance/blueprints/concepts/parameters"
    target="_blank">Creating dynamic blueprints through parameters</a> from Azure.</li><li><code>scope</code>:
    the subscription where blueprint definition will be assigned.</li></ul></li><li>Your
    assign.json file must have a <code>scope</code> property (<code>properties.scope</code>)
    for management group level assignments. The <code>scope</code> is the target subscription
    of the Blueprint assignment (format: <code>/subscriptions/{subscriptionId}</code>).
    For management group level assignments, the property is required.<br/>For example:<pre>{<br/>    &#34;identity&#34;:
    {<br/>    &#34;type&#34;: &#34;SystemAssigned&#34;<br/>    },<br/>    &#34;location&#34;:
    &#34;westus2&#34;,<br/>    &#34;properties&#34;: {<br/>    &#34;blueprintId&#34;:
    &#34;/providers/Microsoft.Management/managementGroups/HarnessARMTest/providers/Microsoft.Blueprint/blueprints/101-boilerplate-mng/versions/v2&#34;,<br/>    &#34;resourceGroups&#34;:
    {<br/>        &#34;SingleRG&#34;: {<br/>        &#34;name&#34;: &#34;mng-001&#34;,<br/>        &#34;location&#34;:
    &#34;eastus&#34;<br/>        }<br/>    },<br/>    &#34;locks&#34;: {<br/>        &#34;mode&#34;:
    &#34;none&#34;<br/>    },<br/>    &#34;parameters&#34;: {<br/>        &#34;principalIds&#34;:
    {<br/>        &#34;value&#34;: &#34;0000000-0000-0000-0000-0000000000&#34;<br/>        },<br/>        &#34;genericBlueprintParameter&#34;:
    {<br/>        &#34;value&#34;: &#34;test&#34;<br/>        }<br/>    },<br/>    &#34;scope&#34;:
    &#34;/subscriptions/0000000-0000-0000-0000-0000000000&#34;<br/>    }<br/>}</pre><br/>The
    <code>scope</code> property is required for deployment using management groups.
    If the Blueprint definition begins with <code>/providers/Microsoft.Management/managementGroups/{managmentGroupName}</code>
    , the definition will be created at the management group scope, but the assignment
    is done at the subscription in <code>scope</code>.</li><li>The subscription provided
    in the <code>scope</code> property must be a descendant of the management group
    provided in the <code>blueprintId</code>.</li><li><code>blueprintId</code> must
    follow the next pattern <code>/{resourceScope}/providers/Microsoft.Blueprint/blueprints/{blueprintName}/versions/{versionId}</code>.
    If not, an exception is thrown.</li><li>If the Blueprint definition is created
    and published at the management group scope, Harness only supports assignment
    to one subscription during deployment. Harness doesn&#39;t support assignment
    to multiple subscriptions. You can only state one subscription as the value of
    <code>scope</code> property in the assign.json file.</li><li>The assignment name
    is generated automatically.</li><li>The artifacts name is taken from artifact
    <code>name</code> property in artifact.json. If <code>name</code> doesn’t exist
    in artifact.json, the file name is used. The artifact name is important because
    of its use with the <code>dependsOn</code> property. See <a href="https://docs.microsoft.com/en-us/azure/governance/blueprints/concepts/sequencing-order"
    target="_blank">Understand the deployment sequence in Azure Blueprints</a> from
    Azure.</li><li>If the blueprint.json file contains the <code>name</code> property
    and that name is not the same as the <code>name</code> provided in the assign.json
    file, this error message is shown:<pre>Not match blueprint name found in blueprint
    json file with properties.blueprintId property in assign json file.<br/>Found
    name in blueprint json: boilerplate-101, and properties.blueprintId: boilerplate-201&#34;</pre></li><li>If
    <code>identity</code> has the <code>SystemAssigned</code> value, then the Azure
    service principal used for the Harness Azure Cloud Provider must have the <strong>Owner</strong>
    role in the subscription where the assignment will be created. If the service
    principal uses a System-assigned user identity, then you are responsible for managing
    the right and lifecycle of a user-managed identity.</li><li>During deployment,
    each Workflow checks whether the version number specified in the assign.json file
    already exits on Azure.<br/>If the version does already exist, only a new assignment
    will be created.<br/>If the version does not exist, the deployment process (creating
    or updating Blueprint definition and artifacts, publishing, and assignment) starts.</li></ul><h3>Azure
    Roles Required</h3><p>See <strong>Azure Blueprint</strong> in <a href="https://docs.harness.io/article/4n3595l6in-add-microsoft-azure-cloud-provider">Add
    Microsoft Azure Cloud Provider</a>.</p><h3>Harness Permissions Required</h3><p>To
    set up a Harness Blueprint Provisioner, your Harness User account must belong
    to a User Group with the following Application Permissions:</p><ul><li><strong>Permission
    Type:</strong> <code>Provisioners</code>.</li><li><strong>Application:</strong> one
    or more Applications.</li><li><strong>Filter:</strong> <code>All Provisioners</code>.</li><li><strong>Action:</strong> <code>Create,
    Read, Update, Delete</code>.</li></ul><p></p><p></p><p></p><p></p><p></p><p></p><p></p>'
  slug: azure-blueprint-how-tos
  tags: []
  is_live: true
