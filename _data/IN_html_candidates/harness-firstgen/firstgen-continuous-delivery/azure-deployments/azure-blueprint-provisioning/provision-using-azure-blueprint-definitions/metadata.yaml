type: article
article_id: vhit72svmc
user_id: mfr0nxh4be
category_id: 4on0a5avqo
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Provision using Azure Blueprint Definitions
slug: provision-using-azure-blueprint-definitions
description: You can provision Azure resources using Blueprint definitions in your
  Harness Workflows. Harness can provision the resources by themselves or as part
  of a Workflow performing other deployment steps.
short_version: You can provision Azure resources using Blueprint definitions in your
  Harness Workflows.
tags: []
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: Article updated
  source: API
  triggered_at: 2021-08-03T16:09:02.098379Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Provision using Azure Blueprint Definitions
  description: You can provision Azure resources using Blueprint definitions in your
    Harness Workflows. Harness can provision the resources by themselves or as part
    of a Workflow performing other deployment steps.
  short_version: You can provision Azure resources using Blueprint definitions in
    your Harness Workflows.
  body: '<p>You can provision Azure resources using Blueprint definitions in your
    Harness Workflows. Harness can provision the resources by themselves or as part
    of a Workflow performing other deployment steps.</p><p>Harness takes a Blueprint
    definition <a href="/article/u4dej7jsix-add-azure-blueprints-to-harness">you set
    up as a Harness Infrastructure Provisioner</a>, publishes it using the version
    specified in assign.json file and creates the assignment.</p><p>In this topic:</p><ul><li><a
    href="https://docs.harness.io/article/vhit72svmc-provision-using-azure-blueprint-definitions#before_you_begin">Before
    You Begin</a></li><li><a href="https://docs.harness.io/article/vhit72svmc-provision-using-azure-blueprint-definitions#visual_summary">Visual
    Summary</a></li><li><a href="https://docs.harness.io/article/vhit72svmc-provision-using-azure-blueprint-definitions#limitations">Limitations</a></li><li><a
    href="https://docs.harness.io/article/vhit72svmc-provision-using-azure-blueprint-definitions#step_1_add_the_infrastructure_provisioner">Step
    1: Add the Infrastructure Provisioner</a></li><li><a href="https://docs.harness.io/article/vhit72svmc-provision-using-azure-blueprint-definitions#step_2_add_arm_blueprint_create_resource_step_to_workflow">Step
    2: Add ARM/Blueprint Create Resource Step to Workflow</a></li><li><a href="https://docs.harness.io/article/vhit72svmc-provision-using-azure-blueprint-definitions#step_3_deploy_the_workflow">Step
    3: Deploy the Workflow</a></li><li><a href="https://docs.harness.io/article/vhit72svmc-provision-using-azure-blueprint-definitions#configure_as_code">Configure
    As Code</a></li></ul><p></p><h3>Before You Begin</h3><ul><li><a href="/article/0qc8f6w5qn-set-up-harness-for-azure-blueprint">Set
    Up Your Harness Account for Azure Blueprint</a></li><li><a href="/article/u4dej7jsix-add-azure-blueprints-to-harness">Add
    Azure Blueprints to Harness</a></li><li>For a conceptual overview of provisioning
    with ARM and Blueprints, seeÂ <a href="/article/c7bzn7vjwn-azure-arm-and-blueprint-provision-with-harness">Azure
    ARM and Blueprint Provisioning with Harness</a>.</li></ul><h3>Visual Summary</h3><p>Here&#39;s
    a short video showing how to provision Azure infrastructure using Blueprint definitions
    and Harness:</p><p></p><div class="hd--embed" data-provider="YouTube" data-thumbnail="https://i.ytimg.com/vi/cGjZCoz3HrY/hqdefault.jpg"><iframe
    width="200" height="150" src="https://www.youtube.com/embed/cGjZCoz3HrY?feature=oembed"
    frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media;
    gyroscope; picture-in-picture" allowfullscreen=""></iframe></div><p>You can use
    Azure Blueprint definitions in Harness to provision any resources.</p><ol><li><strong>ARM
    Infrastructure Provisioner</strong>: add your Azure Blueprint definition as a
    Harness Infrastructure Provisioner.</li><li><strong>Workflow Provisioner Step</strong>:
    create a Canary Workflow or Multi-Service Workflow and add an <strong>ARM/Blueprint
    Create Resource</strong> step in its <strong>Pre-deployment Steps</strong> to
    provision the resources you need. You can use the Workflow to deploy anything
    else, or just omit any further phases and steps.</li><li><strong>Deploy:</strong>
    the Workflow will provision the resource according to your Blueprint definitions.</li></ol><p>When
    you run the Workflow, it can provision the resources without deploying anything
    else.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/c7bzn7vjwn/1615334078509/image.png"
    style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><h3>Limitations</h3><ul><li>See
    <a href="/article/qhnnq1mks3-azure-arm-and-blueprint-how-tos">Azure Resource Management
    (ARM) How-tos</a>.</li><li>Unlike other provisioners supported by Harness, Azure
    Blueprint definitions cannot be added to Infrastructure Definitions. Blueprint
    definitions cannot be used as deployment targets in Harness Workflows. You can
    simply use them in a Workflow to provision resources.<br/>You can use ARM templates
    to provision deployment target environments. See <a href="/article/idqiy49prl-target-azure-arm-or-blueprint-provisioned-infrastructure">Provision
    and Deploy to ARM Provisioned Infrastructure</a>.</li></ul><h3>Step 1: Add the
    Infrastructure Provisioner</h3><p>A Harness Infrastructure Provisioner connects
    Harness to the Git repo where your Blueprint definition is located.</p><p>To set
    up a Harness Infrastructure Provisioner for a Blueprint, follow the steps in <a
    href="/article/u4dej7jsix-add-azure-blueprints-to-harness">Add Azure Blueprints
    to Harness</a>.</p><h3>Step 2: Add ARM/Blueprint Create Resource Step to Workflow</h3><p>Canary,
    Multi-Service, and Blue/Green Workflow types contain a pre-deployment section
    where you can provision infrastructure using your Harness Infrastructure Provisioner.</p><p>Let&#39;s
    look at a Canary Workflow.</p><p>In a Canary Workflow, in <strong>Pre-deployment
    Steps</strong>, click <strong>Add Step</strong>.</p><p>Click <strong>ARM/Blueprint
    Create Resource</strong> and then click <strong>Next</strong>.</p><p>In <strong>Overview</strong>,
    in <strong>Provisioner</strong>, select the Infrastructure Provisioner for your
    Blueprint.</p><p>In <strong>Azure Cloud Provider</strong>, enter the Cloud Provider
    for Harness to use when connecting to Azure and provisioning with the Blueprint.</p><div
    class="note-callout">The Azure service account used with the Cloud Provider must
    have the Azure permissions needed to provision the resources in your Blueprint.
    See <strong>Azure Blueprint</strong> in <a href="/article/4n3595l6in-add-microsoft-azure-cloud-provider">Add
    Microsoft Azure Cloud Provider</a>.</div><p>In <strong>Timeout</strong>, enter
    at least 20m. Provisioning Azure resources can take time.</p><p>Click <strong>Submit</strong>.</p><h3>Step
    3: Deploy the Workflow</h3><p>Here&#39;s an example of a Canary Workflow deployment
    that uses the ARM/Blueprint Create Resource step:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/vhit72svmc/1616797139001/image.png"/></figure><p>In
    the <strong>ARM/Blueprint Create Resource</strong> step&#39;s <strong>Execute
    Blueprint Deployment</strong> section, you can see the Blueprint assignment created:</p><pre>Starting
    Blueprint deployment <br/>- Blueprint Name: [101-boilerplate-mng] <br/>- Assignment
    Name: [Assignment-101-boilerplate-mng-1615468935700] <br/>- Version ID: [v2]<br/><br/>Start
    getting exiting blueprint definition at scope <br/>- Scope: [/providers/Microsoft.Management/managementGroups/HarnessARMTest]
    <br/>- Blueprint Name: [101-boilerplate-mng]<br/>Found blueprint definition at
    requested scope<br/>Start getting already published blueprint with version - [v2]<br/>Found
    already published blueprint with display name - [null], continue assignment<br/>Start
    granting the rights to Azure Blueprints service principal<br/>Assignment is using
    system-assigned managed identity. Owner rights need to be assign to Azure Blueprints
    service principal<br/>Start getting Azure Blueprints Service Principal details
    at scope - [/subscriptions/0000000-0000-0000-0000-0000000000]<br/>Azure Blueprints
    Service Principal details successfully obtained - Azure Blueprints SP Object ID:
    [992cad90-3eb5-4d04-9ac2-3a73d16efd65]<br/>Start creating role assignment for
    Azure Blueprints Service Principal on subscription<br/>- Role Assignment Name:
    [333513df-e63d-4dc2-9894-29d3bb2a73be] <br/>- Built In Role: [Owner] <br/>- Azure
    Blueprints SP Object ID: [992cad90-3eb5-4d04-9ac2-3a73d16efd65] <br/>- Subscription
    Id: [0000000-0000-0000-0000-0000000000]<br/>Role assignment successfully created
    <br/>- Principal ID: [992cad90-3eb5-4d04-9ac2-3a73d16efd65] <br/>- Role Definition
    ID: [/subscriptions/0000000-0000-0000-0000-0000000000/providers/Microsoft.Authorization/roleDefinitions/8e3af657-a8ff-443c-a75c-2fe8c4bcb635]
    <br/>- Scope: [/subscriptions/0000000-0000-0000-0000-0000000000]<br/><br/>Start
    creating assignment <br/>- Scope: [/subscriptions/0000000-0000-0000-0000-0000000000]
    <br/>- Assignment Name: [Assignment-101-boilerplate-mng-1615468935700]<br/>Blueprint
    assignment request sent successfully<br/><br/>Blueprint is assigned successfully.</pre><p></p><p>In
    the <strong>Blueprint Deployment Steady state</strong> section you can see the
    deployment reach steady state:</p><pre>Deployment Status for - [Assignment-101-boilerplate-mng-1615468935700]
    is [creating]<br/>Deployment Status for - [Assignment-101-boilerplate-mng-1615468935700]
    is [creating]<br/>Deployment Status for - [Assignment-101-boilerplate-mng-1615468935700]
    is [waiting]<br/>Deployment Status for - [Assignment-101-boilerplate-mng-1615468935700]
    is [waiting]<br/>Deployment Status for - [Assignment-101-boilerplate-mng-1615468935700]
    is [waiting]<br/>Deployment Status for - [Assignment-101-boilerplate-mng-1615468935700]
    is [deploying]<br/>Deployment Status for - [Assignment-101-boilerplate-mng-1615468935700]
    is [succeeded]<br/><br/>Deployment Jobs:<br/><br/>- Job Id: [DeploymentJob:b71b6336:2D49f4:2D42e9:2Db4ae:2Db2a25dc6e991]<br/>-
    Job Kind: [system]<br/>- Job State: [succeeded]<br/>- Job Created Resource IDs:
    [/subscriptions/0000000-0000-0000-0000-0000000000/providers/Microsoft.Authorization/roleAssignments/3ce1a35a-9c05-4ad2-c74a-a076e4fbd79a]<br/>-
    Job Result Error: []<br/><br/>- Job Id: [DeploymentJob:32907ca6:2D7416:2D454e:2Db6ea:2Dd42c1c68290b]<br/>-
    Job Kind: [azureResource]<br/>- Job State: [succeeded]<br/>- Job Created Resource
    IDs: [/subscriptions/0000000-0000-0000-0000-0000000000/providers/Microsoft.Authorization/roleAssignments/9a0111c8-f675-0c97-6805-4b43332bd0ae]<br/>-
    Job Result Error: []<br/><br/>- Job Id: [DeploymentJob:ea8b2d3e:2Df7ce:2D4960:2D913f:2D67015c335de9]<br/>-
    Job Kind: [azureResource]<br/>- Job State: [succeeded]<br/>- Job Created Resource
    IDs: [/subscriptions/0000000-0000-0000-0000-0000000000/resourceGroups/mng-001]<br/>-
    Job Result Error: []<br/><br/>- Job Id: [DeploymentJob:e0827aea:2Df93f:2D4763:2D90a2:2D0ff88e8329cd]<br/>-
    Job Kind: [azureResource]<br/>- Job State: [succeeded]<br/>- Job Created Resource
    IDs: [/subscriptions/0000000-0000-0000-0000-0000000000/resourcegroups/mng-001/providers/Microsoft.Authorization/policyAssignments/cc9921013c83e1da9876c1d0ca898a33a4ef0a94fba55a900e6ee41da3373387]<br/>-
    Job Result Error: []<br/><br/>- Job Id: [DeploymentJob:4bfd4524:2Dc4c4:2D45cb:2D9d28:2D37e0b6552ecf]<br/>-
    Job Kind: [azureResource]<br/>- Job State: [succeeded]<br/>- Job Created Resource
    IDs: []<br/>- Job Result Error: []<br/><br/>- Job Id: [DeploymentJob:3b954a5f:2D2bb6:2D40ee:2D9939:2D4b1bf8f4b1b1]<br/>-
    Job Kind: [system]<br/>- Job State: [succeeded]<br/>- Job Created Resource IDs:
    []<br/>- Job Result Error: []<br/><br/>Blueprint Deployment - [Assignment-101-boilerplate-mng-1615468935700]
    completed successfully</pre><p></p><p>Now you&#39;ve provisioned the Azure infrastructure
    and deployed to it using a single Workflow.</p><h3>Configure As Code</h3><p>To
    see how to configure the settings in this topic using YAML, configure the settings
    in the UI first, and then click the YAML editor button (<span style="color:#fb9e00"
    data-hd-color="#fb9e00">&lt;/&gt;</span>).</p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>'
  slug: provision-using-azure-blueprint-definitions
  tags: []
  is_live: true
