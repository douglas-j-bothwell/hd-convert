type: article
article_id: j917dpk2zv
user_id: mfr0nxh4be
category_id: 872aodnvl1
author:
  name: Michael Cretzman
  profile_image: https://www.gravatar.com/avatar/2e8616837f4ee92be5d19ffe9b9ccba9?d=mm&s=150
title: Backup and Recovery
slug: virtual-machine-on-prem-backup-and-recovery
description: You can back up and recover Harness Self-Managed Enterprise Edition -
  Virtual Machine using KOTS snapshots. KOTS has documented snapshots extensively
  in Snapshots. This topic provides a summary of th…
short_version: You can back up and recover Harness Self-Managed Enterprise Edition
  - Virtual Machine using KOTS snapshots. KOTS has documented snapshots extensively
  in Snapshots. This topic provides a summary of th…
tags:
- on-premise
show_toc: true
is_private: false
is_published: true
is_featured: false
stale_status:
  is_stale: false
  reason: Article updated
  source: API
  triggered_at: 2022-07-22T19:54:53.431068Z
  expires_at: null
permission_groups: []
multilingual:
- language_code: en
  title: Backup and Recovery
  description: ""
  short_version: ""
  body: '<p>You can back up and recover Harness Self-Managed Enterprise Edition -
    Virtual Machine using KOTS snapshots.</p><p>KOTS has documented snapshots extensively
    in <a href="https://kots.io/kotsadm/snapshots/overview/" target="_blank">Snapshots</a>.</p><p>This
    topic provides a summary of the backup and recovery steps involved, and provides
    details on storage and Harness Self-Managed Enterprise Edition - Virtual Machine
    version requirements.</p><h3>Overview</h3><p>You can back up and recover Harness
    Self-Managed Enterprise Edition - Virtual Machine using <a href="https://kots.io/kotsadm/snapshots/overview/"
    target="_blank">KOTS snapshots</a>.</p><p>There are two types of snapshots:</p><ul><li><strong>Full
    snapshots:</strong> a snapshot of all objects including setup data and applications.<ul><li>Full
    snapshots are useful in disaster recovery and rolling back to previous versions
    of Harness Self-Managed Enterprise Edition -  Virtual Machine.</li><li>Full snapshots
    can restore fully or partially.</li></ul></li><li><strong>Partial snapshots:</strong>
    a snapshot of application data only.<ul><li>Partial snapshots are useful for rolling
    back to previously installed versions of Harness Self-Managed Enterprise Edition
    - Virtual Machine.</li></ul></li></ul><p>You can automate both types of snapshots.</p><h3>Requirements</h3><p>Ensure
    you meet the Harness Self-Managed Enterprise Edition - Virtual Machine version
    and other requirements below.</p><h4>Harness Self-Managed Enterprise Edition -
    Virtual Machine Version Required</h4><p>Automated backup and recovery is supported
    in the following Harness Self-Managed Enterprise Edition versions:</p><ul><li>670XX
    and later. See <a href="/article/0v512791gf-harness-on-prem-release-notes">Harness
    Self-Managed Enterprise Edition Release Notes</a>.</li></ul><h4>Storage Required</h4><p>Snapshots
    are stored in an AWS S3 bucket or AWS S3-compatible storage (Harness recommends
    either), or in Internal Storage.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/j917dpk2zv/1614379633031/image.png"/></figure><p>You
    will select and set up the storage option before creating a snapshot. This setup
    is described below.</p><h4>Velero is Already Installed</h4><p>Velero is installed
    and configured automatically in Harness Self-Managed Enterprise Edition - Virtual
    Machine installations. You do not have to install it.</p><p></p><p></p><h3>Step
    1: Choose Storage Destination</h3><p>You have the following options for snapshot
    storage:</p><ul><li>AWS S3 bucket</li><li>AWS S3-compatible storage</li><li>Internal
    Storage</li></ul><p>Harness recommends using an S3 bucket or S3-compatible storage
    to accommodate large files.</p><p>A Harness Self-Managed Enterprise Edition -
    Virtual Machine <strong>Production</strong> installation has a minimum disk space
    requirement of 400G, so there should be enough space for Internal Storage. Still,
    Harness recommends an S3 bucket or S3-compatible storage to avoid any issues.</p><p>Storage
    destinations are described in the <a href="https://kots.io/kotsadm/snapshots/storage-destinations/"
    target="_blank">KOTS documentation</a>.</p><ol><li>Log into the Harness Self-Managed
    Enterprise Edition - Virtual Machine KOTS admin tool.</li><li>Click <strong>Snapshots</strong>.</li><li>Click
    <strong>Settings &amp; Schedule</strong>.</li><li>In <strong>Storage</strong>,
    select the storage method to use.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/j917dpk2zv/1614382120437/image.png"/></figure></li><li>For
    <strong>Amazon S3</strong> and <strong>Other S3-Compatible Storage</strong>, enter
    in the location and credentials.<br/>For details on these settings, see <a href="https://kots.io/kotsadm/snapshots/storage-destinations/"
    target="_blank">Compatible Backend Stores</a> from KOTS.</li><li>Click <strong>Update
    storage settings</strong>. The settings are updated.</li></ol><p>Now that you
    have storage for your snapshots, you can create the snapshots.</p><h3>Step 2:
    Create Full or Partial Snapshots</h3><ol><li>In the KOTS admin tool, click <strong>Full
    Snapshots (Instance)</strong> or <strong>Partial Snapshots (Application)</strong>.</li><li>Click
    <strong>Start a snapshot</strong>. The snapshot begins. You can see its progress:<figure><img
    src="https://files.helpdocs.io/kw8ldg1itf/articles/j917dpk2zv/1614382801592/image.png"/></figure></li><li>Click
    the <strong>more options</strong> (<strong>︙</strong>) button. The details of
    the snapshot appear.</li></ol><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/j917dpk2zv/1614382880974/image.png"/></figure><p>That&#39;s
    it! You now have a snapshot you can use for recovery.</p><h3>Option: Automating
    Snapshots</h3><p>Scheduling snapshots is covered in the KOTS <a href="https://kots.io/kotsadm/snapshots/schedule/"
    target="_blank">Schedules</a> documentation. Here is a summary of the steps:</p><ol><li>To
    automate snapshots, click <strong>Settings &amp; Schedule</strong>.</li><li>Select
    <strong>Full snapshots</strong> or <strong>Partial snapshots</strong>.</li><li>Select
    <strong>Enable automatic scheduled snapshots</strong>.</li><li>In <strong>Schedule</strong>,
    select the schedule for the snapshot.</li><li>In <strong>Retention policy</strong>,
    define how long to keep snapshots.</li></ol><p></p><p>The retention policy is
    described by KOTS:</p><blockquote>The default retention period for snapshots is
    1 month. Setting the retention only affects snapshots created after the time of
    the change. For example, if an existing snapshot had a retention of 1 year and
    is already 6 months old, and a user then uses the UI to change the retention to
    1 month, the existing snapshot will still be around for another 6 months.</blockquote><p></p><ol><li
    style="counter-increment:li 5" start="6">Click <strong>Update schedule</strong>.
    The schedule is updated. To disable it, deselect <strong>Enable automatic scheduled
    snapshots</strong>.</li></ol><h3>Option: Restore from a Full Snapshot</h3><p>You
    can perform a full or partial restore from a Full Snapshot. This is why KOTS recommends
    Full Snapshots.</p><ol><li>Click <strong>Full Snapshots (Instance)</strong>.</li><li>Click
    the restore button.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/j917dpk2zv/1614383969838/image.png"/></figure><strong>Restore
    from backup</strong> appears.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/j917dpk2zv/1614384217821/image.png"/></figure></li><li>Select
    <strong>Full restore</strong> or <strong>Partial restore</strong>.</li><li>For
    <strong>Full restore</strong>, do the following:<ol><li>Copy the provided command
    and run it on any master node. You might need to log into the admin tool again
    after the restore.</li><li>Click <strong>Ok, got it</strong>.</li></ol></li><li>For
    <strong>Partial restore</strong>, do the following:<ol><li>Enter the slug <strong>harness</strong>.</li><li>Click
    <strong>Confirm and restore</strong>. You might need to log into the admin tool
    again after the restore.</li></ol></li></ol><p></p><h3>Option: Restore from a
    Partial Snapshot</h3><p>You can perform a partial restore using a Full or Partial
    Snapshot. The Full Snapshot steps are described above.</p><ol><li>Click <strong>Partial
    snapshots</strong>.</li><li>Click the restore button.<figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/j917dpk2zv/1614383969838/image.png"/></figure><strong>Restore
    from Partial backup (Application)</strong> appears.</li><li>Enter the slug <strong>harness</strong>.</li><li>Click
    <strong>Confirm and restore</strong>. You might need to log into the admin tool
    again after the restore.</li></ol><h3>Notes</h3><p>See the <a href="https://kots.io/kotsadm/snapshots/overview/"
    target="_blank">KOTS documentation</a> for more details on backup and recovery
    settings.</p>'
  slug: virtual-machine-on-prem-backup-and-recovery
  tags:
  - on-premise
  is_live: true
