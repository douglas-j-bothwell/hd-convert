<p>This document lists the infrastructure requirements for installing Harness Self-Managed Enterprise Edition - Kubernetes Cluster in an existing Kubernetes cluster.</p><h3>Production Installation</h3><p>Here are the requirements for each microservice.</p><table><tbody><tr><td><p><strong>Microservice</strong></p></td><td><p><strong>Pods</strong></p></td><td><p><strong>CPU / Pod</strong></p></td><td><p><strong>Memory / Pod</strong></p></td><td><p><strong>Total CPU</strong></p></td><td><p><strong>Total Memory</strong></p></td></tr><tr><td><p>Manager</p></td><td><p>2</p></td><td><p>2</p></td><td><p>4</p></td><td><p>4</p></td><td><p>8</p></td></tr><tr><td><p>Verification</p></td><td><p>2</p></td><td><p>1</p></td><td><p>3</p></td><td><p>2</p></td><td><p>6</p></td></tr><tr><td><p>Machine Learning Engine</p></td><td><p>1</p></td><td><p>8</p></td><td><p>2</p></td><td><p>8</p></td><td><p>2</p></td></tr><tr><td><p>UI</p></td><td><p>2</p></td><td><p>0.25</p></td><td><p>0.25</p></td><td><p>0.5</p></td><td><p>0.5</p></td></tr><tr><td><p>MongoDB</p></td><td><p>3</p></td><td><p>4</p></td><td><p>8</p></td><td><p>12</p></td><td><p>24</p></td></tr><tr><td><p>Proxy</p></td><td><p>1</p></td><td><p>0.5</p></td><td><p>0.5</p></td><td><p>0.5</p></td><td><p>0.5</p></td></tr><tr><td><p>Ingress</p></td><td><p>2</p></td><td><p>0.25</p></td><td><p>0.25</p></td><td><p>0.5</p></td><td><p>0.5</p></td></tr><tr><td><p>TimescaleDB</p></td><td><p>3</p></td><td><p>2</p></td><td><p>8</p></td><td><p>6</p></td><td><p>24</p></td></tr><tr><td><p>KOTS Admin Pods</p></td><td><p> </p></td><td><p> </p></td><td><p> </p></td><td><p>4</p></td><td><p>8</p></td></tr><tr><td><p><strong>Total</strong></p></td><td><p><strong> </strong></p></td><td><p><strong> </strong></p></td><td><p><strong> </strong></p></td><td><p><strong>37.5</strong></p></td><td><p><strong>73.5</strong></p></td></tr></tbody></table><p>The KOTS Admin Pods requirements are for a full stack. In an existing cluster, they will likely be lower.</p><h3>Dev Installation</h3><p>Here are the requirements for each microservice.</p><table><tbody><tr><td><p><strong>Microservice</strong></p></td><td><p><strong>Pods</strong></p></td><td><p><strong>CPU / Pod</strong></p></td><td><p><strong>Memory / Pod</strong></p></td><td><p><strong>Total CPU</strong></p></td><td><p><strong>Total Memory</strong></p></td></tr><tr><td><p>Manager</p></td><td><p>1</p></td><td><p>2</p></td><td><p>4</p></td><td><p>2</p></td><td><p>4</p></td></tr><tr><td><p>Verification</p></td><td><p>1</p></td><td><p>1</p></td><td><p>3</p></td><td><p>1</p></td><td><p>3</p></td></tr><tr><td><p>Machine Learning Engine</p></td><td><p>1</p></td><td><p>3</p></td><td><p>2</p></td><td><p>3</p></td><td><p>2</p></td></tr><tr><td><p>UI</p></td><td><p>1</p></td><td><p>0.25</p></td><td><p>0.25</p></td><td><p>0.25</p></td><td><p>0.25</p></td></tr><tr><td><p>MongoDB</p></td><td><p>3</p></td><td><p>2</p></td><td><p>4</p></td><td><p>6</p></td><td><p>12</p></td></tr><tr><td><p>Proxy</p></td><td><p>1</p></td><td><p>0.5</p></td><td><p>0.5</p></td><td><p>0.5</p></td><td><p>0.5</p></td></tr><tr><td><p>Ingress</p></td><td><p>1</p></td><td><p>0.25</p></td><td><p>0.25</p></td><td><p>0.25</p></td><td><p>0.25</p></td></tr><tr><td><p>TimescaleDB</p></td><td><p>1</p></td><td><p>2</p></td><td><p>8</p></td><td><p>2</p></td><td><p>8</p></td></tr><tr><td><p>Kots Admin Pods</p></td><td><p> </p></td><td><p> </p></td><td><p> </p></td><td><p>4</p></td><td><p>8</p></td></tr><tr><td><p><strong>Total</strong></p></td><td><p><strong> </strong></p></td><td><p><strong> </strong></p></td><td><p><strong> </strong></p></td><td><p><strong>19</strong></p></td><td><p><strong>38</strong></p></td></tr></tbody></table><p></p><h3>Recommended Nodes Specifications</h3><p>Node Specifications: 8 cores vCPU, greater than 12 GB memory.</p><h3>Storage Requirements</h3><p>You should have a Kubernetes Storage Class attached to the Kubernetes cluster.</p><p>You need to provide the StorageClass name during installation.</p><p>Harness uses a total 1000 GB of space distributed as:</p><ul><li>MongoDB - 3 pods * 200 GB each = 600 GB</li><li>Timescale DB - 3 pods * 120 GB each = 360 GB</li><li>Redis: 40 GB total</li><li>Note: For POC installation, total requirement will be: 200 GB total</li><li>MongoDB - 3 pods * 50 GB each = 150 GB</li><li>Timescale DB - 1 pods * 20 GB each = 20 GB</li><li>Redis: 30 GB total</li></ul><h3>Whitelist and Outbound Access Requirements</h3><p>Whitelist the following URLs:</p><ul><li>kots.io — Kots pulls the latest versions of the kubectl plugin and Kots admin console.</li><li>app.replicated.com — Kots admin console connects to check for the availability of releases according to your license</li><li>proxy.replicated.com — Proxy your registry to pull your private images.</li></ul><p>Outbound access to the following URLs:</p><ul><li>proxy.replicated.com​</li><li>replicated.app</li><li>k8s.kurl.sh​</li><li>app.replicated.com</li></ul><div class="note-callout">The outbound access is required for a <strong>connected install only</strong>. If you have opted for <a href="https://kots.io/kotsadm/installing/airgap-packages/" target="_blank">Airgap mode</a>, this is not required.</div><p>If your cluster does not have direct outbound connectivity and needs a proxy for outbound connections, use these instructions: <a href="https://docs.docker.com/network/proxy/">https://docs.docker.com/network/proxy</a> to set up a proxy on the node machines.</p><h3>Cluster and Network Architecture</h3><p>The following diagram illustrates the simple cluster and networking architecture for an Harness Self-Managed Enterprise Edition - Kubernetes Cluster setup.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/hmza5cvxib/1650919732455/clean-shot-2022-04-25-at-13-48-40.png"/></figure><p>The following sections go into greater detail.</p><h3>Namespace Requirements</h3><p>In the examples in all Harness Self-Managed Enterprise Edition documentation, we use namespace named <code>harness</code>.</p><p>If can use a different namespace, ensure that you update any spec samples provided by Harness.</p><h3>Load Balancer</h3><p>You need to set up a Load Balancer before installing Harness Self-Managed Enterprise Edition.</p><p>During installation, you will provide the Load Balancer URL in the KOTS admin console.</p><p>After Harness Self-Managed Enterprise Edition is installed, the load balancer is used to access the Harness Manager UI using a web browser.</p><p>Follow the steps on creating the load balancer as part of the process described in <a href="/article/v6x4n5j9lv-kubernetes-on-prem-existing-cluster-setup">Harness Self-Managed Enterprise Edition - Kubernetes Cluster Setup</a>.</p><h5 id="undefined">Port Mapping for gRPC Traffic</h5><p>You also need to open port 9879 on the Load Balancer and map it to port 9879 on the Ingress controller. This is to support gRPC traffic.</p><h3>Trusted Certificate Requirement for Harness Self-Managed Enterprise Edition</h3><p>All connections to the Harness Manager can be secure or unencrypted according to the URL scheme you use when you configure the Load Balancer URL during installation (<code>https://</code> or <code>http://</code>):</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1604688719498/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>For secure connections from any integration into the Harness Manager (Github Webhooks, etc), including the <strong>Harness Delegate</strong>, you must use a <u>publicly trusted certificate</u>.</p><p>Harness does not support self-signed certificates for connections to the Harness Manager.</p><p>For connections from the Harness Manager outbound to an integration, you can use a self-signed certificate. In this case, you must import the self-signed certificate into Harness Delegate&#39;s JRE keystore manually or using a Harness <a href="https://docs.harness.io/article/yd4bs0pltf-run-scripts-on-the-delegate-using-profiles">Delegate Profile</a>.</p><p>See <a href="/article/8bj3v5jqzk-add-self-signed-certificates-for-delegate-connections">Add Self-Signed Certificates for Delegate Connections</a>.</p><div class="note-callout">You can use self-signed certs for TLS connections between the MongoDB that ships with Harness and the Harness microservices. See <a href="/article/kgvg58wg1g-on-prem-embedded-cluster-setup#enable_tls_ssl_between_mongo_db_and_harness_components">Enable TLS/SSL between MongoDB and Harness Components</a>.</div><h3>Install Harness Self-Managed Enterprise Edition</h3><p>Now that you have set up the requirements, proceed with installation in <a href="/article/v6x4n5j9lv-kubernetes-on-prem-existing-cluster-setup">Harness Self-Managed Enterprise Edition - Kubernetes Cluster Setup</a>.</p><p></p><p></p><p></p><p></p><p></p>