<p>This topic covers installing Harness Self-Managed Enterprise Edition - Kubernetes Cluster in an existing Kubernetes cluster.</p><div class="note-callout">We assume that you are very familiar with Kubernetes, and can perform the standard Kubernetes and managing configurations using <a href="https://kubernetes.io/docs/tasks/manage-kubernetes-objects/kustomization/" target="_blank">Kustomize</a> overlays.</div><p>Harness Self-Managed Enterprise Edition - Kubernetes Cluster uses the <a href="https://kots.io/kots-cli/getting-started/" target="_blank">KOTS kubectl plugin</a> for installation. This topic covers installing KOTS in your existing cluster as part of setting up Harness Self-Managed Enterprise Edition.</p><p>Installing Harness Self-Managed Enterprise Edition into an existing Kubernetes cluster is a simple process where you prepare your existing cluster and network, and use the KOTS admin tool and Kustomize to complete the installation and deploy Harness.</p><h3>Cluster Requirements</h3><p>Do not perform any of the steps in this topic until you have set up the requirements in the <a href="/article/hmza5cvxib-existing-cluster-kubernetes-on-prem-infrastructure-requirements">Harness Self-Managed Enterprise Edition - Kubernetes Cluster: Infrastructure Requirements</a> topic.</p><h3>Summary</h3><p>Installing Harness in an existing cluster is performed as a <a href="https://kots.io/kotsadm/installing/installing-a-kots-app/#existing-cluster-or-embedded-kubernetes" target="_blank">KOTS Existing Cluster Online Install</a>.</p><p>This simply means that you are using an existing Kubernetes cluster, as opposed to bare metal or VMs, and that your cluster can make outbound internet requests for an online installation.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1596470762187/image.png" style="display:block;margin-left:auto;margin-right:auto" data-hd-align="center"/></figure><h3>Step 1: Set up Cluster Requirements</h3><p>As stated earlier, follow the steps in the <a href="/article/hmza5cvxib-existing-cluster-kubernetes-on-prem-infrastructure-requirements">Harness Self-Managed Enterprise Edition - Kubernetes Cluster: Infrastructure Requirements</a> topic to ensure you have your cluster set up correctly.</p><p>These requirements also include RBAC settings that might require your IT administrator to assist you unless your user account is bound to the <code>cluster-admin</code> Cluster Role.</p><p>Specifically, you need to create a KOTS admin Role and bind it to the user that will install Harness. You also need to create a Harness ClusterRole.</p><h3>Step 2: Set Up Networking Requirements</h3><p>Perform the following steps to ensure that you have the Load Balancer set up for Harness Self-Managed Enterprise Edition.</p><p>Later, when you set up the kustomization for Harness Self-Managed Enterprise Edition, you will provide an IP address for the cluster load balancer settings.</p><p>Finally, when you configure the Harness Self-Managed Enterprise Edition application, you will provide the Load Balancer URL. This URL is what Harness Self-Managed Enterprise Edition users will use.</p><h4>Using NodePort?</h4><p>If you are creating the load balancer&#39;s Service type using NodePort, create a load balancer that points to any port in range 30000-32767 on the node pool on which the Kubernetes cluster is running.</p><p>If you are using NodePort, you can skip to <a href="/article/v6x4n5j9lv-kubernetes-on-prem-existing-cluster-setup#step_3_install_kots">Step 3: Install KOTS</a>.</p><h4>Set Up Static External IP</h4><p>You should have a static IP reserved to expose Harness outside of the Kubernetes cluster.</p><p>For example, in the GCP console, click <strong>VPC network</strong>, and then click <strong>External IP Addresses</strong>.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/voxht9rqkr/1592599157533/image.png"/></figure><p>For more information, see <a href="https://cloud.google.com/compute/docs/ip-addresses/reserve-static-external-ip-address" target="_blank">Reserving a static external IP address</a>.</p><div class="note-callout">For GCP, the External IP address must be <a href="https://cloud.google.com/network-tiers/docs/overview#premium_tier" target="_blank">Premium Tier</a>.</div><h4>Set Up DNS</h4><p>Set up DNS to resolve the domain name you want to use for Harness Self-Managed Enterprise Edition to the static IP address you reserved in the previous step.</p><p>For example, the domain name <strong>harness.abc.com</strong> would resolve to the static IP:</p><pre>host harness.abc.com<br/>harness.abc.com has address 192.0.2.0</pre><p>The above DNS setup can be tested by running <code>host &lt;domain_name&gt;</code>.</p><h3>Review: OpenShift Clusters</h3><p>If you will be using OpenShift Clusters, run the following commands after installing the KOTS plugin, but before installing Harness:</p><pre>oc adm policy add-scc-to-user anyuid -z harness-serviceaccount -n harness</pre><pre>oc adm policy add-scc-to-user anyuid -z harness-default -n harness</pre><pre>oc adm policy add-scc-to-user anyuid -z default -n harness</pre><p></p><p>Once you&#39;ve installed Harness and you want to install a Harness Kubernetes Delegate, see <a href="#delegates_and_open_shift">Delegates and OpenShift</a>.</p><h3>Option 1: Disconnected Installation (Airgap)</h3><p>The following steps will install KOTS from your private repo and the Harness Self-Managed Enterprise Edition license and airgap file you obtain from Harness.</p><ol><li>Download the latest KOTS (kotsadm.tar.gz) release from <a href="https://github.com/replicatedhq/kots/releases" target="_blank">https://github.com/replicatedhq/kots/releases</a>.</li><li>Push KOTS images to your private registry:<br/><pre>kubectl kots admin-console push-images ./kotsadm.tar.gz &lt;private.registry.host&gt;/harness \<br/>--registry-username &lt;rw-username&gt; \<br/>--registry-password &lt;rw-password&gt;</pre></li><li>Obtain the Harness license file from your Harness Customer Success contact or email <a href="https://mail.google.com/mail/?view=cm&amp;fs=1&amp;tf=1&amp;to=support@harness.io" target="_blank">support@harness.io</a>.</li><li>Obtain the Harness airgap file from Harness.</li><li>Log into your cluster.</li><li>Install KOTS and Harness using the following command:</li></ol><pre>kubectl kots install harness <br/>--namespace harness<br/>--shared-password &lt;password&gt; <br/>--license-file &lt;path to license.yaml&gt;<br/>--config-values &lt;path to configvalues.yaml&gt;<br/>--airgap-bundle &lt;path to harness-&lt;version&gt;.airgap&gt;<br/>--kotsadm-registry &lt;private.registry.url&gt;<br/>--registry-username &lt;rw-username&gt; <br/>--registry-password &lt;rw-password&gt;</pre><p></p><p>Notes:</p><ul><li>The <code>--namespace</code> parameter uses the namespace you created in <a href="/article/hmza5cvxib-existing-cluster-kubernetes-on-prem-infrastructure-requirements">Harness Self-Managed Enterprise Edition - Kubernetes Cluster: Infrastructure Requirements</a>. in this documentation, we use the namespace <strong>harness</strong><strong>.</strong></li><li>For the <code>--shared-password</code> parameter, enter a password for the KOTS admin console. You will use this password to log into the KOTS admin tool.</li><li>The <code>--config-values</code> parameter is only needed if you use a config-values files, as described in <a href="https://kots.io/kotsadm/installing/automating/#config-values" target="_blank">Config Values</a> from KOTS.</li></ul><p>In the terminal, it will look like this:</p><pre>  • Deploying Admin Console<br/>    • Creating namespace ✓  <br/>    • Waiting for datastore to be ready ✓  </pre><p>The KOTS admin tool URL is provided:</p><pre>  • Waiting for Admin Console to be ready ✓  <br/><br/>  • Press Ctrl+C to exit<br/>  • Go to http://localhost:8800 to access the Admin Console</pre><p>Use the URL provided in the output to open the KOTS admin console in a browser.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593543936446/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Enter the password you provided earlier, and click <strong>Log In</strong>.</p><p>You might be prompted to allow a port-forward connection into the cluster.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593544048482/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Now that KOTS and Harness are installed, you can perform the necessary configurations.</p><h3>Option 2: Connected Installation</h3><p>The following steps will install KOTS and Harness Self-Managed Enterprise Edition online. There is also an option to use a Harness Self-Managed Enterprise Edition airgap file instead of downloading Harness Self-Managed Enterprise Edition.</p><h4>Install KOTS Plugin</h4><ol><li>Log into your cluster.</li><li>Install the KOTS kubectl plugin using the following command:</li></ol><p><code>curl https://kots.io/install | bash</code></p><p>The output of the command is similar to this:</p><pre>Installing replicatedhq/kots v1.16.1<br/>(https://github.com/replicatedhq/kots/releases/download/v1.16.1/kots_darwin_amd64.tar.gz)...<br/>############################################# 100.0%#=#=-#  #<br/>############################################# 100.0%<br/>Installed at /usr/local/bin/kubectl-kots</pre><p>To test the installation, run this command:</p><p><code>kubectl kots --help</code></p><p>The KOTS help appears.</p><p>Now that KOTS is installed, you can install Harness Self-Managed Enterprise Edition into your cluster.</p><h4>Install KOTS</h4><p>To install the KOTS Admin tool, enter the following command:</p><p><code>kubectl kots install harness</code></p><p>You are prompted to enter the namespace for the Harness installation. This is the namespace you created in <a href="/article/hmza5cvxib-existing-cluster-kubernetes-on-prem-infrastructure-requirements">Harness Self-Managed Enterprise Edition - Kubernetes Cluster: Infrastructure Requirements</a>.</p><p>In this documentation, we use the namespace <strong>harness</strong>.</p><p>In the terminal, it will look like this:</p><pre>Enter the namespace to deploy to: harness<br/>  • Deploying Admin Console<br/>    • Creating namespace ✓  <br/>    • Waiting for datastore to be ready ✓  </pre><p>Enter a password for the KOTS admin console and hit Enter. You will use this password to log into the KOTS admin tool.</p><p>The KOTS admin tool URL is provided:</p><pre>Enter a new password to be used for the Admin Console: ••••••••<br/>  • Waiting for Admin Console to be ready ✓  <br/><br/>  • Press Ctrl+C to exit<br/>  • Go to http://localhost:8800 to access the Admin Console</pre><p>Use the URL provided in the output to open the KOTS admin console in a browser.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593543936446/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Enter the password you provided earlier, and click <strong>Log In</strong>.</p><p>You might be prompted to allow a port-forward connection into the cluster.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593544048482/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><h4>Upload Your Harness License</h4><p>Once you are logged into the KOTS admin console, you can upload your Harness license.</p><p>Obtain the Harness license file from your Harness Customer Success contact or email <a href="mailto:support@harness.io">support@harness.io</a>.</p><p>Drag your license YAML file into the KOTS admin tool:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593544168266/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Next, upload the license file:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593544350008/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Click <strong>Upload license</strong>.</p><p>Now that license file is uploaded, you can install Harness.</p><h4>Download Harness over the Internet</h4><p>If you are installing Harness over the Internet, click the <strong>download Harness from the Internet</strong> link.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593544532503/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><p>KOTS begins installing Harness into your cluster.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593544576040/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Next, you will configure Harness.</p><h3>Step 3: Configure Harness</h3><p>Now that you have added your license you can configure the networking for the Harness installation.</p><div class="note-callout">If the KOTS Admin tool is not running, point <code>kubectl</code> to the cluster where Harness is deployed and run the following command: <code>kubectl kots admin-console --namespace harness</code></div><p>In the KOTS admin tool, the <strong>Configure Harness</strong> settings appear.</p><p>Harness Self-Managed Enterprise Edition - Kubernetes Cluster requires that you provide a NodePort and Application URL.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1608063321994/image.png"/></figure><h4>Mode</h4><ul><li>Select <strong>Demo</strong> to run Harness Self-Managed Enterprise Edition in demo mode and experiment with it.</li><li>Select <strong>Production HA</strong> to run a production version of Harness Self-Managed Enterprise Edition.</li></ul><p></p><h4>Ingress Service Type</h4><p>By default, nginx is used for Ingress automatically. If you are deploy nginx separately, do the following:</p><ol><li>Click <strong>Advanced Configurations</strong>.</li><li>Disable the <strong>Install Nginx Ingress Controller</strong> option.</li></ol><h5>External Traffic Policy</h5><p>You can select the external traffic policy for the Ingress controller.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1631053773578/clean-shot-2021-09-07-at-15-29-25.png"/></figure><p>Select one of the following:</p><ul><li>Cluster</li><li>Local</li></ul><p>For information on how these options work, see <a href="https://kubernetes.io/docs/tasks/access-application-cluster/create-external-load-balancer/#preserving-the-client-source-ip" target="_blank">Preserving the client source IP</a> from Kubernetes.</p><h4>NodePort</h4><p>Enter any port in the range 30000-32767 on the node pool on which the Kubernetes cluster is running.</p><p>If you do not enter a port, Harness uses 32500 by default.</p><h4>External Loadbalancer</h4><p>Enter the IP address of the Load Balancer.</p><h4>Application URL</h4><p>Enter the URL users will enter to access Harness. This is the DNS domain name mapped to the Load Balancer IP.</p><p>When you are done, click <strong>Continue</strong>.</p><h4>Host Name</h4><p>The hostname is the DNS name or IP address of the Load Balancer.</p><h4>Storage Class</h4><p>You can also add a Storage Class. The name of the Storage Class depends on the provider where you are hosting your Kubernetes cluster. See <a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#parameters" target="_blank">Storage Classes</a> from Kubernetes.</p><p>If you don&#39;t provide a name, Harness will use <code>default</code>.</p><p>Once you have Harness Self-Managed Enterprise Edition installed, you can just run the following command to get the Storage Classes in the namespace (in this example, <strong>harness</strong>):</p><p><code>kubectl get storageclass -n harness</code></p><p>Enter the name of the Storage Class.</p><p></p><h4>Option: Advanced Configurations</h4><p>In the <strong>Advanced Configurations</strong> section, there are a number of advanced settings you can configure. If this is the first time you are setting up Harness Self-Managed Enterprise Edition, there&#39;s no reason to fine tune the installation with these settings.</p><p>You can change the settings later in the KOTS admin console&#39;s Config tab:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593545725176/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><h3>Step 4: Perform Preflight Checks</h3><p>Preflight checks run automatically and verify that your setup meets the minimum requirements.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593545769365/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>You can skip these checks, but we recommend you let them run.</p><p>Fix any issues in the preflight steps. A common example is the message:</p><pre>Your cluster meets the minimum version of Kubernetes, but we recommend you update to 1.15.0 or later.</pre><p>You can update your cluster&#39;s version of Kubernetes if you like.</p><p></p><h3>Step 5: Deploy Harness</h3><p>When you are finished pre-flight checks, click <strong>Deploy and</strong> <strong>Continue</strong>.</p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1608066016585/image.png"/></figure><p></p><p>Harness is deployed in a few minutes.</p><p>In a new browser tab, go to the following URL, replacing <code>&lt;LB_URL&gt;</code> with the URL you entered in the <strong>Application URL</strong> setting in the KOTS admin console:</p><p><code>&lt;LB_URL&gt;/auth/#/signup</code></p><p>For example:</p><p><code>http://harness.mycompany.com/auth/#/signup</code></p><p>The Harness sign up page appears.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/kgvg58wg1g/1648592863659/clean-shot-2022-03-29-at-15-27-33.png"/></figure><p>Sign up with a new account and then sign in.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/kgvg58wg1g/1648592928001/clean-shot-2022-03-29-at-15-27-52.png"/></figure><p>Your new account will be added to the Harness Account Administrators User Group.</p><p>See <a href="/article/ven0bvulsj-users-and-permissions">Managing Users and Groups (RBAC)</a>.</p><h4>Future Versions</h4><p>To set up future versions of Harness Self-Managed Enterprise Edition, in the KOTS admin console, in the <strong>Version history</strong> tab, click <strong>Deploy</strong>. The new version is displayed in Deployed version.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593545900180/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p></p><h3>Important Next Steps</h3><div class="note-callout"><strong>Important:</strong> You cannot invite other users to Harness until a Harness Delegate is installed and a Harness SMTP Collaboration Provider is configured.</div><ol><li>Install the Harness Delegate: <a href="/article/igftn7rrtg-delegate-installation-overview">Delegate Installation Overview</a>.</li><li>Set up an SMTP Collaboration Provider in Harness for email notifications from the Harness Manager: <a href="/article/8nkhcbjnh7-add-smtp-collaboration-provider">Add SMTP Collaboration Provider</a>.<br/>Ensure you open the correct port for your SMTP provider, such as <a href="https://support.office.com/en-us/article/server-settings-you-ll-need-from-your-email-provider-c82de912-adcc-4787-8283-45a1161f3cc3">Office 365</a>.</li><li><a href="/article/uuer539u3l-add-a-secrets-manager">Add a Harness Secrets Manager</a>. By default, Harness Self-Managed Enterprise Edition installations use the local Harness MongoDB for the default Harness Secrets Manager. This is not recommended.<br/>After Harness Self-Managed Enterprise Edition installation, configure a new Secret Manager (Vault, AWS, etc). You will need to open your network for the Secret Manager connection.</li></ol><h4>Delegates and OpenShift</h4><p>If you are deploying the Harness Kubernetes Delegate into an OpenShift cluster, you need to edit the Harness Kubernetes Delegate YAML before installing the Delegate.</p><p>You simply need to point to the OpenShift image.</p><p>Here&#39;s the default YAML with <code>harness/delegate:latest</code>:</p><pre>...<br/>apiVersion: apps/v1<br/>kind: StatefulSet<br/>...<br/>    spec:<br/>      containers:<br/>      - image: harness/delegate:latest</pre><p></p><p>Change the <code>image</code> entry to <code>harness/delegate:non-root-openshift</code>:</p><pre>...<br/>apiVersion: apps/v1<br/>kind: StatefulSet<br/>...<br/>    spec:<br/>      containers:<br/>      - image: harness/delegate:non-root-openshift</pre><h3>Updating Harness</h3><div class="note-callout"><strong>Do not upgrade Harness past 4 major releases.</strong> Instead, upgrades each interim release until you upgrade to the latest release. A best practice is to upgrade Harness once a month.</div><p>Please follow these steps to update your Harness Self-Managed Enterprise Edition installation.</p><p>The steps are very similar to how you installed Harness initially.</p><p>For more information on updating KOTS and applications, see <a href="https://kots.io/kotsadm/updating/updating-kots-apps/#using-cli" target="_blank">Using CLI</a> and <a href="https://kots.io/kotsadm/updating/updating-admin-console/" target="_blank">Updating the Admin Console</a> from KOTS.</p><h4>Disconnected (Airgap)</h4><p>The following steps require a private registry, just like the initial installation of Harness.</p><h5>Upgrade Harness</h5><ol><li>Download the latest release from Harness.</li><li>Run the following command on the cluster hosting Harness, replacing the placeholders:</li></ol><pre class="hljs bash">kubectl kots upstream upgrade harness \ <br/>--airgap-bundle &lt;path to harness-&lt;version&gt;.airgap&gt; \<br/>--kotsadm-registry &lt;private.registry.url&gt; \<br/>--registry-username &lt;username&gt; \<br/>--registry-password &lt;password&gt; \<br/>--deploy \<br/>-n harness</pre><h5>Upgrade KOTS Admin Tool</h5><p>To upgrade the KOTS admin tool, first you will push images to your private Docker registry.</p><ol><li>Run the following command to push the images, replacing the placeholders:</li></ol><pre class="hljs bash">kubectl kots admin-console push-images ./&lt;new-kotsadm&gt;.tar.gz \<br/>&lt;private.registry.host&gt;/harness \<br/>--registry-username rw-username \<br/>--registry-password rw-password</pre><ol><li style="counter-increment:li 1" start="2">Next, run the following command on the cluster hosting Harness, replacing the placeholders:</li></ol><pre class="hljs bash">kubectl kots admin-console upgrade \ <br/>--kotsadm-registry &lt;private.registry.host&gt;/harness \<br/>--registry-username rw-username \<br/>--registry-password rw-password \<br/>-n harness</pre><h4>Connected</h4><p>The following steps require a secure connection to the Internet, just like the initial installation of Harness.</p><h5>Upgrade Harness</h5><ol><li>Run the following command on the cluster hosting Harness:</li></ol><pre class="hljs bash">kubectl kots upstream upgrade harness --deploy -n harness</pre><h5>Upgrade KOTS Admin Tool</h5><ol><li>Run the following command on the cluster hosting Harness:</li></ol><pre class="hljs bash">kubectl kots admin-console upgrade -n harness</pre><h3>Monitoring Harness</h3><p>Harness monitoring is performed using the built in monitoring tools.</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1594857436751/image.png"/></figure><p>For steps on using the monitoring tools, see <a href="https://kots.io/kotsadm/monitoring/prometheus/" target="_blank">Prometheus</a> from KOTS.</p><h3>License Expired</h3><p>If your license has expired, you will see something like the following:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1593544662234/image.png" style="max-height:50%;max-width:50%" data-hd-height="50%" data-hd-width="50%"/></figure><p>Contact your Harness Customer Success representative or <a href="mailto:support@harness.io">support@harness.io</a>.</p><h3>Bring Down Harness Cluster for Planned Downtime</h3><p>If you need to bring down the Harness cluster for any reason, you simply scale down the Harness Manager and Verification Service deployments to zero replicas. That is sufficient to stop background tasks and remove connections to the database.</p><p>Next, optionally, you can scale everything else down if needed, but it is not necessary.</p><p>To bring Harness back up, first ensure the Harness MongoDB is scaled up to 3 instances and Redis is scaled up also. Next, scale up the Harness Manager and Verification Service.</p><h3>Logging</h3><p>For Harness Self-Managed Enterprise Edition - Kubernetes Cluster, logs are available as standard out.</p><p>Use <code>kubectl get logs</code> on any pod to see the logs.</p><h3>Enable TLS/SSL between MongoDB and Harness Components</h3><p>You can now enable a TLS/SSL connection between the Harness Self-Managed Enterprise Edition components (microservices) and the MongoDB database that is included in Harness Self-Managed Enterprise Edition.</p><p>You can use public or self-signed certs.</p><p>Simply select <strong>True</strong> in <strong>Mongo Use SSL</strong> and then upload your ca.pem, client.pem, and mongo.pem files:</p><p></p><figure><img src="https://files.helpdocs.io/kw8ldg1itf/articles/v6x4n5j9lv/1630534726016/image.png"/></figure><p></p><details><summary>Instructions for creating self signed certs</summary><div><pre class="hljs bash"># Create CA <br/><br/> openssl req -passout pass:password -new -x509 -days 3650 -extensions v3_ca -keyout ca_private.pem -out ca.pem -subj &#34;/CN=CA/OU=MONGO/O=HARNESS/L=SFO/ST=CA/C=US&#34; -config /usr/local/etc/openssl@1.1/openssl.cnf<br/><br/># Create Client key<br/><br/>openssl req -newkey rsa:4096 -nodes -out client.csr -keyout client.key -subj &#39;/CN=MC/OU=MONGO_CLIENTS/O=HARNESS/L=SFO/ST=CA/C=US&#39;<br/>Generating a 4096 bit RSA private key<br/><br/># Create Server key<br/><br/>openssl req -newkey rsa:4096 -nodes -out mongo.csr -keyout mongo.key -subj &#39;/CN=*.mongodb-replicaset-chart.&lt;namespace&gt;.svc.cluster.local/OU=MONGO/O=HARNESS/L=SFO/ST=CA/C=US&#39;<br/>Generating a 4096 bit RSA private key<br/><br/><br/>* Please change &lt;namespace&gt; to namespace name where Harness is installed / will be installed*<br/><br/># Get Client crt<br/><br/>openssl x509 -passin pass:password -sha256 -req -days 365 -in client.csr -CA ca.pem -CAkey ca_private.pem -CAcreateserial -out client_signed.crt<br/><br/># Get Server crt<br/><br/>openssl x509 -passin pass:password -sha256 -req -days 365 -in mongo.csr -CA ca.pem -CAkey ca_private.pem -CAcreateserial -out mongo_signed.crt -extensions v3_req -extfile &lt;(<br/>cat &lt;&lt;EOF<br/>[ v3_req ]<br/>subjectAltName = @alt_names<br/><br/>[ alt_names ]<br/>DNS.1 = 127.0.0.1<br/>DNS.2 = localhost<br/>DNS.3 = *.mongodb-replicaset-chart.&lt;namespace&gt;.svc.cluster.local<br/>EOF<br/>)<br/># Please change &lt;namespace&gt; to namespace name where Harness is installed / will be installed<br/><br/># Combine Client crt and key to get client.pem<br/><br/>cat client_signed.crt client.key &gt;client.pem<br/><br/># Combine Server crt and key to get mongo.pem<br/><br/>cat mongo_signed.crt mongo.key &gt; mongo.pem</pre></div></details><p>Now you have the ca.pem, client.pem and mongo.pem files.</p><p>Upload all files into the <strong>Mongo Use SSL</strong> settings.</p><h3>Notes</h3><p>Harness Self-Managed Enterprise Edition installations do not currently support the Harness <a href="/article/6n7fon8rit-using-the-helm-delegate">Helm Delegate</a>.</p><h3>Remove Previous kustomization for Ingress Controller</h3><p><strong>This option is only needed if you have installed Harness Self-Managed Enterprise Edition previously.</strong> If this is a fresh install, you can go directly to <a href="#step_4_configure_harness">Configure Harness</a>.</p><p>If you have installed Harness Self-Managed Enterprise Edition previously, you updated Harness manifests using kustomize for the ingress controller. This is no longer required.</p><p>Do the following to remove the kustomization as follows:</p><ol><li>If you are using a single terminal, close the KOTS admin tool (Ctrl+C).</li><li>Ensure <code>kubectl</code> is pointing to the cluster.</li><li>Run the following command:</li></ol><pre>kubectl kots download --namespace harness --slug harness</pre><div class="note-callout">This example assumes we are installing Harness in a namespace named <strong>harness</strong>. Please change the namespace according to your configuration.</div><p>This command will download a folder named <strong>harness</strong> in your current directory.</p><ol><li style="counter-increment:li 3" start="4">In the <strong>harness</strong> folder, open the file <strong>kustomization.yaml</strong>:</li></ol><pre>vi harness/overlays/midstream/kustomization.yaml </pre><ol><li style="counter-increment:li 4" start="5">In <code>patchesStrategicMerge</code> <strong>remove</strong> <code>nginx-service.yaml</code>.</li><li>Save the file.</li><li>Remove the nginx-service.yaml file:</li></ol><pre>rm -rf harness/overlays/midstream/nginx-service.yaml</pre><ol><li style="counter-increment:li 7" start="8">Upload Harness:</li></ol><pre>kubectl kots upload --namespace harness --slug harness ./harness</pre><ol><li style="counter-increment:li 8" start="9">Open the KOTS admin tool, and then deploy the uploaded version of Harness.</li></ol><p></p><p></p><p></p>